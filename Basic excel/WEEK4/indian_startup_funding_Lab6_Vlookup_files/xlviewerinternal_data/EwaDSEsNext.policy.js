'use strict';(window.dullscriptWebpackJsonp=window.dullscriptWebpackJsonp||[]).push([[59],{1436:function(u,D,a){a.r(D);var c=a(0),b=a(15),e=a(84),f=a(848),d=a(187);class h{constructor(cc,Wc,id=null){this.id=cc.Id;id||(id="");this.xdj=id;this.sensitivityLabel=cc}}Object(c.a)(h,"AutoPolicyLabelData",null,[]);class m{constructor(cc,Wc){this.QP=cc;this.displayName=Wc}}Object(c.a)(m,"PolicyLabelRequestState",null,[]);var l=a(146),v=a(4),t=a(152),z=a(14),r=a(45),n=a(30);class w{static get Lud(){return w.Lxi}}
w.Lxi="<div class='WACDialogRow' id='JustificationMessageBlock'> <div class='WACDialogIcon' id='JustificationIconArea'> <div class='clip32x32' id='JustificationIconClip' unselectable='on' style='z-index: 0; display: inline-block;'> <img id='iconJustification' class='{1}' role='presentation' src={0} /> </div> </div> <div class='WACDialogTextPanel WACJustificationDialogMessage' id='JustificationMessageArea'> <label id='messageJustification' class='WACDialogLabel' >{2}</label> </div> </div> <br/> <div class='WACDialogTextPanel WACJustificationDialogRow' id='JustificationDlgBlock0'> <input type='radio' id='radiobox0' name='ListRadioBox' class='WACDialogRadio' alt='{3}' title='{3}'></input> <label id='JustificationDlgList0' class='WACDialogLabel' for='radiobox0' >{3}</label> </div> <div class='WACDialogTextPanel WACJustificationDialogRow' id='JustificationDlgBlock1'> <input type='radio' id='radiobox1' name='ListRadioBox' class='WACDialogRadio' alt='{4}' title='{4}'></input> <label id='JustificationDlgList1' class='WACDialogLabel' for='radiobox1' >{4}</label> </div> <div class='WACDialogTextPanel WACJustificationDialogRow' id='JustificationDlgBlock2'> <input type='radio' id='radiobox2' name='ListRadioBox' class='WACDialogRadio' alt='{5}' title='{5}'></input> <label id='JustificationDlgList2' class='WACDialogLabel' for='radiobox2' >{5}</label> </div> <div class='WACDialogTextPanel WACJustificationDialogRow WACJustificationDialogTextAreaRow' id='JustificationTextAreaBlock'> <textarea id='txtJustification' class='JustificationTextArea' placeholder='{6}' style='border:solid 1px grey;resize:none;' autocomplete=\"off\"></textarea> </div>";
Object(c.a)(w,"JustificationDialogHtml",null,[]);class B extends l.a{constructor(cc,Wc){super(!1,!1,B.Wu);this.Zqa=[CommonUIStrings.l_SensitivityJustificationNoLongerApplies,CommonUIStrings.l_SensitivityJustificationIncorrect,CommonUIStrings.l_SensitivityJustificationOther];this.lXb=null;this.jXb=!1;this.WXb=cc;this.rE=Wc;this.ng=this.hYg();this.Rb=1;this.Ee=B.id;this.oc(1,CommonUIStrings.l_DialogChange);this.GL(1,!1);this.V0(0)}uVd(){if(B.Wu)this.initializeAndShow(CommonUIStrings.l_SensitivityJustificationTitle,
Object(e.a)(this,this.dRf,"reactJustificationDialogHandler"),this.q6e(this.jXb));else{const cc={};for(let Wc=0;Wc<this.Zqa.length;Wc++)cc[B.hJd+Wc]=!1;cc[B.fPb]="";this.initializeAndShow(CommonUIStrings.l_SensitivityJustificationTitle,Object(e.a)(this,this.Kxi,"justificationDialogHandler"),cc);this.rfj();r.a.addHandler($get(B.fPb),z.a.input,Object(e.a)(this,this.VQj,"textAreaHandler"))}}validate(){if(B.Wu)return this.Lkg(this.lXb);const cc=$get(B.fPb);return cc.disabled?!0:this.Lkg(cc.value)}Lkg(cc){const Wc=
2>cc.length,id=500<cc.length,Tc=RegExp("[{|}|;|\\\\]").test(cc);cc=""===n.a.ruc(cc);return!Wc&&!id&&!Tc&&!cc}Kxi(cc,Wc){let id="";if(1===cc)for(let Tc=0;Tc<this.Zqa.length;Tc++)if(Wc[B.hJd+Tc]){id=Tc===this.Zqa.length-1?Wc[B.fPb]:this.Zqa[Tc];break}this.rE(cc,this.WXb,id)}dRf(cc){let Wc="";1===cc&&this.lXb&&(Wc=this.lXb);this.rE(cc,this.WXb,Wc)}EVi(cc){this.lXb=cc;cc=this.validate();this.jXb!==cc&&(this.jXb=cc,this.YUa(CommonUIStrings.l_SensitivityJustificationTitle,Object(e.a)(this,this.dRf,"reactJustificationDialogHandler"),
this.q6e(this.jXb)))}q6e(cc){return{["id"]:this.Ee,["bodyControls"]:{["choiceGroupProps"]:{},["textAreaProps"]:{["placeholder"]:CommonUIStrings.l_SensitivityJustificationPlaceholder}},["actionButtonProps"]:{["label"]:CommonUIStrings.l_DialogChange,["disabled"]:!cc},["infoMessage"]:CommonUIStrings.l_SensitivityJustificationMessage,["justificationIrrelevantLabel"]:CommonUIStrings.l_SensitivityJustificationNoLongerApplies,["justificationIncorrectLabel"]:CommonUIStrings.l_SensitivityJustificationIncorrect,
["justificationOtherLabel"]:CommonUIStrings.l_SensitivityJustificationOther,["onJustificationUpdated"]:Object(e.a)(this,this.EVi,"onJustificationUpdated")}}VQj(cc){cc.target&&this.GL(1,this.validate())}hYg(){return l.a.iq(B.Lud,v.AFrameworkApplication.yB,t.getImageClass(B.iconName),CommonUIStrings.l_SensitivityJustificationMessage,this.Zqa[0],this.Zqa[1],this.Zqa[2],CommonUIStrings.l_SensitivityJustificationPlaceholder)}rfj(){const cc=document.getElementsByName(B.jAi);for(let Wc=0;Wc<cc.length;Wc++)r.a.addHandler(cc[Wc],
z.a.focus,Object(e.a)(this,this.KPf,"radioButtonFocusHandler")),r.a.addHandler(cc[Wc],z.a.click,Object(e.a)(this,this.KPf,"radioButtonFocusHandler"))}KPf(cc){if(cc=cc.target){cc.checked=!0;var Wc=$get(B.fPb);cc.id===B.hJd+(this.Zqa.length-1)?(Wc.disabled=!1,Sys.UI.DomElement.setVisible(Wc,!0),Wc.focus()):(Wc.disabled=!0,cc.focus());this.GL(1,this.validate())}}static get Wu(){return v.AFrameworkApplication.sa.Pa.Jv&&v.AFrameworkApplication.sa.Pa.xsd}}B.Lud=w.Lud;B.jAi="ListRadioBox";B.hJd="radiobox";
B.fPb="txtJustification";B.iconName="Info_32x32x32";B.id="JustificationDialog";Object(c.a)(B,"JustificationDialog",l.a,[]);class A extends l.a{constructor(cc,Wc,id){super(!1,!1,!0);if(cc&&id){var Tc={["id"]:"MandatoryLabellingDialog"};this.Lvg=id;this.POc=Wc;if(!v.AFrameworkApplication.fa.qa("MandatoryLabelingDialogLearnMoreSwitchIsEnabled")||this.POc&&""!==this.POc)Tc.learnMoreLink={["type"]:"AppLinkProps",["id"]:"mandatoryLabellingLearnMoreLink",["text"]:CommonUIStrings.l_LearnMore,["handler"]:{["href"]:this.POc,
["target"]:"_blank"},["customTooltip"]:CommonUIStrings.L_LearnMoreTooltip};Wc={["sections"]:[],["shouldAutoOpen"]:!1};Array.add(Wc.sections,{["id"]:"mandatoryLabellingFlyoutMenuSection",["controls"]:cc});Tc.labelFlyout={["type"]:"AppFlyoutAnchorProps",["id"]:"mandatoryLabellingFyout",["label"]:"Pick a label",["hideLabel"]:!1,["hideChevron"]:!1,["hideIcon"]:!0,["menuDefinition"]:Wc};cc={["id"]:"MandatoryLabellingDialog",["bodyControls"]:Tc};Tc.initialLabelText=CommonUIStrings.l_MandatoryLabellingDialogInitialLabelText;
Tc.descriptionText=CommonUIStrings.l_MandatoryLabellingDialogDescriptionText;this.initializeAndShow(CommonUIStrings.l_MandatoryLabellingDialogBusinessBarTitle,Object(e.a)(this,this.kGi,"mandatoryLabellingDialogHandler"),cc)}else b.ULS.sendTraceTag(560547850,306,10,"MandatoryLabelingDialog was triggered with invalid inputs")}kGi(cc,Wc){1===cc&&Wc.selectedLabel&&(cc=Wc.selectedLabel,""!==cc&&this.Lvg(cc))}}Object(c.a)(A,"MandatoryLabellingDialog",l.a,[]);class y{constructor(){this.okb=!!v.AFrameworkApplication.sa&&
v.AFrameworkApplication.sa.Pa.Jv}weh(cc,Wc,id){this.okb&&new A(cc,Wc,id)}static get instance(){return y.Ma||(y.Ma=new y)}}y.Ma=null;Object(c.a)(y,"MandatoryLabellingDialogFactory",null,[461]);class x{}x.$Nj="sbProtectForm14";x.bOj="SBStatusBarMarkAsReadOnly14";x.uzi="Info_16x16x32";x.krb="QuickSearchCompletedToday_16x16x32";x.IJd="CommonControlCheckboxCheck_16";x.eeg="On";x.visible="Visible";x.HJh="ImageIsVisible";x.xG="SourceControlId";x.menuItemId="MenuItemId";x.menu="Menu";x.JYc="AppLockId";x.value=
"Value";x.ti="LabelText";x.alt="Alt";x.Cdf="Image16by16";x.A6a="Image16by16Class";x.ZNj="SBProtectForm_16";x.aOj="SBStatusBarMarkAsReadOnly_16";x.icon="Icon";x.iconColor="IconColor";x.customTooltip="CustomTooltip";x.Rcj="MipTagDynamicFillWithOutline_20";x.Scj="MipTagLockDynamicFillWithOutline_20";x.Qcj="MipTagErrorOutline_20";x.Tcj="MipTagQuestionOutline_20";x.z_d="transparent";Object(c.a)(x,"PolicyConstants",null,[]);class F extends l.a{constructor(cc,Wc,id){super(!1,!1,F.Wu);this.WXb=cc;this.zXa=
Wc;this.rE=id;this.Rb=1;this.Ee=F.id;this.V0(1);this.V0(0)}TVd(){const cc={["id"]:"UserDefinedPermissionsDialog"};F.Wu&&this.initializeAndShow("Defined Permissions",Object(e.a)(this,this.p2j,"userDefinedPermissionsDialogHandler"),cc)}p2j(cc){1!==cc&&this.rE(cc,this.WXb,"",this.zXa)}static get Wu(){return v.AFrameworkApplication.sa.Pa.Jv&&v.AFrameworkApplication.sa.Pa.xsd}}F.id="UserDefinedPermissionsDialog";Object(c.a)(F,"UserDefinedPermissionsDialog",l.a,[]);var I=a(590),L=a(375),X=a(313),P=a(566),
G=a(97),C=a(145),H=a(561),J=a(558),M=a(136),S=a(428),W=a(134),O=a(86),T=a(200),Y=a(331),va=a(83),ca=a(105),V=a(25),ra=a(55);class N{constructor(cc,Wc,id,Tc){this.pOc=this.qOc=null;this.sce=this.GNc=this.$Nc=this.rkb=this.vde=this.Vee=this.DJc=!1;this.rWa=this.Efa=this.wga=this.Wpa=this.zXa=this.fv=this.H9=this.zh=null;this.vHc=0;this.r$d=this.XNc=this.HHc=null;this.La=cc;this.ef=Wc;this.mb=id;this.Qg=Tc;this.alb={};this.She={};this.Wee={};this.Yzb=id.qa("WacApplyManualPolicyLabelIsEnabled");this.Qg.value.xse(Object(e.a)(this,
this.wId,"processAutoSensitivityLabel"));this.Qg.value.OXc(Object(e.a)(this,this.wId,"processAutoSensitivityLabel"));this.Qg.value.k0b(Object(e.a)(this,this.L0i,"onUpdateLabelInfo"));v.AFrameworkApplication.sa&&v.AFrameworkApplication.sa.HNg(Object(e.a)(this,this.Aej,"refreshDocumentPolicyLabelsOnModeChange"));id.qa("SupportsPolicies")&&id.Xa("AppliedPolicyId")&&(this.qOc=id.Xa("IrmPolicyTitle"),this.pOc=id.Xa("IrmPolicyDescription"));this.sRc=id.qa("ProtectedFile");this.utg=this.mb.ud("SetPolicyLabelAwaitFileExistsOnHostMaxRetries",
6);this.vtg=this.mb.ud("SetPolicyLabelAwaitFileExistsOnHostRetryDelayMs",5E3)}get T7a(){return v.AFrameworkApplication.T7a||!!this.XNc&&this.XNc()}Fg(){this.La.Mb(V.a.fKf,ca.a.frame,Object(e.a)(this,this.INe,"documentLabelPaneHandler"));this.La.Me(V.a.Obb,ca.a.frame,Object(e.a)(this,this.Obb,"queryPolicyLabel"),96);this.La.Mb(V.a.FUa,ca.a.frame,Object(e.a)(this,this.FUa,"toggleSensitivity"));this.La.Mb(V.a.aAa,ca.a.frame,Object(e.a)(this,this.aAa,"populateSensitivityFlyout"));this.La.Mb(V.a.setSensitivity,
ca.a.frame,Object(e.a)(this,this.setSensitivity,"setSensitivity"));this.La.Me(V.a.Pbb,ca.a.frame,Object(e.a)(this,this.Pbb,"querySensitivity"),96);this.La.Mb(V.a.p7,ca.a.frame,Object(e.a)(this,this.p7,"querySensitivityToggleButton"));this.La.Mb(V.a.o7,ca.a.frame,Object(e.a)(this,this.o7,"querySensitivitySubFlyout"));this.Bnb(V.a.FUa)||this.La.Qdb(V.a.FUa,4);this.Bnb(V.a.aAa)||this.La.Qdb(V.a.aAa,4);this.Bnb(V.a.setSensitivity)||this.La.Qdb(V.a.setSensitivity,4);this.Bnb(V.a.p7)||this.La.Qdb(V.a.p7,
4);this.Bnb(V.a.o7)||this.La.Qdb(V.a.o7,4);this.ef.updateCommandUI();v.AFrameworkApplication.fa&&v.AFrameworkApplication.fa.getBooleanFeatureGate("Microsoft.Office.SharedOnline.CacheSensitivityVisibility",!1)&&M.a("isSharedUxGateEnabled")&&appChrome.api.isSharedUxGateEnabled("SharedOnline.ChangeGate.DelayPolicyActionRegistration")&&this.Qg.value.dkj(Object(e.a)(this,this.XSf,"registerActionsHandler"))}XSf(){this.Fg()}bQb(){this.La.aE(V.a.fKf,ca.a.frame,Object(e.a)(this,this.INe,"documentLabelPaneHandler"));
this.La.aE(V.a.Obb,ca.a.frame,Object(e.a)(this,this.Obb,"queryPolicyLabel"));this.La.aE(V.a.FUa,ca.a.frame,Object(e.a)(this,this.FUa,"toggleSensitivity"));this.La.aE(V.a.aAa,ca.a.frame,Object(e.a)(this,this.aAa,"populateSensitivityFlyout"));this.La.aE(V.a.setSensitivity,ca.a.frame,Object(e.a)(this,this.setSensitivity,"setSensitivity"));this.La.aE(V.a.Pbb,ca.a.frame,Object(e.a)(this,this.Pbb,"querySensitivity"));this.La.aE(V.a.p7,ca.a.frame,Object(e.a)(this,this.p7,"querySensitivityToggleButton"));
this.La.aE(V.a.o7,ca.a.frame,Object(e.a)(this,this.o7,"querySensitivitySubFlyout"))}FUa(){return 32}m0e(cc){const Wc="mandatoryLabelling_"+cc.Id;this.Wee[Wc]=cc.Id;return{["type"]:"AppToggleButtonProps",["id"]:Wc,["label"]:cc.DisplayName,["hideLabel"]:!1,["customTooltip"]:cc.Tooltip}}dOa(){return this.mb.getBooleanFeatureGate("Microsoft.Office.SharedOnline.UDPEnabled",!1)}oZh(){const cc=[],Wc=this.H9;for(let Tc in Wc){var id=Wc[Tc];const Gd=this.fv[Tc];if(this.mb.getBooleanFeatureGate("Microsoft.Office.SharedOnline.HideUDPFromMandatoryDialogEnabled",
!1)){if(!Gd||!Gd.Enabled||Gd.HasUserDefinedPermissions)continue}else if(!Gd||!Gd.Enabled)continue;if(id.count){const Wd={["sections"]:[],["shouldAutoOpen"]:!1},Dd={["id"]:"mandatoryLabelling_flyoutMenuSection_"+Gd.Id,["controls"]:[]};for(let Kd of id){id=this.fv[Kd];if(this.mb.getBooleanFeatureGate("Microsoft.Office.SharedOnline.HideUDPFromMandatoryDialogEnabled",!1)){if(!id||!id.Enabled||id.HasUserDefinedPermissions)continue}else if(!id||!id.Enabled)continue;Array.add(Dd.controls,this.m0e(id))}Array.add(Wd.sections,
Dd);Array.add(cc,{["type"]:"AppFlyoutAnchorProps",["id"]:"mandatoryLabelling_"+Gd.Id,["label"]:Gd.DisplayName,["hideLabel"]:!1,["hideChevron"]:!1,["hideIcon"]:!1,["menuDefinition"]:Wd})}else Array.add(cc,this.m0e(Gd))}return cc}aAa(cc,Wc,id,Tc,Gd){if(1===id||!this.Qg.value.Aha(!0))return 32;Gd.MenuItems=Object.assign(new H.a,{Id:"SensitivityList",MenuSectionList:[],UpdateDynamically:!0});Array.add(Gd.MenuItems.MenuSectionList,this.Ec(!this.isReactRibbonEnabled()));this.zh.CustomUrl&&Array.add(Gd.MenuItems.MenuSectionList,
this.leh(this.isReactRibbonEnabled()?this.zh.CustomUrl:n.a.df(this.zh.CustomUrl)));this.isReactRibbonEnabled()||(Gd.PopulationXML=X.q(Gd.MenuItems));return 32}Pbb(cc,Wc,id,Tc,Gd){if(1===id||!Gd||!this.Yzb)return 32;this.zh=this.Qg.value.Wn;if(this.Qg.value.Aha(!0)&&(Gd[x.visible]=!0,this.mb.getBooleanFeatureGate("Microsoft.Office.SharedOnline.LabelsAvailableActivityControlEnabled",!1)?this.vde||(C.a("MipLabelsAvailable"),this.vde=!0):C.a("MipLabelsAvailable"),this.mb.getBooleanFeatureGate("Microsoft.Office.SharedOnline.ClpLouderLabelTUIEnabled",
!1)&&this.zh&&this.zh.AreLabelsAvailable&&(cc=va.a.instance.Ub("Common.ISystemInitiatedFeedback")))){const Wd=N.ph(this.zh.AppliedPolicyId)?"LouderLabel_NoLabelAppliedOnLoadActivity":"LouderLabel_LabelExistsOnLoadActivity";cc.execute(Dd=>{Dd.logActivity(Wd,null)})}return 32}p7(cc,Wc,id,Tc,Gd){if(1===id||!Gd)return 32;let Wd,Dd;Gd[x.eeg]=!!(Wd=Gd[x.menuItemId])&&!!(Dd=this.alb[Wd])&&Dd===this.zh.AppliedPolicyId;return 32}o7(cc,Wc,id,Tc,Gd){if(1===id||!Gd)return 32;let Wd,Dd,Kd;cc=!!(Wd=Gd[x.xG])&&
!!(Dd=this.alb[Wd])&&!!(Kd=this.H9[Dd])&&Kd.contains(this.zh.AppliedPolicyId);Gd[x.HJh]=cc;Gd[x.eeg]=cc;return 32}setSensitivity(cc,Wc,id,Tc,Gd){return 1!==id&&Gd?this.WSa(this.alb[Gd[x.xG]],Gd,2):32}$hc(){return!!v.AFrameworkApplication.sa&&1===v.AFrameworkApplication.sa.mode}Aej(){this.GNc&&!this.$hc()&&(this.GNc=!1,this.Qg.value.zej())}Zeg(){this.zh.DefaultLabelId&&this.zh.MandatoryLabelingEnforced?this.DJc||this.$hc()?this.zh.AppliedPolicyId?this.gad(""):(this.Qg.value.zti(this.Qg.value.$Cb)||
this.$hc())&&this.cQe():this.w3f():this.zh.DefaultLabelId?this.w3f():this.zh.MandatoryLabelingEnforced&&(this.zh.AppliedPolicyId?this.gad(""):this.cQe())}Tjf(){return this.zh.MandatoryLabelingEnforced?this.zh&&this.zh.AreLabelsAvailable?this.mb.qa("TestOverrideIsReactDialogEnabled")||this.ef&&this.ef.Pa&&this.ef.Pa.Jv?!0:(b.ULS.sendTraceTag(539109065,306,50,"Mandatory labelling not invoked b/c react dialogs disabled!"),!1):(b.ULS.sendTraceTag(539109064,306,50,"Mandatory labelling not invoked b/c there are no sensitivity labels!"),
!1):(b.ULS.sendTraceTag(539109063,306,50,"Mandatory labelling not invoked b/c user did not have policy!"),!1)}cQe(){!this.Tjf()||v.AFrameworkApplication.y5||this.Vee||(this.Vee=v.AFrameworkApplication.y5=!0,b.ULS.sendTraceTag(562837517,306,50,"Mandatory labelling is invoked successfully."),this.Qg.value.cQf("",1),this.Qg.value.KWc(37,CommonUIStrings.l_MandatoryLabellingDialogBusinessBarTitle,CommonUIStrings.l_MandatoryLabellingDialogDescriptionText,CommonUIStrings.l_MandatoryLabellingDialogBusinessBarButton,
()=>{this.iGi()}))}gad(cc){this.Tjf()&&v.AFrameworkApplication.y5&&(v.AFrameworkApplication.y5=!1,b.ULS.sendTraceTag(562837518,306,50,"Mandatory labelling is escaped successfully."),this.Qg.value.OLd(),this.Qg.value.cQf(cc,2))}iGi(){y.instance.weh(this.oZh(),this.zh.CustomUrl,Object(e.a)(this,this.jGi,"mandatoryLabellingDialogCallback"))}jGi(cc){this.gad(this.Wee[cc])}zxe(){return this.mb.qa("CoAuthForProtectedFilesEnabled")&&this.mb.qa("SupportsOfficeClientCoauthoring")&&this.mb.qa("SetPolicyLabelAwaitFileExistsOnHostIsEnabled")&&
!!this.r$d&&this.T7a}WSa(cc,Wc,id,Tc=null){this.Qg.value.ybj(id);let Gd=32,Wd=!1,Dd=!0;const Kd=2===id||8===id||16===id,we=cc===this.zh.AppliedPolicyId;if(this.HHc&&this.HHc(cc,Kd))b.ULS.sendTraceTag(42860829,306,15,"SetSensitivity : As app doesn't support changing the label, skipping SetSensitivity call. ApplyLabelFlag : {0}",id),this.ef.updateCommandUI();else if(Wc&&x.JYc in Wc&&this.Qg.value.Izj(Wc[x.JYc]),cc)if(this.Qg.value.Zlf()||this.zxe()&&this.$Nc)b.ULS.sendTraceTag(42796168,306,50,"Policy label cannot be set because a set policy label request is already in progress. ApplyLabelFlag: {0}",
id),this.ef.updateCommandUI(),Kd&&this.Z0b(CommonUIStrings.l_SensitivityApplicationDialogErrorTitle,CommonUIStrings.l_SensitivityQuickApplicationErrorMessage);else if(this.mb.qa("HasDocumentEditRights"))if(this.Qg.value.s1g(cc))if(!this.dOa()&&this.fv[cc]&&this.fv[cc].HasUserDefinedPermissions&&!we)b.ULS.sendTraceTag(540608323,306,50,"UDP label cannot be applied during UDP in WAC Phase 1. ApplyLabelFlag: {0}",id),1!==id&&4!==id&&this.AQg();else if(Kd&&this.zh.MandatoryLabelingEnforced&&we)b.ULS.sendTraceTag(570972054,
306,50,"Policy label cannot be removed due to mandatory labeling. ApplyLabelFlag: {0}",id),this.Z0b(CommonUIStrings.l_MandatoryLabellingBlockLabelRemovalDialogTitle,CommonUIStrings.l_MandatoryLabellingBlockLabelRemovalDialogDescriptionText);else{if(Kd&&this.mb.qa("WacLabelingJustificationDialogIsEnabled")&&this.zh.RequiredDowngradeJustification&&(we||this.fv[cc].RequiredDowngradeJustification)&&(this.dOa()?!this.sce&&!Tc:!this.zXa))return b.ULS.sendTraceTag(570972055,306,50,"Downgrade justification is required. ApplyLabelFlag: {0}",
id),this.uVd(cc),Gd;if(this.dOa()&&this.fv[cc].HasUserDefinedPermissions&&!we)return b.ULS.sendTraceTag(523019968,306,50,"UDP Label is selected. ApplyLabelFlag: {0}",id),this.TVd(cc,Tc),Gd;if(this.zxe()&&!this.r$d())this.vHc<this.utg?(b.ULS.sendTraceTag(577356770,306,50,"File does not exist on host, retrying after delay. RetryCount: {0} ApplyLabelFlag: {1}",this.vHc,id),this.$Nc=!0,this.vHc++,ra.Task.delay(this.vtg).continueWith(()=>{this.$Nc=!1;this.WSa(cc,Wc,id)})):(b.ULS.sendTraceTag(577356771,
306,15,"Policy label cannot be set because maximum retries were reached checking for file existence. ApplyLabelFlag: {0}",id),Wd=1!==id,Dd=!1,Gd=8);else{if(this.gsi(cc)&&(b.ULS.sendTraceTag(553911752,306,15,"Policy label cannot be set because the selected label is a parent label. ApplyLabelFlag: {0}",id),1===id||8===id||4===id))return Gd;b.ULS.sendTraceTag(570972056,306,50,"SetSensitivityByPolicyId is succeeded. ApplyLabelFlag: {0}",id);this.setPolicyLabel(we?"":cc,this.dOa()?Tc:this.zXa,"",id);return Gd}}else b.ULS.sendTraceTag(42796169,
306,50,"Policy label cannot be set because the user is in a coauth session. ApplyLabelFlag: {0}",id),this.ef.updateCommandUI(),Kd&&this.Z0b(CommonUIStrings.l_SensitivityApplicationDialogErrorTitle,CommonUIStrings.l_SensitivityCoauthApplicationErrorMessage);else b.ULS.sendTraceTag(558892739,306,50,"Policy label cannot be set because the user doesn't have edit rights. ApplyLabelFlag: {0}",id),this.ef.updateCommandUI(),Kd&&this.Z0b(CommonUIStrings.l_SensitivityApplicationDialogErrorTitle,CommonUIStrings.l_SensitivityNoEditRightsErrorMessage);
else b.ULS.sendTraceTag(42796167,306,15,"Policy label cannot be set because the selected policy ID is null. ApplyLabelFlag: {0}",id),this.ef.updateCommandUI(),Wd=Kd,Dd=!1,Gd=8;this.Qg.value.wJd(0,id,Wd,Dd);return Gd}t_a(cc,Wc,id=null,Tc=!1){G.Health.instance.recordKpiUsage("MipAutoClassificationSetLabel",0,"wordclpfc",null);this.mb.qa("SupportsOfficeClientCoauthoring")&&this.mb.qa("CoAuthForProtectedFilesIsEnabled")?(this.rkb=!1,(this.zh=this.Qg.value.Wn)&&!this.zh.AppliedPolicyId?this.rkb=!0:this.zh&&
this.zh.PolicyLabelAssignmentMethod&&(this.rkb=T.e(this.zh.PolicyLabelAssignmentMethod)===T.e("standard"))):this.rkb=Tc;cc=N.ph(cc)?null:this.fv[cc];(Wc=N.ph(Wc)?null:this.fv[Wc])?this.wga=new h(Wc,!0,id):(this.Qg.value.Oda(29),this.Efa=null);cc?this.Wpa=new h(cc,!1):this.rWa=null;this.wId(null,null);return 32}wSg(cc){""!==this.zh.AppliedPolicyId?this.Qg.value.wJd(14,16,!0):this.WSa(cc,null,16)}k4f(){this.fv={};if(this.zh=this.Qg.value.Wn)for(const cc of this.zh.SensitivityLabels)this.fv[cc.Id]=cc}gsi(cc){if(this.H9&&
cc in this.H9){cc=this.H9[cc];for(let Wc of cc)if((cc=this.fv[Wc])&&cc.Enabled)return!0}return!1}R4f(){this.H9={};if(this.zh=this.Qg.value.Wn){for(const cc of this.zh.SensitivityLabels)cc.ParentId||(this.H9[cc.Id]=new d.a);for(const cc of this.zh.SensitivityLabels)cc.ParentId&&cc.ParentId in this.H9&&this.H9[cc.ParentId].add(cc.Id)}}yPf(){if(this.mb.getBooleanFeatureGate("Microsoft.Office.SharedOnline.CacheSensitivityVisibility",!1)){this.zh=this.Qg.value.Wn;const cc=this.Yzb&&this.isReactRibbonEnabled()&&
this.Qg.value.Aha();N.DRa(cc)}else this.Yzb&&this.isReactRibbonEnabled()?(this.zh=this.Qg.value.Wn,this.Qg.value.Aha()?(N.DRa(!0),appChrome.api.dispatch(appChrome.actions.updateControlHiddenState("Sensitivity",!1))):N.DRa(!1)):N.DRa(!1)}Yej(cc){this.HHc=cc}Mfj(cc){this.XNc=cc}w3f(){this.mb.qa("WacApplyDefaultPolicyLabelIsEnabled")&&(this.$hc()?this.GNc=!0:this.DJc||(this.DJc=!0,(this.zh=this.Qg.value.Wn)&&this.zh.DefaultLabelId&&!this.zh.AppliedPolicyId&&(b.ULS.sendTraceTag(593774210,306,50,"Default labeling triggered. DefaultLabel: {0}",
this.zh.DefaultLabelId),this.WSa(this.zh.DefaultLabelId,null,1))))}wId(){if(!this.Qg.value.Zlf()){var cc=this.fv[this.Qg.value.Wn.AppliedPolicyId];this.rkb&&this.Wpa&&this.rWa!==this.Wpa.id&&(!cc||cc.Order<this.Wpa.sensitivityLabel.Order)&&(cc=this.WSa(this.Wpa.id,{},4),32!==cc?b.ULS.sendTraceTag(50868813,306,10,"ProcessAutoSensitivityLabel: SetSensitivityByPolicyId failed with response: "+cc):(this.rWa=this.Wpa.id,this.Efa&&(cc=this.fv[this.Efa])&&cc.Order<=this.Wpa.sensitivityLabel.Order&&(this.Qg.value.Oda(29),
this.Efa=null)));cc=this.fv[this.Qg.value.Wn.AppliedPolicyId];if(this.wga&&this.Efa!==this.wga.id&&(!cc||cc.Order<this.wga.sensitivityLabel.Order)){const Wc=this.wga.id;this.Qg.value.Oda(29);this.Qg.value.x_b(29,CommonUIStrings.l_PolicyBusinessBarTitle,String.format(CommonUIStrings.l_PolicyLabelRecommendationMessage,this.bid(this.wga.sensitivityLabel))+" "+this.wga.xdj,CommonUIStrings.l_PolicyLabelRecommendationButton,()=>{this.WSa(Wc,{},8)});this.Efa=this.wga.id}this.wga=this.Wpa=null}}setPolicyLabel(cc,
Wc,id,Tc=2){this.dOa()?Wc&&(this.sce=!0):this.zXa=Wc;this.Qg.value.setPolicyLabel(cc);this.ef.updateCommandUI();id=new m(Tc,this.bid(this.fv[cc]));this.Qg.value.wSd(cc,this.dOa()?Wc:this.zXa,id)}m$g(cc,Wc,id,Tc){1===cc&&this.setPolicyLabel(Wc,Tc,id)}l$g(cc,Wc,id){1===cc?this.dOa()?this.WSa(Wc,null,2,id):this.setPolicyLabel(Wc===this.zh.AppliedPolicyId?"":Wc,id,""):this.ef.updateCommandUI()}uVd(cc){(new B(cc,Object(e.a)(this,this.l$g,"continueToSetPolicyLabelFromJustificationDialog"))).uVd()}TVd(cc,
Wc){(new F(cc,Wc,Object(e.a)(this,this.m$g,"continueToSetPolicyLabelFromUDPDialog"))).TVd()}Z0b(cc="",Wc=""){const id=new W.StandardDialog;id.Jt=v.AFrameworkApplication.eAb;id.Rb=0;id.oc(1,CommonUIStrings.l_DialogClose);id.oX(cc,Wc,null)}qWg(cc){1===cc&&this.Qg.value.Cbj()}AQg(){const cc=new W.StandardDialog;cc.Jt=v.AFrameworkApplication.eAb;cc.Rb=1;cc.oc(1,CommonUIStrings.l_OICDownLoadACopyDialogOpenButton);cc.oc(0,CommonUIStrings.l_DialogClose);cc.oX(CommonUIStrings.l_SensitivityApplicationDialogErrorTitle,
CommonUIStrings.l_SensitivityBlockUDPSetLabelMessage,Object(e.a)(this,this.qWg,"blockUDPSetLabelHandler"))}isReactRibbonEnabled(){return!!this.ef&&!!this.ef.Pa&&this.ef.Pa.Oi}Ejc(){return this.ef&&this.ef.Pa?this.ef.Pa.Ejc:!1}INe(){return 32}Obb(cc,Wc,id,Tc,Gd){if(1===id)return 32;this.zh=this.Qg.value.Wn;if(!this.zh||!Gd)return 32;Gd[x.value]="";Gd[x.ti]="";Gd[x.alt]=null;Gd[x.Cdf]=null;Gd[x.A6a]=null;Gd[x.customTooltip]="";Gd[x.visible]=!1;Gd[x.iconColor]="";id=Wc=cc=Gd[x.icon]="";if(!this.zh.AreLabelsAvailable){if(!this.qOc)return 32;
cc=this.qOc;id=x.z_d;this.pOc&&(Wc=this.pOc)}else if(this.zh.AppliedPolicyId){Tc=null;for(const Wd of this.zh.SensitivityLabels)if(Wd.Id.toLowerCase()===this.zh.AppliedPolicyId.toLowerCase()){Tc=Wd;break}Tc&&(cc=this.bid(Tc),Wc=Tc.Tooltip,this.sRc=v.AFrameworkApplication.protectedFile=Tc.IsEndpointProtectionEnabled,id=this.n1e(Tc))}this.mb.getBooleanFeatureGate("Microsoft.Office.SharedOnline.ClpLouderLabelEnabled",!1)?(cc?(Gd[x.value]=cc,Gd[x.ti]=cc,Gd[x.customTooltip]=Wc,this.t4f(id,this.sRc,Gd)):
this.mb.isChangeGateEnabled("Microsoft.Office.SharedOnline.ChangeGate.ClpUseOutlineImageForNoLabel")?(Gd[x.iconColor]=x.z_d,this.zh.MandatoryLabelingEnforced?(Gd[x.value]=Gd[x.ti]=HeaderStrings.SelectASensitivityLabel,Gd[x.icon]=x.Qcj):(Gd[x.value]=Gd[x.ti]=HeaderStrings.NoSensitivityLabel,Gd[x.icon]=x.Tcj)):(Gd[x.iconColor]="#000000",this.zh.MandatoryLabelingEnforced?(Gd[x.value]=Gd[x.ti]=HeaderStrings.SelectASensitivityLabel,Gd[x.icon]="MipTagErrorDynamicColor_20"):(Gd[x.value]=Gd[x.ti]=HeaderStrings.NoSensitivityLabel,
Gd[x.icon]="MipTagQuestionDynamicColor_20")),Gd[x.visible]=!0):cc&&(Gd[x.value]=cc,Gd[x.ti]=cc,this.Ejc()?Gd[x.customTooltip]=Wc:Gd[x.alt]=Wc,this.t4f(id,this.sRc,Gd),Gd[x.visible]=!0);return 32}bid(cc){return cc?this.fv?cc.ParentId&&this.fv[cc.ParentId]?this.fv[cc.ParentId].DisplayName+"\\"+cc.DisplayName:cc.DisplayName:(b.ULS.sendTraceTag(4282E4,306,15,"Policy ID to Sensitivity label dictionary has not been initialized."),cc.DisplayName):""}t4f(cc,Wc,id){this.mb.getBooleanFeatureGate("Microsoft.Office.SharedOnline.ClpLouderLabelEnabled",
!1)?(id[x.icon]=this.b8e(Wc),id[x.iconColor]=this.c8e(cc)):this.Ejc()?id[x.icon]=Wc?x.ZNj:x.aOj:(id[x.Cdf]=v.AFrameworkApplication.yB,id[x.A6a]=Wc?t.getImageClass(x.$Nj):t.getImageClass(x.bOj))}leh(cc){const Wc=this.jF("LearnMoreSection",!0);cc=Object.assign(new L.a,{Id:"SensitivityLearnMore",ExternalId:"SensitivityLearnMore",MenuItemId:cc,LabelText:CommonUIStrings.l_LearnMore,Command:"1959943459",Image16by16:v.AFrameworkApplication.yB,Image16by16Class:t.getImageClass(x.uzi),Visible:!0,Alt:CommonUIStrings.L_LearnMoreTooltip,
KeyTip:"L"});Array.add(Wc.ControlList,cc);return Wc}RJe(cc,Wc,id=!1){let Tc;Tc="Toggle_"+cc.Id;Tc="Sensitivity_"+Tc;const Gd=cc.DisplayName,Wd=cc.Tooltip;var Dd=cc.Id===this.zh.AppliedPolicyId,Kd=id?n.a.df(Tc):Tc;this.mb.getBooleanFeatureGate("Microsoft.Office.SharedOnline.ClpLouderLabelEnabled",!1)?(Dd=this.n1e(cc),Wc=Object.assign(new S.a,{Id:Kd,ExternalId:Kd,LabelText:id?n.a.df(Gd):Gd,Command:"2935633379",MenuItemId:Kd,QueryCommand:"991261903",Visible:!0,Alt:id?n.a.df(Wd):Wd,AriaLabel:O.a.E1b,
IconColor:this.c8e(Dd),KeyTip:Wc}),Wc.ExternalImageId=this.b8e(cc.IsEndpointProtectionEnabled)):(Kd=Object.assign(new I.a,{Id:Kd,ExternalId:Kd,LabelText:id?n.a.df(Gd):Gd,Command:"2935633379",MenuItemId:Kd,QueryCommand:"991261903",CheckedImage:v.AFrameworkApplication.yB,Visible:!0,Alt:id?n.a.df(Wd):Wd,IsChecked:Dd,AriaLabel:O.a.E1b,KeyTip:Wc}),this.isReactRibbonEnabled()?(Kd.CheckedImageClass=t.getImageClass(x.IJd),Kd.ExternalImageId=x.IJd):Kd.CheckedImageClass=t.getImageClass(x.krb),Wc=Kd);Kd=Tc;
this.alb[Kd]=cc.Id;this.She[cc.Id]=Kd;return Wc}jF(cc,Wc=!1){return Object.assign(new J.a,{Title:"",Id:cc,DisplayMode:x.menu,ShowMenuSectionSeparator:Wc,ControlsId:"Ctrl_"+cc,ControlList:[]})}mhh(cc,Wc,id){cc=this.jF(cc+"Sub");let Tc=1;for(let Gd of Wc)(Wc=this.fv[Gd])&&Wc.Enabled&&(Array.add(cc.ControlList,this.RJe(Wc,Tc.toString(),id)),Tc++);return cc}Ec(cc=!1){const Wc=this.jF("SensitivitySection");let id=1;const Tc=this.H9;for(let Wd in Tc){const Dd=Tc[Wd],Kd=this.fv[Wd];if(Kd&&Kd.Enabled){if(Dd.count){const we=
"Sensitivity_"+Kd.Name;var Gd=cc?n.a.df(we):we;Gd=Object.assign(new P.a,{Id:Gd,ExternalId:Gd,LabelText:cc?n.a.df(Kd.DisplayName):Kd.DisplayName,Command:"798637440",QueryCommand:"2875864574",Menu:Object.assign(new H.a,{Title:"",MenuSectionList:[],UpdateDynamically:!0}),ImageIsVisible:!1,Toggled:!1,ImageUsesSpaceWhileInvisible:!0,AriaLabel:O.a.E1b,KeyTip:id.toString(),Alt:cc?n.a.df(Kd.Tooltip):Kd.Tooltip});this.isReactRibbonEnabled()?Gd.ExternalImageId=x.IJd:(Gd.Image16by16=v.AFrameworkApplication.yB,
Gd.Image16by16Class=t.getImageClass(x.krb));Array.add(Gd.Menu.MenuSectionList,this.mhh(we,Dd,cc));Array.add(Wc.ControlList,Gd);this.alb[Gd.Id]=Kd.Id;this.She[Kd.Id]=Gd.Id}else Array.add(Wc.ControlList,this.RJe(Kd,id.toString(),cc));id++}}return Wc}Bnb(cc){return!!this.La.H4(cc)&&!!this.La.H4(cc).flags&&!!this.La.H4(cc).flags.length}L0i(cc,Wc){Wc.onSuccess&&this.fv&&(cc=this.fv[this.Qg.value.Wn.AppliedPolicyId])&&(this.Efa&&(Wc=this.fv[this.Efa])&&Wc.Order<=cc.Order&&(this.Qg.value.Oda(29),this.Efa=
null),this.rWa&&this.rWa!==cc.Id&&(this.Qg.value.Oda(28),this.rWa=null))}b8e(cc){return cc?x.Scj:x.Rcj}c8e(cc){return cc?cc:x.z_d}n1e(cc){if(cc.Color||!cc.ParentId)return cc.Color;const Wc=this.fv[cc.ParentId];return Wc?Wc.Color:cc.Color}static DRa(cc){v.AFrameworkApplication.fa&&v.AFrameworkApplication.fa.getBooleanFeatureGate("Microsoft.Office.SharedOnline.GeneralizedRibbonTTVRReporting",!1)||(cc?(Y.a.BBd("ribbon","sensitivity"),Y.a.vBd("ribbon","sensitivity")):Y.a.ABd("ribbon","sensitivity"));
v.AFrameworkApplication.fa&&v.AFrameworkApplication.fa.getBooleanFeatureGate("Microsoft.Office.SharedOnline.CacheSensitivityVisibility",!1)&&M.c()&&appChrome.api.dispatch(appChrome.actions.updateControlHiddenState("Sensitivity",!cc))}static ph(cc){return cc&&cc.length?!1:!0}}Object(c.a)(N,"PolicyActor",null,[444]);var ea=a(639),Ba=a(553),ka=a(96),Ka;(function(cc){cc[cc.unknown=0]="unknown";cc[cc.boot=1]="boot";cc[cc.refresh=2]="refresh";cc[cc.selfSetPolicyLabel=3]="selfSetPolicyLabel"})(Ka||(Ka={}));
Object(c.b)("GetPolicyLabelsReason",Ka);class Oa extends Sys.EventArgs{constructor(cc,Wc,id,Tc,Gd,Wd){super();this.vqb=cc;this.title=Wc;this.message=id;this.buttonText=Tc;this.o3=Gd;this.wBb=Wd}}Object(c.a)(Oa,"AddAutoPolicyBusinessBarEntryEventArgs",Sys.EventArgs,[]);class wa extends Sys.EventArgs{constructor(cc,Wc,id,Tc,Gd){super();this.vqb=cc;this.title=Wc;this.message=id;this.buttonText=Tc;this.o3=Gd}}Object(c.a)(wa,"AddMandatoryLabellingBusinessBarEntryEventArgs",Sys.EventArgs,[]);var qa;(function(cc){cc[cc.none=
0]="none";cc[cc.reasonDefaultLabel=1]="reasonDefaultLabel";cc[cc.reasonManual=2]="reasonManual";cc[cc.reasonAutomatic=4]="reasonAutomatic";cc[cc.reasonRecommended=8]="reasonRecommended";cc[cc.reasonMandatory=16]="reasonMandatory"})(qa||(qa={}));Object(c.b)("ApplyLabelFlags",qa);class aa extends Sys.EventArgs{constructor(cc,Wc,id){super();this.pEe=cc;this.oEe=Wc;this.existingLabelPriority=id}}Object(c.a)(aa,"AutoCLPSecurityNodesEventArgs",Sys.EventArgs,[]);class ia extends Sys.EventArgs{constructor(){super()}}
Object(c.a)(ia,"GetPolicyLabelEventArgs",Sys.EventArgs,[]);class Ha extends Sys.EventArgs{constructor(){super()}}Object(c.a)(Ha,"GetPolicyLabelFailureEventArgs",Sys.EventArgs,[]);class Z{constructor(){this.AreLabelsAvailable=!1;this.AppliedPolicyId=null;this.MandatoryLabelingEnforced=this.RequiredDowngradeJustification=!1;this.SensitivityLabels=this.PolicyLabelVersionToken=this.PolicyLabelAssignmentMethod=this.CustomUrl=this.DefaultLabelId=null;this.AreLabelsAvailable=!1;this.AppliedPolicyId="";this.RequiredDowngradeJustification=
!1;this.PolicyLabelVersionToken=this.PolicyLabelAssignmentMethod=this.DefaultLabelId="";this.SensitivityLabels=[];this.MandatoryLabelingEnforced=!1;this.CustomUrl=""}}Object(c.a)(Z,"GetPolicyLabelsData",null,[]);class la extends Sys.EventArgs{constructor(cc=!1){super();this.onSuccess=cc}}Object(c.a)(la,"LabelInfoUpdateEventArgs",Sys.EventArgs,[]);class Xa extends Sys.EventArgs{constructor(cc,Wc){super();this.Nya=cc;this.zue=Wc}}Object(c.a)(Xa,"MandatoryLabellingAppHandlerEventArgs",Sys.EventArgs,
[]);class Za extends Sys.EventArgs{constructor(cc,Wc,id,Tc){super();this.title=cc;this.ksc=Wc;this.buttonText=id;this.Qzf=Tc}}Object(c.a)(Za,"PolicyTipEventArgs",Sys.EventArgs,[]);class xa extends Sys.EventArgs{constructor(cc,Wc){super();this.vqb=cc;this.wBb=Wc}}Object(c.a)(xa,"RemoveAutoPolicyBusinessBarEntryEventArgs",Sys.EventArgs,[]);class fa extends Sys.EventArgs{constructor(){super()}}Object(c.a)(fa,"RemoveMandatoryLabellingBusinessBarEntryEventArgs",Sys.EventArgs,[]);class ua extends Sys.EventArgs{constructor(cc,
Wc){super();this.jsc=cc;this.QP=Wc}}Object(c.a)(ua,"SetPolicyLabelEventArgs",Sys.EventArgs,[]);class sa extends Sys.EventArgs{constructor(cc,Wc,id,Tc=null,Gd=null,Wd=null,Dd=null){super();this.errorType=cc;this.Y8f=id;this.title=Tc;this.message=Gd;this.buttonText=Wd;this.o3=Dd}}Object(c.a)(sa,"SetPolicyLabelFailureEventArgs",Sys.EventArgs,[]);class sb extends Sys.EventArgs{constructor(){super()}}Object(c.a)(sb,"SetPolicyLabelTriggeredEventArgs",Sys.EventArgs,[]);class hb extends Sys.EventArgs{constructor(cc){super();
this.FFj=cc}}Object(c.a)(hb,"UDPLabelingAppHandlerEventArgs",Sys.EventArgs,[]);var bb=a(106),lb=a(102),Fa=a(41),Na=a(80),Mb=a(40);class dc{constructor(cc,Wc,id,Tc,Gd,Wd,Dd,Kd=null,we=null,We=!1,Od=null,le=null,de=null,Re=null,Ee=!1,Te=null,Ae=null,kf=null,Oe=null,$a=null,Zb=null){this.url=cc;this.y3j=Wc;this.body=id;this.headers=Tc;this.Deb=Gd;this.priority=Wd;this.state=Dd;this.Ulg=Kd;this.xO=we;this.nR=We;this.maj=Od;this.Rvj=le;this.name=de;this.sHb=Re;this.Ndd=Ee;this.PKf=Te;this.X$b=Ae;this.ihc=
kf;this.hdb=Oe;this.Fdi=$a;this.responseType=Zb}}Object(c.a)(dc,"ClientRequest",null,[]);var Cb=a(464),Tb=a(263);class Jb{static nyj(cc,Wc){if(!cc||!Wc||cc.count!==Wc.count)return!1;for(let id of cc)if(!Wc.contains(id))return!1;return!0}static toArray(cc){if(!cc)return null;const Wc=Array(cc.count);let id=0;for(let Tc of cc)Wc[id]=Tc,id++;return Wc}}Object(c.a)(Jb,"HashSetUtils",null,[]);var eb=a(279),za=a(72),ha=a(189);class fb{constructor(cc,Wc,id,Tc=0,Gd=null){this.zJc=this.G9d=null;this.Ura=this.Jjb=
this.Ljb=0;this.N8="";this.PFa=this.pHc=this.Sbe=this.Tpa=this.aPc=null;this.tce=!1;this.uDa=null;this.bMc=0;this.aXb=this.RFa=this.xEa=this.$Wb=null;this.fb=new ka.a;this.PMb=this.wxb=this.MFa=null;this.RMc=!1;this.$Cb=null;this.mb=cc;this.yh=Wc;this.Bh=id;this.eWb=Tc;this.Wn=new Z;this.Rhe=this.mb.Xa("PolicyHandlerEndpointName")||"PolicyHandler.ashx";this.qP=Gd;this.Yzb=cc.qa("WacApplyManualPolicyLabelIsEnabled");this.Hhc=cc.qa("CoAuthForProtectedFilesIsEnabled");this.supportsOfficeClientCoauthoring=
cc.qa("SupportsOfficeClientCoauthoring");this.rui=!1;this.vAj=3E4;this.fe=lb.a.instance;cc.qa("SupportsPolicies")&&C.a("MipSupportsPolicies");this.Hhc&&this.supportsOfficeClientCoauthoring&&C.a("MipSupportsOfficeClientCoauthoring")}get opd(){return this.RMc}ise(cc){this.fb.addHandler("PolicyTipEvent",cc)}k0b(cc){this.fb.addHandler("LabelInfoUpdateEvent",cc)}dkj(cc){this.fb.removeHandler("LabelInfoUpdateEvent",cc)}xse(cc){this.fb.addHandler("SetPolicyLabelEventKey",cc)}plj(cc){this.fb.removeHandler("SetPolicyLabelEventKey",
cc)}OXc(cc){this.fb.addHandler("SetPolicyLabelFailureEventKey",cc)}olj(cc){this.fb.removeHandler("SetPolicyLabelFailureEventKey",cc)}UMg(cc){this.fb.addHandler("GetPolicyLabelEventKey",cc)}TMg(cc){this.fb.addHandler("GetPolicyLabelFailureEventKey",cc)}RMg(cc){this.fb.addHandler("GetAutoPolicyLabelEventKey",cc);this.opd&&(b.ULS.sendTraceTag(51668058,306,15,"GetAutoPolicyLabelHandler was registered after the AutoPolicyLabelHandlerEvent was raised"),this.lJd(new ia(0)))}Jjj(cc){this.fb.removeHandler("GetAutoPolicyLabelEventKey",
cc)}qMg(cc){this.fb.addHandler("CreateAutoCLPSecurityNodesEventKey",cc)}njj(cc){this.fb.removeHandler("CreateAutoCLPSecurityNodesEventKey",cc)}jPg(cc){this.fb.addHandler("UpdateAutoCLPLabelPriorityNodeEventKey",cc)}Elj(cc){this.fb.removeHandler("UpdateAutoCLPLabelPriorityNodeEventKey",cc)}kPg(cc){this.fb.addHandler("UpdateAutoCLPSITNodesEventKey",cc)}Flj(cc){this.fb.removeHandler("UpdateAutoCLPSITNodesEventKey",cc)}Tqe(cc){this.fb.addHandler("AddAutoPolicyBusinessBarEntryEventKey",cc)}Fij(cc){this.fb.removeHandler("AddAutoPolicyBusinessBarEntryEventKey",
cc)}lse(cc){this.fb.addHandler("RemoveAutoPolicyBusinessBarEntryEventKey",cc)}Ykj(cc){this.fb.removeHandler("RemoveAutoPolicyBusinessBarEntryEventKey",cc)}Uqe(cc){this.fb.addHandler("AddMandatoryLabellingBusinessBarEntryEventKey",cc)}Hij(cc){this.fb.removeHandler("AddMandatoryLabellingBusinessBarEntryEventKey",cc)}mse(cc){this.fb.addHandler("RemoveMandatoryLabellingBusinessBarEntryEventKey",cc)}Zkj(cc){this.fb.removeHandler("RemoveMandatoryLabellingBusinessBarEntryEventKey",cc)}CNg(cc){this.fb.addHandler("MandatoryLabellingAppHandlerEventKey",
cc)}okj(cc){this.fb.removeHandler("MandatoryLabellingAppHandlerEventKey",cc)}fPg(cc){this.fb.addHandler("UDPLabelingAppHandlerEventKey",cc)}Blj(cc){this.fb.removeHandler("UDPLabelingAppHandlerEventKey",cc)}get Aqd(){if(!this.G9d)return!1;for(const cc of this.G9d.gjk())if(!cc.Capabilities||!cc.Capabilities.SupportsClientIsMipTrusted)return!1;return!0}get Mti(){return!!this.MFa}L3g(){return this.Sbe?this.Sbe():!1}Uej(cc){this.pHc=cc}Ew(){return(new Date).getTime()}ggd(){this.Bh&&(this.$Wb=this.Bh.Ac("WebServiceCall",
"Call Get Policy Endpoint On Server"));var cc=eb.a.Aia(1,1);this.mb.qa("SendHostAttributionInfoForPolicyLabelEnabled")?(cc=new dc(this.s5a("datalosspolicy"),1,null,null,!0,2,null,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,cc),this.yh.send(cc).SKd(Object(e.a)(this,this.mBf,"onDataLossPolicySuccessCallback"),Object(e.a)(this,this.lBf,"onDataLossPolicyFailureCallback"))):this.yh.Rm(this.s5a("datalosspolicy"),1,null,null,!0,2,Object(e.a)(this,this.mBf,"onDataLossPolicySuccessCallback"),
Object(e.a)(this,this.lBf,"onDataLossPolicyFailureCallback"),null);this.Ljb++;b.ULS.sendTraceTag(25565151,306,50,"Policy request is sent to server. The endpoint used is {0}. Policy call times: {1}.",this.Rhe,this.Ljb)}zej(){this.fgd(this.N8,2,this.Tpa)}fgd(cc,Wc=0,id=null,Tc=!1){G.Health.instance.recordKpiUsage("MipGetPolicyLabel",0,"officewebclp",this.ugd(void 0,Wc));this.wxb=this.Ew();const Gd=this.a6c(Wc);this.Bcc(cc,Gd,id,Tc,Wc);this.mNd(!0)}mBf(cc){this.wMf();let Wc="";({data:Wc}=this.Y_d(cc)).returnValue&&
(b.ULS.sendTraceTag(25565153,306,50,"Request to get DataLossPrevention policy succeeded."),this.Ljb=0,this.Bh&&(this.aXb=this.Bh.Ac("Task","Parse and Handle Get Policy Response")),this.Q3i(Wc),this.aXb&&(this.aXb.stop(),this.aXb=null))}lBf(cc){this.wMf();this.Ljb<=this.eWb?this.ggd():(b.ULS.sendTraceTag(25565154,306,15,"Request to get DataLossPrevention policy failed with error response: {0}.",cc?cc.data?cc.data.QRa:null:null),this.Ljb=0)}Zlf(){return 0<this.Ura}setPolicyLabel(cc){this.Wn.AppliedPolicyId=
cc}wSd(cc,Wc,id=null){const Tc=this.Pdh(id);this.uAj(cc,Wc,Tc,id)}aIf(cc){this.RFa&&(this.RFa.stop(),this.RFa=null);let Wc,id;({u1f:Wc,Y4f:id}=this.j7e(cc));const Tc=cc.data.state,Gd=Tc?Tc.QP:2;let Wd="";({data:Wd}=this.Y_d(cc)).returnValue?(b.ULS.sendTraceTag(41799707,306,50,"Request to set label policy data succeeded. ApplyLabelFlag: {0}",Gd),this.Ura=0,this.h4i(Wd,Wc,id,Tc)):this.SOd(Gd)}ybj(cc){G.Health.instance.recordKpiUsage("MipSetPolicyLabel",0,"officewebclp",this.ugd(cc));this.PMb=this.Ew();
b.ULS.sendTraceTag(575947405,306,50,"Raising set policy label triggered event.");this.fb.raiseEvent("SetPolicyLabelTriggeredEventKey",new sb(cc))}KLi(){this.Hhc&&this.supportsOfficeClientCoauthoring&&this.Mti&&this.MFa.iea(12,null,!0)}$Hf(cc){this.RFa&&(this.RFa.stop(),this.RFa=null);let Wc;({u1f:id,Y4f:Wc}=this.j7e(cc));if(this.Ura<=this.eWb)this.wSd(id,Wc);else{var id=(id=cc.data.state)?id.QP:2;b.ULS.sendTraceTag(41799708,306,15,"Request to set label policy failed with error response: {0}. ApplyLabelFlag: {1}",
cc?cc.data?cc.data.QRa:null:null,id);this.$Cb="WACServerConnectionFailed";this.Ura=0;this.SOd(id)}}zti(cc){if(cc&&("LabelNotSupported"===cc||"LabelErrorRetryLater"===cc||"CoherencyFailure"===cc||"LabelIdNotFound"===cc||"LabelDisabled"===cc))return b.ULS.sendTraceTag(539103556,306,50,"LabelError is retriable: {0}",cc),!0;b.ULS.sendTraceTag(539103557,306,50,"LabelError is not retriable: {0}",cc);return!1}s1g(cc){if(!cc)return!1;let Wc=null,id=null;for(const Tc of this.Wn.SensitivityLabels)Tc.Id===cc&&
(Wc=Tc),Tc.Id===this.N8&&(id=Tc);if(!Wc)return!1;if(this.Hhc&&this.supportsOfficeClientCoauthoring){if(this.pHc&&this.pHc()||this.Aqd)return!0}else if(v.AFrameworkApplication.uz&&v.AFrameworkApplication.uz.mwb||this.Tpa&&this.Tpa())return!0;return Wc.IsEndpointProtectionEnabled===(!!id&&id.IsEndpointProtectionEnabled)}x_b(cc,Wc,id,Tc,Gd){28===cc?this.MPf(new Oa(cc,Wc,id,Tc,Gd,!1)):this.MPf(new Oa(cc,Wc,id,Tc,Gd,!0))}Oda(cc){28===cc?this.pQf(new xa(cc,!1)):this.pQf(new xa(cc,!0))}Caj(cc,Wc,id){b.ULS.sendTraceTag(545280777,
306,50,"Raising a CreateAutoCLPSecurityNodes event.");this.fb.raiseEvent("CreateAutoCLPSecurityNodesEventKey",new aa(cc,Wc,id))}Dbj(cc){b.ULS.sendTraceTag(545280778,306,50,"Raising a UpdateAutoCLPLabelPriorityNode event.");this.fb.raiseEvent("UpdateAutoCLPLabelPriorityNodeEventKey",new aa(null,null,cc))}Ebj(cc,Wc){b.ULS.sendTraceTag(545280779,306,50,"Raising a UpdateAutoCLPSITNodes event.");this.fb.raiseEvent("UpdateAutoCLPSITNodesEventKey",new aa(cc,Wc,null))}cQf(cc,Wc){b.ULS.sendTraceTag(572650527,
306,50,"Raising a mandatory labelling"+(1===Wc?"Reading":"Edit")+" switch event.");this.fb.raiseEvent("MandatoryLabellingAppHandlerEventKey",new Xa(cc,Wc))}KWc(cc,Wc,id,Tc,Gd){37===cc&&this.raj(new wa(37,Wc,id,Tc,Gd))}OLd(){this.sbj(new fa)}Cbj(){b.ULS.sendTraceTag(540608322,306,50,"Raising a UDP labeling event.");this.fb.raiseEvent("UDPLabelingAppHandlerEventKey",new hb(!0))}Aha(cc=!1){const Wc=!!this.Wn&&this.Wn.AreLabelsAvailable&&!!this.Wn.SensitivityLabels&&0<this.Wn.SensitivityLabels.length&&
Tb.a.any(this.Wn.SensitivityLabels,id=>!!id&&id.Enabled);Wc||cc||N.DRa(!1);return Wc}hDf(cc){this.xEa&&(this.xEa.stop(),this.xEa=null);var Wc="";this.mNd(!1);({data:Wc}=this.Y_d(cc)).returnValue?(b.ULS.sendTraceTag(34996493,306,50,"Request to get label policy data succeeded."),this.Jjb=0,Wc=this.Z3i(Wc),cc=this.V5e(cc.data),G.Health.instance.recordKpiSuccess("MipGetPolicyLabel",this.Mbc(void 0,cc,this.wxb)),this.wxb=null,cc=new ia(cc),this.Raj(cc),this.mb.getBooleanFeatureGate("Microsoft.Office.SharedOnline.AutoCLPV2Transition",
!1)?Wc&&this.nEj()?this.opd?this.MYj():(this.mb.getBooleanFeatureGate("Microsoft.Office.SharedOnline.EnableSecurityNodesAfterLicenseCheck",!1)||this.tsb(),this.lJd(cc),this.RMc=!0):Wc||this.rtc():!this.opd&&Wc&&this.mb.qa("WacApplyManualPolicyLabelIsEnabled")&&this.Xve()?(this.lJd(cc),this.RMc=!0):Wc||this.rtc()):this.rtc()}nEj(){if(!this.mb.qa("WacApplyManualPolicyLabelIsEnabled"))return b.ULS.sendTraceTag(539877667,306,50,"ShouldAutoClassificationRun returned false - Manual Labeling is not enabled"),
!1;if(!this.Xve())return!1;if(""===this.N8)return b.ULS.sendTraceTag(539877696,306,50,"ShouldAutoClassificationRun returned true - document is not labeled"),!0;if(this.uDa===this.bMc)return b.ULS.sendTraceTag(539877697,306,50,"ShouldAutoClassificationRun returned false - Applied label already has the highest priority"),!1;b.ULS.sendTraceTag(539877698,306,50,"ShouldAutoClassificationRun returned true - document is labeled but not with the highest priority label");return!0}tsb(){this.Ehg();b.ULS.sendTraceTag(545104324,
306,50,"Creating AutoCLP Security nodes. HasSITs: {0}, LabelPriority: {1}",0<this.PFa.count,this.uDa);const cc=Jb.toArray(this.PFa);this.Caj(cc,cc,this.uDa)}MYj(){var cc=this.PFa;this.Ehg();Jb.nyj(cc,this.PFa)||(b.ULS.sendTraceTag(545104325,306,50,"Updating AutoCLP SIT nodes. HasSITs: {0}",0<this.PFa.count),cc=Jb.toArray(this.PFa),this.Ebj(cc,cc));this.tce&&(b.ULS.sendTraceTag(545104326,306,50,"Updating AutoCLP Label Priority node. LabelPriority: {0}",this.uDa),this.Dbj(this.uDa))}Ehg(){const cc=
new ea.a(Ba.a.cl());for(const Wc of this.Wn.SensitivityLabels)if(Wc&&Wc.AutoLabelingSensitiveTypeIds&&0<Wc.AutoLabelingSensitiveTypeIds.length)for(const id of Wc.AutoLabelingSensitiveTypeIds)id&&cc.add(id);this.PFa=cc}gDf(cc){const Wc=this.V5e(cc.data);G.Health.instance.recordKpiFailure("MipGetPolicyLabel","GetPolicyLabelsFailure",!1,!1,this.Mbc(void 0,Wc,this.wxb));this.wxb=null;this.xEa&&(this.xEa.stop(),this.xEa=null);if(this.Jjb<=this.eWb){if(this.mb.qa("SendHostAttributionInfoForPolicyLabelEnabled")){const id=
cc.data.request.get_headers();if("HostAttributionInfo.ScenarioParamName"in id&&id[eb.a.OPd]&&"HostAttributionInfo.ScenarioTypeParamName"in id&&id[eb.a.PPd]){cc.data.request.get_headers();cc.data.request.get_headers();cc=this.a6c(Wc);this.Bcc(this.N8,cc,this.Tpa,void 0,Wc);return}}this.fgd(this.N8,Wc,this.Tpa)}else b.ULS.sendTraceTag(34996494,306,15,"Request to get label policy failed with error response: {0}.",cc?cc.data?cc.data.QRa:null:null),this.rtc(),this.Jjb=0,this.mNd(!1)}V5e(cc){return cc.state?
cc.state:0}s5a(cc,Wc=!1){let id=String.format("{0}{1}?action={2}&{3}",this.mb.Xa("PolicyHandlerWebServiceBase")||v.AFrameworkApplication.sa.Pa.$V,this.Rhe,cc,v.AFrameworkApplication.Zi);"setpolicylabel"===cc&&v.AFrameworkApplication.uz&&v.AFrameworkApplication.uz.sif&&(id=Na.a.Ol(id,"sl","1"));Wc&&(id=Na.a.Ol(id,"cbd","1"));return id}j7e(cc){let Wc,id;Wc=id=null;cc&&cc.data&&cc.data.request&&cc.data.request.get_headers()&&(Wc=cc.data.request.get_headers()[Cb.a.v1f],id=cc.data.request.get_headers()[Cb.a.Z4f]);
return{u1f:Wc,Y4f:id}}Y_d(cc){cc=cc?cc.data?cc.data.te:null:null;return cc&&cc.length&&!this.nui(cc)?{returnValue:!0,data:cc}:(b.ULS.sendTraceTag(25565152,306,10,"No response data from policy endpoint."),{returnValue:!1,data:cc})}Q3i(cc){let Wc;try{Wc=Fa.b(cc)}catch(id){b.ULS.sendTraceTag(37880331,306,10,"Error when deserializing DataLossPrevention response.");return}if(Wc)if(Wc.IsPolicyTipAvailable)switch(Wc.IsPolicyTipAvailable.toLowerCase()){case "false":b.ULS.sendTraceTag(26007261,306,50,"policyData.IsPolicyTipAvailable is false so DLP policy tip is not present.");
break;case "true":b.ULS.sendTraceTag(25565186,306,50,"DLP Policy is enabled on this document.");this.zJc=Wc.NavigateUrl;this.uJj(Wc.GeneralText,Object(e.a)(this,this.zQi,"onDataLossPolicyOverrideButtonClick"));break;default:b.ULS.sendTraceTag(26007262,306,10,"policyData.IsPolicyTipAvailable is expected to be 'true' or 'false' but it is {0}",Wc.IsPolicyTipAvailable)}else b.ULS.sendTraceTag(26007260,306,10,"policyData.IsPolicyTipAvailable is null or empty whereas it should be 'true' or 'false'.");else b.ULS.sendTraceTag(25565185,
306,10,"policyData is null after deserializing DataLossPrevention response.")}eah(cc){switch(cc){case "CoherencyFailure":return 1;case "DisabledByPolicy":return 2;case "FileCheckedOut":return 3;case "FileEncrypted":return 4;case "FileLocked":return 5;case "FileNotSupported":return 6;case "FileTooLarge":return 7;case "InvalidOperationOnZeroByteFile":return 8;case "LabelDisabled":return 9;case "LabelErrorRetryLater":return 10;case "LabelIdNotFound":return 11;case "LabelIrmDisabledByTenant":return 12;
case "LabelNotSupported":return 13;case "MinorVersionLimitExceeded":return 15;default:return 0}}h4i(cc,Wc,id,Tc){var Gd=Tc?Tc.QP:2;let Wd=0,Dd="",Kd;if(({At:Kd}=Fa.d(cc)).returnValue)if(Kd){Dd="Success";cc=this.a6c(3);if(Kd.IsSuccessful){G.Health.instance.recordKpiSuccess("MipSetPolicyLabel",this.Mbc(Gd,void 0,this.PMb));this.$Cb=this.PMb=null;b.ULS.sendTraceTag(51233632,306,50,"setPolicyLabel was successful as seen after deserializing set policy label data response. ApplyLabelFlag: {0}",Gd);2===
Gd&&this.Oda(29);this.qBj(Wc,Gd);this.KLi();this.Oda(28);Tc&&4===Gd&&this.x_b(28,CommonUIStrings.l_PolicyBusinessBarTitle,String.format(CommonUIStrings.l_PolicyLabelAutomaticallyAppliedMessage,Tc.displayName),CommonUIStrings.l_DialogOk,()=>{});C.a("MipAppliedLabels",void 0,void 0,[Object.assign(new za.a,{name:"SetPolicyLabelApplyFlag",string:qa[Gd]})]);this.Bcc(Wc,cc,this.Tpa,void 0,3);return}b.ULS.sendTraceTag(51233631,306,10,"setPolicyLabel was unsuccessful as seen after deserializing set policy label data response. ApplyLabelFlag: {0}, FailureReason: {1}",
Gd,Kd.FailureReason);this.$Cb=Kd.FailureReason;this.mb.getBooleanFeatureGate("Microsoft.Office.SharedOnline.ImproveSetLabelFailureErrMsg",!1)?Wd=this.eah(Kd.FailureReason):"FileTooLarge"===Kd.FailureReason?Wd=7:"LabelNotSupported"===Kd.FailureReason?Wd=13:"LabelDisabled"===Kd.FailureReason?Wd=9:"MinorVersionLimitExceeded"===Kd.FailureReason&&(Wd=15);this.rui&&0<=Kd.FailureReason.indexOf("InvalidOperationOnZeroByteFile")&&(Tc=new bb.a(2,1,this.vAj,()=>{b.ULS.sendTraceTag(575428443,306,15,"Retring SetPolicyLabelRequestAsync as previous called failed due to zero byte. Attempt number : {0}",
this.Ura);this.Ura<=this.eWb&&this.wSd(Wc,id)}),this.fe.Cg(Tc));this.Hhc&&this.supportsOfficeClientCoauthoring&&this.Bcc(this.Wn.AppliedPolicyId,cc,this.Tpa,!0,3)}else Dd="setPolicyLabelData null.",b.ULS.sendTraceTag(42467541,306,10,"setPolicyLabelData is null after deserializing set policy label data response. ApplyLabelFlag: {0}",Gd);else Dd="TryDeserialize failed.",b.ULS.sendTraceTag(41799709,306,10,"Error when deserializing set policy label data response. ApplyLabelFlag: {0}",Gd);this.SOd(Gd,
Wd);Gd=this.Mbc(Gd,void 0,this.PMb);this.PMb=null;Gd.extendedProperties.set("SetPolicyLabelDataFailureReason",this.$Cb);Gd.extendedProperties.set("SetPolicyLabelDataParseStatus",Dd.toString());G.Health.instance.recordKpiFailure("MipSetPolicyLabel","SetPolicyLabelFailure",!1,!1,Gd)}SOd(cc,Wc=0){const id=2===cc||8===cc||16===cc;this.setPolicyLabel(this.N8);this.aQf(new la);this.wJd(Wc,cc,id,!1)}qBj(cc,Wc){this.setPolicyLabel(this.N8=cc);if(""===cc)v.AFrameworkApplication.protectedFile=!1,v.AFrameworkApplication.enableMacrosForProtectedFile=
!1;else for(const id of this.Wn.SensitivityLabels)if(id.Id===cc){v.AFrameworkApplication.protectedFile=id.IsEndpointProtectionEnabled;break}this.xbj(new ua(cc,Wc))}J_j(){for(const cc of this.Wn.SensitivityLabels)cc&&cc.Enabled&&(cc.Id===this.N8&&(this.tce=this.uDa!==cc.Order,this.uDa=cc.Order),cc.Order>this.bMc&&(this.bMc=cc.Order))}Z3i(cc){if(!({At:cc}=Fa.d(cc)).returnValue)return b.ULS.sendTraceTag(34996495,306,10,"Error when deserializing label policy data response."),!1;if(!cc)return b.ULS.sendTraceTag(42467542,
306,10,"policyData is null after deserializing label policy data response."),!1;if(!cc.AreLabelsAvailable)return!1;this.Wn=cc;this.N8=cc.AppliedPolicyId;this.mb.getBooleanFeatureGate("Microsoft.Office.SharedOnline.AutoCLPV2Transition",!1)&&this.J_j();this.Aha()&&b.ULS.sendTraceTag(51197846,306,50,"Labels are available for display after GetPolicyLabels call.");this.aQf(new la(!0));return!0}Xve(){if(!this.Aha())return b.ULS.sendTraceTag(539877699,306,50,"AreAutoLabelingSensitiveTypesAvailable returned false - No labels to display"),
!1;for(const cc of this.Wn.SensitivityLabels)if(cc&&cc.AutoLabelingSensitiveTypeIds&&0<cc.AutoLabelingSensitiveTypeIds.length)return!0;b.ULS.sendTraceTag(539877700,306,50,"AreAutoLabelingSensitiveTypesAvailable returned false - No labels with AutoClp SIT");return!1}aQf(cc){b.ULS.sendTraceTag(35393610,306,50,"Raising label info update event.");this.fb.raiseEvent("LabelInfoUpdateEvent",cc)}Raj(cc){b.ULS.sendTraceTag(50676305,306,50,"Raising get policy label event.");this.fb.raiseEvent("GetPolicyLabelEventKey",
cc)}rtc(){N.DRa(!1);this.fb.raiseEvent("GetPolicyLabelFailureEventKey",new Ha)}lJd(cc){this.qP&&this.qP.execute(Wc=>{Wc=[Wc.isFeatureEnabled("MsoClpSpTwo",!0),Wc.isFeatureEnabled("MsoDrmPremiumSpTwo",!0)];Promise.all(Wc).then(id=>{Tb.a.any(id,Tc=>Tc)&&(b.ULS.sendTraceTag(50944077,306,50,"Raising get auto policy label event."),this.fb.raiseEvent("GetAutoPolicyLabelEventKey",cc),this.mb.getBooleanFeatureGate("Microsoft.Office.SharedOnline.EnableSecurityNodesAfterLicenseCheck",!1)&&this.tsb(),C.a("MipAutoClassificationEnabled"));
return null})})}ugd(cc=null,Wc=null){const id=new Map;id.set("ClpCoauth",this.supportsOfficeClientCoauthoring.toString());null!=cc&&id.set("ApplyLabelFlags",qa[cc]);null!=Wc&&id.set("GetPolicyLabelsReason",Ka[Wc]);return id}Mbc(cc=null,Wc=null,id=null){const Tc=new ha.a;Tc.extendedProperties=this.ugd(cc,Wc);null!=id&&(Tc.durationMs=this.Ew()-id);return Tc}xbj(cc){b.ULS.sendTraceTag(41799710,306,50,"Raising set policy label event.");this.fb.raiseEvent("SetPolicyLabelEventKey",cc)}MPf(cc){b.ULS.sendTraceTag(51128227,
306,50,"Raising an add auto policy business bar entry event.");cc&&cc.wBb&&C.a("MipRecommendations");this.fb.raiseEvent("AddAutoPolicyBusinessBarEntryEventKey",cc)}pQf(cc){b.ULS.sendTraceTag(51128256,306,50,"Raising an remove auto policy business bar entry event.");this.fb.raiseEvent("RemoveAutoPolicyBusinessBarEntryEventKey",cc)}raj(cc){b.ULS.sendTraceTag(573842331,306,50,"Raising an add mandatory labelling business bar entry event.");this.fb.raiseEvent("AddMandatoryLabellingBusinessBarEntryEventKey",
cc)}sbj(cc){b.ULS.sendTraceTag(573842332,306,50,"Raising a remove mandatory labelling business bar entry event.");this.fb.raiseEvent("RemoveMandatoryLabellingBusinessBarEntryEventKey",cc)}uJj(cc,Wc=null){b.ULS.sendTraceTag(34996496,306,50,"Showing policy tip to user.");this.fb.raiseEvent("PolicyTipEvent",new Za(CommonUIStrings.l_PolicyBusinessBarTitle,cc,CommonUIStrings.l_PolicyOverrideButton,Wc))}wJd(cc,Wc,id,Tc=!0){b.ULS.sendTraceTag(42074656,306,Tc?50:15,"Raising set policy label failure event. ApplyLabelFlags: {0}",
Wc);Tc=CommonUIStrings.l_SensitivityApplicationErrorBusinessBarTitle;let Gd=CommonUIStrings.l_SensitivityApplicationErrorBusinessBarMessage,Wd=null,Dd=null;switch(cc){case 2:Tc=CommonUIStrings.l_SensitivityApplicationErrorDisabledByPolicyBusinessBarTitle;Gd=CommonUIStrings.l_SensitivityApplicationErrorDisabledByPolicyBusinessBarMessage;break;case 5:Gd=CommonUIStrings.l_SensitivityApplicationErrorFileLockedBusinessBarMessage;break;case 7:Tc=CommonUIStrings.l_SensitivityApplicationErrorFileTooLargeBusinessBarTitle;
Gd=CommonUIStrings.l_SensitivityApplicationErrorFileTooLargeBusinessBarMessage;break;case 13:Tc=CommonUIStrings.l_SensitivityApplicationErrorLabelNotSupportedBusinessBarTitle;Gd=CommonUIStrings.l_SensitivityApplicationErrorLabelNotSupportedBusinessBarMessage;break;case 9:Tc=CommonUIStrings.l_SensitivityApplicationErrorLabelDisabledBusinessBarTitle;Gd=CommonUIStrings.l_SensitivityApplicationErrorLabelDisabledBusinessBarMessage;break;case 10:Gd=CommonUIStrings.l_SensitivityApplicationErrorLabelErrorRetryLaterBusinessBarMessage;
break;case 14:Tc=CommonUIStrings.l_SensitivityCoauthMandatoryApplicationErrorTitle;Gd=CommonUIStrings.l_SensitivityCoauthMandatoryApplicationErrorMessage;break;case 15:Tc=CommonUIStrings.l_SensitivityApplicationErrorMinorVersionLimitReachedBusinessBarTitle,Gd=CommonUIStrings.l_SensitivityApplicationErrorMinorVersionLimitReachedBusinessBarMessage,Wd=CommonUIStrings.l_LearnMore,Dd=()=>{this.wAj()}}cc=new sa(cc,Wc,id,Tc,Gd,Wd,Dd);this.fb.raiseEvent("SetPolicyLabelFailureEventKey",cc)}Izj(cc){this.aPc=
cc}zQi(){this.zJc?(b.ULS.sendTraceTag(25565187,306,50,"DLP override button was clicked."),Mb.a.bV(this.zJc)):b.ULS.sendTraceTag(25565188,306,10,"Null NavigateUrl got in policy response. Could not navigate to SPO.")}nui(cc){if(!cc.startsWith("<")||-1===cc.indexOf("Error")&&-1===cc.indexOf("Unavailable"))return!1;b.ULS.sendTraceTag(25565189,306,10,"The response from server is not a valid JSON response and it matches the error page keyword. This might be the error response from a non-existing endpoint.");
return!0}wMf(){this.$Wb&&(this.$Wb.stop(),this.$Wb=null)}zOh(cc){if(!cc)return"manual";switch(cc.QP){case 0:return"manual";case 4:return"auto";case 1:return"default";case 16:return"mandatory";case 2:return"manual";case 8:return"recommended";default:return"manual"}}GPh(cc){if(!cc)return"privileged";cc=cc.QP;let Wc="privileged";if(4===cc||1===cc)Wc="standard";return Wc}Bcc(cc,Wc,id=null,Tc=!1,Gd=0){this.mb.qa("WacLabelingGetPolicyLabelsIsEnabled")&&(this.N8=cc,this.Tpa=id,this.Bh&&(this.xEa=this.Bh.Ac("WebServiceCall",
"Call Get Policy Endpoint On Server")),id={},id[Cb.a.lSg]=cc,this.mb.qa("SendHostAttributionInfoForPolicyLabelEnabled")?(cc=new dc(this.s5a("getpolicylabels",Tc),1,null,id,!0,2,Gd,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,Wc),this.yh.send(cc).SKd(Object(e.a)(this,this.hDf,"onGetPolicyLabelsSuccessCallback"),Object(e.a)(this,this.gDf,"onGetPolicyLabelsFailureCallback"))):this.yh.Rm(this.s5a("getpolicylabels",Tc),1,null,id,!0,2,Object(e.a)(this,this.hDf,"onGetPolicyLabelsSuccessCallback"),
Object(e.a)(this,this.gDf,"onGetPolicyLabelsFailureCallback"),Gd,void 0,void 0,void 0,void 0,"22"),this.Jjb++,b.ULS.sendTraceTag(34996492,306,50,"Policy label request sent to server. Policy call times: {0}",this.Jjb))}uAj(cc,Wc,id,Tc=null){if(this.Yzb){this.Bh&&(this.RFa=this.Bh.Ac("WebServiceCall","Call Set Policy Endpoint On Server"));var Gd={};Gd[Cb.a.v1f]=cc;Wc&&(Gd[Cb.a.Z4f]=encodeURIComponent(Wc));this.aPc&&(Gd[Cb.a.CRg]=this.aPc);Tc?(Gd[Cb.a.W4f]=this.zOh(Tc),Gd[Cb.a.X4f]=this.GPh(Tc)):(Gd[Cb.a.W4f]=
"manual",Gd[Cb.a.X4f]="privileged");this.supportsOfficeClientCoauthoring&&this.Wn&&(Gd[Cb.a.W5i]=this.Wn.PolicyLabelVersionToken);this.mb.qa("SendHostAttributionInfoForPolicyLabelEnabled")?(cc=new dc(this.s5a("setpolicylabel",!0),1,null,Gd,!0,2,Tc,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,id),this.yh.send(cc).SKd(Object(e.a)(this,this.aIf,"onSetPolicyLabelSuccessCallback"),Object(e.a)(this,this.$Hf,"onSetPolicyLabelFailureCallback"))):this.yh.Rm(this.s5a("setpolicylabel",
!0),1,null,Gd,!0,2,Object(e.a)(this,this.aIf,"onSetPolicyLabelSuccessCallback"),Object(e.a)(this,this.$Hf,"onSetPolicyLabelFailureCallback"),Tc,void 0,void 0,void 0,void 0,"32");this.Ura++;b.ULS.sendTraceTag(41799706,306,50,"Set policy label request sent to server. Policy call times: {0}",this.Ura)}else b.ULS.sendTraceTag(570972052,306,50,"SetPolicyLabelRequestInternalAsync was exited - ApplyManualPolicyLabel was not enabled.")}wAj(){const cc=new W.StandardDialog,Wc=this.mb.Xa("BreadcrumbFolderUrl");
Wc?(cc.Rb=11,cc.oc(1,CommonUIStrings.l_SensitivityApplicationErrorMinorVersionLimitReachedViewInfoAction),cc.oc(2,CommonUIStrings.l_DialogOk)):(cc.Rb=0,cc.oc(1,CommonUIStrings.l_DialogOk));cc.Mpe(CommonUIStrings.l_SensitivityApplicationErrorMinorVersionLimitReachedViewInfoHelpText,"0f6cd105-974f-44a4-aadb-43ac5bdfd247");cc.Nhj();cc.oX(CommonUIStrings.l_SensitivityApplicationErrorMinorVersionLimitReachedViewInfoTitle,CommonUIStrings.l_SensitivityApplicationErrorMinorVersionLimitReachedViewInfoMessage,
id=>{1===id&&Wc&&Mb.a.lf(Wc,"_blank",void 0,"SetPolicyLabelFailureBusinessBarActionCallback.BreadcrumbFolderUrl")})}a6c(cc){switch(cc){case 1:return eb.a.Aia(1,1);case 2:return eb.a.Aia(7,1);case 3:return eb.a.Aia(8,1);default:return eb.a.Aia(7,0)}}Pdh(cc=null){if(!cc)return eb.a.Aia(8,0);switch(cc.QP){case 1:case 16:return eb.a.Aia(1,1);case 4:case 2:case 8:return eb.a.Aia(8,1);default:return eb.a.Aia(8,0)}}mNd(cc){this.mb.getBooleanFeatureGate("Microsoft.Office.SharedOnline.GeneralizedRibbonTTVRReporting",
!1)&&appChrome.api.setAsyncRequestStatus("sensitivity",cc)}}Object(c.a)(fb,"PolicyManager",null,[362]);var rb=a(137),pa=a(248);class Ma{constructor(){this.L1=this.Dra=this.gb=this.Qg=null}get name(){return"Common.App.Policy"}init(){v.AFrameworkApplication.fa.qa("ShouldInitCommonPolicyPackage")&&(v.AFrameworkApplication.fa.qa("IsDataLossPreventionEnabledForUser")&&v.AFrameworkApplication.sa&&(this.Qg=this.gb.resolve("Common.App.Policy.Contracts.IPolicyManager"),this.Qg.ise(Object(e.a)(this,this.EVd,
"showPolicyBusinessBar")),b.ULS.sendTraceTag(36537375,306,50,"PolicyManager is created successfully."),rb.a.get_instance().Ck(6,()=>{this.Qg.ggd()})),v.AFrameworkApplication.fa.qa("WacLabelingPoliciesIsEnabled")&&v.AFrameworkApplication.fa.qa("SupportsPolicies")?rb.a.get_instance().Ck(6,Object(e.a)(this,this.DNi,"onAfterRibbonBehaviorAttached")):N.DRa(!1))}dispose(){}Vh(cc){cc.register(362,"Common.App.Policy.Contracts.IPolicyManager").xc().Fc(()=>new fb(v.AFrameworkApplication.fa,v.AFrameworkApplication.Bd,
v.AFrameworkApplication.sa.mE,v.AFrameworkApplication.fa.ud("MaxGetPolicyRetries",1),cc.Ub("Common.App.ApplicationFeatureHelper.IApplicationFeatureHelper"),v.AFrameworkApplication.sa.Pa.Fj));cc.register(N,"Common.App.Policy.PolicyActor").as("Common.App.Policy.Contracts.IPolicyActor").xc().Fc(()=>new N(v.AFrameworkApplication.ub,v.AFrameworkApplication.sa,v.AFrameworkApplication.fa,cc.wOd("Common.App.Policy.Contracts.IPolicyManager")));this.gb=cc}DNi(){this.L1=this.gb.Jh("CommonUI.BusinessBar");this.Qg||
(this.Qg=this.gb.resolve("Common.App.Policy.Contracts.IPolicyManager"));this.Dra=this.gb.resolve("Common.App.Policy.PolicyActor");v.AFrameworkApplication.fa&&v.AFrameworkApplication.fa.getBooleanFeatureGate("Microsoft.Office.SharedOnline.CacheSensitivityVisibility",!1)&&M.a("isSharedUxGateEnabled")&&appChrome.api.isSharedUxGateEnabled("SharedOnline.ChangeGate.DelayPolicyActionRegistration")?this.Qg.k0b(Object(e.a)(this.Dra,this.Dra.XSf,"registerActionsHandler")):this.Dra.Fg();this.Qg.k0b(Object(e.a)(this,
this.l1d,"updateLabelInfo"));v.AFrameworkApplication.fa.qa("WacApplyManualPolicyLabelIsEnabled")&&(this.Qg.OXc(Object(e.a)(this,this.Bai,"handleSetPolicyLabelFailure")),this.Qg.Tqe(Object(e.a)(this,this.x_b,"addAutoPolicyBusinessBarEntry")),this.Qg.lse(Object(e.a)(this,this.Oda,"removeAutoPolicyBusinessBarEntry")),this.Qg.Uqe(Object(e.a)(this,this.KWc,"addMandatoryLabellingBusinessBarEntry")),this.Qg.mse(Object(e.a)(this,this.OLd,"removeMandatoryLabellingBusinessBarEntry")))}l1d(){this.Dra.R4f();
this.Dra.k4f();this.Dra.yPf();const cc=this.Qg.L3g();v.AFrameworkApplication.fa.qa("HasDocumentEditRights")&&!cc?this.Dra.Zeg():b.ULS.sendTraceTag(558682911,306,50,"Default/Mandatory Labeling has been skipped because HasDocumentEditRights: {0}, IsClpBlockedByAppSpecificScenario: {1}",v.AFrameworkApplication.fa.qa("HasDocumentEditRights"),cc);v.AFrameworkApplication.sa.updateCommandUI()}EVd(cc,Wc){this.T5e(Wc.title,Wc.ksc,38,Wc.Qzf,Wc.buttonText);b.ULS.sendTraceTag(34174784,306,10,"Failed to add entry to business bar. Policy message could not be shown to user.")}Bai(cc,
Wc){Wc.Y8f&&(this.T5e(Wc.title,Wc.message,21,null,null,Wc.o3,Wc.buttonText),b.ULS.sendTraceTag(42074654,306,10,"Failed to add entry to business bar. CLP policy message could not be shown to user."))}Oda(){}x_b(cc,Wc){this.L1&&(this.Qg.Oda(Wc.vqb),cc=new f.a(Wc.title,Wc.message,null),cc.id=Wc.vqb,cc.closeable=!0,cc.image=3,cc.addButton(Wc.buttonText,Wc.o3,Wc.buttonText,!0),this.L1.HC(cc,!1))}KWc(cc,Wc){this.L1&&(cc=new f.a(Wc.title,Wc.message,null),cc.id=Wc.vqb,cc.closeable=!1,cc.image=3,cc.addButton(Wc.buttonText,
Wc.o3,Wc.buttonText,!1),this.L1.HC(cc,!1))}OLd(){}T5e(cc,Wc,id,Tc=null,Gd=null,Wd=null,Dd=null){cc=new f.a(cc,Wc,null);cc.id=id;cc.closeable=!0;Tc&&cc.sJg(Gd,Tc);Wd&&cc.addButton(Dd,Wd,Dd)}static main(){pa.a.instance.Ei(new Ma)}}Object(c.a)(Ma,"PackageManager",null,[4,5]);var Ja=a(9),Ga=a(552),La=a(222),nb=a(50),Lb=a(37),ac=a(82),ib=a(38),Ra=a(174),ya=a(371),Va=a(188),oa=a(91),kb=a(29),Sa=a(282),U=a(1),ta=a(22),ub=a(281);class hc{constructor(){this.jsc=this.k2f=null;this.QP=0}}Object(c.a)(hc,"ApplyPolicyContextParameters",
null,[]);var Bc=a(7),Qa=a(691),na=a(562),ab=a(47),Gb=a(46);class fc{constructor(){this.jHa=this.annotationType=null;this.XMa=this.wy=!1}}Object(c.a)(fc,"AnnotationActivationOptions",null,[]);var pb=a(60);const Ea=(cc,Wc,id,Tc,Gd,Wd,Dd=null)=>{Dd=cc.Na(1,Dd);Dd.tenantId=Wc;return pb.g(cc,"GetPolicyLabelId",Dd,id,Tc,Gd,Wd,4)},xb=(cc,Wc,id,Tc,Gd,Wd,Dd,Kd,we,We,Od=null)=>{Od=cc.Na(41,Od);Od.labelsInfoJson=Wc;Od.appliedLabelId=id;Od.tenantId=Tc;Od.applyLabelFlag=Gd;Od.skipApplyOutcomes=Wd;return pb.g(cc,
"ApplyPolicyLabel",Od,Dd,Kd,we,We,0)},bc=(cc,Wc,id,Tc,Gd,Wd,Dd=null)=>{Dd=cc.Na(1,Dd);Dd.tenantId=Wc;return pb.g(cc,"GetPolicyApplicationMethod",Dd,id,Tc,Gd,Wd,4)};var zb=a(722),Ub=a(697);class wc extends zb.a{constructor(){super();this.source=this.automatic=this.recommended=null;this.H_=Object.assign(new Ub.a,{T_:wc.getTypeName(),B_:wc.Pd()})}static getTypeName(){return"AugLoop_SecurityClp_LabellingAnnotation"}static Pd(){return["AugLoop_Core_Annotation"]}}Object(c.a)(wc,"LabellingAnnotation",zb.a,
[]);var mb=a(713);class Db extends mb.a{constructor(){super();this.fullDocSITs=this.partialDocSITs=null;this.H_=Object.assign(new Ub.a,{T_:Db.getTypeName(),B_:Db.Pd()})}static getTypeName(){return"AugLoop_SecurityShared_SecurityShared"}static Pd(){return[]}}Object(c.a)(Db,"SecurityShared",mb.a,[]);class Ic extends Db{constructor(){super();this.existingLabelPriority=null;this.H_=Object.assign(new Ub.a,{T_:Ic.getTypeName(),B_:Ic.Pd()})}static getTypeName(){return"AugLoop_SecurityShared_CLP"}static Pd(){return["AugLoop_SecurityShared_SecurityShared"]}}
Object(c.a)(Ic,"CLP",Db,[]);class Hc extends zb.a{constructor(){super();this.source=this.automatic=this.recommended=null;this.H_=Object.assign(new Ub.a,{T_:Hc.getTypeName(),B_:Hc.Pd()})}static getTypeName(){return"AugLoop_Automatic_Clp_LabellingAnnotation"}static Pd(){return["AugLoop_Core_Annotation"]}}Object(c.a)(Hc,"LabellingAnnotation",zb.a,[]);var Ab=a(969),db=a(865),Pb=a(971);class td extends zb.a{constructor(){super();this.classificationId=null;this.H_=Object.assign(new Ub.a,{T_:td.getTypeName(),
B_:td.Pd()})}static getTypeName(){return"AugLoop_LinkedDataType_LinkedDataTypeAnnotation"}static Pd(){return["AugLoop_Core_Annotation"]}}Object(c.a)(td,"LinkedDataTypeAnnotation",zb.a,[]);class Vb extends ib.a{constructor(cc,Wc,id,Tc,Gd){super();this.wuf=3;this.YA=this.augmentationLoopManager=null;this.N_a=!1;this.Eab=[];this.$of=new Qa.a(na.a.zK());this.YHd=0;this.cId=null;this.tsb=(Wd,Dd)=>{Wd=Object(Bc.a)(new Ab.a,{parentPath:["session","doc","security"],items:[Object(Bc.a)(new db.a,{id:"clp",
body:Object(Bc.a)(new Ic,{existingLabelPriority:Dd.existingLabelPriority,partialDocSITs:Dd.pEe,fullDocSITs:Dd.oEe})})]});this.Eab.push(Wd);this.yzb()};this.Chg=(Wd,Dd)=>{Wd=Object(Bc.a)(new Pb.a,{parentPath:["session","doc","security"],items:[Object(Bc.a)(new db.a,{id:"clp",body:Object(Bc.a)(new Ic,{existingLabelPriority:Dd.existingLabelPriority})})]});this.Eab.push(Wd);this.yzb()};this.Dhg=(Wd,Dd)=>{Wd=Object(Bc.a)(new Pb.a,{parentPath:["session","doc","security"],items:[Object(Bc.a)(new db.a,{id:"clp",
body:Object(Bc.a)(new Ic,{partialDocSITs:Dd.pEe,fullDocSITs:Dd.oEe})})]});this.Eab.push(Wd);this.yzb()};this.CR=()=>{b.ULS.sendTraceTag(537154588,306,50,`AutoPolicyManager::OnApplicationModeChanged - isEditMode:${this.$.isEditMode}.`);this.$.isEditMode?U.EwaSettings.getBooleanFeatureGate("Microsoft.Office.SharedOnline.AutoCLPV2Transition",!1)?this.yzb():this.eef():(this.businessBar.removeEntry(41),this.businessBar.removeEntry(40),this.Kjh())};this.BPa=()=>{b.ULS.sendTraceTag(537154587,306,50,"AutoPolicyManager::OnAugmentationLoopSessionClose called.");
this.VLe();this.augmentationLoopManager=null};this.lyi=(Wd,Dd)=>{var Kd,we,We,Od,le;b.ULS.sendTraceTag(537154586,306,50,"AutoPolicyManager::LabellingAnnotationHandler called.");if(3===Dd.operationType)b.ULS.sendTraceTag(537154585,306,50,"AutoPolicyManager::LabellingAnnotationHandler Ignoring delete operation.");else{var de=Wd=null,Re=null;if(this.shc()){var Ee=Dd.EM;if(!Ee){b.ULS.sendTraceTag(537154584,306,50,"AutoPolicyManager::LabellingAnnotationHandler LabellingAnnotation is null.");return}if(null===
(Kd=Ee.automatic)||void 0===Kd?0:Kd.id)Wd=Ee.automatic.id;if(null===(we=Ee.recommended)||void 0===we?0:we.id)de=Ee.recommended.id,Ee.recommended.policyTip&&(Re=Ee.recommended.policyTip)}else{Kd=Dd.EM;if(!Kd){b.ULS.sendTraceTag(537154583,306,50,"AutoPolicyManager::LabellingAnnotationHandler LabellingAnnotation is null.");return}if(null===(We=null===(Ee=Kd.automatic)||void 0===Ee?void 0:Ee.sensitivityLabel)||void 0===We?0:We.id)Wd=Kd.automatic.sensitivityLabel.id;if(null===(le=null===(Od=Kd.recommended)||
void 0===Od?void 0:Od.sensitivityLabel)||void 0===le?0:le.id)de=Kd.recommended.sensitivityLabel.id,Kd.recommended.sensitivityLabel.policyTip&&(Re=Kd.recommended.sensitivityLabel.policyTip)}this.applyPolicyLabel(Wd,de,Re,1)}};this.gAi=(Wd,Dd)=>{b.ULS.sendTraceTag(537154582,306,50,"AutoPolicyManager::LinkedDataTypeLabellingAnnnotationHandler - Handler called.");3===Dd.operationType?b.ULS.sendTraceTag(537154581,306,50,"AutoPolicyManager::LinkedDataTypeLabellingAnnnotationHandler - Received delete operation."):
(Wd=Dd.EM)?(Wd=Wd.classificationId,this.applyPolicyLabel(Wd,Wd,null,2)):b.ULS.sendTraceTag(537154580,306,50,"AutoPolicyManager::LinkedDataTypeLabellingAnnnotationHandler - Received an empty annotation.")};this.$Tf=(Wd,Dd)=>{Dd?Dd.wBb&&this.businessBar.cF(41)?(this.businessBar.removeEntry(41),b.ULS.sendTraceTag(537154562,306,50,"Remove entry to RecommendedSensitivityLabelBusinessBarEntry succeeded.")):!Dd.wBb&&this.businessBar.cF(40)&&(this.businessBar.removeEntry(40),b.ULS.sendTraceTag(537154561,
306,50,"Remove entry to AutomaticSensitivityLabelBusinessBarEntry succeeded.")):b.ULS.sendTraceTag(537154563,306,15,"RemoveAutoPolicyBusinessBar is called but AddAutoPolicyBusinessBarEntryEventArgs is null.")};this.k8f=(Wd,Dd)=>{Dd?Dd.wBb?(this.businessBar.IJj(Dd.title,Dd.message,Dd.buttonText,Kd=>{Dd.o3(Kd);this.businessBar.cF(41)&&this.businessBar.removeEntry(41)}),b.ULS.sendTraceTag(537154531,306,50,"Add entry to RecommendedSensitivityLabelBusinessBarEntry succeeded. Message is shown to user.")):
(this.businessBar.AHj(Dd.title,Dd.message,Dd.buttonText,Kd=>{Dd.o3(Kd);this.businessBar.cF(40)&&this.businessBar.removeEntry(40)}),b.ULS.sendTraceTag(537154530,306,50,"Add entry to AutomaticSensitivityLabelBusinessBarEntry succeeded. Message is shown to user.")):b.ULS.sendTraceTag(537154560,306,15,"ShowAutoPolicyBusinessBar is called but AddAutoPolicyBusinessBarEntryEventArgs is null.")};this.MGd=cc;this.policyManager=Wc;this.$=id;this.fa=Tc;this.businessBar=Gd;this.Bfi();this.Wej();this.disposed=
!1}get Zb(){return!this.disposed&&this.$.ea.Zb}dispose(){this.disposed||(this.disposed=!0,this.Alh(),this.VLe(),this.MGd=this.policyManager=this.augmentationLoopManager=null,super.dispose())}t_a(cc,Wc,id,Tc,Gd=!1){b.ULS.sendTraceTag(537154642,306,50,`AutoPolicyManager: ApplyAutoPolicyLabel called for LabellingSource ${Tc} with AutoLabelPresent: ${!!cc}, RecommendedLabelPresent: ${!!Wc}, isStandard: ${Gd}.`);this.Zb?this.MGd&&(this.t1g(Wc,Tc)?(this.cId=Wc,this.YHd=Tc,this.$of.ia(Tc,Wc)):Wc=this.cId,
cc=this.MGd.t_a(cc,Wc,id,Gd),b.ULS.sendTraceTag(537154640,306,50,`AutoPolicyManager::ApplyAutoPolicyLabel - policyActor.ApplyAutoPolicyLabel returned ${cc}.`)):b.ULS.sendTraceTag(537154641,306,15,`AutoPolicyManager: ApplyAutoPolicyLabel failing because IsDisposed: ${this.disposed}, IsSessionActive: ${this.$.ea.Zb}.`)}t1g(cc,Wc){if(!this.policyManager.Aha())return b.ULS.sendTraceTag(537154639,306,15,"CanShowRecommendedSensitivityLabel - Labels are not available."),!1;const id=this.policyManager.Wn;
let Tc;({value:Tc}=this.$of.Dc(this.YHd));let Gd=null,Wd=null,Dd=null;for(const Kd of id.SensitivityLabels)Kd.Id===cc&&(Gd=Kd),Kd.Id===Tc&&(Wd=Kd),Kd.Id===this.cId&&(Dd=Kd);return Wd&&Wd.Id===cc?(b.ULS.sendTraceTag(537154638,306,50,"AutoPolicyManager: CanShowRecommendedSensitivityLabel - Suppressing the recommendation since it is same as last recommendation from current source."),!1):this.businessBar.cF(41)&&this.YHd!==Wc&&Dd&&(!Gd||Dd.Order>=Gd.Order)?(b.ULS.sendTraceTag(537154637,306,50,"AutoPolicyManager: CanShowRecommendedSensitivityLabel - Suppressing the recommendation since current label priority is lower than last label priority."),
!1):!0}shc(){return U.EwaSettings.getBooleanFeatureGate("Microsoft.Office.SharedOnline.AutoCLPV2Transition",!1)}Hgf(){return U.EwaSettings.getBooleanFeatureGate("Microsoft.Office.SharedOnline.AutoCLPSecurityNodeCreation",!1)}Wej(){this.policyManager.Tqe(this.k8f);this.policyManager.lse(this.$Tf);this.$.ea.FY(this.CR);this.shc()&&this.Hgf()&&(this.policyManager.qMg(this.tsb),this.policyManager.jPg(this.Chg),this.policyManager.kPg(this.Dhg))}Alh(){this.businessBar.removeEntry(41);this.businessBar.removeEntry(40);
this.policyManager.Fij(this.k8f);this.policyManager.Ykj(this.$Tf);this.$.ea.C0(this.CR);this.shc()&&this.Hgf()&&(this.policyManager.njj(this.tsb),this.policyManager.Elj(this.Chg),this.policyManager.Flj(this.Dhg))}Bfi(){this.YA=new Qa.a(na.a.zK());const cc=this.shc()?wc.getTypeName():Hc.getTypeName();this.YA.add(1,Object(Bc.a)(new fc,{annotationType:cc,jHa:this.lyi,wy:!1,XMa:!1}));this.YA.add(2,Object(Bc.a)(new fc,{annotationType:td.getTypeName(),jHa:this.gAi,wy:!1,XMa:!1}))}Abg(){for(let cc of this.Eab)this.augmentationLoopManager.submitOperation(cc);
this.Eab=[]}Rej(cc){if(!this.YA.lb(cc))return b.ULS.sendTraceTag(537154636,306,15,`AutoPolicyManager::RegisterAnnotation - AnnotationActivationOptions not available for LabellingSource ${cc}.`),!1;if(this.YA.oa(cc).wy)return b.ULS.sendTraceTag(537154635,306,15,`AutoPolicyManager::RegisterAnnotation - Annotations already registered for LabellingSource ${cc}.`),!0;this.YA.oa(cc).wy=!0;b.ULS.sendTraceTag(537154634,306,50,`AutoPolicyManager::RegisterAnnotation - Annotations registered for LabellingSource ${cc}.`);
if(!this.$.isEditMode)return b.ULS.sendTraceTag(537154633,306,50,"AutoPolicyManager::RegisterAnnotation - Skipping AugmentationLoop initialization in view mode."),!0;U.EwaSettings.getBooleanFeatureGate("Microsoft.Office.SharedOnline.AutoCLPV2Transition",!1)?this.yzb():this.eef();return!0}eef(){var cc=!1;for(let Wc of this.YA)if(cc=Wc.value.wy||cc)break;cc?this.augmentationLoopManager?(b.ULS.sendTraceTag(537154631,306,50,"AutoPolicyManager::InitAugmentationLoopIfNecessaryAndActivateAnnotations - AugmentationLoop already initialized."),
this.XZb()):this.N_a?b.ULS.sendTraceTag(537154630,306,50,"AutoPolicyManager::InitAugmentationLoopIfNecessaryAndActivateAnnotations - AugmentationLoop initialization in-progress."):(this.N_a=!0,cc=this.$.va.FlightingSettings.AutoCLPStartUpDelay,b.ULS.sendTraceTag(537154629,306,50,`AutoPolicyManager::InitAugmentationLoopIfNecessaryAndActivateAnnotations - Initializing AugmentationLoop in ${cc} milliseconds.`),ab.a.instance.create(()=>{this.Dfi()},cc,Gb.a.txe,!0,!0)):b.ULS.sendTraceTag(537154632,306,
50,"AutoPolicyManager::InitAugmentationLoopIfNecessaryAndActivateAnnotations - no registered annotations.")}yzb(){var cc=0<this.Eab.length;if(!cc)for(let Wc of this.YA)if(cc=Wc.value.wy||cc)break;cc?this.augmentationLoopManager?(b.ULS.sendTraceTag(537154627,306,50,"AutoPolicyManager::InitAugmentationLoopIfNecessary - AugmentationLoop already initialized."),this.XZb(),this.Abg()):this.N_a?b.ULS.sendTraceTag(537154626,306,50,"AutoPolicyManager::InitAugmentationLoopIfNecessary - AugmentationLoop initialization in-progress."):
(this.N_a=!0,cc=this.$.va.FlightingSettings.AutoCLPStartUpDelay,b.ULS.sendTraceTag(537154625,306,50,`AutoPolicyManager::InitAugmentationLoopIfNecessary - Initializing AugmentationLoop in ${cc} milliseconds.`),ab.a.instance.create(()=>{this.Efi()},cc,Gb.a.txe,!0,!0)):b.ULS.sendTraceTag(537154628,306,50,"AutoPolicyManager::InitAugmentationLoopIfNecessary - no registered annotations and operations.")}Efi(){Lb.TaskExtensions.Aa(nb.GetServiceTaskFactory.Oa(this.$.da,328,327,1),cc=>{this.augmentationLoopManager=
cc.result;this.N_a=!1;this.augmentationLoopManager?(b.ULS.sendTraceTag(537154595,306,50,"AutoPolicyManager::InitAugmentationLoop - AugmentationLoopManager instantiated."),this.augmentationLoopManager.z_b(this.BPa),this.$.isEditMode?(this.XZb(),this.Abg()):b.ULS.sendTraceTag(537154594,306,50,"AutoPolicyManager::InitAugmentationLoop - Skipping annotation activation in view mode.")):b.ULS.sendTraceTag(537154624,306,10,"AutoPolicyManager::InitAugmentationLoop - Failed to instantiate AugmentationLoopManager.")},
this.la,3)}Dfi(){Lb.TaskExtensions.Aa(nb.GetServiceTaskFactory.Oa(this.$.da,328,327,1),cc=>{this.augmentationLoopManager=cc.result;this.N_a=!1;this.augmentationLoopManager?(b.ULS.sendTraceTag(571479120,306,50,"AutoPolicyManager::InitAugmentationLoop - AugmentationLoopManager instantiated."),this.augmentationLoopManager.z_b(this.BPa),this.$.isEditMode?this.XZb():b.ULS.sendTraceTag(537154592,306,50,"AutoPolicyManager::InitAugmentationLoop - Skipping annotation activation in view mode.")):b.ULS.sendTraceTag(537154593,
306,10,"AutoPolicyManager::InitAugmentationLoop - Failed to instantiate AugmentationLoopManager.")},this.la,3)}VLe(){for(let cc of this.YA)cc.value.wy&&this.zlh(cc.key)}zlh(cc){this.YA.oa(cc).XMa&&this.UKe(cc);this.YA.oa(cc).wy=!1;b.ULS.sendTraceTag(537154591,306,50,`AutoPolicyManager::DeregisterAnnotation completed for LabellingSource ${cc}.`)}XZb(){for(let cc of this.YA)cc.value.wy&&!cc.value.XMa&&this.activateAnnotation(cc.key)}activateAnnotation(cc){this.augmentationLoopManager.activateAnnotation(this.YA.oa(cc).annotationType);
this.augmentationLoopManager.AY(this.YA.oa(cc).annotationType,this.YA.oa(cc).jHa);this.YA.oa(cc).XMa=!0;b.ULS.sendTraceTag(537154590,306,50,`AutoPolicyManager::ActivateAnnotation completed for LabellingSource ${cc}.`)}Kjh(){for(let cc of this.YA)cc.value.XMa&&this.UKe(cc.key)}UKe(cc){this.augmentationLoopManager.qRa(this.YA.oa(cc).annotationType,this.YA.oa(cc).jHa);this.YA.oa(cc).XMa=!1;b.ULS.sendTraceTag(537154589,306,50,`AutoPolicyManager::DeactivateAnnotation completed for LabellingSource ${cc}.`)}applyPolicyLabel(cc,
Wc,id,Tc){if(this.fa.qa("SupportsOfficeClientCoauthoring"))b.ULS.sendTraceTag(537154579,306,50,"AutoPolicyManager::ApplyPolicyLabel - SupportsOfficeClientCoauthoring is enabled."),this.t_a(cc,Wc,id,Tc);else{b.ULS.sendTraceTag(537154578,306,50,"AutoPolicyManager::ApplyPolicyLabel - SupportsOfficeClientCoauthoring is disabled.");const Gd=Wd=>{this.t_a(cc,Wc,id,Tc,0===Wd||1===Wd||4===Wd)};this.hid(Gd,()=>{Gd(2)},this.wuf)}}PZc(cc,Wc){let id=null,Tc=null;if(!({sensitivityLabel:id,lHa:Tc}=this.Nfg(cc)).returnValue)return b.ULS.sendTraceTag(537154577,
306,15,"AutoApplyOrRecommendPolicyLabel - Failed to set the sensitivity labels."),!1;if(Tc&&Tc.Order>=id.Order)return b.ULS.sendTraceTag(537154576,306,50,"AutoApplyOrRecommendPolicyLabel - The applied label has a higher sensitivty."),!1;this.applyPolicyLabel(id.Id,id.Id,null,Wc);return!0}QZc(cc,Wc){Wc=!1;let id=null,Tc=null;if(!({sensitivityLabel:id,lHa:Tc}=this.Nfg(cc)).returnValue)return b.ULS.sendTraceTag(537154575,306,15,"AutoApplyOrRecommendPowerBILabel - Failed to set the sensitivity labels."),
{returnValue:!1,t7a:Wc};if(Tc&&Tc.ParentId&&id.ParentId&&Tc.ParentId===id.ParentId)return b.ULS.sendTraceTag(537154574,306,50,"AutoPolicyManager::AutoApplyOrRecommendPowerBILabel - Label has a common parent with AppliedLabel."),{returnValue:!1,t7a:Wc};if(Tc&&Tc.Order>=id.Order)return b.ULS.sendTraceTag(537154573,306,50,"AutoPolicyManager::AutoApplyOrRecommendPowerBILabel - Label does not have a higher priority than AppliedLabel."),{returnValue:!1,t7a:Wc};if(this.fa.qa("SupportsOfficeClientCoauthoring"))b.ULS.sendTraceTag(537154572,
306,50,"AutoPolicyManager::AutoApplyOrRecommendPowerBILabel - SupportsOfficeClientCoauthoring is enabled."),cc=this.policyManager.Wn,cc=!cc.AppliedPolicyId||!cc.PolicyLabelAssignmentMethod||T.e(cc.PolicyLabelAssignmentMethod)===T.e("standard"),this.Qve(id.Id,cc);else{b.ULS.sendTraceTag(537154571,306,50,"AutoPolicyManager::AutoApplyOrRecommendPowerBILabel - SupportsOfficeClientCoauthoring is disabled.");const Gd=Wd=>{this.Qve(id.Id,0===Wd||1===Wd||4===Wd)};this.hid(Gd,()=>{Gd(2)},this.wuf)}return{returnValue:!0,
t7a:Wc}}hid(cc,Wc,id,Tc=0){if(this.Zb){var Gd=this.$.pa.ya.Wb();bc(this.$.pa.ya,this.$.va.DocumentHostInfo.TenantId,Wd=>{this.M0h(Wd,cc)},()=>{this.L0h(cc,Wc,id,Tc)},null,null,Gd)}else b.ULS.sendTraceTag(537154570,306,15,`AutoPolicyManager: GetPolicyApplicationMethod failing because IsDisposed: ${this.disposed}, IsSessionActive: ${this.$.ea.Zb}.`)}M0h(cc,Wc){b.ULS.sendTraceTag(537154569,306,50,"AutoPolicyManager: GetPolicyApplicationMethod web service call was successful.");this.Zb?!cc||Sa.a(cc)?
b.ULS.sendTraceTag(537154567,306,15,cc?"AutoPolicyManager: GetPolicyApplicationMethod result has non-status message.":"AutoPolicyManager: GetPolicyApplicationMethod result is null"):Wc(cc.Result):b.ULS.sendTraceTag(537154568,306,50,`AutoPolicyManager: GetPolicyApplicationMethodSuccessCallback failing because IsDisposed: ${this.disposed}, IsSessionActive: ${this.$.ea.Zb}.`)}L0h(cc,Wc,id,Tc){b.ULS.sendTraceTag(537154566,306,15,"AutoPolicyManager: GetPolicyApplicationMethod web service call failed. Trying again");
this.Zb?Tc>=id?(b.ULS.sendTraceTag(537154564,306,15,"AutoPolicyManager: GetPolicyApplicationMethod max retries exhausted."),Wc()):this.hid(cc,Wc,id,Tc+1):b.ULS.sendTraceTag(537154565,306,50,`AutoPolicyManager: GetPolicyApplicationMethodFailureCallback failing because IsDisposed: ${this.disposed}, IsSessionActive: ${this.$.ea.Zb}.`)}Qve(cc,Wc){Wc?this.t_a(cc,null,null,3,!0):this.t_a(null,cc,null,3,!1)}Nfg(cc){let Wc,id;id=Wc=null;if(!this.$.isEditMode)return{returnValue:!1,sensitivityLabel:Wc,lHa:id};
if(!this.policyManager.Aha())return b.ULS.sendTraceTag(537154529,306,15,"TryGettingSensitivityLabels - Labels are not available."),{returnValue:!1,sensitivityLabel:Wc,lHa:id};const Tc=this.policyManager.Wn;if(!Tc)return b.ULS.sendTraceTag(537154528,306,15,"TryGettingSensitivityLabels - GetPolicyLabelsData returned an invalid result."),{returnValue:!1,sensitivityLabel:Wc,lHa:id};if(Tb.a.ph(Tc.SensitivityLabels))return b.ULS.sendTraceTag(537154527,306,15,"TryGettingSensitivityLabels - Attempting to apply labels when there are no sensitivity labels available."),
{returnValue:!1,sensitivityLabel:Wc,lHa:id};const Gd=Tc.AppliedPolicyId;for(const Wd of cc)for(const Dd of Tc.SensitivityLabels)Dd.Id===Wd&&(!Wc||Wc.Order<Dd.Order)&&(Wc=Dd),Dd.Id===Gd&&(id=Dd);return Wc?{returnValue:!0,sensitivityLabel:Wc,lHa:id}:(b.ULS.sendTraceTag(537154526,306,10,"TryGettingSensitivityLabels - None of the sensitivity labels matched."),{returnValue:!1,sensitivityLabel:Wc,lHa:id})}}Object(c.a)(Vb,"AutoPolicyManager",ib.a,[2]);var Ac=a(154),Kc=a(12),dd=a(13);class Vd extends Ac.ErrorDialog{constructor(cc){super(cc,
Vd.PQ(cc))}vq(){super.vq();if(this.error.Appearance&1&&this.$.rd&2){const cc=this.getButton(0);Kc.DOMElementExtensions.KRd(cc.get_element(),dd.a.instance.ga(1309));this.LP(()=>{0===this.returnValue&&this.$.rd&2&&(b.ULS.sendTraceTag(50373725,306,50,"BlockSenitivityLabelActionDialog : Opening the book in excel desktop."),Lb.TaskExtensions.Aa(nb.GetServiceTaskFactory.Oa(this.$.da,55,56,0),Wc=>{Wc.result.M4c()},this.$.la,3))})}}static PQ(cc){return cc.rd&2?kb.a.Zc(3,1,0,1965,0,-1237306487,"SensitivityLabelBlockApplyLabelOpenInDesktop"):
kb.a.Zc(1,1,0,1966,0,-313914360,"SensitivityLabelBlockApplyLabel")}}Object(c.a)(Vd,"BlockSenitivityLabelActionDialog",Ac.ErrorDialog,[]);class Jd extends ib.a{constructor(cc,Wc,id,Tc,Gd){super();this.statusBarManager=null;this.Q_c=!1;this.E$=null;this.rEc=!1;this.Nya=this.aRd=null;this.Fo=this.NGd=!1;this.TEa=this.Jge=this.gga=this.The=this.Xp=null;this.FPe=()=>{b.ULS.sendTraceTag(537154520,306,50,"PolicyManagerWrapper::EnableAutoLabellingInDocument - Triggered EnableAutoLabellingInDocument");const Wd=
this.ZSf(1);b.ULS.sendTraceTag(537154519,306,50,`PolicyManagerWrapper::EnableAutoLabellingInDocument - Annotation registration result: ${Wd}.`)};this.EVd=(Wd,Dd)=>{Dd?(this.Xp=Dd.title,this.The=Dd.ksc,this.gga=Dd.buttonText,this.Jge=Dd.Qzf,this.WE.kg(27,null),b.ULS.sendTraceTag(537154509,306,50,"Add entry to BusinessBar succeeded. Message is shown to user.")):b.ULS.sendTraceTag(537154510,306,15,"ShowPolicyBusinessBar is called but PolicyTipventArgs is null.")};this.y9f=(Wd,Dd)=>{const Kd=Object(ac.a)(sa,
Dd);Kd?Kd.Y8f?this.fa.getBooleanFeatureGate("Microsoft.Office.SharedOnline.CommonBusinessBarEntryForSensitivityLabelError",!1)?(b.ULS.sendTraceTag(537154508,306,15,`ShowSetPolicyLabelFailureInBusinessBar :: SetPolicyLabelFailure because of ${Kd.errorType}`),this.WE.QJj(Kd.title,Kd.message,Kd.buttonText,we=>{Kd.o3&&(this.WE.cF(54)&&this.WE.removeEntry(54),Kd.o3(we))})):7===Kd.errorType?(b.ULS.sendTraceTag(537154507,306,15,"ShowSetPolicyLabelFailureInBusinessBar :: SetPolicyLabelFailure because of File too large"),
this.WE.kg(49,null)):13===Kd.errorType?this.WE.kg(50,null):9===Kd.errorType?this.WE.kg(51,null):14===Kd.errorType?this.WE.kg(52,null):15===Kd.errorType?this.WE.RJj(Kd.title,Kd.message,Kd.buttonText,we=>{this.WE.cF(53)&&this.WE.removeEntry(53);Kd.o3(we)}):this.WE.kg(48,null):b.ULS.sendTraceTag(537154506,306,50,"ShowSetPolicyLabelFailureInBusinessBar :: SetPolicyLabelFailure ShowMessage is false"):(b.ULS.sendTraceTag(537154505,306,10,"ShowSetPolicyLabelFailureInBusinessBar :: SetPolicyLabelFailure args is null"),
this.WE.kg(48,null))};this.l1d=(Wd,Dd)=>{this.k7&&(b.ULS.sendTraceTag(537154504,306,50,"PolicyManagerWrapper: UpdateLabelInfo called"),this.k7.R4f(),this.k7.k4f(),this.k7.yPf(),this.$.rd&64&&(Dd.onSuccess&&this.Nya?this.vSg():this.k7.Zeg()));this.fa.qa("SupportsOfficeClientCoauthoring")&&(Wd=this.Js.Wn,this.TEa=Wd.AppliedPolicyId,"null"===this.labelId&&(this.TEa=""),this.rEc&&(Wd=Wd.PolicyLabelAssignmentMethod&&T.e(Wd.PolicyLabelAssignmentMethod)===T.e("standard")?4:2,this.applyPolicyLabel(this.labelId,
Wd,!0,this.aRd)));this.$Ve();this.Sz()};this.fDf=()=>{this.NGd=!0;this.$Ve()};this.ZHf=(Wd,Dd)=>{b.ULS.sendTraceTag(42322116,306,50,`PolicyManagerWrapper.OnSetLabelSucceeded: Applying outcomes for change in policy label. ProtectedFile = ${v.AFrameworkApplication.protectedFile}, ApplyLabelFlag = ${Dd.QP}`);this.applyPolicyLabel(Dd.jsc,Dd.QP,!1,null)};this.NNi=(Wd,Dd)=>{this.TEa=Dd.jsc;if(kb.a.Oq(Wd.Errors)){var Kd=kb.a.v4(Wd.Errors,[2045508683]);0<Kd.length&&(Wd.Errors=kb.a.VB(Wd.Errors,[2045508683],
"PolicyManagerWrapper: OnApplyManualPolicyLabelSuccessCallback"),this.$.ea.Qo(Wd.Errors));Kd=kb.a.v4(Wd.Errors,[2046680228]);0<Kd.length&&(4===Dd.QP||1===Dd.QP)&&(Wd.Errors=kb.a.VB(Wd.Errors,[2046680228],"PolicyManagerWrapper: OnApplyManualPolicyLabelSuccessCallback"),this.$.ea.Qo(Wd.Errors));Kd=Wd=null;for(var we of this.Js.Wn.SensitivityLabels)ta.a.equals(this.labelId,we.Id,!1)&&(Wd=we),ta.a.equals(Dd.k2f,we.Id,!1)&&(Kd=we);we={};we.ApplyLabelFlag=Dd.QP;Wd?(we.currentLabel="Set",we.currentLabelEnabled=
Wd.Enabled,we.currentLabelName=Wd.Name?"Set":"NotSet",we.currentLabelParentId=Wd.ParentId?"Set":"NotSet"):we.currentLabel="NotSet";Kd?(we.serverLabel="Set",we.serverLabelEnabled=Kd.Enabled,we.serverLabelName=Kd.Name?"Set":"NotSet",we.serverLabelParentId=Kd.ParentId?"Set":"NotSet"):we.serverLabel="NotSet";b.ULS.sendTraceTag(541638850,306,15,`PolicyManagerWrapper.OnApplyManualPolicyLabelSuccessCallback Failed. DiagnosticInfo : ${JSON.stringify(we)}`)}};this.oWg=(Wd,Dd)=>{if(!this.$.workbookContext.HasRoundTrippedHFPart)return!1;
const Kd=this.Js.Wn;if(!Kd)return b.ULS.sendTraceTag(537154502,306,15,"PolicyManagerWrapper.BlockSetSensitivityCall: policyLabelsData is null."),!1;let we=null;for(const We of Kd.SensitivityLabels)ta.a.equals(We.Id,Wd,!1)&&(we=We);return we&&this.ici(we)?(b.ULS.sendTraceTag(50341186,306,50,"PolicyManagerWrapper.BlockSetSensitivityCall: selectedSensitivityLabel has watermark label action."),this.DHj(Dd),!0):!1};this.tli=()=>{let Wd=!1;!this.$.va.IsNewWorkbook||this.labelId&&this.labelId.length||(Wd=
!0);b.ULS.sendTraceTag(537154501,306,50,`PolicyManagerWrapper.IsANewFile: is this a new file : ${Wd}`);return Wd};this.muf=(Wd,Dd)=>{1===Dd.zue?this.$.isEditMode?(b.ULS.sendTraceTag(537154500,306,50,"MandatoryLabellingHandler : Swtiching to view-mode."),this.$.Ka.Lb(new oa.a(-723527778,0,this.$.Hc,10,null))):b.ULS.sendTraceTag(537154499,306,50,"MandatoryLabellingHandler : App is already in view-mode."):(this.Nya=Dd.Nya,this.$.ea.FY(this.Lve),this.$.xgb(),b.ULS.sendTraceTag(537154498,306,50,"MandatoryLabellingHandler : Swtiching to edit-mode."),
this.$.Ka.Lb(new oa.a(-8805455,0,this.$.Hc,10,null)))};this.Tpe=(Wd,Dd)=>{Dd?(Wd=!!(this.$.rd&64),b.ULS.sendTraceTag(537154496,306,50,`AddMandatoryLabellingBusinessBar User has edit permission : ${Wd}`),Wd&&(this.$.xgb(),this.WE.ZIj(Dd.title,Dd.message,Dd.buttonText,Kd=>{Dd.o3(Kd)}))):b.ULS.sendTraceTag(537154497,306,15,"AddMandatoryLabellingBusinessBar is called but MandatoryLabellingAppHandlerEventArgs is null.")};this.wUf=()=>{this.WE.cF(42)&&this.WE.removeEntry(42)};this.ogg=(Wd,Dd)=>{Dd.FFj&&
(b.ULS.sendTraceTag(527716803,306,50,"PolicyManagerWrapper.udpLabelingAppHandler: Open the document in the client when the applied label is a UDP label."),Lb.TaskExtensions.Aa(nb.GetServiceTaskFactory.Oa(this.$.da,55,56,0),Kd=>{Kd.result.M4c()},this.$.la,3))};this.Lve=()=>{this.Nya&&this.$.isEditMode?(this.$.ea.C0(this.Lve),this.Lwb()):b.ULS.sendTraceTag(537154467,306,15,`ApplyMandatoryLabelOnEditMode : mandatoryPolicyId empty ${!this.Nya} , edit mode : ${this.$.isEditMode}.`)};this.Dka=()=>{const Wd=
this.$.ea.Ho;Wd&&!ta.a.equals(Wd.AppliedPolicyLabelId,this.labelId,!1)&&(b.ULS.sendTraceTag(537154464,306,50,"PolicyManagerWrapper.HandleWorkbookMetadataChanged: Calling GetPolicyLabels to update statusbar and ribbon control."),b.ULS.shipAssertTag(537154463,306,this.$.isEditMode,"PolicyManagerWrapper.HandleWorkbookMetadataChanged policyId cannot change in read-only mode, this can happen if right policy id is not read from server."),this.fa.qa("SupportsOfficeClientCoauthoring")&&this.$.isEditMode&&
(this.rEc=!0,this.aRd=Wd.AppliedPolicyLabelId),this.TEa=Wd.AppliedPolicyLabelId,this.Lwb())};this.Aqd=()=>{let Wd=!0;if(!this.$.ea.amIAlone)for(const Dd of this.$.ea.Ym)if(!Dd.SupportsClientIsMipTrusted){Wd=!1;break}b.ULS.sendTraceTag(537154462,306,50,`PolicyManagerWrapper.IsEveryCoauthorInSessionClientMipTrusted : ${Wd}`);return Wd};this.lEf=()=>{b.ULS.sendTraceTag(537154461,306,50,"PolicyManagerWrapper.OnLabelUpdate: RTC notification received");this.rEc=!0;this.Lwb()};this.$=Tc;this.Js=cc;this.WE=
id;this.fa=Gd;this.Js.ise(this.EVd);this.k7=Wc}initialize(){this.fa.qa("SupportsPolicies")?(this.TEa=this.fa.Xa("AppliedPolicyId"),this.k7.Fg(),this.$.da.$a(29,cc=>{this.statusBarManager=cc;cc.JJ(this)}),this.Sz(),ta.a.ph(this.fa.Xa("HostUserId"))||this.X5i(),this.k7.Yej(this.oWg),this.k7.Mfj(this.tli),this.Js.Uej(this.Aqd),this.Fo=U.EwaSettings.getBooleanFeatureGate(Ra.a.HQa,!1)):U.EwaSettings.getBooleanFeatureGate("Microsoft.Office.SharedOnline.CacheSensitivityVisibility",!1)&&M.c()&&appChrome.api.dispatch(appChrome.actions.updateControlHiddenState("Sensitivity",
!0));!ta.a.ph(this.fa.Xa("HostUserId"))&&U.EwaSettings.ma(167)&&this.$.ea.Vg.get(45)&&(b.ULS.sendTraceTag(537154524,306,50,"DataLossPrevention feature is Enabled and launched on Excel."),this.zUh())}Mq(cc){this.addHandler("LabelInfoChangedKey",cc)}hr(cc){this.removeHandler("LabelInfoChangedKey",cc)}Hn(){return!0}rs(cc,Wc){if("QueryPolicyLabel"!==cc)return!1;if(this.voa())return Wc.Visible=!1,!0;Wc.Visible=!0;return 32===v.AFrameworkApplication.ub.ae(V.a.Obb,2,Wc)}dispose(){this.statusBarManager&&
(this.statusBarManager.lG(this),this.statusBarManager=null);this.k7.bQb();this.Q_c=!1;this.Js.olj(this.y9f);this.Js.plj(this.ZHf);this.$.ea.Ov(this.Dka);if(this.fa.qa("SupportsOfficeClientCoauthoring")){const cc=this.$.da.za(292);cc&&cc.ekj(this.lEf)}this.Js.Hij(this.Tpe);this.Js.Zkj(this.wUf);this.Js.okj(this.muf);this.Js.Blj(this.ogg);U.EwaSettings.ma(287)&&this.Js.Jjj(this.FPe);this.E$&&(this.E$.dispose(),this.E$=null);super.dispose()}get title(){return this.Xp}get ksc(){return this.The}get linkText(){return this.gga}get $Vi(){return this.Jge}get labelId(){return this.TEa}PZc(cc,
Wc){if(!this.fa.qa("SupportsPolicies"))return b.ULS.sendTraceTag(537154523,306,15,"AutoApplyOrRecommendPolicyLabel - Called when SupportPolicies is disabled."),!1;if(!this.NGd)return b.ULS.sendTraceTag(537154522,306,15,"AutoApplyOrRecommendPolicyLabel - PolicyData hasn't been received yet."),!1;if(Tb.a.ph(cc))return!1;this.E$||this.Mnd();return this.E$.PZc(cc,Wc)}Sz(){this.raiseEvent("LabelInfoChangedKey")}zUh(){rb.a.get_instance().Ck(10,()=>{this.Js.ggd()})}X5i(){rb.a.get_instance().Ck(10,()=>{this.Js.k0b(this.l1d);
this.Js.UMg(this.fDf);this.Js.TMg(this.fDf);this.Js.OXc(this.y9f);this.Js.xse(this.ZHf);this.$.ea.mu(this.Dka);this.Js.Uqe(this.Tpe);this.Js.mse(this.wUf);this.Js.CNg(this.muf);this.Js.fPg(this.ogg);if(this.fa.qa("SupportsOfficeClientCoauthoring")){const cc=this.$.da.za(292);cc&&cc.tNg(this.lEf)}U.EwaSettings.ma(287)&&(b.ULS.sendTraceTag(537154521,306,50,"PolicyManagerWrapper: ApplyAutomaticPolicyLabel enabled and registered GetAutoPolicyLabelHandler"),this.Js.RMg(this.FPe));this.jGh()});this.$.eeb("sensitivity",
!0)}jGh(){this.fa.qa("SupportsOfficeClientCoauthoring")||this.labelId&&this.labelId.length?this.Lwb():this.yPh(this.$.va.DocumentHostInfo.TenantId)}Mnd(){this.E$=new Vb(this.k7,this.Js,this.$,this.fa,this.WE)}ZSf(cc){if(!this.fa.qa("SupportsPolicies"))return b.ULS.sendTraceTag(537154518,306,10,"PolicyManagerWrapper::RegisterAugmentationLoopAnnotations called when CLP is disabled."),!1;this.E$||this.Mnd();return this.E$.Rej(cc)}QZc(cc,Wc){if(!this.fa.qa("SupportsPolicies"))return b.ULS.sendTraceTag(537154517,
306,10,"PolicyManagerWrapper::AutoApplyOrRecommendPowerBILabel called when CLP is disabled."),{returnValue:!1,t7a:!1};if(!this.NGd)return b.ULS.sendTraceTag(537154516,306,15,"PolicyManagerWrapper::AutoApplyOrRecommendPowerBILabel called before PolicyData fetch is complete."),{returnValue:!1,t7a:!0};this.E$||this.Mnd();return this.E$.QZc(cc,Wc)}yPh(cc){b.ULS.sendTraceTag(537154514,306,50,`PolicyManagerWrapper: Doing GetPolicyLabelId web service call with tenantId length ${cc.length}`);const Wc=this.$.pa.ya.Wb();
Ea(this.$.pa.ya,cc,id=>{this.YOj(id)},null,null,null,Wc)}YOj(cc){b.ULS.sendTraceTag(537154513,306,50,"PolicyManagerWrapper: GetPolicyLabelId web service call was successful");cc&&!Sa.a(cc)&&(this.TEa=cc.Result);this.Lwb();this.labelId?b.ULS.sendTraceTag(537154512,306,50,`PolicyManagerWrapper: Fetched LabelId length from custom.xml is ${this.labelId.length}`):b.ULS.sendTraceTag(537154511,306,50,"PolicyManagerWrapper: LabelId is invalid")}Lwb(){this.Js.fgd(this.labelId,void 0,void 0,!1)}$Ve(){if(!this.Q_c){this.$.af();
this.Q_c=!0;this.WE.M$e();const cc={};cc.hasLabel=!!this.labelId&&0<this.labelId.length;cc.isProtectedFile=this.fa.qa("ProtectedFile");cc.SupportsPolicies=this.fa.qa("SupportsPolicies");cc.AreLabelsAvailableForDisplay=this.Js.Aha();cc.SupportsOfficeClientCoauthoring=this.fa.qa("SupportsOfficeClientCoauthoring");cc.IsAnonymousUser=this.fa.qa("IsAnonymousUser");b.ULS.sendTraceTag(51238051,306,50,`CLPUsage : ${JSON.stringify(cc)}`)}}vSg(){this.k7.wSg(this.Nya);this.Nya=null}ici(cc){for(const Wc of cc.LabelActions)if(ta.a.equals(Wc.Name,
"ApplyWatermark",!1))return!0;return!1}DHj(cc){cc?(new Vd(this.$)).ug():b.ULS.sendTraceTag(537154465,306,50,"PolicyManagerWrapper.showBlockApplyLabelDialogDialog: Watermark Dialog box called with showDialog set to false from autoapply.")}applyPolicyLabel(cc,Wc,id,Tc){const Gd=Fa.c(this.Js.Wn);if(void 0===cc||null===cc)cc="";const Wd=new hc;Wd.jsc=cc;Wd.k2f=Tc;Wd.QP=Wc;const Dd=this.$.pa.ya;ya.a(this.$.userOperationManager,(Kd,we,We)=>xb(Dd,Gd,cc,this.$.va.DocumentHostInfo.TenantId,Wc,id,ub.b.call(null,
this.NNi,Kd),null,We,Wd),Kd=>new Va.a(222,0,Kd),null);this.rEc=!1;this.aRd=null}voa(){const cc=this.$.da.za(478);return this.Fo&&cc?cc.Fo():!1}}Object(c.a)(Jd,"PolicyManagerWrapper",ib.a,[161,162,456]);class oe extends La.a{constructor(cc){super();this.$=cc;this.Fb()}create(){const cc=nb.GetServiceTaskFactory.Oa(this.$.da,5,4,this.Ya),Wc=v.AFrameworkApplication.Bd,id=v.AFrameworkApplication.fa;Lb.TaskExtensions.Aa(cc,()=>{try{const Tc=new Ga.a(()=>new fb(id,Wc,v.AFrameworkApplication.sa.mE,this.$.va.MaxGetPolicyRetries,
va.a.instance.Ub("Common.App.ApplicationFeatureHelper.IApplicationFeatureHelper"))),Gd=new Ga.a(()=>new N(v.AFrameworkApplication.ub,v.AFrameworkApplication.sa,v.AFrameworkApplication.fa,Tc));let Wd=this.$.da.za(274);Wd||(Wd=new Jd(Tc.value,Gd.value,cc.result,this.$,v.AFrameworkApplication.fa),this.$.da.Ga(274,Wd),Wd.initialize());this.ob(Wd)}catch(Tc){throw b.ULS.sendTraceTag(537154525,306,10,`PolicyManager was not created successfully [Exception: ${Tc.toString()}]`),Tc;}},this.la,3)}static ka(cc){cc.da.Ga(275,
new oe(cc))}}Object(c.a)(oe,"PolicyManagerFactory",La.a,[]);var De=a(692),Ke=a(183);class rd{constructor(cc){this.$=cc}nc(){return!1}executeCommand(cc,Wc,id){switch(Wc.command){case V.a.setSensitivity:return this.$.workbookContext.FileCoauthorable||(id[x.JYc]=this.$.workbookContext.ExclusiveLockId),cc=v.AFrameworkApplication.ub.ae(V.a.setSensitivity,2,id),ra.Task.Ta(32===cc);case V.a.o7:return cc=v.AFrameworkApplication.ub.ae(V.a.o7,2,id),ra.Task.Ta(32===cc);case V.a.p7:return cc=v.AFrameworkApplication.ub.ae(V.a.p7,
2,id),ra.Task.Ta(32===cc);default:return Ke.a(Wc.command)}}wc(cc,Wc){switch(Wc.command){case V.a.setSensitivity:case V.a.o7:case V.a.p7:return!0;default:return!1}}Jc(cc,Wc,id){switch(Wc){case "PopulateSensitivityFlyout":return 32===v.AFrameworkApplication.ub.ae(V.a.aAa,2,id);default:return!1}}}Object(c.a)(rd,"SensitivityCommandHandler",null,[165]);class bf extends De.a{constructor(cc){super(cc)}nd(){this.Yc([new rd(this.$)])}static ka(cc){De.a.Nd(316,new bf(cc))}}Object(c.a)(bf,"SensitivityCommandHandlerFactory",
De.a,[]);Type.registerNamespace("_Ewa");Type.registerNamespace("Common.App.Policy.Contracts");Type.registerNamespace("Common.App.Policy");Ma.main();(()=>{Ja.a.Fa(cc=>{oe.ka(cc);bf.ka(cc)})})()}}]);

//# sourceMappingURL=https://artifacts.dev.azure.com/office/_apis/symbol/symsrv/EwaDSEsNext.policy.js.map/c5a1f0dfe497ee769a5358ae948899e4/EwaDSEsNext.policy.js.map