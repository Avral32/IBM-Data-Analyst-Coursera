'use strict';(window.dullscriptWebpackJsonp=window.dullscriptWebpackJsonp||[]).push([[18],{1111:function(u,D,a){a.d(D,"a",function(){return c});const c=()=>{Type.registerNamespace("Common.App.InsertFile")}},1112:function(u,D,a){a.d(D,"a",function(){return c});const c=()=>{Type.registerNamespace("Common.App.InsertPicture")}},1114:function(u,D,a){a.d(D,"a",function(){return b});var c=a(511);const b=()=>{c.a.Mi(".insert-media-dialog-old{width:870px;float:left;margin-top:7px}.insert-media-dialog{width:870px;width:clamp(400px,870px,80vw);float:left;margin-top:7px}.app-rtl .insert-media-dialog{float:right}.insert-media-frame{width:100%;height:100%;visibility:visible}.insert-media-panel-old{height:550px}.insert-media-panel{height:550px;height:clamp(300px,550px,90vh)}.keep-focus-start{position:absolute;width:-1000px;top:-1000px}.keep-focus{position:absolute;width:-1000px;top:1000px}.display-none{display:none}.padding-zero{padding:0}")}},
1115:function(u,D,a){a.d(D,"a",function(){return c});u=a(0);class c{}c.QFc="b-ring_Apc_Trans";c.vng="cdn_static_resource_ewa_image";Object(u.a)(c,"ResourceHosts",null,[])},1139:function(u,D,a){var c=a(0),b=a(7),e=a(15),f=a(222),d=a(30),h=a(27),m=a(351),l=a(170),v=a(263),t=a(354),z=a(4),r=a(1),n=a(38),w=a(8),B=a(284),A=a(13);class y extends B.a{constructor($a){super($a);this.R5g=()=>{e.ULS.sendTraceTag(537167827,0,50,"ClipboardReadPermissionAskDialog OK button pressed")};e.ULS.sendTraceTag(537167828,
0,50,"ClipboardReadPermissionAskDialog.ClipboardReadPermissionAskDialog");this.Rb=0;this.oc(1,A.a.instance.ga(2250));$a=A.a.instance.ga(2248);const Zb=this.nN();this.initializeAndShow($a,this.R5g,Zb)}get pc(){return"ClipboardReadPermissionAskDialog"}nN(){const $a={};$a.id=this.pc;const Zb=A.a.instance.ga(2249);$a.DialogMessage=Zb;return $a}}Object(c.a)(y,"ClipboardReadPermissionAskDialog",B.a,[]);var x=a(51);const F=($a,Zb,Da,Pa,tb)=>{const Ib=$a.Stopwatch,Yb={};Yb.a=tb;Yb.e=Ib.id;Yb.c="RearrangeRowColumn";
Yb.b="mouse";Yb.d=$a.OperationId.toString();Yb.f=Da.toString();Yb.g=Pa.toString();Yb.h=Zb.toString();Yb.i=$a.DragDropIsShiftKeyDown;Yb.j=!0;Yb.o=Ib.zc;Yb.q=!1;Yb.r=$a.CopyPasteTargetType.toString();Yb.s=$a.EncounteredDeploymentErrors;return Yb};class I{constructor($a,Zb){this.rMh=()=>{const Da={};Da.SourceItem=this.toString();return Da};this.sessionStateId=$a;this.sessionId=Zb;this.toJSON=this.rMh}dif($a){return $a?this.sessionStateId===$a.sessionStateId&&this.sessionId===$a.sessionId:!1}isFromCurrentSession($a){return this.sessionId===
$a.va.UserSessionId}}Object(c.a)(I,"SourceItem",null,[]);class L extends I{constructor($a,Zb,Da,Pa,tb){super(Da,Pa);this.activeFloatingObjectControlId=$a;this.sheetName=Zb;this.type=tb}isEqual($a){return $a&&Object.getType($a)===L?this.dif($a)&&this.activeFloatingObjectControlId===$a.activeFloatingObjectControlId&&this.sheetName===$a.sheetName:!1}toString(){return this.type.toString()}}Object(c.a)(L,"ArtSourceItem",I,[]);var X;(function($a){$a[$a.valid=0]="valid";$a[$a.notPairwiseDisjoint=1]="notPairwiseDisjoint";
$a[$a.cutNotSupportedInDiscontinuousSelection=2]="cutNotSupportedInDiscontinuousSelection";$a[$a.notValidForm=3]="notValidForm";$a[$a.temporarilyBlockedCopy=4]="temporarilyBlockedCopy"})(X||(X={}));Object(c.b)("CopySourceValidationOptions",X);var P=a(42);class G extends I{constructor($a,Zb,Da,Pa,tb){super(Pa,tb);e.ULS.shipAssertTag(537167645,0,!!Zb&&0<Zb.length,"RangeSourceItem.ctor: ranges should not be null or empty");this.$=$a;this.ranges=Zb;this.sheetName=Da}isEqual($a){return $a&&Object.getType($a)===
G?this.dif($a)&&P.Q(this.ranges,$a.ranges)&&this.sheetName===$a.sheetName:!1}toString(){return P.i(this.ranges,",",this.$,!1)}}Object(c.a)(G,"RangeSourceItem",I,[]);const C=$a=>!!$a&&Object.getType($a)===G;class H{}H.t2j="PasteError_FailedToReadFromClipboard_UserHashMismatchError";Object(c.a)(H,"ExpectedErrorNames",null,[]);class J{}J.plainText="text/plain";J.html="text/html";J.png="image/png";J.shadowWorkbook="data/shadow-workbook";J.Tqi="metadata/is-last-copy-was-external";J.hni="metadata/is-last-copy-was-external-XLO-source";
J.k4g="metadata/chrome-extension-id";J.lsb="copyId";J.QPg="metadata/additional-signature-data-attributes";Object(c.a)(J,"ClipboardDataFormat",null,[]);const M=$a=>$a.clipboardItems&&($a=$a.clipboardItems.getItem(J.Tqi))&&"1"===$a?!0:!1,S=$a=>M($a)&&!(void 0===$a.clipboardItems||null===$a.clipboardItems)&&!!$a.clipboardItems.getItem(J.png)&&!$a.clipboardItems.getItem(J.plainText),W=$a=>$a.clipboardItems&&($a=$a.clipboardItems.getItem(J.hni))&&"1"===$a?!0:!1,O=$a=>$a&&($a=$a.getCachedMetadata(),null===
$a||void 0===$a?0:$a.lastCopy)?$a.lastCopy:null;var T=a(49),Y=a(21),va=a(34);class ca{constructor($a,Zb,Da,Pa){this.$=$a;this.originalDestinations=Zb;this.S$b=Da;this.Esg=Pa;this.yCg=this.originalDestinations;this.swg=this.S$b;this.Rzg="PasteRecoveryUI"}get PPg(){return this.Esg}get tzi(){return this.Rzg}get lej(){return this.yCg}get dFh(){return this.swg}fLa(){return ca.H4i}pUh(){return this.S$b&&1===this.S$b.length?this.qUh(this.S$b[0]):null}qUh($a){var Zb=Y.h(this.$);const Da=Zb.ib.Li($a);var Pa=
Zb.ag($a,Da);Zb=Zb.rtl;if(!Pa)return null;$a=Y.h(this.$).Af(Da);const tb=$a.Cm;if(!tb.Ad(Pa))return null;Pa=tb.Ke(Pa);const Ib=Pa.topLeft.y;var Yb=Pa.bottomRight.y;const vc=Zb?Pa.bottomRight.x:Pa.topLeft.x;Pa=Zb?Pa.topLeft.x:Pa.bottomRight.x;var Zc=new T.a(Pa+(Zb?-81:81),Yb+38+6);if(tb.via(Zc))return this.r5a($a,tb,Da,Pa,Yb,Zb?12:-3,66);Zc=new T.a(Pa+(Zb?-81:81),Yb);if(tb.via(Zc))return this.r5a($a,tb,Da,Pa,Yb,Zb?20:3,22);Zc=new T.a(Pa,Yb+38+6);if(tb.via(Zc))return this.r5a($a,tb,Da,Pa,Yb,-81+(Zb?
18:0),66);Pa=new T.a(vc+(Zb?81:-81),Yb);if(tb.via(Pa))return this.r5a($a,tb,Da,vc,Yb,-81+(Zb?12:-6),22);Yb=new T.a(vc,Ib-38-6);return tb.via(Yb)?this.r5a($a,tb,Da,vc,Ib,Zb?15:0,16):this.r5a($a,tb,Da,Zb?tb.topLeft.x:tb.bottomRight.x,tb.bottomRight.y,-81+(Zb?15:-6),22)}r5a($a,Zb,Da,Pa,tb,Ib,Yb){var vc=Y.h(this.$);const Zc=vc.rtl;$a=Sys.UI.DomElement.getLocation($a.domElement);Pa=new Sys.UI.Point(Pa+(Zc?0:$a.x)-Zb.topLeft.x,tb+$a.y-Zb.topLeft.y);Zc&&(vc=vc.view.visibleArea,Pa.x=vc.bottomRight.x-vc.topLeft.x-
Pa.x,2===Da||4===Da)&&(Pa.x+=Zb.bottomRight.x);Pa=va.a(this.$).nka(Pa);return new Sys.UI.Point(Pa.x+Ib,Pa.y+Yb)}}ca.H4i=["PasteRecoveryUI"];Object(c.a)(ca,"PasteRecoveryUI",null,[445]);var V=a(76),ra=a(174);class N{}N.AHg="ActiveSelection";N.shadowWorkbook="ShadowWorkbook";N.opg="GVML";N.plainText="PlainText";N.html="Html";N.WVg="Bitmap";Object(c.a)(N,"PayloadType",null,[]);class ea{}ea.$Kj="Slice6";Object(c.a)(ea,"SliceName",null,[]);class Ba{}Ba.tLi="NotCalled";Ba.success="Success";Ba.failed="Failed";
Object(c.a)(Ba,"SucceededPopulatingSystemClipboardOptions",null,[]);var ka=a(358);const Ka=($a,Zb)=>$a?Zb&&Zb.va?$a.sessionId!==Zb.va.UserSessionId:(e.ULS.shipAssertTag(537166209,0,!1,"ewaControl shouldn't be null"),!1):(e.ULS.shipAssertTag(537166210,0,!1,"copyContext shouldn't be null"),!1),Oa=$a=>{switch($a){case 0:return"None";case 2:return"Art";case 1:return"Range";default:return"Unknown"}},wa=$a=>{if(!$a)return"null";const Zb=[];for(const Da of $a.get())Zb.push(`${Da.clipboardDataFormat}(${Da.data.length})`);
Zb.sort();return Zb.join(",")};var qa;(function($a){$a[$a.valid=0]="valid";$a[$a.destinationRangesIsEmpty=1]="destinationRangesIsEmpty";$a[$a.discontinuousSelectionNotSupportPasteFromExternal=2]="discontinuousSelectionNotSupportPasteFromExternal";$a[$a.discontinuousSelectionNotSupportPasteCrossSession=3]="discontinuousSelectionNotSupportPasteCrossSession";$a[$a.multipleSourcesAndMultipleDestinationsAreNotSupported=4]="multipleSourcesAndMultipleDestinationsAreNotSupported";$a[$a.multipleDestinationsAreNotMultiplyOfSourceRange=
5]="multipleDestinationsAreNotMultiplyOfSourceRange";$a[$a.sourceAndDestinationAreOverlapping=6]="sourceAndDestinationAreOverlapping";$a[$a.copySourceNotValid=7]="copySourceNotValid";$a[$a.cutNotSupportedInDiscontinuousSelection=8]="cutNotSupportedInDiscontinuousSelection";$a[$a.pasteLinkNotSupportMultipleDestination=9]="pasteLinkNotSupportMultipleDestination";$a[$a.temporarilyBlockedPaste=10]="temporarilyBlockedPaste";$a[$a.unknown=100]="unknown"})(qa||(qa={}));Object(c.b)("PasteValidationOptions",
qa);var aa=a(50),ia=a(142),Ha=a(37),Z=a(154),la=a(345),Xa=a(29),Za=a(318),xa=a(11),fa=a(22),ua=a(124),sa=a(112),sb=a(563),hb=a(98),bb=a(55),lb=a(184),Fa=a(64),Na=a(343);class Mb extends n.a{constructor($a,Zb,Da,Pa,tb,Ib,Yb,vc,Zc=null){super();this.pasteShortcutManager=null;this.hhf=r.EwaSettings.xb();this.Jxa=r.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.CopyPasteWFEIncreasedLimits",!1);this.udg=null;this.p8a=!1;this.Ftd=r.EwaSettings.isChangeGateEnabled("OfficeVSO:6660890_Tag_aoi75RetryLoggingFix2");
this.TDd=nd=>{this.wEj(nd)&&(this.aq.Cfc(),e.ULS.sendTraceTag(537167777,0,50,"CopyPasteInfrastructure.OnMetadataChanged: found that cut/copy operation was preformed in another session therefore removed the highlight in this session."))};this.bEi=(nd,hd)=>{e.ULS.sendTraceTag(537167768,0,50,`CopyPasteInfrastructure.LogShortcutDialogAndRestoreFocus: Got shortcut dialog, user pressed [${nd}]. userPressedExtensionLink=${hd}`);this.gridView.focus()};this.ed=(nd,hd)=>{hd.IN||hd.Lf||this.Cr("OnWorkbookOpened",
!1).catch(()=>{})};this.Eh=(nd,hd)=>{nd=O(this.XK);const Ud=this.aq.Exb(nd);Ud&&(hd.na&&hd.na.sheetName===Ud.sheetName&&Ud.isFromCurrentSession(this.$)?this.aq.ocf(Ud.ranges,nd.commandParameters.commandType):this.aq.Cfc())};this.Gpc=(nd,hd)=>{nd=O(this.XK);(nd=this.aq.Exb(nd))&&hd.item&&hd.item.sheetName===nd.sheetName&&nd.isFromCurrentSession(this.$)&&this.Cr("OnItemDeleting",!1).catch(()=>{})};this.PGb=(nd,hd)=>{this.hhf?this.udg(nd,hd):this.HIf()};this.HR=(nd,hd)=>{1===hd.Mr&&hd.Qf.operation.flags&
2&&this.Cr("OnQueueItemChanged/ItemRemoved",!1).catch(()=>{})};this.$=$a;this.zg=Da;this.gridView=Y.h($a);this.aq=tb;this.oji=Ib;this.XK=Zb;this.N5b=Pa;this.getStringifiedError=Zc||copyPasteInfra.getStringifiedError;this.R7f=1===vc;this.gdd=r.EwaSettings.isChangeGateEnabled("OfficeVSO:6713439_FixCloneRangeArray");this.Kj();this.copyPasteShortcutDialogFactory=this.$.da.za(85);e.ULS.shipAssertTag(537167825,0,!!this.copyPasteShortcutDialogFactory,"CopyPasteInfrastructure.ctor: this.copyPasteShortcutDialogFactory shouldn't be null.");
Yb||(e.ULS.sendTraceTag(537167824,0,50,"CopyPasteInfrastructure.ctor: userId is null, using default userId."),Yb=Mb.Kkh);this.userHash=d.a.qw(Yb);this.fIi="CultureTag: "+A.a.instance.wtb+" HASH: ";this.XK.addMetadataChangeListener(Mb.yvf,this.TDd);this.TGi=ra.a.pEb;this.Sya=this.Jxa?r.EwaSettings.getIntFeatureGate("Microsoft.Office.Excel.CopyPasteHtmlImportMaxLength",this.$.va.CopyPasteMaxPayloadLength):w.a.Sya;(this.Fo=r.EwaSettings.getBooleanFeatureGate(ra.a.HQa,!1))&&$a.da.$a(478,nd=>{this.pasteShortcutManager=
nd});this.hhf&&(this.udg=Za.a(()=>{this.HIf()},1,this.$.la,"CopyPasteInfrastructure.OnStartEditInternal",!0))}get pasteIndicationManager(){return this.$.da.za(373)}cOg($a){this.addHandler(Mb.REd,$a)}Fkj($a){this.removeHandler(Mb.REd,$a)}copy($a){$a.stopwatch=this.$.Jb.Ac("UserAction",x.b().uj($a.ribbonCommandInfo.command)+"ClientSide");if(this.Fo){const Ib=aa.GetServiceTaskFactory.Oa(this.$.da,478,479,0);Ha.TaskExtensions.Aa(Ib,()=>{this.pasteShortcutManager=Ib.result},this.la,3)}const Zb=!!O(this.XK);
r.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.CrossAppShadowWorkbookPaste",!1)&&!h.a.Iz&&(this.p8a=!1);this.Cr("Copy/before/"+m.a[$a.ribbonCommandInfo.method],!1,void 0,!0,$a.copyPasteTargetType).catch(()=>{});var Da=-1985798686===$a.ribbonCommandInfo.command;if(1===this.gridView.Ne&&(Da=this.aq.uhf(this.gridView.ha.ra.selectedRanges,Da),0!==Da)){const Ib=Mb.v$g(Da);this.bAa(Ib,X[Da],!1);return Promise.reject(!1)}$a.userHash=this.userHash;$a.id=l.a.create().toString();let Pa=this,tb=
this;return this.N5b.onCopy($a).then(Ib=>{Ib.isAsyncCopy||$a.stopwatch.stop();Pa.pasteIndicationManager.fOe();const Yb=ka.d($a);e.ULS.sendTraceTag(24150883,0,50,`CopyPasteInfrastructure.OnCopy: Copy operation finished successfully. ${Yb}`);Pa.ZBi(Ib,Zb);Ib=r.EwaSettings.isChangeGateEnabled("OfficeVSO:6591921_CheckTargetTypeForEnterToPaste")?1===$a.copyPasteTargetType:!0;!$a.isFormatPainter&&Pa.Fo&&Ib&&(Pa.pasteShortcutManager?Pa.pasteShortcutManager.nsh():e.ULS.shipAssertTag(537167823,0,!1,"Copy: pasteShortcutManager is null."));
return Promise.resolve(!0)},Ib=>{let Yb=!1,vc="none",Zc=Mb.ttb,nd=!0,hd=-1,Ud=Mb.copyErrorName+Mb.YJa,ee=!1,ec=null;if(Ib){ec=Ib.copyContext;hd=Ib.reason;Ud+=Mb.nLa(Ib);Ib.message&&(Zc=Ib.message);var Vc=Mb.u$g(Ib);if(Vc)if(3===Vc.copyErrorName)Yb=!0,Zc=vc="Async Copy canceled by the user.",nd=!1;else if(Xa.a.Oq(Vc.ewaErrors))if(Zc=tb.Icc(Vc.ewaErrors),Xa.a.ah(Vc.ewaErrors,Mb.operationSucceededWithAlert))ee=Yb=!0;else if(Xa.a.ah(Vc.ewaErrors,Mb.pasteDataLimitHit)||Xa.a.ah(Vc.ewaErrors,Mb.copyThrottlingError))Yb=
!0;13===Ib.reason?(Yb=!0,nd=!1):11===Ib.reason&&(nd=!1)}Vc=Ib?tb.getStringifiedError(Ib):"null";Yb?(Vc=ka.d($a),e.ULS.sendTraceTag(36304157,0,15,`CopyPasteInfrastructure.OnCopy: Copy operation failed with an expected error. clearStateNeeded: ${nd}, Friendly message: ${vc}, Error Message: ${Zc}, CommandParameters: ${Vc}`)):e.ULS.sendTraceTag(24150912,0,10,`CopyPasteInfrastructure.OnCopy: Copy operation failed with an unexpected error. clearStateNeeded: ${nd}, Error Message: ${Vc}, CommandParameters: ${ka.d($a)}`);
nd&&tb.Cr("Copy/fail/"+m.a[$a.ribbonCommandInfo.method],!0,void 0,void 0,$a.copyPasteTargetType).catch(()=>{});tb.YBi($a,Yb,Zc,Ud,hd,ee,ec);return Promise.reject(Ib)})}paste($a){$a.stopwatch=this.$.Jb.Ac("UserAction",x.b().uj($a.ribbonCommandInfo.command)+"ClientSide");r.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.CrossAppShadowWorkbookPaste",!1)&&!h.a.Iz&&(e.ULS.sendTraceTag(537167822,0,50,"CopyPasteInfrastructure.OnPaste: Cross-app shadow workbook paste is enabled"),this.p8a=!1,$a.clipboardPicklingApiDataFormatsToRead=
[J.shadowWorkbook]);Y.h(this.$).ji&&Y.h(this.$).ji.g8(this.Shd($a.ribbonCommandInfo.command),$a.stopwatch.id);if($a.isPasteCommandFromRecoveryUI){var Zb=this.$.da.za(406);var Da=this.gdd?P.d(Zb.ilc):v.a.clone(Zb.ilc);Zb=Zb.Wud;$a.pasteRecoveryCachedClipboardItems=Zb?Zb[Mb.JLf]:null}else Da=this.gdd?P.d(this.gridView.ha.ra.selectedRanges):v.a.clone(this.gridView.ha.ra.selectedRanges);$a.originalDestinations=Da;$a.expandDestinations=this.N0c($a.originalDestinations,$a.commandType);if(this.Z0c($a.commandType,
$a.expandDestinations)||this.k1g())return $a.userHash=this.userHash,$a.id=l.a.create().toString(),r.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.PerfImpactExperimentForAsyncApi",!1)&&!h.a.Iz&&($a.clipboardReadPermissionPromptShown=!1,$a.clipboardAsyncApiDataFormatsToRead=[J.plainText+"Async"],this.N5b.shouldShowClipboardReadPermissionDialog().then(Pa=>{Pa&&($a.clipboardReadPermissionPromptShown=!0,new y(this.$));return Promise.resolve(!0)},()=>Promise.resolve(!0))),this.N5b.onPaste($a).then(Pa=>
this.fqc(Pa,$a),Pa=>this.CGb($a,Pa));this.$.Xc(927125067,V.a.Db,30,null);Da=P.i($a.expandDestinations,",",this.$,!1);e.ULS.sendTraceTag(24150913,0,15,`CopyPasteInfrastructure.OnPaste: paste was triggered but the estimated destination range is not editable, do nothing. ExpandDestinations: ${Da}, CommandType: ${$a.commandType}, copyPasteTargetType="${$a.copyPasteTargetType}"`);return Promise.resolve(!0)}Shd($a){switch($a){case 1804571062:return 6;case -185374993:return 7;case 1766348718:return 8;default:return 3}}k1g(){return!!Y.h(this.$).ha.Ra.activeFloatingObjectControlId&&
this.$.Zp(null,!1,470)}QCb(){const $a=O(this.XK);return $a&&$a.commandParameters?$a.commandParameters.copyPasteTargetType:0}Sqi(){return!!O(this.XK)&&Ka(O(this.XK),this.$)}Cr($a,Zb,Da=!1,Pa=!1,tb=0){try{this.Fo&&this.pasteShortcutManager&&this.pasteShortcutManager.s8b();let Ib=tb;const Yb=this.oyi();if(!Pa&&2===Yb)return e.ULS.sendTraceTag(537167821,0,50,`CopyPasteInfrastructure.ClearState clipboard won't be cleared as there's art in the clipboard. clearClipboardContent = '${Zb}', isExplicit = '${Da}', isForce = '${Pa}', Current CCP operation copyPasteTargetType = '${tb}', LastCopyPasteTargetType = '${Yb}'`),
Promise.reject(null);0===Ib&&(Ib=Yb);const vc=this.$.Jb.Ac("UserAction","ClearCopyState"),Zc=vc.id;e.ULS.sendTraceTag(537167820,0,50,`CopyPasteInfrastructure.ClearState clear clipboard state. clearClipboardContent = '${Zb}', isExplicit = '${Da}', isForce = '${Pa}', Current CCP operation copyPasteTargetType = '${tb}', LastCopyPasteTargetType = '${Yb}'`);this.aq.Cfc();this.zbj();return this.N5b.onCancelCopy(Zb).then(()=>{Zb&&r.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.CrossAppShadowWorkbookPaste",
!1)&&!h.a.Iz&&(this.p8a=!1);vc.stop();this.erf($a,Zc,!0,Da,Zb,"","",vc.zc,Ib);return Promise.resolve(!0)},nd=>{var hd=nd?this.getStringifiedError(nd):"null";e.ULS.sendTraceTag(24150915,0,15,`CopyPasteInfrastructure.ClearState: error during call to copyPasteFlowManager.OnClear(). error: ${hd}`);vc.stop();hd=Mb.B1g+Mb.YJa;let Ud=Mb.ttb;nd&&(hd+=Mb.nLa(nd),nd.message&&(Ud=nd.message));this.erf($a,Zc,!1,Da,Zb,Ud,hd,vc.zc,Ib);return Promise.reject(nd)})}catch(Ib){return Promise.reject(null)}}R2c($a,Zb,
Da=!1,Pa=!1,tb=0){return Pa||!r.EwaSettings.ma(647)||this.rph()?this.Cr($a,Zb,Da,Pa,tb):(e.ULS.sendTraceTag(537167819,0,50,"CopyPasteInfrastructure.ClearStateOnlyIfClipboardHasContentFromSameSession clipboard won't be cleared as there is no content in the clipboard from the current session"),Promise.reject(null))}bAa($a,Zb,Da){e.ULS.sendTraceTag(590705172,0,50,`CopyPasteInfrastructure.PopupDiscontinuousSelectionErrorDialog: Blocked CCP due to discontinuous selection, reason: ${Zb}`);const Pa=new hb.a;
Pa.ia("reason",Zb);sb.a(ua.a.discontinuousSelectionBlocking,[Da?sa.a.A4i:sa.a.rah],!0,!0,!1,!1,Pa);$a=Xa.a.Zc(1,1,751,$a,0,371863010,"DiscontinuousSelectionBlocking");r.EwaSettings.Mz()?new la.a(this.$,$a):($a=new Z.ErrorDialog(this.$,$a),$a.initialize(),$a.ug())}oyi(){const $a=O(this.XK);return $a&&$a.sourceItem?Object.getType($a.sourceItem)===L?2:1:0}dragDropCells($a,Zb,Da,Pa,tb=!1){$a.stopwatch=this.$.Jb.Ac("UserAction","DragDropClientSide");$a.isDragDrop=!0;this.Cr("DragDrop/before/"+m.a[$a.ribbonCommandInfo.method],
!1,void 0,void 0,$a.copyPasteTargetType).catch(()=>{});const Ib=tb?2:1;let Yb=0;Yb=tb?4:Pa?256:128;const vc={encounteredDeploymentErrors:!1};vc.commandParameters=$a;$a.userHash=this.userHash;$a.id=l.a.create().toString();return this.Ftd?this.aq.pasteRange($a.ribbonCommandInfo,P.q(Zb,this.$),P.q(Da,this.$),Ib,Yb,[$a.stopwatch],vc,!1,()=>{e.ULS.sendTraceTag(537167818,0,50,`CopyPasteInfrastructure.DragDropCells: success. copyPasteTargetType="${$a.copyPasteTargetType}"`);this.w9a($a,Ib,Zb,Da,vc)},Zc=>
{const nd=Zc?this.getStringifiedError(Zc):"null";e.ULS.sendTraceTag(537167817,0,10,`CopyPasteInfrastructure.DragDropCells: ${nd}, copyPasteTargetType="${$a.copyPasteTargetType}"`);this.U$a(Zc,$a,Ib,Zb,Da,vc)}).then(()=>{this.gridView.ha.selectionType=-1;return Promise.resolve(!0)},Zc=>Promise.reject(Zc)):this.aq.pasteRange($a.ribbonCommandInfo,P.q(Zb,this.$),P.q(Da,this.$),Ib,Yb,[$a.stopwatch],vc,!1,null,null).then(()=>{e.ULS.sendTraceTag(521410075,0,50,`CopyPasteInfrastructure.DragDropCells: success. copyPasteTargetType="${$a.copyPasteTargetType}"`);
this.gridView.ha.selectionType=-1;this.w9a($a,Ib,Zb,Da,vc);return Promise.resolve(!0)},Zc=>{const nd=Zc?this.getStringifiedError(Zc):"null";e.ULS.sendTraceTag(521410074,0,10,`CopyPasteInfrastructure.DragDropCells: ${nd}, copyPasteTargetType="${$a.copyPasteTargetType}"`);this.U$a(Zc,$a,Ib,Zb,Da,vc);return Promise.reject(Zc)})}Pph($a,Zb,Da,Pa,tb=!1){$a.stopwatch=this.$.Jb.Ac("UserAction","DragDropReplaceClientSide");$a.isDragDrop=!0;this.R2c("DragDropReplace/before/"+m.a[$a.ribbonCommandInfo.method],
!1,void 0,void 0,$a.copyPasteTargetType).catch(()=>{});const Ib=tb?2:1;let Yb=0;Yb=tb?4:Pa?256:128;const vc={encounteredDeploymentErrors:!1};vc.commandParameters=$a;r.EwaSettings.getBooleanFeatureGate(ra.a.a9b,!1)&&($a.isDragInsert=!1);$a.userHash=this.userHash;$a.id=l.a.create().toString();return this.Ftd?this.aq.pasteRange($a.ribbonCommandInfo,P.q(Zb,this.$),P.q(Da,this.$),Ib,Yb,[$a.stopwatch],vc,!1,()=>{e.ULS.sendTraceTag(537167816,0,50,`CopyPasteInfrastructure.DragDropReplaceCells: success. copyPasteTargetType="${$a.copyPasteTargetType}"`);
this.w9a($a,Ib,Zb,Da,vc)},Zc=>{const nd=Zc?this.getStringifiedError(Zc):"null";e.ULS.sendTraceTag(537167815,0,10,`CopyPasteInfrastructure.DragDropReplaceCells: ${nd}, copyPasteTargetType="${$a.copyPasteTargetType}"`);return this.U$a(Zc,$a,Ib,Zb,Da,vc)}).then(()=>{this.gridView.ha.selectionType=-1;return Promise.resolve(!0)},Zc=>Promise.reject(Zc)):this.aq.pasteRange($a.ribbonCommandInfo,P.q(Zb,this.$),P.q(Da,this.$),Ib,Yb,[$a.stopwatch],vc,!1,null,null).then(()=>{e.ULS.sendTraceTag(521410073,0,50,
`CopyPasteInfrastructure.DragDropReplaceCells: success. copyPasteTargetType="${$a.copyPasteTargetType}"`);this.gridView.ha.selectionType=-1;this.w9a($a,Ib,Zb,Da,vc);return Promise.resolve(!0)},Zc=>{const nd=Zc?this.getStringifiedError(Zc):"null";e.ULS.sendTraceTag(521410072,0,10,`CopyPasteInfrastructure.DragDropReplaceCells: ${nd}, copyPasteTargetType="${$a.copyPasteTargetType}"`);this.U$a(Zc,$a,Ib,Zb,Da,vc);return Promise.reject(Zc)})}Oph($a,Zb,Da,Pa,tb=!1){$a.stopwatch=this.$.Jb.Ac("UserAction",
"DragDropInsertClientSide");this.R2c("DragDropInsert/before/"+m.a[$a.ribbonCommandInfo.method],!1,void 0,void 0,$a.copyPasteTargetType).catch(()=>{});const Ib=tb?2:1,Yb=P.K(this.N0c([Da],Ib));var vc=this.$.ea.na.sheetName;const Zc=this.$.ea.na.sheetName,nd=P.v(Zb,this.$);nd.SheetName=vc;vc=P.v(Yb,this.$);vc.SheetName=Zc;Pa=Yb.isRow||Zb.isRow||Pa?1:0;const hd={encounteredDeploymentErrors:!1};$a.isDragInsert=!0;hd.commandParameters=$a;$a.userHash=this.userHash;$a.id=l.a.create().toString();if(this.Ftd)return tb=
this.aq.lOe(hd,nd,vc,tb,Pa,$a.ribbonCommandInfo,()=>{e.ULS.sendTraceTag(537167814,0,50,`CopyPasteInfrastructure.DragDropInsertCells: success. copyPasteTargetType="${$a.copyPasteTargetType}"`);this.w9a($a,Ib,Zb,Da,hd)},ee=>{const ec=ee?this.getStringifiedError(ee):"null";e.ULS.sendTraceTag(537167813,0,10,`CopyPasteInfrastructure.DragDropInsertCells: ${ec}, copyPasteTargetType="${$a.copyPasteTargetType}"`);this.U$a(ee,$a,Ib,Zb,Da,hd)}),lb.c(tb.then(()=>{this.gridView.ha.selectionType=-1;return Promise.resolve(!0)},
ee=>Promise.reject(ee))).jp(()=>!0);tb=this.aq.lOe(hd,nd,vc,tb,Pa,$a.ribbonCommandInfo,null,null);let Ud=this;return lb.c(tb.then(()=>{e.ULS.sendTraceTag(521410071,0,50,`CopyPasteInfrastructure.DragDropInsertCells: success. copyPasteTargetType="${$a.copyPasteTargetType}"`);this.gridView.ha.selectionType=-1;this.w9a($a,Ib,Zb,Da,hd);return Promise.resolve(!0)},ee=>{const ec=ee?Ud.getStringifiedError(ee):"null";e.ULS.sendTraceTag(521410070,0,10,`CopyPasteInfrastructure.DragDropInsertCells: ${ec}, copyPasteTargetType="${$a.copyPasteTargetType}"`);
Ud.U$a(ee,$a,Ib,Zb,Da,hd);return Promise.reject(ee)})).jp(()=>!0)}nji($a,Zb){var Da=O(this.XK);if(!Da)return e.ULS.sendTraceTag(537167812,0,50,"InsertCopiedCutCells: CopyContext must not be null or undefined"),bb.Task.Ta(!1);if(!C(Da.sourceItem))return e.ULS.sendTraceTag(537167811,0,50,"InsertCopiedCutCells: CopyContext must be a Range"),bb.Task.Ta(!1);var Pa=Da.sourceItem;if(!Pa)return e.ULS.shipAssertTag(537167810,0,!!Pa,"InsertCopiedCutCells: rangeSourceItem must not be null or undefined"),bb.Task.Ta(!1);
if(!Pa.isFromCurrentSession(this.$))return e.ULS.sendTraceTag(537167809,0,50,"InsertCopiedCutCells: rangeSourceItem is from a different session"),bb.Task.Ta(!1);if(1<Pa.ranges.length)return e.ULS.sendTraceTag(537167808,0,50,"InsertCopiedCutCells: multiple source ranges are not supported"),this.bAa(2182,"InsertCopiedCutCells",!0),bb.Task.Ta(!1);Da=P.K(Pa.ranges);var tb=this.gridView.ha.ra.$c.clone();$a=P.K(this.N0c([tb],$a));const Ib=this.Vof();Pa=Pa.sheetName;tb=this.$.ea.na.sheetName;const Yb=P.v(Da,
this.$);Yb.SheetName=Pa;const vc=P.v($a,this.$);vc.SheetName=tb;return($a.hf||Da.hf?bb.Task.Ta(0):$a.isRow||Da.isRow?bb.Task.Ta(1):this.oji.c6b(this.$,Y.h(this.$).rtl)).jp(Zc=>this.aq.executeInsertCopiedCutCellsOperation(Yb,vc,Ib,Zc.result,Zb,null,null)).continueWith(()=>{Ib?this.aq.Cfc():this.Cr("InsertCopiedCutCells/success/"+m.a[Zb.method],!0)})}nrd(){const $a=O(this.XK),Zb=this.gridView.ha.ra.Mg;return!!$a&&C($a.sourceItem)&&Zb&&1===$a.sourceItem.ranges.length}Vof(){return this.Wof(-911352779)}hlc(){return this.Wof(-1985798686)}Z0c($a,
Zb){var Da=new ia.a(this.$.xa),Pa=36===$a;const tb=Da.Td(4);$a=2===this.QCb()&&Da.Td(1);Pa=Pa&&tb;Da=!Da.ki||!this.hlc()||!ia.a.O8b(Zb,Y.h(this.$));return Pa||$a||this.$.Zp(Zb,!0)&&Da}uic($a,Zb){return this.aq.uic($a,Zb)}dispose(){super.dispose();this.$j();this.XK.removeMetadataChangeListener(Mb.yvf)}e9c($a,Zb,Da,Pa,tb,Ib){if(!this.x5g($a.commandParameters.ribbonCommandInfo.command))return $a.cseStatus=2,!1;if(Ib&&Zb.Ad(Pa))return $a.cseStatus=4,!1;if(Da!==tb)return $a.cseStatus=6,!1;if(r.EwaSettings.isChangeGateEnabled("OfficeVSO:5593878_PasteCSE_CCPErrorTests")&&
(Pa.width%Zb.width||Pa.height%Zb.height))return $a.cseStatus=16,!1;if(r.EwaSettings.getBooleanFeatureGate(ra.a.cKe,!1)){if(Da=Zb,Pa=Pa.Ke(this.gridView.ui),Zb=null===Zb.Ke(this.gridView.ui),tb=$a.commandParameters.ribbonCommandInfo.command,Zb&&1804571062!==tb&&-185374993!==tb||!Pa)return $a.cseStatus=7,!1}else if(Da=Zb.Ke(this.gridView.ui),Pa=Pa.Ke(this.gridView.ui),!Da||!Pa)return $a.cseStatus=7,!1;Zb=P.v(Da,this.$);Zb=this.zg.F4i(this.gridView,Zb,P.v(Pa,this.$),$a.commandParameters.ribbonCommandInfo.command,
$a.commandParameters.stopwatch);1===Zb&&(Ib&&(this.zg.J2c(Da,!1),this.zg.J2c(Da,!0)),-185374993===$a.commandParameters.ribbonCommandInfo.command&&Y.h(this.$).kbj(),this.pasteIndicationManager.amd($a.commandParameters.id),this.nxc($a.commandParameters.expandDestinations,$a.commandParameters.isPasteCommandFromRecoveryUI),this.tDe("DoPasteClientEstimation/"+m.a[$a.commandParameters.ribbonCommandInfo.method],$a));$a.cseStatus=Zb;return 1===Zb}TMf(){this.copyPasteShortcutDialogFactory.create(this.$).showDialog(!0,
!1,!1,this.bEi)}Nrf($a,Zb,Da,Pa){$a=F($a,Zb,Da,Pa,this.$.va.UserSessionId);$a.k=!0;x.b().Pe(45,$a,!0)}BGf($a,Zb,Da,Pa,tb){var Ib=!1,Yb=!1,vc=Mb.ttb,Zc=Mb.hOe+Mb.YJa;$a&&(Zc+=Mb.nLa($a),Xa.a.Oq($a.ewaErrors)?(vc=this.Icc($a.ewaErrors),Xa.a.ah($a.ewaErrors,[-103190598])&&(Ib=!0)):$a.message&&(vc=$a.message));Yb||(Yb=this.Fqd($a));Zb=F(Zb,Da,Pa,tb,this.$.va.UserSessionId);Zb.k=!1;Zb.l=Yb;Zb.n=vc;Zb.p=Zc;Zb.q=Ib;x.b().Pe(45,Zb,!0);return Promise.reject($a)}x5g($a){switch($a){case 237279923:case 808159687:return r.EwaSettings.isChangeGateEnabled("OfficeVSO:7317055_PasteCse");
case -185374993:return!0;case 1804571062:return!0;default:return!1}}Wof($a){const Zb=O(this.XK);if(!Zb)return!1;const Da=Zb.sourceItem;return Da&&!Da.isFromCurrentSession(this.$)?(e.ULS.sendTraceTag(537167779,0,50,"CopyPasteInfrastructure.LastOperationWasCopyCut: Last copy operation was from a different session."),!1):Zb.commandParameters.ribbonCommandInfo.command===$a}rph(){var $a=O(this.XK);return $a?($a=$a.sourceItem)&&!$a.isFromCurrentSession(this.$)?(e.ULS.sendTraceTag(537167778,0,50,"CopyPasteInfrastructure.DoesClipboardHaveCopiedOrCutContent: Last copy/cut operation was from a different session."),
!1):!0:!1}wEj($a){return $a&&$a.lastCopy?Ka($a.lastCopy,this.$):!0}m2e($a,Zb,Da,Pa,tb){const Ib={};Ib.a=this.$.va.UserSessionId;Ib.e=$a.stopwatch.id;Ib.c=x.b().uj($a.ribbonCommandInfo.command);Ib.b=m.a[$a.ribbonCommandInfo.method];Ib.d=$a.id;Ib.f=Da.toString();Ib.g=Pa.toString();Ib.h=Zb.toString();Ib.o=$a.stopwatch.zc;Ib.q=!1;Ib.r=$a.copyPasteTargetType.toString();Ib.s=tb.encounteredDeploymentErrors;r.EwaSettings.getBooleanFeatureGate(ra.a.a9b,!1)&&(Ib.i=tb.commandParameters.dragDropIsShiftKeyDown,
Ib.j=tb.commandParameters.isDragInsert);return Ib}w9a($a,Zb,Da,Pa,tb){$a=this.m2e($a,Zb,Da,Pa,tb);$a.k=!0;x.b().Pe(45,$a,!0)}gCi($a,Zb,Da,Pa,tb,Ib,Yb,vc,Zc){$a=this.m2e($a,Zb,Da,Pa,Zc);$a.k=!1;$a.l=tb;$a.n=Ib;$a.p=Yb;$a.q=vc;x.b().Pe(45,$a,!0)}erf($a,Zb,Da,Pa,tb,Ib,Yb,vc,Zc){const nd={};nd.a=this.$.va.UserSessionId;nd.b=Zb;nd.c=$a;nd.f=Da;nd.e=Pa;nd.d=tb;nd.g=Ib;nd.h=Yb;nd.i=vc;nd.j=Zc.toString();x.b().Pe(46,nd,!0)}ZBi($a,Zb){$a=this.J1e($a.commandParameters,$a);$a.l=!0;$a.j=Zb;x.b().Pe(43,$a,!0)}YBi($a,
Zb,Da,Pa,tb,Ib,Yb){$a=this.J1e($a,Yb);$a.l=!1;$a.m=Zb;$a.o=Da;$a.y=Pa;$a.x=tb;$a.z=Ib;x.b().Pe(43,$a,!0);e.ULS.sendTraceTag(537167776,0,15,`CopyPasteInfrastructure.LogCopyFailedTelemetry: ErrorName=${$a.y},ErrorReason=${$a.x},IsExpectedError=${$a.m},IsSucceededWithAlert=${$a.z},ErrorMessage=${$a.o}`)}J1e($a,Zb){const Da={};Da.a=this.$.va.UserSessionId;Da.f=$a.stopwatch.id;Da.g=$a.id;Da.c=x.b().uj($a.ribbonCommandInfo.command);Da.b=m.a[$a.ribbonCommandInfo.method];Da.q=$a.stopwatch.zc;Da.bd=Mb.Xbc();
Da.bg=$a.copyPasteHandlerName;Da.bj=void 0===$a.ribbonCommandInfo.$e||null===$a.ribbonCommandInfo.$e?null:t.a[$a.ribbonCommandInfo.$e];Da.bq=$a.uploadToClipService;Da.br=$a.floatingObjectType;Da.s=$a.copyPasteTargetType.toString();Da.bc=Oa($a.copyPasteTargetType);Da.z=!1;if(Zb){Da.bk=Zb.id;Da.bl=Zb.serverRequestTimeInMs;Zb.requestTelemetryData&&(Da.bm=Zb.requestTelemetryData.EcsOperationDuration,Da.bn=Zb.requestTelemetryData.EcsRequestDuration,Da.bo=Zb.requestTelemetryData.WfeRequestDuration);Da.d=
Zb.sourceItem?Zb.sourceItem.toString():null;Da.e=-1;if(C(Zb.sourceItem)){Da.e=0;$a=Zb.sourceItem.ranges;for(const Pa of $a)Da.e+=Pa.sH}Da.h=Zb.isAsyncCopy;Da.i=Zb.isFromCache;Da.k=Zb.isSelectionAllowed;Da.r=Zb.plainTextPayloadSize;Da.u=Zb.htmlPayloadSize;Da.v=Zb.htmlSizeExceedsLimit;Da.w=Zb.copyTotalSizeExceedsLimit;Da.t=Zb.shadowWorkbookPayloadSize;Da.p=Zb.clientSideCopyTime;Da.ba=Zb.encounteredDeploymentErrors;Da.bb=Zb.shadowWorkbookSizeExceedsLimit;Da.be=Zb.syncClipboardItemsKeys;Da.bf=Zb.asyncClipboardItemsKeys;
Da.bh=this.UGe(Zb.succeededPopulatingSystemClipboardSync);Da.bi=this.UGe(Zb.succeededPopulatingSystemClipboardAsync)}return Da}nxc($a,Zb=!1){if(!this.gridView.eb&&!this.gridView.ri){var Da=this.gridView.ha.ra,Pa=!Zb&&1===$a.length&&P.Q($a,Da.selectedRanges),tb=Pa?Da.activeCell:$a[0].topLeft;$a[0].contains(tb)||(e.ULS.shipAssertTag(537167775,0,!1,`CopyPasteInfrastructure.SelectPastedRange: SelectedRanges ${Da.selectedRanges}, IndexOfActiveRange ${Da.Cs}, ActiveCell ${Da.activeCell}, calculatedDestinationRanges ${$a}, keepThePreviousActiveCell ${Pa}, newActiveCell ${tb}, isPasteCommandFromRecoveryUI ${Zb}`),
tb=$a[0].topLeft);this.gridView.ha.ox($a,0,tb,0,void 0,"CopyPasteInfrastructure.SelectPastedRange")}}J5e($a,Zb){const Da={};Da.a=this.$.va.UserSessionId;Da.g=$a.stopwatch.id;Da.t=$a.stopwatch.zc;Da.bz=!1;Zb&&(Da.bv=Zb.id,Da.bw=Zb.serverRequestTimeInMs,Da.n=Zb.commandParameters.clipboardFormatReadTimes,Da.o=Zb.commandParameters.clipboardFormatReadStatus,Da.p=Zb.commandParameters.clipboardReadPermissionPromptShown,Da.q=Zb.commandParameters.asyncApiReadTimedOut,Zb.requestTelemetryData&&(Da.cb=Zb.requestTelemetryData.EcsOperationDuration,
Da.cc=Zb.requestTelemetryData.EcsRequestDuration,Da.cd=Zb.requestTelemetryData.WfeRequestDuration));Da.x=$a.copyPasteTargetType.toString();Da.bl=Oa($a.copyPasteTargetType);Da.br=$a.copyPasteHandlerName;Da.i=P.i($a.expandDestinations,",",this.$,!1);Da.h=P.i($a.originalDestinations,",",this.$,!1);Da.e=$a.id;Da.d=$a.commandType;Da.c=x.b().uj($a.ribbonCommandInfo.command);Da.b=m.a[$a.ribbonCommandInfo.method];Da.bf=!1;Da.bg=!1;Da.bp=Mb.Xbc();Da.bt=void 0===$a.ribbonCommandInfo.$e||null===$a.ribbonCommandInfo.$e?
null:t.a[$a.ribbonCommandInfo.$e];Da.cj=$a.isPasteCommandFromEnterShortcut;if(Da.ca=$a.isPasteCommandFromRecoveryUI)Da.cf=$a.pasteRecoveryUndoStopwatch.id,Da.cg=$a.pasteRecoveryUndoStopwatch.zc;if(Zb){if(($a=Zb.copyContextSnapshot)&&!Zb.wasLastCopyExternal){Da.f=$a.commandParameters.id;Da.j=$a.sourceItem.toString();Da.k=-1;if(C($a.sourceItem)){Da.k=0;const Pa=$a.sourceItem.ranges;for(const tb of Pa)Da.k+=tb.sH}Da.bg=1===$a.commandParameters.commandType}else Zb.clipboardItems?Da.f=Zb.clipboardItems.getItem(J.lsb):
e.ULS.sendTraceTag(537167774,0,50,"CopyPasteInfrastructure.GetPasteUsageData: pasteContext.ClipboardItems is null");Da.bz=Zb.pasteRecoveryUIDisplayed;Da.ci=Zb.cseStatus}else e.ULS.sendTraceTag(537167773,0,50,"CopyPasteInfrastructure.GetPasteUsageData: pasteContext is null");return Da}rDi($a,Zb,Da,Pa,tb,Ib,Yb,vc,Zc){$a=this.J5e($a,vc);$a.l=!1;$a.m=Zb;$a.s=Da;$a.bc=Pa;$a.be=tb;$a.bd=Ib;$a.bf=Yb;vc?($a.y=M(vc)||!vc.copyContextSnapshot,$a.bi=!$a.y&&Ka(vc.copyContextSnapshot,this.$),$a.bj=vc.shadowWorkbookSizeExceedsLimit,
$a.v=vc.shadowWorkbookPayloadSize,$a.w=vc.htmlPayloadSize,$a.bq=wa(vc.clipboardItems),$a.bb=vc.activeSelectionType,$a.bs=vc.isSameSession,$a.bn=vc.payloadOrigin,$a.bo=vc.payloadType,$a.bu=vc.externalAppSource,$a.bx=vc.indicationDisplayScheduled,$a.by=vc.pasteIndicationDisplayStatus,$a.ck=vc.pasteDestinationHasMergedCells):$a.bi=Ka(Zc,this.$);x.b().Pe(44,$a,!0);e.ULS.sendTraceTag(537167772,0,15,`CopyPasteInfrastructure.LogPasteFailedTelemetry: ErrorName=${$a.be},ErrorReason=${$a.bd},IsExpectedError=${$a.m},IsSucceededWithAlert=${$a.bf},ErrorMessage=${$a.s}`)}sDi($a){const Zb=
this.J5e($a.commandParameters,$a);Zb.y=$a.wasLastCopyExternal;Zb.l=!0;Zb.u=$a.plainTextPayloadSize;Zb.v=$a.shadowWorkbookPayloadSize;Zb.w=$a.htmlPayloadSize;Zb.z=$a.isClipboardDataContainShadowWorkbook;Zb.ba=$a.isShadowWorkbookParsedSuccessfully;Zb.bb=$a.activeSelectionType;Zb.bc=$a.pasteResult;Zb.bh=$a.encounteredDeploymentErrors;Zb.bj=$a.shadowWorkbookSizeExceedsLimit;Zb.bk=W($a);Zb.bq=wa($a.clipboardItems);Zb.bs=$a.isSameSession;Zb.bn=$a.payloadOrigin;Zb.bo=$a.payloadType;Zb.bu=$a.externalAppSource;
Zb.bx=$a.indicationDisplayScheduled;Zb.by=$a.pasteIndicationDisplayStatus;Zb.ck=$a.pasteDestinationHasMergedCells;Zb.bm=$a.clipboardItems?$a.clipboardItems.getItem(J.k4g):null;Zb.bi=!$a.isSameSession&&!$a.wasLastCopyExternal;x.b().Pe(44,Zb,!0)}Kj(){this.$.xa.Uf(this.Eh);this.$.xa.mNg(this.Gpc);this.$.userOperationManager.xr(this.HR);this.$.nl(this.ed);Y.h(this.$).Vb.Xk(this.PGb)}$j(){this.$&&this.$.xa&&(this.$.xa.Bg(this.Eh),this.$.xa.Xjj(this.Gpc));this.$&&this.$.userOperationManager&&this.$.userOperationManager.mo(this.HR);
this.gridView&&this.gridView.Vb&&this.gridView.Vb.Fk(this.PGb)}CGb($a,Zb){var Da=null;let Pa=!1;var tb=null;let Ib="UnknownFailure",Yb=-1,vc=Mb.ttb,Zc=Mb.pasteErrorName+Mb.YJa,nd=!1;this.pasteIndicationManager.amd($a.id);this.pasteDestinationHasMergedCells($a.expandDestinations)&&(Zb.pasteContext.pasteDestinationHasMergedCells=!0);const hd=O(this.XK);($a.clearStateOnFinish||$a.clearSystemClipboard)&&this.Cr("Paste/fail/"+m.a[$a.ribbonCommandInfo.method],!0,void 0,void 0,$a.copyPasteTargetType).catch(()=>
{});if(Zb){Yb=Zb.reason;Zc+=Mb.nLa(Zb);Zb.message&&(vc=Zb.message);if(Da=Mb.J$g(Zb))if(1===Da.pasteErrorName)Pa=!0,Ib="CopyPasteLengthTooLongPopup",vc=tb="The pasted content is too long. Popup a dialog to the user.",e.ULS.sendTraceTag(25216992,0,15,`CopyPasteInfrastructure.OnPasteFailed: ${tb}, copyPasteTargetType="${$a.copyPasteTargetType}"`),Da=Xa.a.Zc(1,0,26,690,0,1306609195,"CopyPasteOversizeError"),r.EwaSettings.Mz()?new la.a(this.$,Da):(Da=new Z.ErrorDialog(this.$,Da),Da.initialize(),Da.ug());
else if(7===Da.pasteErrorName)Pa=!0,Ib="No-Op",vc=tb="The shadow workbook is not ready yet and an async copy failed to populate the clipboard. Do nothing (by the spec)",e.ULS.sendTraceTag(33948251,0,15,`CopyPasteInfrastructure.OnPasteFailed: ${tb}, copyPasteTargetType="${$a.copyPasteTargetType}"`);else if(8===Da.pasteErrorName)Pa=!0,Ib="UseShortcutsPopup",vc=tb="Unable to paste content from the system clipboard. Popup dialog to the user.",e.ULS.sendTraceTag(25216994,0,15,`CopyPasteInfrastructure.OnPasteFailed: ${tb}, copyPasteTargetType="${$a.copyPasteTargetType}"`),
this.TMf();else if(18===Da.pasteErrorName){Pa=!0;Ib="PasteExternalNotSupportMultipleSelectionPopup";vc="Paste external not support multiple selection.";tb="Unknown";var Ud=2182;100!==Da.validationFailureReason&&(tb=qa[Da.validationFailureReason],Ud=Mb.MGe(Da.validationFailureReason));this.bAa(Ud,tb,!0)}else 20===Da.pasteErrorName||19===Da.pasteErrorName?(Pa=!0,20===Da.pasteErrorName?(Ib="PasteAcrossSessionNotSupportMultipleSelectionPopup",vc="Paste across session does not support multiple selection."):
(Ib="PasteInSameSessionNotSupportMultipleSelectionPopup",vc="This kind of multiple selection is not supported for same session paste."),tb="Unknown",Ud=2182,100!==Da.validationFailureReason&&(tb=qa[Da.validationFailureReason],Ud=Mb.MGe(Da.validationFailureReason)),Da=6===Da.validationFailureReason,this.Z0c($a.commandType,$a.expandDestinations)&&Da&&this.nxc($a.expandDestinations),this.bAa(Ud,tb,!0)):6===Da.pasteErrorName?(Pa=!0,Ib="No-Op",vc=tb="Paste Formatting/Transpose is not yet a supported operation on System Clipboard based content",
e.ULS.sendTraceTag(36263241,0,15,`CopyPasteInfrastructure.OnPasteFailed: ${tb}, copyPasteTargetType="${$a.copyPasteTargetType}"`)):17===Da.pasteErrorName?(Pa=!0,Ib="No-Op",vc=tb="Paste text on Art is not yet a supported operation",e.ULS.sendTraceTag(0,0,15,`CopyPasteInfrastructure.OnPasteFailed: ${tb}, copyPasteTargetType="${$a.copyPasteTargetType}"`)):16===Da.pasteErrorName?(Pa=!0,Ib="No-Op",vc=tb="Paste has failed because the previous copy has failed",Da=this.getStringifiedError(Da),e.ULS.sendTraceTag(537167771,
0,15,`CopyPasteInfrastructure.OnPasteFailed: ${tb}, copyPasteTargetType="${$a.copyPasteTargetType}", error=${Da}`)):Xa.a.Oq(Da.ewaErrors)?(Xa.a.y$(Da.ewaErrors)||Xa.a.ah(Da.ewaErrors,Xa.a.uec())?(Pa=!0,Ib="CommunicationError",tb=Xa.a.sc(Da.ewaErrors),e.ULS.sendTraceTag(36304159,0,15,`CopyPasteInfrastructure.OnPasteFailed: ${vc} copyPasteTargetType="${$a.copyPasteTargetType}"`)):Xa.a.ah(Da.ewaErrors,Mb.Bsj)?(Pa=!0,Ib="SavingWorkbookError",tb=Xa.a.sc(Da.ewaErrors),e.ULS.sendTraceTag(36304160,0,15,`CopyPasteInfrastructure.OnPasteFailed: ${vc} copyPasteTargetType="${$a.copyPasteTargetType}"`)):
Xa.a.ah(Da.ewaErrors,Mb.operationSucceededWithAlert)&&(nd=Pa=!0,Ib="OperationSucceededWithAlert",tb=Xa.a.sc(Da.ewaErrors),e.ULS.sendTraceTag(36304161,0,15,`CopyPasteInfrastructure.OnPasteFailed: ${vc} copyPasteTargetType="${$a.copyPasteTargetType}"`)),Pa||(vc=this.Icc(Da.ewaErrors),Pa=this.Fqd(Zb))):11===Da.pasteErrorName&&(Pa=!0,Ib="No-Op",vc="Paste has failed because user try copy cross-session oart object");15===Zb.reason&&(Pa=!0,Ib="No-Op",vc="Rejecting deferred paste there is metadata update without copy context. Usually it means that copy canceled before finished.");
fa.a.equals(Zc,H.t2j,!1)&&(Pa=!0,Ib="No-Op",vc="User hash of the copy is different then the user hash of the paste during cross-session copy-paste. Do nothing.")}Pa||(Da=Zb?this.getStringifiedError(Zb):"null",e.ULS.sendTraceTag(24150916,0,10,`CopyPasteInfrastructure.OnPasteFailed: ${Da}, copyPasteTargetType="${$a.copyPasteTargetType}"`));this.rDi($a,Pa,vc,Ib,Zc,Yb,nd,Zb.pasteContext,hd);return Promise.reject(Zb)}fqc($a,Zb){var Da;e.ULS.sendTraceTag(24150917,0,50,`CopyPasteInfrastructure.OnPasteSuccess: paste succeed. copyPasteTargetType="${Zb.copyPasteTargetType}"`);
this.pasteIndicationManager.amd(Zb.id);if(this.K4i(Zb.copyPasteTargetType,$a)){r.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.CrossAppShadowWorkbookPaste",!1)&&!h.a.Iz&&$a.wasLastCopyExternal&&$a.payloadType===N.shadowWorkbook&&(this.p8a=!0);var Pa=null;(null===(Da=$a.pastedRange)||void 0===Da?0:Da.Ranges)&&0<$a.pastedRange.Ranges.length?Pa=P.g($a.pastedRange.Ranges):$a.wasLastCopyExternal||(Pa=Zb.expandDestinations);this.kuj($a,Pa);if(this.xGj($a,Pa)){let tb;this.gdd?(Da=P.d(Zb.originalDestinations),
tb=1028===Zb.commandType?P.d(Zb.expandDestinations):P.d(Pa)):(Da=v.a.clone(Zb.originalDestinations),tb=1028===Zb.commandType?v.a.clone(Zb.expandDestinations):v.a.clone(Pa));let Ib=null;$a.wasLastCopyExternal&&(Zb.isKeyboardEvent||Zb.isPasteCommandFromRecoveryUI)&&(Ib={[Mb.JLf]:$a.clipboardItems});this.pasteDestinationHasMergedCells(Zb.expandDestinations)&&($a.pasteDestinationHasMergedCells=!0);$a.pasteRecoveryUIDisplayed=!0;const Yb=new ca(this.$,Da,tb,Ib),vc=aa.GetServiceTaskFactory.Oa(this.$.da,
406,405,0);Ha.TaskExtensions.Aa(vc,()=>{const Zc=vc.result;Zc.VVg(Yb);Zc.JJj(Zb.ribbonCommandInfo.method)},this.la,8)}$a.pasteRecoveryUIDisplayed||1!==Pa.length||(Pa=P.K(Pa),z.AFrameworkApplication.Rt("XLS-SmartView-CutAndPaste-Treatment;XLS-SmartView-CutAndPaste-Control"),r.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.SmartView.CutAndPasteEnabled",!1)&&Pa&&(Da=Fa.d(this.$.xa.na),Pa=new Na.a(Pa,Da),this.K_d(Pa,"CutAndPaste")))}this.tDe("Paste/success/"+m.a[Zb.ribbonCommandInfo.method],
$a);this.sDi($a);this.R7f&&(!Zb.isKeyboardEvent||W($a))&&this.$.ea.Vg.get(66)&&(e.ULS.sendTraceTag(537167770,0,15,"CopyPasteInfrastructure.OnPasteSuccess: show localStorage disable notification"),this.R7f=!1,this.mbh());return Promise.resolve(!0)}xGj($a,Zb){return!Zb||1!==Zb.length||$a.commandParameters.clearSystemClipboard||$a.commandParameters.clearStateOnFinish||$a.commandParameters.skipClipboardAccess?!1:M($a)&&(Zb=$a.clipboardItems.getItem(J.plainText),$a=$a.clipboardItems.getItem(J.html),void 0===
Zb||null===Zb||Zb.length>this.TGi||void 0===$a||null===$a||$a.length>this.Sya)?(e.ULS.sendTraceTag(537167769,0,50,"CopyPasteInfrastructure.ShouldShowPasteRecoveryUI: Not showing PasteRecoveryUI for external copy."),!1):!0}K4i($a,Zb){return 1===$a||Zb.payloadType===N.plainText||r.EwaSettings.ma(160)&&Zb.payloadType===N.html||r.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.CrossAppShadowWorkbookPaste",!1)&&!h.a.Iz&&Zb.payloadType===N.shadowWorkbook}pasteDestinationHasMergedCells($a){const Zb=
Y.h(this.$).Ea.sD();if(!Zb||!Zb.length)return!1;for(const Da of Zb)if(Da.Gw($a[0]))return!0;return!1}tDe($a,Zb){let Da;({gIa:Da}=this.fni(Zb)).returnValue&&this.Cr($a,Da,void 0,void 0,Zb.commandParameters.copyPasteTargetType).catch(()=>{})}U$a($a,Zb,Da,Pa,tb,Ib){var Yb=$a?this.getStringifiedError($a):"null";e.ULS.sendTraceTag(24150918,0,10,`CopyPasteInfrastructure.OnDragAndDropCellsFailed: ${Yb}`);let vc=Yb=!1,Zc=!1,nd=Mb.ttb,hd=Mb.hOe+Mb.YJa;$a&&(hd+=Mb.nLa($a),Xa.a.Oq($a.ewaErrors)?(nd=this.Icc($a.ewaErrors),
Xa.a.ah($a.ewaErrors,Mb.operationSucceededWithAlert)&&(Yb=!0),Xa.a.ah($a.ewaErrors,Mb.dragDropNonEmptyRange)&&(vc=Zc=!0)):$a.message&&(nd=$a.message));Zc||(Zc=this.Fqd($a));vc?this.gridView.ha.selectionType=-1:this.aq.oej(tb);this.gCi(Zb,Da,Pa,tb,Zc,nd,hd,Yb,Ib)}N0c($a,Zb){let Da=$a;const Pa=this.GYh();if(null===Pa||void 0===Pa?0:Pa.ranges)Da=this.aq.v0g(Zb,Pa.ranges,$a);return Da}GYh(){const $a=O(this.XK);return $a&&C($a.sourceItem)?$a.sourceItem:null}zbj(){this.raiseEvent(Mb.REd,null)}kuj($a,Zb){const Da=
$a.commandParameters.originalDestinations;Zb&&(P.Q(this.gridView.ha.ra.selectedRanges,Da)?(this.nxc(Zb),$a=xa.HelperMethods.wpb(Zb),e.ULS.sendTraceTag(537167767,0,50,`CopyPasteInfrastructure.SelectPastedRangeIfNeeded: select paste range, range: ${$a}`)):$a.commandParameters.isPasteCommandFromRecoveryUI?(this.nxc(Zb,!0),e.ULS.sendTraceTag(537167766,0,50,`CopyPasteInfrastructure.SelectPastedRangeIfNeeded: select paste range for IsPasteCommandFromRecoveryUI, range: ${Zb}, active cell: ${Zb[0].topLeft}`)):
($a=xa.HelperMethods.wpb(Da),e.ULS.sendTraceTag(537167765,0,50,`CopyPasteInfrastructure.SelectPastedRangeIfNeeded: user change his selection during paste operation. don't change selection. originalPasteDestinations: ${$a}`)))}fni($a){if($a.isPlainTextPaste||$a.isHtmlPaste||S($a)||$a.commandParameters.isPasteCommandFromEnterShortcut)return{returnValue:!0,gIa:!1};var Zb=$a.copyContextSnapshot;if($a.commandParameters.clearStateOnFinish)return{returnValue:!0,gIa:!0};if(Zb&&C(Zb.sourceItem)){var Da=Zb.sourceItem;
if(!Da.isFromCurrentSession(this.$))return{returnValue:!1,gIa:!0};Zb=-1985798686===Zb.commandParameters.ribbonCommandInfo.command;if(!(1<Da.ranges.length||1<$a.commandParameters.expandDestinations.length)){const Pa=P.K(Da.ranges);$a=P.K($a.commandParameters.expandDestinations);const tb=this.$.ea.na.sheetName;Da=Da.sheetName;if(Da===tb&&$a.equals(Pa))return{returnValue:!1,gIa:!0};if(Da===tb&&$a.Ke(Pa))return{returnValue:!0,gIa:!1}}return{returnValue:Zb,gIa:!0}}return{returnValue:!1,gIa:!0}}HIf(){var $a=
O(this.XK);($a=this.aq.Exb($a))&&$a.isFromCurrentSession(this.$)&&this.Cr("OnStartEdit",!1).catch(()=>{})}Icc($a){$a=Xa.a.jVh($a,Mb.YJa);return this.fIi+d.a.qw($a).toString()}Fqd($a){$a=Mb.nLa($a);return!!$a&&fa.a.c3a($a,Mb.eIi)}mbh(){const $a=Xa.a.Zc(1,2,327,328,h.a.Dp?329:h.a.bI?330:331,530046625,"ActivateLocalStorage"),Zb=aa.GetServiceTaskFactory.Oa(this.$.da,5,4,0);Ha.TaskExtensions.Aa(Zb,()=>{Zb.result.kg(43,$a)},this.la,3)}UGe($a){return void 0===$a||null===$a?Ba.tLi:$a?Ba.success:Ba.failed}static J$g($a){const Zb=
$a.innerError;return Zb&&0!==Zb.pasteErrorName?$a.innerError:null}static u$g($a){const Zb=$a.innerError;return Zb&&0!==Zb.copyErrorName?$a.innerError:null}static nLa($a){let Zb="";if(!$a)return Mb.kLe;$a.errorName&&(Zb=$a.errorName,$a.innerError&&(Zb+=Mb.YJa+Mb.nLa($a.innerError)));Zb||(Zb=$a&&$a.name?$a.name:Mb.kLe);return Zb}static Xbc(){Mb.wS||(Mb.wS=ea.$Kj);return Mb.wS}static MGe($a){switch($a){case 7:case 1:return 2189;case 5:return 2186;case 6:return 2185;case 8:case 3:case 2:case 4:case 9:case 10:return 2182;
default:return e.ULS.shipAssertTag(537167764,0,!1,`CopyPasteInfrastructure.ConvertPasteValidationOptionToJsStringId: no case for validationOptions = ${$a}`),2189}}static v$g($a){switch($a){case 3:return 2183;case 1:return 2184;case 2:case 4:return 2182;default:return e.ULS.shipAssertTag(537167763,0,!1,`CopyPasteInfrastructure.ConvertCopySourceValidationOptionToJsStringId: no case for validationOptions = ${$a}`),2189}}K_d($a,Zb){Ha.TaskExtensions.Aa(aa.GetServiceTaskFactory.Oa(this.$.da,426,427,1),
Da=>{void Da.result.Uea($a,Zb);e.ULS.sendTraceTag(512615303,0,50,"CopyPasteInfrastructure.triggerTableInvitationHandRaise: IntelligentMetadataOverlayManager is triggered.")},this.$.la,3)}}Mb.yvf="EwaJsMetadataChangeListenerId";Mb.REd="cpiOSC";Mb.Kkh="cpiDID";Mb.ttb="Unknown";Mb.kLe="UnknownError";Mb.YJa="_";Mb.hOe="DragAndDropError";Mb.pasteErrorName="PasteError";Mb.B1g="CancelError";Mb.copyErrorName="CopyError";Mb.eIi="MergedCellOverlap";Mb.JLf="PasteRecoveryCachedClipboardItems";Mb.Bsj=[1352631530,
1679665408];Mb.operationSucceededWithAlert=[-103190598];Mb.pasteDataLimitHit=[1306609195];Mb.copyThrottlingError=[-386183710];Mb.dragDropNonEmptyRange=[563945982];Mb.wS=null;Object(c.a)(Mb,"CopyPasteInfrastructure",n.a,[387,388,2]);class dc{constructor(){this.d1a=this.MDe=null}}Object(c.a)(dc,"ClipboardPlatformInitializationResult",null,[]);var Cb=a(187),Tb=a(639),Jb=a(553),eb=a(121),za=a(5),ha=a(60);const fb=($a,Zb,Da,Pa,tb,Ib,Yb,vc,Zc,nd=null)=>{Zc=$a.Na(9,Zc);Zc.sourceRanges=Zb;Zc.destinationRanges=
Da;Zc.flags=Pa;return ha.g($a,"PasteRange",Zc,tb,Ib,Yb,vc,64,nd)},rb=($a,Zb,Da,Pa,tb,Ib,Yb,vc=null)=>{Yb=$a.Na(1,Yb);Yb.pasteHtmlParameters=Zb;return ha.g($a,"PasteHtmlContent",Yb,Da,Pa,tb,Ib,64,vc)},pa=($a,Zb,Da,Pa,tb,Ib,Yb,vc,Zc=null)=>{vc=$a.Na(9,vc);vc.destinationRange=Zb;vc.source=Da;return ha.g($a,"PasteString",vc,Pa,tb,Ib,Yb,64,Zc)},Ma=($a,Zb,Da,Pa,tb,Ib,Yb=null,vc=null)=>{Yb=$a.Na(1,Yb);Yb.copyParameters=Zb;return ha.g($a,"Copy",Yb,Da,Pa,tb,Ib,0,vc)},Ja=($a,Zb,Da,Pa,tb,Ib,Yb=null,vc=null)=>
{Yb=$a.Na(1,Yb);Yb.copyParameters=Zb;return ha.g($a,"Cut",Yb,Da,Pa,tb,Ib,0,vc)},Ga=($a,Zb,Da,Pa,tb,Ib,Yb=null,vc=null)=>{Yb=$a.Na(1,Yb);Yb.pasteParameters=Zb;return ha.g($a,"Paste",Yb,Da,Pa,tb,Ib,64,vc)};class La{constructor($a,Zb,Da){this.destinationRange=this.sourceRange=null;this.pasteFlags=0;this.sourceRange=$a;this.destinationRange=Zb;this.pasteFlags=Da}}Object(c.a)(La,"MacroRecorderPasteRangePayload",null,[125]);class nb{constructor($a,Zb){this.content=this.destinationRange=null;this.destinationRange=
$a;this.content=Zb}getContent(){return this.content}}Object(c.a)(nb,"MacroRecorderPasteStringPayload",null,[125]);class Lb{constructor($a){this.pasteParameters=null;this.pasteParameters=$a}}Object(c.a)(Lb,"MacroRecorderPastePayload",null,[125]);var ac=a(584),ib=a(761),Ra=a(188),ya=a(33),Va=a(207),oa=a(116),kb=a(281);const Sa=($a,Zb,Da,Pa,tb,Ib,Yb=null)=>{Yb=$a.Na(41,Yb);Yb.insertCopiedCutCellsParameters=Zb;return ha.g($a,"InsertCopiedCutCells",Yb,Da,Pa,tb,Ib,4)},U=($a,Zb,Da,Pa,tb,Ib,Yb=null)=>{Yb=
$a.Na(41,Yb);Yb.insertCopiedCutCellsParameters=Zb;return ha.g($a,"InsertCopiedCutCellsV2",Yb,Da,Pa,tb,Ib,0)};class ta{constructor($a){this.parameters=null;this.parameters=$a}getParameters(){return this.parameters}}Object(c.a)(ta,"MacroRecorderRangeCopyCutCellsInsertedPayload",null,[125]);var ub=a(371);class hc{constructor($a,Zb,Da,Pa,tb,Ib,Yb,vc,Zc){this.destinationRange=$a;this.lsb=Da;this.D4i=Pa;this.Wd=tb;this.NQb=Ib;this.pasteContext=Yb;this.f4b=vc;this.Ceg=Zc}}Object(c.a)(hc,"PasteHtmlRequestParams",
null,[]);class Bc{constructor($a,Zb){this.Ukc=this.pOa=null;this.qQa=ra.a.qQa;this.iGd=ra.a.iGd;this.pEb=ra.a.pEb;this.Qhc=r.EwaSettings.getBooleanFeatureGate(ra.a.K6b,!1);this.yqi=r.EwaSettings.isChangeGateEnabled("OfficeVSO:7316963_InsertCopiedCutCellsV2Enabled");this.cpd=!1;this.Jxa=r.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.CopyPasteWFEIncreasedLimits",!1);this.Wz=(Da,Pa)=>{if(2===Pa.Mr)this.Lv.clear(),this.pOa=null;else if(1===Pa.Mr&&this.Lv&&this.Lv.contains(Pa.Qf)){Da=eb.a(Pa.Qf.operation.operationName);
const tb=Pa.Qf.dequeueUtcTime.getTime()-Pa.Qf.enqueueUtcTime.getTime();e.ULS.sendTraceTag(526758673,0,50,`CopyPasteUtils.OnQueueChanged: web method ${Da} returned, it took ${tb} milliseconds to complete.`);this.Lv.remove(Pa.Qf);this.pOa=null}};this.$=$a;this.gridView=Zb;this.cpd&&(this.$.userOperationManager.xr(this.Wz),this.Lv=new Cb.a)}get Sya(){return this.Jxa?r.EwaSettings.getIntFeatureGate("Microsoft.Office.Excel.CopyPasteHtmlImportMaxLength",this.$.va.CopyPasteMaxPayloadLength):w.a.Sya}copy($a,
Zb,Da,Pa=null,tb=null){const Ib=this.$.pa.ya.Wb();this.cpd&&this.uY();this.Ukc=Ib.ClientRequestId;var Yb=new Ra.a(505,0,(vc,Zc,nd)=>{const hd={CopyPasteTargetType:1};hd.SourceRanges=$a;hd.CopyOperationId=Zb.id;e.ULS.sendTraceTag(537167756,0,50,`CopyPasteInfrastructure.Copy served from CopyPasteProxy : ${this.Jxa}, CopyOperationId : ${hd.CopyOperationId}`);return this.pOa=this.Jxa?Ma(this.$.pa.vw,hd,kb.b(vc,Da),Pa?kb.a(Zc,Pa):Zc,nd,Zb.ribbonCommandInfo,Ib,tb):Ma(this.$.pa.ya,hd,kb.b(vc,Da),Pa?kb.a(Zc,
Pa):Zc,nd,Zb.ribbonCommandInfo,Ib,tb)},80);Yb=this.$.userOperationManager.Kc(Yb,Zb.ribbonCommandInfo);this.cpd&&this.Lv.add(Yb)}ILf($a,Zb,Da,Pa,tb,Ib){return new Promise((Yb,vc)=>{var Zc;const nd=Ib.commandParameters.stopwatch.zc;let hd=2;20===Ib.commandParameters.commandType&&(hd=16);36===Ib.commandParameters.commandType&&(hd=32);68===Ib.commandParameters.commandType&&(hd=64);ya.a.lud(this.$)&&1028===Ib.commandParameters.commandType&&(hd=1024);let Ud=null;if(null===(Zc=Ib.copyContextSnapshot)||void 0===
Zc?0:Zc.commandParameters)Ud=Ib.copyContextSnapshot.commandParameters.id;Bc.RQd(this.$,$a,Pa,Zb,Da,null,ee=>{Bc.Tec(ee,Ib,Yb,vc,nd,this.$,null,!0,null,null)},ee=>{Ib.serverRequestTimeInMs=Ib.commandParameters.stopwatch.zc-nd;ee=oa.a.Oe(ee.data);vc(new ib.a(5,ee))},tb,hd,Ud,Ib.commandParameters.id)})}pasteRange($a,Zb,Da,Pa,tb,Ib,Yb,vc,Zc,nd){return new Promise((hd,Ud)=>{const ee=Yb.commandParameters.stopwatch.zc;Bc.qvj(this.$,$a,Zb,Da,Pa|-5&tb,ec=>{Bc.Tec(ec,Yb,hd,Ud,ee,this.$,null,!0,Zc,nd)},ec=>
{Yb.serverRequestTimeInMs=Yb.commandParameters.stopwatch.zc-ee;ec=oa.a.Oe(ec.data);ec=new ib.a(5,ec);null===nd||void 0===nd?void 0:nd(ec);Ud(ec)},Ib,vc)})}G9i($a,Zb,Da,Pa,tb,Ib,Yb){return(new Promise((vc,Zc)=>{if(Zb)if(Zb.length>this.Sya){var nd=Yb.clipboardItems.getItem(J.plainText);let hd=-1;void 0!==nd&&null!==nd&&(hd=nd.length);ra.a.pif&&Zb.length<this.iGd&&Zb.length>this.qQa&&(this.MMf(Zb),this.mW=new hc($a,Zb,Da,Pa,tb,Ib,Yb,0,this.Krc.length),window.requestIdleCallback&&window.requestIdleCallback(()=>
this.yGd()));e.ULS.sendTraceTag(42071712,0,15,`CopyPasteInfrastructure.ProcessPasteHtml copy paste length too long. clipboardHtml.Length: ${Zb.length}, MaxHtmlImportLength: ${this.Sya}, PlainTextLength: ${hd}`);Zc(new ib.a(1))}else nd=new Ra.a(204,0,(hd,Ud,ee)=>{this.$.Qy();const ec=Yb.commandParameters.stopwatch.zc;hd=kb.b(hd,te=>{Bc.Tec(te,Yb,vc,Zc,ec,this.$,Zb,!1,null,null)});Ud=kb.a(Ud,te=>{Yb.serverRequestTimeInMs=Yb.commandParameters.stopwatch.zc-ec;te=oa.a.Oe(te.data);Zc(new ib.a(3,te))});
const Vc=this.$.pa.ya.Wb(),ud=P.v($a,this.$),ke={};ke.SourceHtml=Zb;ke.DestinationRanges=ud?P.s(ud):null;ke.CopyOperationId=Da;ke.PasteId=Pa;e.ULS.sendTraceTag(537167755,0,50,`CopyPasteInfrastructure.ProcessPasteHtml served from CopyPasteProxy : ${this.Jxa}. PasteId : ${ke.PasteId}`);return this.Jxa?rb(this.$.pa.vw,ke,hd,Ud,ee,null,Vc,Ib):rb(this.$.pa.ya,ke,hd,Ud,ee,null,Vc,Ib)},65),this.$.userOperationManager.Kc(nd,tb);else vc("")})).then(()=>{ra.a.pif&&Zb.length>this.qQa&&(this.MMf(Zb),this.mW=
new hc($a,Zb,Da,Pa,tb,Ib,Yb,0,this.Krc.length),window.requestIdleCallback&&window.requestIdleCallback(()=>this.yGd()))})}MMf($a){const Zb=this.$.Jb.Ac("Task","pasteHtmlChunkOperation"),Da=Math.floor($a.length/this.qQa)+1;this.Krc=Array(Da);let Pa=0;for(;Pa<Da;)this.Krc[Pa]=$a.substring(Pa*this.qQa,(Pa+1)*this.qQa),Pa++;e.ULS.sendTraceTag(523257954,0,50,`CopyPasteUtils.populatePasteChunks Time taken for chunking: ${Zb.zc}`)}yGd(){this.C4i(this.mW.destinationRange,this.Krc[this.mW.f4b],this.mW.lsb,
this.mW.D4i,this.mW.Wd,this.mW.NQb,this.mW.pasteContext,this.mW.f4b,this.mW.Ceg);this.mW.f4b++;this.mW.f4b<this.mW.Ceg&&window.requestIdleCallback(()=>this.yGd())}C4i($a,Zb,Da,Pa,tb,Ib,Yb,vc,Zc){const nd=new Ra.a(204,0,(hd,Ud,ee)=>{const ec=Yb.commandParameters.stopwatch.zc;hd=kb.b(hd,()=>{e.ULS.sendTraceTag(512313415,0,15,`CopyPasteUtils.pasteHtmlServerCall succeeded serverRequestTimeInMs:${Yb.commandParameters.stopwatch.zc-ec},
             pasteid:${Pa},
             chunkIndex:${vc},
             totalChunks:${Zc}`)});Ud=kb.a(Ud,()=>{Yb.serverRequestTimeInMs=Yb.commandParameters.stopwatch.zc-ec;e.ULS.sendTraceTag(512313414,0,15,`CopyPasteUtils.pasteHtmlServerCall failed serverRequestTimeInMs:${Yb.serverRequestTimeInMs},
               pasteid:${Pa},
               chunkIndex:${vc},
               totalChunks:${Zc}`)});const Vc=this.$.pa.ya.Wb();var ud=P.v($a,this.$);ud={SourceHtml:Zb,DestinationRanges:ud?P.s(ud):null,CopyOperationId:Da,PasteId:`${Pa}_chunk_${vc}`,ChunkIndex:vc,TotalChunks:Zc};e.ULS.sendTraceTag(523257952,0,50,`CopyPasteInfrastructure.ProcessPasteHtml served from CopyPasteProxy : ${this.Jxa}. PasteId : ${ud.PasteId}`);return rb(this.$.pa.vw,ud,hd,Ud,ee,null,Vc,Ib)},65);this.$.userOperationManager.Kc(nd,tb)}H9i($a,Zb,Da,Pa,tb){return new Promise((Ib,Yb)=>{e.ULS.sendTraceTag(537167754,
0,50,`CopyPasteInfrastructure.ProcessPasteText profiling trace: method start. pasteContext.Id=${tb.id}`);Zb&&(Zb=fa.a.trimEnd(Zb,"\n","\r"));e.ULS.sendTraceTag(537167753,0,50,`CopyPasteInfrastructure.ProcessPasteText profiling trace: after clipboardText.TrimEnd. pasteContext.Id=${tb.id}`);if(Zb)if(Zb.length>this.pEb)e.ULS.sendTraceTag(24150921,0,15,"CopyPasteInfrastructure.ProcessPasteText copy paste length too long. clipboardText.Length: {0}, MaxCopyPasteLength: {1}",Zb.length,this.pEb),Yb(new ib.a(1));
else{let Zc,nd;const hd=P.v($a,this.$);e.ULS.sendTraceTag(537167752,0,50,`CopyPasteInfrastructure.ProcessPasteText profiling trace: before treatAsLink calculation. pasteContext.Id=${tb.id}`);var vc=!this.$.ea.isNamedObjectViewMode&&!Zb.includes("\n")&&!Zb.includes("\t");e.ULS.sendTraceTag(537167751,0,50,`CopyPasteInfrastructure.ProcessPasteText profiling trace: before isLink check. pasteContext.Id=${tb.id}. treatAsLink=${vc}`);vc=vc&&fa.a.Mjf(Zb);e.ULS.sendTraceTag(537167750,0,50,`CopyPasteInfrastructure.ProcessPasteText profiling trace: after treatAsLink calculation. pasteContext.Id=${tb.id}. treatAsLink=${vc}`);
const Ud=this.$.pa.ya.Wb();if(vc){nd=526;e.ULS.sendTraceTag(537167749,0,50,`CopyPasteInfrastructure.ProcessPasteText profiling trace: before FixUpUrl. pasteContext.Id=${tb.id}`);const ee=Va.a.idd(Zb);e.ULS.sendTraceTag(537167748,0,50,`CopyPasteInfrastructure.ProcessPasteText profiling trace: after FixUpUrl. pasteContext.Id=${tb.id}`);const ec=P.s(hd);vc=(Vc,ud,ke)=>{const te=tb.commandParameters.stopwatch.zc;Vc=kb.b(Vc,pe=>{e.ULS.sendTraceTag(537167747,0,50,`CopyPasteInfrastructure.ProcessPasteText profiling trace: on ApplyHyperlink successCallback. pasteContext.Id=${tb.id}`);
tb.requestTelemetryData=pe.RequestTelemetryData;tb.serverRequestTimeInMs=tb.commandParameters.stopwatch.zc-te;pe.Errors&&0<pe.Errors.length?Yb(new ib.a(2,pe.Errors)):Ib(Zb)});ud=kb.a(ud,pe=>{tb.serverRequestTimeInMs=tb.commandParameters.stopwatch.zc-te;pe=oa.a.Oe(pe.data);Yb(new ib.a(2,pe))});this.$.Qy();e.ULS.sendTraceTag(537167746,0,50,`CopyPasteInfrastructure.ProcessPasteText profiling trace: before ApplyHyperlink. pasteContext.Id=${tb.id}`);return ha.b(this.$.pa.ya,ec,Zb,ee,!1,!1,63,Vc,ud,ke,
$a,Ud,Pa)};Zc=()=>new ac.a(ec,Zb,ee)}else nd=180,vc=(ee,ec,Vc)=>{this.$.Qy();const ud=tb.commandParameters.stopwatch.zc;ee=kb.b(ee,ke=>{e.ULS.sendTraceTag(537167745,0,50,`CopyPasteInfrastructure.ProcessPasteText profiling trace: on PasteString successCallback. pasteContext.Id=${tb.id}`);Bc.Tec(ke,tb,Ib,Yb,ud,this.$,Zb,!1,null,null)});ec=kb.a(ec,ke=>{tb.serverRequestTimeInMs=tb.commandParameters.stopwatch.zc-ud;ke=oa.a.Oe(ke.data);Yb(new ib.a(4,ke))});e.ULS.sendTraceTag(537167744,0,50,`CopyPasteInfrastructure.ProcessPasteText profiling trace: before PasteString. pasteContext.Id=${tb.id}`);
return pa(this.$.pa.ya,hd,Zb,ee,ec,Vc,null,Ud,Pa)},Zc=()=>new nb(hd,Zb);e.ULS.sendTraceTag(537167715,0,50,`CopyPasteInfrastructure.ProcessPasteText profiling trace: before UserWebMethodOperation. pasteContext.Id=${tb.id}`);vc=new Ra.a(nd,0,vc,65,Zc);e.ULS.sendTraceTag(537167714,0,50,`CopyPasteInfrastructure.ProcessPasteText profiling trace: returning. pasteContext.Id=${tb.id}`);this.$.userOperationManager.Kc(vc,Da)}else Ib("")})}ocf($a,Zb){Zb=[1===Zb?4:5];this.gridView.qb.nx(Na.a.Nea(Fa.d(this.$.na),
$a),Zb,!0);this.gridView.qb.Tn(Zb);this.gridView.qb.update(!0)}Cfc(){const $a=[4,5];this.gridView.qb.Wg($a,!1,!1);this.gridView.qb.Qi(null,$a,!1);1===this.gridView.ha.Ne&&this.gridView.Tn(!1,!1);this.gridView.qb.update(!1,!1)}v0g($a,Zb,Da){const Pa=[];for(const tb of Da)Pa.push(this.z0g($a,Zb,tb));return Pa}uY(){if(this.Lv)for(let $a of this.Lv)if(this.$&&this.$.userOperationManager){if($a.operation){const Zb=eb.a($a.operation.operationName);e.ULS.sendTraceTag(526758675,0,50,`CopyPasteUtils.AbortOutstandingUserOperation: Trying to abort pending operation ${Zb}.`)}this.z1g();
this.$.userOperationManager.tua($a)}}z1g(){if(this.pOa){const $a=this.pOa.nu;e.ULS.sendTraceTag(526758674,0,15,`Cancelling pending copy request with Id=${$a}`);oa.a.Tu($a);!r.EwaSettings.isChangeGateEnabled("OfficeVSO:6151555_DisableCancelCopyRequest")&&this.Ukc&&ha.h(this.$.pa.ya,this.Ukc,null,null,null);this.Ukc=this.pOa=null}}z0g($a,Zb,Da){e.ULS.shipAssertTag(537167713,0,!!Zb,"CopyPasteUtils.CalculateSingleImpactedRange: sourceArray shouldn't be null");e.ULS.shipAssertTag(537167712,0,0<Zb.length,
"CopyPasteUtils.CalculateSingleImpactedRange: sourceArray length shouldn't be zero");let Pa=0,tb=0;var Ib=new Set;const Yb=new Set;for(const vc of Zb){Zb=`${vc.left}_${vc.right}`;const Zc=`${vc.top}_${vc.bottom}`;Yb.has(Zb)||(Yb.add(Zb),tb+=vc.width);Ib.has(Zc)||(Ib.add(Zc),Pa+=vc.height)}if(36===$a)return Da.isSingle?Bc.qWe(tb,Pa,Da):Da.clone();516===$a&&($a=Pa,Pa=tb,tb=$a);$a=!(Da.width%tb)&&!(Da.height%Pa);Ib=Da.E_&&!(Da.height%Pa);Da.V5&&!(Da.width%tb)||Ib?Da=Bc.qWe(tb,Pa,Da):$a?Da=Da.clone():
(Da=Da.clone(),Da.bottom=Math.min(w.a.eh,Da.top+Pa-1),Da.right=Math.min(w.a.qh,Da.left+tb-1));return Da}$Sg($a,Zb,Da,Pa,tb,Ib,Yb,vc,Zc,nd,hd){if(!Pa||!Pa.length)return 1;if(1<Pa.length){if(!this.Qhc&&Ib)return 3;if(nd)return 0;if(vc)return 9;if(Zc)return 8;if(hd)return 2;if(1<Zb.length)return 4;const Ud=Zb[0];if(!Yb&&!v.a.all(Pa,ee=>ee.isSingle||!(ee.width%Ud.width)&&!(ee.height%Ud.height)))return 5;if((!this.Qhc||!Ib)&&fa.a.equals($a,Da,!0))for(const ee of tb)if(ee.Ad(Ud)&&!ee.equals(Ud))return 6}else if(Zb&&
0<Zb.length){if(0!==this.uhf(Zb,Zc))return 7;if(1<Zb.length){if(!this.Qhc&&Ib)return 3;if((!this.Qhc||!Ib)&&fa.a.equals($a,Da,!0))for(const Ud of Zb)if($a=tb[0],Ud.Ad($a)&&!Ud.equals($a))return 6}}return 0}uhf($a,Zb){if(!$a||1>=$a.length)return 0;if(Zb)return 2;if(!P.S($a))return 1;Zb=new Tb.a(Jb.a.cl());for(const Da of $a)for(const Pa of $a){const tb=Da.top===Pa.top&&Da.bottom===Pa.bottom,Ib=Da.left===Pa.left&&Da.right===Pa.right,Yb=Math.max(Da.left,Pa.left)<Math.min(Da.right,Pa.right);if(Math.max(Da.top,
Pa.top)<Math.min(Da.bottom,Pa.bottom)&&!tb||Yb&&!Ib)return 3;Zb.add(`${Da.top}-${Da.bottom}-${Pa.left}-${Pa.right}`);Zb.add(`${Pa.top}-${Pa.bottom}-${Da.left}-${Da.right}`)}for(const Da of $a)Zb.remove(`${Da.top}-${Da.bottom}-${Da.left}-${Da.right}`);return 0<Zb.count?3:0}oej($a){const Zb=this.gridView.ha;Zb.updateSelection($a,$a.topLeft,0);Zb.selectionType=-1}Exb($a){if(null===$a||void 0===$a?0:$a.sourceItem){if(!C($a.sourceItem))return null;if(($a=$a.sourceItem)&&P.cb($a.ranges,!0))return $a}return null}uic($a,
Zb){e.ULS.shipAssertTag(537167711,0,!!$a,"CopyPasteUtils.IsFromKeyboardShortcut: commandInfo shouldn't be null");return Zb&&za.a.xG in Zb||$a.tabName?!1:1===$a.method}static qvj($a,Zb,Da,Pa,tb,Ib,Yb,vc,Zc){const nd=$a.pa.ya.Wb(Zc?{Dca:!0,Nba:1}:{Dca:!1,Nba:0});Zc=new Ra.a(506,0,(hd,Ud,ee)=>{$a.Qy();return fb($a.pa.ya,Da,Pa,tb,kb.b(hd,Ib),kb.a(Ud,Yb),ee,null,nd,vc)},65,()=>new La(Da,Pa,tb));$a.userOperationManager.Kc(Zc,Zb)}static Tec($a,Zb,Da,Pa,tb,Ib,Yb=null,vc,Zc,nd){e.ULS.sendTraceTag(537167710,
0,50,`CopyPasteInfrastructure.HandlePasteResult profiling trace: on HandlePasteResult start. pasteContext.Id=${Zb.id}`);Zb.requestTelemetryData=$a.RequestTelemetryData;Zb.serverRequestTimeInMs=Zb.commandParameters.stopwatch.zc-tb;Xa.a.Zf($a.Errors)?Xa.a.yha($a.Errors)?(Zb&&(Zb.encounteredDeploymentErrors=!0),$a=Xa.a.sc($a.Errors),e.ULS.sendTraceTag(537167707,0,15,`CopyPasteUtils.HandlePasteServerResponse: Got deployment errors - keeping promise unfulfilled until we replay the operation. errors: ${$a}`)):
($a=new ib.a(5,$a.Errors),null===nd||void 0===nd?void 0:nd($a),Pa($a)):$a.Result?(Pa=!!$a&&!!$a.RequestTelemetryData,Y.h(Ib).ji.gma(Zb.commandParameters.stopwatch.id,$a.StateId,Pa?$a.RequestTelemetryData.EcsOperationDuration:0,Pa?$a.RequestTelemetryData.EcsRequestDuration:0,Pa?$a.RequestTelemetryData.WfeRequestDuration:0),Zb.pastedRange=$a.Result.SheetMultiRange,e.ULS.sendTraceTag(537167708,0,50,`CopyPasteInfrastructure.HandlePasteResult profiling trace: resolving promise ewaResult.Result is not null. pasteContext.Id=${Zb.id}`),
null===Zc||void 0===Zc?void 0:Zc(),Da(!0),r.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.OptimizeCellTableBigHammerSlowOperationsTeachingCallout",!1)&&vc&&(Zb=Zb.commandParameters.isDragDrop?9:6,(Ib=Ib.da.za(465))&&Ib.q1(Zb,$a))):(e.ULS.sendTraceTag(537167709,0,50,`CopyPasteInfrastructure.HandlePasteResult profiling trace: resolving promise when ewaResult.Result is null. pasteContext.Id=${Zb.id}`),Da(Yb||!0))}static RQd($a,Zb,Da,Pa,tb,Ib,Yb,vc,Zc,nd,hd,Ud){const ee=$a.pa.ya.Wb(),ec=Bc.sfh(Da,
Pa,tb,nd,hd,Ud);Da=new Ra.a(503,0,(Vc,ud,ke)=>{$a.Qy();return Ga($a.pa.ya,ec,kb.b(Vc,Yb),kb.a(ud,vc),ke,Ib,ee,Zc)},65,()=>new Lb(ec));$a.userOperationManager.Kc(Da,Zb)}static sfh($a,Zb,Da,Pa,tb,Ib){const Yb={};Yb.ShadowWorkbookBase64=$a.shadowWorkbookBase64;Yb.SourceRanges={};Yb.SourceRanges.Ranges=Array(1);Yb.SourceRanges.Ranges[0]={};Yb.SourceRanges.Ranges[0].FirstRow=$a.rangeRowStart;Yb.SourceRanges.Ranges[0].LastRow=$a.rangeRowEnd;Yb.SourceRanges.Ranges[0].FirstColumn=$a.rangeColumnStart;Yb.SourceRanges.Ranges[0].LastColumn=
$a.rangeColumnEnd;r.EwaSettings.getBooleanFeatureGate(ra.a.K6b,!1)?Da?Yb.DestinationRanges=P.u(Da.SheetName,Da.NamedObjectName,P.g(Da.Ranges)):(e.ULS.sendTraceTag(537167706,0,15,"CopyPasteInfrastructure.CreatePasteParameters: multiRangeDestination is null"),Yb.DestinationRanges=null):Yb.DestinationRanges=Zb?P.s(Zb):null;Yb.CopyPasteTargetType=1;Yb.PasteType=Pa;Yb.CopyOperationId=tb;Yb.PasteId=Ib;Yb.SourceClientPath=$a.sourceClientPath;Yb.SourceSheetName=$a.sourceSheetName;Yb.SourceWorkbookName=$a.sourceWorkbookName;
if(!$a.originalSourceRangesCountExceedsLimit&&$a.originalSourceRanges&&0<$a.originalSourceRanges.length&&1024===Pa){Yb.OriginalSourceMultiRange={};Zb=Array($a.originalSourceRanges.length);for(Da=0;Da<Zb.length;++Da)Zb[Da]={},Zb[Da].FirstRow=$a.originalSourceRanges[Da][0],Zb[Da].FirstColumn=$a.originalSourceRanges[Da][1],Zb[Da].LastRow=$a.originalSourceRanges[Da][2],Zb[Da].LastColumn=$a.originalSourceRanges[Da][3];Yb.OriginalSourceMultiRange.Ranges=Zb}return Yb}static qWe($a,Zb,Da){Da=Da.clone();Da.height<
Zb&&(Da.bottom=Math.min(w.a.eh,Da.top+Zb-1));Da.width<$a&&(Da.right=Math.min(w.a.qh,Da.left+$a-1));return Da}executeInsertCopiedCutCellsOperation($a,Zb,Da,Pa,tb,Ib=null,Yb=null){const vc={};vc.InsertDirection=Pa;vc.SourceRange=$a;vc.DestRange=Zb;vc.CopyCutOperation=Da?0:1;const Zc=this.$.pa.ya,nd=this.$.pa.ya.Wb(),hd=()=>new ta(vc);return ub.a(this.$.userOperationManager,(Ud,ee,ec)=>this.yqi?U(Zc,vc,Ib?kb.b(Ud,Ib):Ud,Yb?kb.a(ee,Yb):ee,ec,nd):Sa(Zc,vc,Ib?kb.b(Ud,Ib):Ud,Yb?kb.a(ee,Yb):ee,ec,null),Ud=>
new Ra.a(104,0,Ud,void 0,hd),tb)}lOe($a,Zb,Da,Pa,tb,Ib,Yb,vc){return new Promise((Zc,nd)=>{this.executeInsertCopiedCutCellsOperation(Zb,Da,Pa,tb,Ib,hd=>{$a.requestTelemetryData=hd.RequestTelemetryData;if(hd.Errors&&0<hd.Errors.length){const Ud=new ib.a(21,hd.Errors);null===vc||void 0===vc?void 0:vc(Ud);nd(new ib.a(21,hd.Errors))}else null===Yb||void 0===Yb?void 0:Yb(),Zc(!0)},hd=>{hd=oa.a.Oe(hd.data);hd=new ib.a(21,hd);null===vc||void 0===vc?void 0:vc(hd);nd(hd)})})}}Object(c.a)(Bc,"CopyPasteUtils",
null,[385]);var Qa=a(494),na;(function($a){$a[$a.range=0]="range";$a[$a.art=1]="art"})(na||(na={}));Object(c.b)("SourceItemType",na);var ab=a(24),Gb=a(91);class fc{constructor($a){this.nbg={["SourceItemType.Range"]:0,["SourceItemType.Art"]:1};this.lOb={};this.jbg={["FloatingObjectType.Unknown"]:99,["FloatingObjectType.CardView"]:6,["FloatingObjectType.Chart"]:0,["FloatingObjectType.Group"]:7,["FloatingObjectType.Image"]:1,["FloatingObjectType.Ink"]:8,["FloatingObjectType.InteractiveReport"]:4,["FloatingObjectType.ModernOfficeExtension"]:3,
["FloatingObjectType.Shape"]:5,["FloatingObjectType.Slicer"]:2,["FloatingObjectType.Unsupported"]:100};this.vZc={["99"]:"FloatingObjectType.Unknown",["6"]:"FloatingObjectType.CardView",["0"]:"FloatingObjectType.Chart",["7"]:"FloatingObjectType.Group",["1"]:"FloatingObjectType.Image",["8"]:"FloatingObjectType.Ink",["4"]:"FloatingObjectType.InteractiveReport",["3"]:"FloatingObjectType.ModernOfficeExtension",["5"]:"FloatingObjectType.Shape",["2"]:"FloatingObjectType.Slicer",["100"]:"FloatingObjectType.Unsupported"};
this.mbg={["RibbonCommand.Copy"]:-911352779,["RibbonCommand.Cut"]:-1985798686};this.VOd={["-911352779"]:"RibbonCommand.Copy",["-1985798686"]:"RibbonCommand.Cut"};this.lbg={["InputManager.InputMethod.NotDefined"]:-1,["InputManager.InputMethod.Unknown"]:0,["InputManager.InputMethod.Keyboard"]:1,["InputManager.InputMethod.Mouse"]:2,["InputManager.InputMethod.Touch"]:3,["InputManager.InputMethod.CrossSlide"]:9};this.Vka={};this.kbg={["FrameMode.None"]:0,["FrameMode.Reading"]:1,["FrameMode.Edit"]:2};this.l4a=
{};this.obg={["UILocation.Unknown"]:0,["UILocation.UpperRibbon"]:1,["UILocation.Ribbon"]:2,["UILocation.QAT"]:3,["UILocation.Jewel"]:4,["UILocation.NavigationPane"]:5,["UILocation.KeyboardShortcut"]:6,["UILocation.StatusBar"]:7,["UILocation.Dialog"]:8,["UILocation.Floatie"]:9,["UILocation.NotificationBar"]:10,["UILocation.StandaloneCuiRoot"]:11,["UILocation.TaskPane"]:12,["UILocation.HeroDock"]:13,["UILocation.SingleLineRibbon"]:14,["UILocation.MultilineRibbon"]:15,["UILocation.Overflow"]:16,["UILocation.TellMe"]:17,
["UILocation.FarPeripheralControls"]:18,["UILocation.ContextMenu"]:19,["UILocation.DialogMenu"]:20,["UILocation.Header"]:21,["UILocation.FileMenu"]:22,["UILocation.Toolbar"]:26,["UILocation.Canvas"]:30};this.Xr={};this.$=$a;this.Vka.notDefined="InputManager.InputMethod.NotDefined";this.Vka.unknown="InputManager.InputMethod.Unknown";this.Vka.keyboard="InputManager.InputMethod.Keyboard";this.Vka.mouse="InputManager.InputMethod.Mouse";this.Vka.touch="InputManager.InputMethod.Touch";this.Vka.crossSlide=
"InputManager.InputMethod.CrossSlide";this.l4a.none="FrameMode.None";this.l4a.reading="FrameMode.Reading";this.l4a.edit="FrameMode.Edit";this.Xr.unknown="UILocation.Unknown";this.Xr.upperRibbon="UILocation.UpperRibbon";this.Xr.ribbon="UILocation.Ribbon";this.Xr.QAT="UILocation.QAT";this.Xr.jewel="UILocation.Jewel";this.Xr.navigationPane="UILocation.NavigationPane";this.Xr.keyboardShortcut="UILocation.KeyboardShortcut";this.Xr.statusBar="UILocation.StatusBar";this.Xr.dialog="UILocation.Dialog";this.Xr.floatie=
"UILocation.Floatie";this.Xr.notificationBar="UILocation.NotificationBar";this.Xr.standaloneCuiRoot="UILocation.StandaloneCuiRoot";this.Xr.taskPane="UILocation.TaskPane";this.Xr.heroDock="UILocation.HeroDock";this.Xr.singleLineRibbon="UILocation.SingleLineRibbon";this.Xr.multilineRibbon="UILocation.MultilineRibbon";this.Xr.overflow="UILocation.Overflow";this.Xr.tellMe="UILocation.TellMe";this.Xr.farPeripheralControls="UILocation.FarPeripheralControls";this.Xr.header="UILocation.Header";this.Xr.fileMenu=
"UILocation.FileMenu";this.Xr.contextMenu="UILocation.ContextMenu";this.Xr.dialogMenu="UILocation.DialogMenu";this.Xr.toolbar="UILocation.Toolbar";this.Xr.canvas="UILocation.Canvas";this.lOb.range="SourceItemType.Range";this.lOb.art="SourceItemType.Art"}serializeSourceItem($a){const Zb={};if($a&&Object.getType($a)===G)Zb.sheetName=$a.sheetName,Zb.topArray=v.a.map($a.ranges,Da=>Da.top),Zb.leftArray=v.a.map($a.ranges,Da=>Da.left),Zb.bottomArray=v.a.map($a.ranges,Da=>Da.bottom),Zb.rightArray=v.a.map($a.ranges,
Da=>Da.right),Zb.sessionStateId=$a.sessionStateId,Zb.sessionId=$a.sessionId,Zb.sourceItemType=this.f2f(0);else if($a&&Object.getType($a)===L)Zb.activeFloatingObjectControlId=$a.activeFloatingObjectControlId,Zb.sheetName=$a.sheetName,Zb.sessionStateId=$a.sessionStateId,Zb.sessionId=$a.sessionId,Zb.floatingObjectType=this.Tvj($a.type),Zb.sourceItemType=this.f2f(1);else return e.ULS.shipAssertTag(537167705,0,!1,"EnvironmentSerializationHelper.SerializeSourceItem: sourceItem shouldn't be null."),null;
return JSON.stringify(Zb)}serializeCommandParameters($a){if(!$a)return e.ULS.shipAssertTag(537167704,0,!1,"EnvironmentSerializationHelper.Serialize: commandParameters shouldn't be null."),null;const Zb={};Zb.id=$a.id;Zb.commandType=$a.commandType;Zb.copyPasteTargetType=$a.copyPasteTargetType;$a.ribbonCommandInfo&&(Zb.ribbonCommandName=this.bwj($a.ribbonCommandInfo.command),Zb.inputMethodName=this.Wvj($a.ribbonCommandInfo.method),Zb.frameModeName=this.Uvj($a.ribbonCommandInfo.mode),Zb.uiLocationName=
this.fwj($a.ribbonCommandInfo.$e),Zb.tabName=$a.ribbonCommandInfo.tabName);return JSON.stringify(Zb)}deserializeSourceItem($a){if(!$a)return null;try{const Zb=JSON.parse($a);if(!Zb)return e.ULS.shipAssertTag(537167703,0,!1,"EnvironmentSerializationHelper.Deserialize: Json.Parse return null result."),null;let Da=null;switch(this.Plh(Zb.sourceItemType)){case 0:Da=new G(this.$,this.Mlh(Zb),Zb.sheetName,Zb.sessionStateId,Zb.sessionId);break;case 1:Da=new L(Zb.activeFloatingObjectControlId,Zb.sheetName,
Zb.sessionStateId,Zb.sessionId,this.Jlh(Zb.floatingObjectType))}return Da}catch(Zb){return e.ULS.sendTraceTag(537167702,0,10,`EnvironmentSerializationHelper.DeserializeSourceItem: got exception while try to JSON.Parse string length: ${$a?$a.length:0}, errror: ${Zb}`),null}}deserializeCommandParameters($a){if(!$a)return null;try{const Zb=JSON.parse($a);if(!Zb)return e.ULS.shipAssertTag(537167701,0,!1,"EnvironmentSerializationHelper.DeserializeCommandParameters: Json.Parse return null result."),null;
const Da=ka.a();Da.id=Zb.id;Da.ribbonCommandInfo=this.Olh(Zb);Da.commandType=Zb.commandType;Da.copyPasteTargetType=Zb.copyPasteTargetType;return Da}catch(Zb){return e.ULS.sendTraceTag(537167700,0,10,`EnvironmentSerializationHelper.DeserializeCommandParameters: got exception while try to JSON.Parse string length: ${$a?$a.length:0}, errror: ${Zb}`),null}}Mlh($a){const Zb=[];e.ULS.shipAssertTag(537167699,0,!!$a.topArray&&0<$a.topArray.length,`EnvironmentSerializationHelper.DeserializeRanges: TopArray shouldn't be ${$a.topArray?
"empty":"null"}.`);e.ULS.shipAssertTag(537167698,0,!!$a.leftArray&&0<$a.leftArray.length,`EnvironmentSerializationHelper.DeserializeRanges: LeftArray shouldn't be ${$a.leftArray?"empty":"null"}.`);e.ULS.shipAssertTag(537167697,0,!!$a.bottomArray&&0<$a.bottomArray.length,`EnvironmentSerializationHelper.DeserializeRanges: BottomArray shouldn't be ${$a.bottomArray?"empty":"null"}.`);e.ULS.shipAssertTag(537167696,0,!!$a.rightArray&&0<$a.rightArray.length,`EnvironmentSerializationHelper.DeserializeRanges: RightArray shouldn't be ${$a.rightArray?
"empty":"null"}.`);if(!($a.topArray&&$a.leftArray&&$a.bottomArray&&$a.rightArray))return Zb;e.ULS.shipAssertTag(537167695,0,$a.topArray.length===$a.bottomArray.length&&$a.topArray.length===$a.leftArray.length&&$a.topArray.length===$a.rightArray.length,`EnvironmentSerializationHelper.DeserializeRanges: The length of TopArray(${$a.topArray.length}), BottomArray(${$a.bottomArray.length}), LeftArray(${$a.leftArray.length}), RightArray(${$a.rightArray.length}) should be the same.`);const Da=Math.min($a.topArray.length,
$a.bottomArray.length,$a.leftArray.length,$a.rightArray.length);for(let Pa=0;Pa<Da;Pa++)Zb.push(new ab.Range($a.topArray[Pa],$a.leftArray[Pa],$a.bottomArray[Pa],$a.rightArray[Pa],!1,!1));return Zb}Olh($a){return new Gb.a(this.Nlh($a.ribbonCommandName),this.Llh($a.inputMethodName),this.Klh($a.frameModeName),this.Rlh($a.uiLocationName),$a.tabName)}bwj($a){return void 0!==$a&&null!==$a&&$a.toString()in this.VOd?this.VOd[$a.toString()]:(e.ULS.shipAssertTag(537167694,0,!1,`EnvironmentSerializationHelper.SerializeRibbonCommand expected to get RibbonCommand.Copy(${-911352779}) or RibbonCommand.Cut(${-1985798686}) but got ${$a}`),
this.VOd["-911352779"])}Nlh($a){return $a&&$a in this.mbg?this.mbg[$a]:(e.ULS.shipAssertTag(537167693,0,!1,`EnvironmentSerializationHelper.DeserializeRibbonCommand: expected to get RibbonCommand.Copy(${-911352779}) or RibbonCommand.Cut(${-1985798686}) but got ${$a}`),-911352779)}Wvj($a){return void 0!==$a&&null!==$a&&m.a[$a]in this.Vka?this.Vka[m.a[$a]]:(e.ULS.shipAssertTag(537167692,0,!1,`EnvironmentSerializationHelper.SerializeInputMethod: got unexpected value ${$a}`),this.Vka.unknown)}Llh($a){return $a&&
$a in this.lbg?this.lbg[$a]:(e.ULS.shipAssertTag(537167691,0,!1,`EnvironmentSerializationHelper.DeserializeInputMethod: got unexpected value ${$a}`),0)}Uvj($a){return void 0!==$a&&null!==$a&&Qa.a[$a]in this.l4a?this.l4a[Qa.a[$a]]:(e.ULS.shipAssertTag(537167690,0,!1,`EnvironmentSerializationHelper.SerializeFrameMode: got unexpected value ${$a}`),this.l4a.edit)}Klh($a){return $a&&$a in this.kbg?this.kbg[$a]:(e.ULS.shipAssertTag(537167689,0,!1,`EnvironmentSerializationHelper.DeserializeFrameMode: got unexpected value ${$a}`),
2)}f2f($a){return void 0!==$a&&null!==$a&&na[$a]in this.lOb?this.lOb[na[$a]]:(e.ULS.shipAssertTag(537167688,0,!1,`EnvironmentSerializationHelper.SerializeSourceItemType: got unexpected value ${$a}`),this.lOb.range)}Plh($a){return $a&&$a in this.nbg?this.nbg[$a]:(e.ULS.shipAssertTag(537167687,0,!1,`EnvironmentSerializationHelper.DeserializeSourceItemType: got unexpected value ${$a}`),0)}Tvj($a){return void 0!==$a&&null!==$a&&$a.toString()in this.vZc?this.vZc[$a.toString()]:(e.ULS.shipAssertTag(537167686,
0,!1,`EnvironmentSerializationHelper.SerializeArtSourceItemType: got unexpected value ${$a}`),this.vZc["99"])}Jlh($a){return $a&&$a in this.jbg?this.jbg[$a]:(e.ULS.shipAssertTag(537167685,0,!1,`EnvironmentSerializationHelper.DeserializeArtSourceItemType: got unexpected value ${$a}`),99)}fwj($a){return void 0!==$a&&null!==$a&&t.a[$a]in this.Xr?this.Xr[t.a[$a]]:(e.ULS.shipAssertTag(36229129,0,!1,`EnvironmentSerializationHelper.SerializeUILocation: got unexpected value ${$a}`),this.Xr.ribbon)}Rlh($a){return $a&&
$a in this.obg?this.obg[$a]:(e.ULS.shipAssertTag(537167684,0,!1,`EnvironmentSerializationHelper.DeserializeUILocation: got unexpected value ${$a}`),2)}}Object(c.a)(fc,"EnvironmentSerializationHelper",null,[]);class pb{}pb.B_f="SameSession";pb.dKe="CrossSession";pb.Ipf="LegacyCrossSession";pb.external="External";Object(c.a)(pb,"PayloadOrigin",null,[]);const Ea=$a=>$a?$a.shadowWorkbookSizeExceedsLimit&&void 0!==$a.shadowWorkbookBlockedSize&&null!==$a.shadowWorkbookBlockedSize?$a.shadowWorkbookBlockedSize:
$a.shadowWorkbookBase64?$a.shadowWorkbookBase64.length:0:0,xb=$a=>$a.shadowWorkbookSizeExceedsLimit?!0:Ea($a)>w.a.Umc;class bc{constructor($a,Zb){this._name=Zb;this.$=$a;this.hm=A.a.instance;this.aq=new Bc($a,Y.h($a))}get name(){return this._name}get yZc(){return this.hm.Ua(5)}shouldWaitForCopyToComplete(){return!1}onDeferredPasteStarted(){}onDeferredPasteCompleted(){}beforePaste(){}fWj($a){let Zb;Zb=null;try{const Da=$a.getItem(J.shadowWorkbook);if(!Da)return{returnValue:!1,Z0:Zb};Zb=JSON.parse(Da);
return{returnValue:this.swi(Zb),Z0:Zb}}catch(Da){return e.ULS.sendTraceTag(537167835,0,50,"BaseCopyPasteHandler.TryParseRangeShadowWorkbookPayload: Exception caught: "+Da),{returnValue:!1,Z0:Zb}}}swi($a){return!!$a&&(!!$a.shadowWorkbookBase64||$a.shadowWorkbookSizeExceedsLimit)&&void 0!==$a.rangeRowStart&&void 0!==$a.rangeRowEnd&&void 0!==$a.rangeColumnStart&&void 0!==$a.rangeColumnEnd}Irc($a){$a.wasLastCopyExternal=!0;if(r.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.CrossAppShadowWorkbookPaste",
!1)&&!h.a.Iz&&516!==$a.commandParameters.commandType&&1028!==$a.commandParameters.commandType){var Zb=null;if(({Z0:Zb}=this.fWj($a.clipboardItems)).returnValue)return $a.isShadowWorkbookParsedSuccessfully=!0,this.B4i($a,Zb)}if(516!==$a.commandParameters.commandType&&36!==$a.commandParameters.commandType){if(r.EwaSettings.ma(160)&&20!==$a.commandParameters.commandType&&(null===this.$.shortcutKeyManager||this.$.shortcutKeyManager.Uhc)&&(Zb=$a.clipboardItems.getItem(J.html),void 0!==Zb&&null!==Zb&&Zb&&
Zb.trim()!==this.yZc&&(Zb.startsWith("<")||h.a.fg&&Zb.startsWith("\n<")))){const Da=$a.clipboardItems.getItem(J.lsb);return this.z4i($a,Zb,void 0===Da?null:Da)}return this.ELf($a)}return Promise.reject(new ib.a(6))}B4i($a,Zb){e.ULS.sendTraceTag(537167834,0,50,"BaseCopyPasteHandler.PasteFromExternalByShadowWorkbook: Pasting shadow workbook from system clipboard");$a.pasteResult="SystemClipboardShadowWorkbookPaste";$a.payloadType=N.shadowWorkbook;$a.payloadOrigin=pb.external;$a.shadowWorkbookPayloadSize=
Ea(Zb);$a.shadowWorkbookSizeExceedsLimit=xb(Zb);let Da=null,Pa=null;const tb=$a.commandParameters.originalDestinations;r.EwaSettings.getBooleanFeatureGate(ra.a.K6b,!1)?Da=P.r(tb,this.$):Pa=P.v(P.K(tb),this.$);Zb.hasOwnProperty("originalSourceRangesCountExceedsLimit")&&($a.originalSourceRangesCountExceedsLimit=Zb.originalSourceRangesCountExceedsLimit);if($a.shadowWorkbookSizeExceedsLimit)return e.ULS.sendTraceTag(537167833,0,15,`BaseCopyPasteHandler.PasteFromExternalByShadowWorkbook: shadow workbook length(${$a.shadowWorkbookPayloadSize}) is over the limit(${w.a.Umc}). reject the paste request. ShadowWorkbookSizeExceedsLimit: ${Zb.shadowWorkbookSizeExceedsLimit}`),
Promise.reject(new ib.a(1));e.ULS.sendTraceTag(537167832,0,50,`BaseCopyPasteHandler.PasteFromExternalByShadowWorkbook: trigger Paste request. PasteOperationId=${$a.commandParameters.id}`);return this.aq.ILf($a.commandParameters.ribbonCommandInfo,Pa,Da,Zb,[$a.commandParameters.stopwatch],$a)}ELf($a){var Zb=$a.clipboardItems.getItem(J.plainText);if(void 0!==Zb&&null!==Zb&&Zb.trim()===this.yZc)return Promise.reject(new ib.a(7));void 0!==Zb&&null!==Zb&&($a.plainTextPayloadSize=Zb.length);$a.isPlainTextPaste=
!0;$a.pasteResult="SystemClipboardPaste";$a.payloadOrigin=W($a)?pb.Ipf:pb.external;$a.payloadType=N.plainText;e.ULS.sendTraceTag(537167831,0,50,`BaseRangeCopyPasteHandler.PasteByPlainText: trigger ProcessPasteText request. pasteContext.Id=${$a.id}, PasteOperationId=${$a.commandParameters.id}`);Zb=this.aq.H9i(P.K($a.commandParameters.originalDestinations),Zb,$a.commandParameters.ribbonCommandInfo,[$a.commandParameters.stopwatch],$a);e.ULS.sendTraceTag(537167830,0,50,`BaseRangeCopyPasteHandler.PasteByPlainText: returned from ProcessPasteText. pasteContext.Id=${$a.id}`);
return Zb}z4i($a,Zb,Da){$a.htmlPayloadSize=Zb.length;$a.isHtmlPaste=!0;$a.pasteResult="SystemClipboardHtmlPaste";$a.payloadType=N.html;$a.payloadOrigin=W($a)?pb.Ipf:pb.external;e.ULS.sendTraceTag(42071711,0,50,`BaseRangeCopyPasteHandler.PasteByHtml: trigger ProcessPasteHtml request. PasteOperationId=${$a.commandParameters.id}`);return this.aq.G9i(P.K($a.commandParameters.originalDestinations),Zb,Da,$a.commandParameters.id,$a.commandParameters.ribbonCommandInfo,[$a.commandParameters.stopwatch],$a)}CJe($a){const Zb=
{};$a&&(Zb.shadowWorkbookBase64=$a.ShadowWorkbookBase64,Zb.shadowWorkbookSizeExceedsLimit=$a.ShadowWorkbookSizeExceedsLimit,Zb.originalSourceRangesCountExceedsLimit=$a.OriginalSourceRangesCountExceedsLimit,Zb.originalSourceRangesCount=$a.OriginalSourceRangesCount,Zb.shadowWorkbookBlockedSize=$a.ShadowWorkbookBlockedSize);return Zb}Mkg($a,Zb){const Da=M($a),Pa=32===($a.commandParameters.commandType&32),tb=1024===($a.commandParameters.commandType&1024);let Ib=!1,Yb=null,vc=null,Zc=!1;if(!Da){Ib=-1985798686===
$a.commandParameters.ribbonCommandInfo.command;var nd=$a.copyContextSnapshot;if(Zb)Zc=!nd.sourceItem.isFromCurrentSession(this.$);else if(nd=this.aq.Exb(nd))Yb=nd.ranges,vc=nd.sheetName,Zc=!$a.isSameSession}return this.aq.$Sg(vc,Yb,this.$.na.sheetName,$a.commandParameters.originalDestinations,$a.commandParameters.expandDestinations,Zc,Pa,tb,Ib,Zb,Da)}}Object(c.a)(bc,"BaseCopyPasteHandler",null,[469,470,471]);class zb{constructor($a){this.clipboardItems=this.key=null;this.W$=$a}Bwa($a){return this.key&&
this.key.isEqual($a)?this.createClipboardItems(this.clipboardItems):null}setValue($a,Zb){this.key=$a;this.clipboardItems=this.createClipboardItems(Zb)}createClipboardItems($a){const Zb=this.W$.create();var Da=$a.getItem(J.plainText);Da&&Zb.setItem(J.plainText,Da);(Da=$a.getItem(J.shadowWorkbook))&&Zb.setItem(J.shadowWorkbook,Da);($a=$a.getItem(J.html))&&Zb.setItem(J.html,$a);return Zb}}Object(c.a)(zb,"CopyCache",null,[]);var Ub=a(67);class wc extends bc{constructor($a,Zb,Da,Pa,tb=null){super($a,Pa);
this.vah=Zb;this.W$=Da;this.h5c=tb||new zb(this.W$);this.gridView=Y.h($a);this.ha=this.gridView.ha;this.clipboardRangeFactory=$a.da.za(169)}getSourceItem(){const $a=r.EwaSettings.isChangeGateEnabled("OfficeVSO:6713439_FixCloneRangeArray")?P.d(this.gridView.ha.ra.selectedRanges):v.a.clone(this.gridView.ha.ra.selectedRanges);return new G(this.$,$a,this.$.ea.na.sheetName,this.$.ea.ye,this.$.va.UserSessionId)}beforeSerialize($a){$a.isSelectionAllowed=!1;$a.isAsyncCopy=!1;$a.isFromCache=!1;$a.encounteredDeploymentErrors=
!1;$a.plainTextPayloadSize=0;$a.shadowWorkbookPayloadSize=0;$a.htmlPayloadSize=0;$a.clientSideCopyTime=0;const Zb=new ia.a(this.$.xa),Da=$a.sourceItem;$a.isSelectionAllowed=v.a.all(Da.ranges,Pa=>this.isSelectionAllowed(Zb,Pa));$a.isSelectionAllowed&&this.aq.ocf(Da.ranges,$a.commandParameters.commandType)}KNa($a){return this.gridView.Ea.l5()&&Y.j(this.gridView,$a)}Z4i($a,Zb,Da,Pa){let tb=!1,Ib=1===Zb.commandParameters.commandType,Yb=Pa[0].sH;1===Da.ranges.length&&1===Pa.length?r.EwaSettings.isChangeGateEnabled("OfficeVSO:5593878_PasteCSE_CCPErrorTests1")&&
Ib&&1!==Yb&&Yb!==Da.ranges[0].sH?$a.cseStatus=17:tb=this.vah.e9c($a,P.K(Da.ranges),Da.sheetName,P.K($a.commandParameters.expandDestinations),this.$.ea.na.sheetName,Ib):$a.cseStatus=5;tb&&Y.h(this.$).ji.yS($a.commandParameters.stopwatch.id,Ub.BasicTelemetryCalculator.cR);return this.I4i($a,Da,P.u(this.$.na.sheetName,null,Pa),Zb.commandParameters.commandType,tb)}isSelectionAllowed($a,Zb){return $a.NBb(Zb,this.gridView)}I4i($a,Zb,Da,Pa,tb){Zb=P.u(Zb.sheetName,null,Zb.ranges);$a.pasteResult="SameSessionPaste";
$a.payloadOrigin=pb.B_f;$a.payloadType=N.AHg;e.ULS.sendTraceTag(537167829,0,50,`BaseRangeCopyPasteHandler.PasteSameSession: trigger PasteRange request. PasteOperationId=${$a.commandParameters.id}`);return this.aq.pasteRange($a.commandParameters.ribbonCommandInfo,Zb,Da,Pa,$a.commandParameters.commandType,[$a.commandParameters.stopwatch],$a,tb,null,null)}}Object(c.a)(wc,"BaseRangeCopyPasteHandler",bc,[]);var mb=a(35);class Db{constructor($a){this.CU=new mb.a(!0);this.$=$a}onDeferredPasteStarted($a){this.CU.lb($a.id)||
this.CU.add($a.id,!0);if(0<this.CU.count){const Zb=aa.GetServiceTaskFactory.Oa(this.$.da,5,4,0);Ha.TaskExtensions.Aa(Zb,()=>{Zb.result.kg(28,null)},this.$.la,3)}}onDeferredPasteCompleted($a){const Zb=0<this.CU.count;this.CU.lb($a.id)&&this.CU.remove($a.id);if(Zb&&!this.CU.count){const Da=aa.GetServiceTaskFactory.Oa(this.$.da,5,4,0);Ha.TaskExtensions.Aa(Da,()=>{Da.result.removeEntry(28)},this.$.la,3)}}}Object(c.a)(Db,"DeferredPasteTracker",null,[]);var Ic;(function($a){$a[$a.none=0]="none";$a[$a.loadClipboardFromServerFailed=
1]="loadClipboardFromServerFailed";$a[$a.loadCopiedDataFromServerFailed=2]="loadCopiedDataFromServerFailed";$a[$a.asyncCopyCanceled=3]="asyncCopyCanceled";$a[$a.loadCopiedArtDataFromServerFailed=4]="loadCopiedArtDataFromServerFailed"})(Ic||(Ic={}));Object(c.b)("CopyErrorType",Ic);var Hc=a(922),Ab=a(1113);class db extends Hc.a{constructor($a,Zb=null){super(Ic[$a]);this.copyErrorName=0;this.ewaErrors=null;this.copyErrorName=$a;this.ewaErrors=Zb;if(null===Zb||void 0===Zb?0:Zb.length)this.innerError=
new Ab.a(Zb,null)}}Object(c.a)(db,"CopyInnerError",Hc.a,[]);class Pb extends wc{constructor($a,Zb,Da,Pa=null){super($a,Zb,Da,"AcrossSessionRangeCopyPasteHandler",Pa);this.CU=new Db($a)}serialize($a){const Zb=$a.sourceItem,Da={};let Pa=this.h5c.Bwa(Zb);if(Pa)Da.synchronousResult=Pa,$a.isFromCache=!0,$a.clientSideCopyTime=$a.commandParameters.stopwatch.zc;else{let Ib=null;var tb=P.F(Zb.ranges);if(!ya.a.hjf()&&this.KNa(tb)){e.ULS.sendTraceTag(537167936,0,50,"AcrossSessionRangeCopyPasteHandler.Serialize: All data is loaded prepare the data in the client side.");
tb=this.clipboardRangeFactory.create(tb);try{Ib=tb.toString(),Pa=this.W$.create(),Pa.setItem(J.plainText,Ib),this.h5c.setValue(Zb,Pa),Da.synchronousResult=Pa,$a.clientSideCopyTime=$a.commandParameters.stopwatch.zc}finally{tb&&tb.dispose()}}else $a.isAsyncCopy=!0,Da.synchronousResult=this.W$.create(),Da.synchronousResult.setItem(J.plainText,this.yZc);Da.asynchronousResult=this.Qfd($a,Zb,Ib)}$a.syncClipboardItemsKeys=wa(Da.synchronousResult);return Da}shouldWaitForCopyToComplete($a){if(!$a||!$a.copyContextSnapshot)return e.ULS.sendTraceTag(537167907,
0,50,"AcrossSessionRangeCopyPasteHandler.ShouldWaitForCopyToComplete: pasteContext or pasteContext.CopyContextSnapshot is not define, return false."),!1;e.ULS.shipAssertTag(537167906,0,!!this.$.va,"AcrossSessionRangeCopyPasteHandler.ShouldWaitForCopyToComplete: this.EwaControl.BootstrapContext shouldn't be null");if($a.copyContextSnapshot.sessionId===this.$.va.UserSessionId)return e.ULS.sendTraceTag(537167905,0,50,"AcrossSessionRangeCopyPasteHandler.ShouldWaitForCopyToComplete: Same session copy scenario, return false."),
!1;e.ULS.sendTraceTag(537167904,0,50,"AcrossSessionRangeCopyPasteHandler.ShouldWaitForCopyToComplete: returning true");return!0}onDeferredPasteStarted($a){this.CU.onDeferredPasteStarted($a)}onDeferredPasteCompleted($a){this.CU.onDeferredPasteCompleted($a)}deserialize($a){$a.isClipboardDataContainShadowWorkbook=!(void 0===$a.clipboardItems.getItem(J.shadowWorkbook)||null===$a.clipboardItems.getItem(J.shadowWorkbook));if(Y.h(this.$).ha.Ne&326)return M($a)&&($a.wasLastCopyExternal=!0),Promise.reject(new ib.a(17));
var Zb=this.Mkg($a,!1);if(0!==Zb)return Promise.reject(new ib.a(M($a)?18:$a.isSameSession?19:20,void 0,void 0,void 0,Zb));var Da=$a.copyContextSnapshot,Pa=this.aq.Exb(Da);if(M($a))return this.Irc($a);Zb=$a.commandParameters.originalDestinations;if(Pa&&$a.isSameSession)return this.Z4i($a,Da,Pa,Zb);if(516!==$a.commandParameters.commandType){if(({Z0:Da}=this.eWj($a.clipboardItems)).returnValue){$a.isShadowWorkbookParsedSuccessfully=!0;let tb=Pa=null;r.EwaSettings.getBooleanFeatureGate(ra.a.K6b,!1)?Pa=
P.r(Zb,this.$):tb=P.v(P.K(Zb),this.$);return this.x4i($a,tb,Pa,Da)}if($a.isClipboardInaccessible)return Promise.reject(new ib.a(8));if(36!==$a.commandParameters.commandType)return this.ELf($a)}return Promise.reject(new ib.a(6))}beforePaste($a){this.$.da.za(373).Wsj($a);$a.indicationDisplayScheduled=!0}xVj($a){let Zb;if(!($a&&$a.SourceRanges&&$a.SourceRanges.Ranges&&$a.SourceRanges.Ranges.length&&($a.OriginalSourceRangesCountExceedsLimit||$a.OriginalSourceMultiRange&&$a.OriginalSourceMultiRange.Ranges&&
$a.OriginalSourceMultiRange.Ranges.length)))return{returnValue:!1,Z0:null};var Da=$a.SourceRanges.Ranges[0];if(!$a.ShadowWorkbookBase64&&!$a.ShadowWorkbookSizeExceedsLimit)return{returnValue:!1,Z0:null};Zb=this.CJe($a);Zb.rangeRowStart=Da.FirstRow;Zb.rangeRowEnd=Da.LastRow;Zb.rangeColumnStart=Da.FirstColumn;Zb.rangeColumnEnd=Da.LastColumn;Zb.sourceClientPath=$a.SourceClientPath;Zb.sourceSheetName=$a.SourceSheetName;Zb.sourceWorkbookName=$a.SourceWorkbookName;if(!$a.OriginalSourceRangesCountExceedsLimit)for($a=
$a.OriginalSourceMultiRange.Ranges,Zb.originalSourceRanges=Array($a.length),Da=0;Da<$a.length;++Da)Zb.originalSourceRanges[Da]=[$a[Da].FirstRow,$a[Da].FirstColumn,$a[Da].LastRow,$a[Da].LastColumn];return{returnValue:!0,Z0:Zb}}eWj($a){let Zb;Zb=null;$a=$a.getItem(J.shadowWorkbook);if(!$a)return{returnValue:!1,Z0:Zb};Zb=JSON.parse($a);return{returnValue:this.rwi(Zb),Z0:Zb}}rwi($a){return!!$a&&(!!$a.shadowWorkbookBase64||$a.shadowWorkbookSizeExceedsLimit)&&void 0!==$a.rangeRowStart&&void 0!==$a.rangeRowEnd&&
void 0!==$a.rangeColumnStart&&void 0!==$a.rangeColumnEnd}x4i($a,Zb,Da,Pa){e.ULS.shipAssertTag(537167903,0,!!Pa,"AcrossSessionRangeCopyPasteHandler.PasteAcrossSessions: shadowWorkbookPayload shouldn't be null");z.AFrameworkApplication.ON("Microsoft.Office.Excel.Server.Flighting.IDenyListNewCopyPasteExperienceAcrossSessions");$a.pasteResult="CrossSessionPaste";$a.payloadOrigin=pb.dKe;$a.payloadType=N.shadowWorkbook;$a.shadowWorkbookPayloadSize=Ea(Pa);$a.shadowWorkbookSizeExceedsLimit=xb(Pa);Pa.hasOwnProperty("originalSourceRangesCountExceedsLimit")&&
($a.originalSourceRangesCountExceedsLimit=Pa.originalSourceRangesCountExceedsLimit);if($a.shadowWorkbookSizeExceedsLimit)return e.ULS.sendTraceTag(34415003,0,15,`AcrossSessionRangeCopyPasteHandler.PasteAcrossSessions: shadow workbook length(${$a.shadowWorkbookPayloadSize}) is over the limit(${w.a.Umc}). reject the paste request. ShadowWorkbookSizeExceedsLimit: ${Pa.shadowWorkbookSizeExceedsLimit}`),Promise.reject(new ib.a(1));if(1028===$a.commandParameters.commandType&&$a.originalSourceRangesCountExceedsLimit)return e.ULS.sendTraceTag(572617859,
0,15,`AcrossSessionRangeCopyPasteHandler.PasteAcrossSessions: Original source ranges count(${Pa.originalSourceRangesCount}) is over the limit(${w.a.UGi}). Reject the paste request. OriginalSourceRangesCountExceedsLimit: ${Pa.originalSourceRangesCountExceedsLimit}`),Promise.reject(new ib.a(1));e.ULS.sendTraceTag(537167902,0,50,`AcrossSessionRangeCopyPasteHandler.PasteAcrossSessions: trigger Paste request. PasteOperationId=${$a.commandParameters.id}`);return this.aq.ILf($a.commandParameters.ribbonCommandInfo,
Zb,Da,Pa,[$a.commandParameters.stopwatch],$a)}Qfd($a,Zb,Da){e.ULS.shipAssertTag(537167901,0,!!$a,"AcrossSessionRangeCopyPasteHandler.GetCopiedDataFromServer: copyContext shouldn't be null");const Pa=$a.commandParameters.stopwatch.zc;return new Promise((tb,Ib)=>{e.ULS.sendTraceTag(26035421,0,50,`AcrossSessionRangeCopyPasteHandler.GetCopiedDataFromServer: issue request to the server to get the copied data for copy Id: ${$a.id}`);const Yb=P.u(Zb.sheetName,null,Zb.ranges);this.aq.copy(Yb,$a.commandParameters,
vc=>{$a.requestTelemetryData=vc.RequestTelemetryData;$a.serverRequestTimeInMs=$a.commandParameters.stopwatch.zc-Pa;if(Xa.a.Zf(vc.Errors))if(Xa.a.yha(vc.Errors))$a.encounteredDeploymentErrors=!0,vc=Xa.a.sc(vc.Errors),e.ULS.sendTraceTag(537167898,0,15,`AcrossSessionRangeCopyPasteHandler.GetCopiedDataFromServer: Got deployment errors - keeping promise unfulfilled until we replay the operation. errors: ${vc}. copy Id: ${$a.id}`);else{var Zc=Xa.a.sc(vc.Errors);e.ULS.sendTraceTag(26035419,0,10,`AcrossSessionRangeCopyPasteHandler.GetCopiedDataFromServer: GetCopiedDataFromServer failed. errors: ${Zc}. copy Id: ${$a.id}`);
Ib(new db(2,vc.Errors))}else if(e.ULS.sendTraceTag(537167900,0,50,`AcrossSessionRangeCopyPasteHandler.GetCopiedDataFromServer: GetCopiedDataFromServer succeed for copy Id: ${$a.id}`),$a.markForCancellation)Ib(new db(3,vc.Errors));else{Zc=vc.Result;var nd=Zc.PlainTextResult;void 0!==Da&&null!==Da&&(nd=Da);void 0!==nd&&null!==nd&&($a.plainTextPayloadSize=nd.length);var hd=this.W$.create();if(({Z0:Ud}=this.xVj(Zc)).returnValue){$a.shadowWorkbookPayloadSize=Ea(Ud);$a.shadowWorkbookSizeExceedsLimit=xb(Ud);
$a.originalSourceRangesCountExceedsLimit=Zc.OriginalSourceRangesCountExceedsLimit;var Ud=JSON.stringify(Ud);hd.setItem(J.shadowWorkbook,Ud)}hd.setItem(J.plainText,nd);ya.a.hjf()&&(nd=Zc.HtmlResult,$a.htmlSizeExceedsLimit=Zc.HtmlSizeExceedsLimit,void 0!==nd&&null!==nd&&($a.htmlPayloadSize=nd.length),hd.setItem(J.html,nd));$a.copyTotalSizeExceedsLimit=Zc.CopyTotalSizeExceedsLimit;hd.setItem(J.lsb,$a.commandParameters.id);this.h5c.setValue(Zb,hd);$a.asyncClipboardItemsKeys=wa(hd);tb(hd);r.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.OptimizeCellTableBigHammerSlowOperationsTeachingCallout",
!1)&&(Zc=1===$a.commandParameters.commandType?8:7,(hd=this.$.da.za(465))&&hd.q1(Zc,vc))}},vc=>{$a.serverRequestTimeInMs=$a.commandParameters.stopwatch.zc-Pa;vc=oa.a.Oe(vc.data);const Zc=Xa.a.sc(vc);e.ULS.sendTraceTag(537167897,0,10,`AcrossSessionRangeCopyPasteHandler.GetCopiedDataFromServer: GetCopiedDataFromServer failed. errors: ${Zc}. copy Id: ${$a.id}`);Ib(new db(2,vc))},[$a.commandParameters.stopwatch])})}}Object(c.a)(Pb,"AcrossSessionRangeCopyPasteHandler",wc,[]);class td{constructor($a,Zb,
Da,Pa,tb,Ib=null,Yb=null){this.floatingObjectId=$a;this.commandParameters=Zb;this.Yt=Da;this.Qih=Pa;this.Oaa=Ib;this.NQb=Yb;this.lah=tb}}Object(c.a)(td,"CopyArtRequest",null,[]);class Vb{constructor($a,Zb,Da,Pa,tb,Ib,Yb,vc,Zc){this.promise=null;this.ribbonCommandInfo=$a;this.destination=Zb;this.aMe=Da;this.NQb=tb;this.Z0=Ib;this.item=Yb;this.pasteContext=vc;this.SOa=Da||Zb.FirstRow+"_"+Zb.FirstColumn;this.Cjf=!0;this.HDe=Zc}}Object(c.a)(Vb,"PasteArtRequest",null,[]);class Ac{constructor($a,Zb){this.JKb=
new hb.a;this.D_a=$a;this.$=Zb;this.h$i=Da=>Promise.resolve(Da);this.CGb=Da=>Promise.reject(Da)}nai($a){if(this.hsi($a.SOa)){e.ULS.sendTraceTag(537167681,5,50,`PasteArtRequestManager.HandleRequest: Enqueued paste request as a result of rapid paste on same destination: ${$a.SOa}`);const Zb=this.JKb.oa($a.SOa);this.JKb.ia($a.SOa,$a);const Da=Zb.promise;Zb.Cjf=!1;return this.Ksh($a,Da)}this.JKb.ia($a.SOa,$a);return this.mzi($a)}hsi($a){return this.JKb.lb($a)}mzi($a){return new Promise((Zb,Da)=>{$a.promise=
this.D_a.DLf($a).then(Pa=>{Zb(null);return this.fqc($a,Pa)},Pa=>{Da(null);return this.CGb(Pa)})})}Ksh($a,Zb){return new Promise((Da,Pa)=>{$a.promise=Zb.then(tb=>{this.r0j($a,tb);return this.D_a.DLf($a).then(Ib=>{Da(null);return this.fqc($a,Ib)},Ib=>{Pa(null);return this.CGb(Ib)})},tb=>this.CGb(tb))})}fqc($a,Zb){$a.Cjf&&(this.U4g($a.SOa),this.tQd($a,Zb));return this.h$i(Zb)}U4g($a){this.JKb.remove($a)}tQd($a,Zb){const Da=this.v3h();$a.SOa===Da&&this.D_a.tQd($a.destination,Zb,$a.item.type)}v3h(){var $a=
Y.h(this.$).ha.Ra.activeFloatingObjectControlId;$a||($a=P.v(Y.h(this.$).ha.ra.activeCell,this.$),$a=$a.FirstRow+"_"+$a.FirstColumn);return $a}r0j($a,Zb){$a.destination=null;$a.aMe=Zb}}Object(c.a)(Ac,"PasteArtRequestManager",null,[]);var Kc=a(199),dd=a(122),Vd=a(103);class Jd extends bc{constructor($a,Zb,Da,Pa,tb=null){super($a,"ArtCopyPasteHandler");this.S5g="XLO";this.T5g="3";this.CU=new Db($a);this.W$=Zb;this.D_a=Da;this.ha=Y.h($a).ha;this.g5c=tb||new zb(this.W$);this.y4i=new Ac(Da,$a);this.ypb=
Pa}getSourceItem(){e.ULS.shipAssertTag(537167896,0,!!this.ha.Ra.activeFloatingObjectControlId,"Expecting a floating object to be currently selected for copy");e.ULS.sendTraceTag(537167895,0,50,`ArtCopyPasteHandler.GetSourceItem: Creating ArtSourceItem with FloatingObjectId=[${this.ha.Ra.activeFloatingObjectControlId}]`);return new L(this.ha.Ra.activeFloatingObjectControlId,this.$.ea.na.sheetName,this.$.ea.ye,this.$.va.UserSessionId,this.ha.Ra.$b.floatingObject.type)}beforeSerialize($a){$a&&$a.commandParameters?
($a?($a.isAsyncCopy=!1,$a.isSelectionAllowed=!1,$a.isFromCache=!1,$a.plainTextPayloadSize=0,$a.shadowWorkbookPayloadSize=0,$a.htmlPayloadSize=0,$a.htmlSizeExceedsLimit=!1,$a.clientSideCopyTime=0,$a.encounteredDeploymentErrors=!1,$a.shadowWorkbookSizeExceedsLimit=!1,$a.originalSourceRangesCountExceedsLimit=!1,$a.copyTotalSizeExceedsLimit=!1):e.ULS.sendTraceTag(537167826,0,10,"CommonCopyPasteUtils.InitializeCopyContext: copyContext is null."),$a.commandParameters.copyPasteTargetType=2):e.ULS.sendTraceTag(537167894,
0,10,"ArtCopyPasteHandler.BeforeSerialize: copyContext or copyContext.CommandParameters is null.")}serialize($a){const Zb=$a.sourceItem,Da={};if(!Zb)return e.ULS.sendTraceTag(537167893,0,10,"ArtCopyPasteHandler.Serialize: artSourceItem should not be null"),Da;if(!this.evi())return e.ULS.sendTraceTag(36824456,0,50,"ArtCopyPasteHandler.Serialize: Unsupported floating object type. This will clear the clipboard"),Da;e.ULS.sendTraceTag(537167892,0,50,`ArtCopyPasteHandler.Serialize: Serializing ArtSourceItem with FloatingObjectId=[${Zb.activeFloatingObjectControlId}]`);
this.sHd();let Pa=this.g5c.Bwa(Zb);if(Pa)Da.synchronousResult=Pa,$a.isFromCache=!0,$a.isAsyncCopy=!1,$a.clientSideCopyTime=$a.commandParameters.stopwatch.zc,1===$a.commandParameters.commandType&&this.$.Xc(2045211913,$a.commandParameters.ribbonCommandInfo.method,$a.commandParameters.ribbonCommandInfo.$e,null);else{$a.isFromCache=!1;$a.isAsyncCopy=!0;Pa=this.W$.create();if($a.commandParameters.uploadToClipService){const tb={};tb["data-clipservice-ccpid"]=$a.commandParameters.id;tb["data-pkey"]=$a.commandParameters.pKey;
tb["data-clipservice-type"]=$a.commandParameters.clipServiceDataType;tb["data-clipservice-count"]=$a.commandParameters.objectCount.toString();tb["data-clipservice-dc"]=$a.commandParameters.clipServiceDataCenter;tb["data-clipservice-client"]=this.S5g;tb["data-TimeStamp"]=(new Date).toUTCString();tb["data-clipservice-version"]=this.T5g;Pa.setItem(J.QPg,JSON.stringify(tb))}Da.synchronousResult=this.kJg(Pa);Da.asynchronousResult=this.Qfd($a,Zb,Pa)}$a.syncClipboardItemsKeys=wa(Da.synchronousResult);return Da}kJg($a){e.ULS.shipAssertTag(537167891,
0,!!this.ha.Ra.$b,"Expecting a floating object to be currently selected for copy");$a||($a=this.W$.create());const Zb=this.ha.Ra.$b.fwb();Zb&&$a.setItem(J.html,`<img src='${Zb}'>`);return $a}sHd(){const $a=this.ha.Ra.$b;this.ypb.sHd(dd.a.zrb($a.floatingObject),dd.a.V5g($a.yu))}shouldWaitForCopyToComplete(){e.ULS.sendTraceTag(537167890,0,50,"ArtCopyPasteHandler.ShouldWaitForCopyToComplete: returning true");return!0}onDeferredPasteStarted($a){this.CU.onDeferredPasteStarted($a)}onDeferredPasteCompleted($a){this.CU.onDeferredPasteCompleted($a)}deserialize($a){var Zb=
M($a),Da=null;let Pa=null;var tb=!1;if(!Zb){Da=$a.copyContextSnapshot;Pa=Da.sourceItem;if(!Pa)return Promise.reject(new ib.a(10));tb=Pa.isFromCurrentSession(this.$)}var Ib=this.Mkg($a,!0);if(0!==Ib)return Promise.reject(new ib.a(Zb?18:tb?19:20,void 0,void 0,void 0,Ib));if(Zb)return this.Irc($a);if(!tb&&!Jd.Mni(Pa))return $a=`User attempted to paste art of type [${Pa.type}] between sessions.`,e.ULS.sendTraceTag(537167889,0,50,$a),Promise.reject(new ib.a(11,void 0,void 0,$a));if(Da.isAsyncSerializeFailed)return Promise.reject(new ib.a(16,
void 0,void 0,"Last async serialize failed, therefore no current shadow workbook payload to paste"));let Yb;try{const vc=$a.clipboardItems.getItem(J.shadowWorkbook);Yb=JSON.parse(vc)}catch(vc){return $a=copyPasteInfra.getStringifiedError(vc),e.ULS.sendTraceTag(537167888,0,10,`ArtCopyPasteHandler.Deserialize: Failed to parse shadow workbook JSON with exception: ${$a}`),Promise.reject(new ib.a(12,void 0,vc))}Yb.floatingObjectId!==Pa.activeFloatingObjectControlId?e.ULS.sendTraceTag(537167887,0,10,`ArtCopyPasteHandler.Deserialize: FloatingObjectId mismatch! Deserializing with artSourceItem.ActiveFloatingObjectControlId=[${Pa.activeFloatingObjectControlId}], shadowWorkbookPayload.FloatingObjectId=[${Yb.floatingObjectId}]`):
e.ULS.sendTraceTag(537167886,0,50,`ArtCopyPasteHandler.Deserialize: Deserializing with artSourceItem.ActiveFloatingObjectControlId=[${Pa.activeFloatingObjectControlId}], shadowWorkbookPayload.FloatingObjectId=[${Yb.floatingObjectId}]`);if(!Yb||!Yb.shadowWorkbookBase64)return Promise.reject(new ib.a(13,void 0,void 0,`shadowWorkbookPayload is null = ${!Yb}`));$a.isShadowWorkbookParsedSuccessfully=!0;$a.shadowWorkbookPayloadSize=Ea(Yb);$a.shadowWorkbookSizeExceedsLimit=xb(Yb);$a.payloadOrigin=tb?pb.B_f:
pb.dKe;$a.payloadType=N.opg;if(xb(Yb))return $a=`Shadow workbook size [${$a.shadowWorkbookPayloadSize}] is over the limit [${w.a.Umc}]. ShadowWorkbookSizeExceedsLimit: ${Yb.shadowWorkbookSizeExceedsLimit}`,e.ULS.sendTraceTag(36304156,0,15,`ArtCopyPasteHandler.Deserialize: ${$a}`),Promise.reject(new ib.a(1,void 0,void 0,$a));Da=Zb=null;Y.h(this.$).ha.Ne&326?Da=Y.h(this.$).ha.Ra.activeFloatingObjectControlId:Zb=this.$.na&&this.$.na.activeCell?P.v(this.$.na.activeCell,this.$):P.v(P.K($a.commandParameters.originalDestinations),
this.$);tb=null;if(this.ypb.t7f(Pa))try{tb=this.ypb.e9c()}catch(vc){Ib=copyPasteInfra.getStringifiedError(vc),e.ULS.sendTraceTag(537167885,0,10,`ArtCopyPasteHandler.Deserialize: Exception encountered while performing client-side estimation. Exception: ${Ib}`)}return this.y4i.nai(new Vb($a.commandParameters.ribbonCommandInfo,Zb,Da,$a.commandParameters.commandType,[$a.commandParameters.stopwatch],Yb,Pa,$a,tb))}Irc($a){$a.wasLastCopyExternal=!0;if($a.clipboardItems.getItem("image/png")){const Zb=$a.commandParameters.stopwatch.zc;
$a.payloadType=N.WVg;return lb.b(this.$.Xc(1403967063,$a.commandParameters.ribbonCommandInfo.method,$a.commandParameters.ribbonCommandInfo.$e,{["dataUrl"]:$a.clipboardItems.getItem("image/png")})).then(Da=>{$a.serverRequestTimeInMs=$a.commandParameters.stopwatch.zc-Zb;return Da?Promise.resolve(null):Promise.reject(new ib.a(15))},()=>{$a.serverRequestTimeInMs=$a.commandParameters.stopwatch.zc-Zb;return Promise.reject(new ib.a(15))})}e.ULS.shipAssertTag(537167884,0,!1,"Should not paste external content that is not image via ArtCopyPasteHandler");
return super.Irc($a)}evi(){const $a=Y.h(this.$).ha;return $a.Ra.activeFloatingObjectControlId&&$a.Ra.$b&&$a.Ra.$b.floatingObject?$a.Ra.$b.floatingObject.eYd():!1}Qfd($a,Zb,Da){return new Promise((Pa,tb)=>{const Ib=$a.commandParameters.stopwatch.zc;e.ULS.sendTraceTag(41562516,0,50,"ArtCopyPasteHandler.GetCopiedDataFromServer: issue request to the server to get the copied data...");this.D_a.nah(new td(Zb.activeFloatingObjectControlId,$a.commandParameters,Yb=>{$a.requestTelemetryData=Yb.RequestTelemetryData;
$a.serverRequestTimeInMs=$a.commandParameters.stopwatch.zc-Ib;if(Xa.a.Zf(Yb.Errors))if(Xa.a.yha(Yb.Errors))$a.encounteredDeploymentErrors=!0,Yb=Xa.a.sc(Yb.Errors),e.ULS.sendTraceTag(537167879,0,15,`ArtCopyPasteHandler.GetCopiedDataFromServer: Got deployment errors - keeping promise unfulfilled until we replay the operation. errors: ${Yb}`);else{var vc=Xa.a.sc(Yb.Errors);e.ULS.sendTraceTag(36229122,0,10,`ArtCopyPasteHandler.GetCopiedDataFromServer: GetCopiedDataFromServer failed. errors: ${vc}`);tb(new db(4,
Yb.Errors))}else if(e.ULS.sendTraceTag(537167883,0,50,`ArtCopyPasteHandler.GetCopiedDataFromServer: GetCopiedDataFromServer succeeded for FloatingObjectId=[${Zb.activeFloatingObjectControlId}].`),$a.markForCancellation)tb(new db(3,Yb.Errors));else{if(Xa.a.Oq(Yb.Errors)){var Zc=Xa.a.sc(Yb.Errors);e.ULS.sendTraceTag(537167882,0,50,`ArtCopyPasteHandler.GetCopiedDataFromServer: Server messages present. Errors: ${Zc}`)}if(Zc=Yb.Result){Zc=this.CJe(Zc);Zc.floatingObjectId=Zb.activeFloatingObjectControlId;
$a.shadowWorkbookPayloadSize=Ea(Zc);$a.shadowWorkbookSizeExceedsLimit=xb(Zc);try{vc=JSON.stringify(Zc)}catch(nd){tb(new ib.a(14,void 0,nd,`Failed to stringify shadow workbook: copyContext.ShadowWorkbookPayloadSize: [${$a.shadowWorkbookPayloadSize}], shadowWorkbookPayload.FloatingObjectId: [${Zc.floatingObjectId}]`));return}e.ULS.shipAssertTag(537167881,0,!!Da,"Expecting syncClipboardItems to be defined");Da.setItem(J.shadowWorkbook,vc);1===$a.commandParameters.commandType&&(this.W7i(Zb.type,Zb.activeFloatingObjectControlId,
Yb.StateId),this.deleteFloatingObject(Zb.activeFloatingObjectControlId,Zb.type));this.g5c.setValue(Zb,Da);$a.asyncClipboardItemsKeys=wa(Da);Pa(Da)}else e.ULS.sendTraceTag(537167880,0,50,`ArtCopyPasteHandler.GetCopiedDataFromServer: Result form server returned null, copied item id: ${Zb.activeFloatingObjectControlId}`),Pa(this.g5c.Bwa(Zb))}},$a.commandParameters.commandType,Zb.type,Yb=>{$a.serverRequestTimeInMs=$a.commandParameters.stopwatch.zc-Ib;Yb=oa.a.Oe(Yb.data);1===$a.commandParameters.commandType&&
this.D_a.dXj(Zb.type,Zb.activeFloatingObjectControlId);const vc=Xa.a.sc(Yb);e.ULS.sendTraceTag(537167878,0,10,`ArtCopyPasteHandler.GetCopiedDataFromServer: GetCopiedDataFromServer failed. errors: ${vc}`);tb(new db(4,Yb))},[$a.commandParameters.stopwatch]))})}deleteFloatingObject($a,Zb){$a=Kc.a.Az(Zb,$a);if($a=Vd.a(this.$).Tq($a))Vd.a(this.$).deleteFloatingObject($a,14,!0),Y.h(this.$).ha.Ra.hB=null}W7i($a,Zb,Da){const Pa=this.$.da.za(277);if(Pa){let Ib=null;$a=Kc.a.Az($a,Zb);$a=Vd.a(this.$).Tq($a);
if(null===$a||void 0===$a?0:$a.Yi)Ib=$a.Yi.block;if(Ib){var tb=$a.floatingObject.Kg();Pa.D_b(()=>!Ib.Ki.lb(tb),Da,"CutArt")}}}static Mni($a){return 1===$a.type||5===$a.type}}Object(c.a)(Jd,"ArtCopyPasteHandler",bc,[]);var oe=a(58);class De extends Lb{constructor($a,Zb,Da,Pa){super($a);this.isFromCurrentSession=!1;this.left=this.top=0;this.isFromCurrentSession=Zb;this.top=Da;this.left=Pa}}Object(c.a)(De,"MacroRecorderPasteArtPayload",Lb,[]);class Ke{constructor($a,Zb){this.$=$a;this.ypb=Zb}Jfi($a,
Zb,Da,Pa,tb,Ib=null,Yb=null){const vc=this.$.pa.ya.Wb();let Zc=null;const nd={CopyPasteTargetType:2};nd.FloatingObjectId=$a;nd.CopyOperationId=Da.id;Da.floatingObjectType=Zb;nd.UploadToClipService=Da.uploadToClipService;nd.PKey=Da.pKey;nd.ClipServiceDataCenter=Da.clipServiceDataCenter;let hd=0;2===tb?(tb=505,hd=16,Zc=(Ud,ee,ec)=>Ma(this.$.pa.ya,nd,kb.b(Ud,Pa),Ib?kb.a(ee,Ib):ee,ec,Da.ribbonCommandInfo,vc,Yb)):(tb=179,Zc=(Ud,ee,ec)=>{this.Roh(Zb,$a);this.$.Qy();return Ja(this.$.pa.ya,nd,kb.b(Ud,Pa),
Ib?kb.a(ee,Ib):ee,ec,Da.ribbonCommandInfo,vc,Yb)});this.$.userOperationManager.Kc(new Ra.a(tb,0,Zc,hd|64),Da.ribbonCommandInfo)}Roh($a,Zb){var Da=Kc.a.Az($a,Zb);(Da=Vd.a(this.$).Tq(Da))?(Y.h(this.$).ha.Ra.zH(Da),Da.isVisible=!1):e.ULS.sendTraceTag(537167876,0,50,`ArtCopyPasteUtils.DoCutClientEstimation: floatingObjectcontrol is null. FloatingObjectType : ${$a}, FloatingObjectId: ${Zb}`)}dXj($a,Zb){$a=Kc.a.Az($a,Zb);if($a=Vd.a(this.$).Tq($a))$a.isVisible=!0}nah($a){this.Jfi($a.floatingObjectId,$a.lah,
$a.commandParameters,$a.Yt,$a.Qih,$a.Oaa,$a.NQb)}kgi($a,Zb,Da,Pa,tb,Ib,Yb,vc=null,Zc=!0){return new Promise((nd,hd)=>{const Ud=Ib.commandParameters.stopwatch.zc;this.RQd($a,tb,Zb,Da,ee=>{Ib.requestTelemetryData=ee.RequestTelemetryData;Ib.serverRequestTimeInMs=Ib.commandParameters.stopwatch.zc-Ud;if(Xa.a.yha(ee.Errors))Ib&&(Ib.encounteredDeploymentErrors=!0),ee=Xa.a.sc(ee.Errors),e.ULS.sendTraceTag(537167875,0,15,`ArtCopyPasteUtils.PasteArt: Got deployment errors - keeping promise unfulfilled until we replay the operation. errors: ${ee}`);
else if(Xa.a.Zf(ee.Errors)){var ec=Xa.a.sc(ee.Errors);e.ULS.sendTraceTag(36459652,0,10,`ArtCopyPasteUtils.PasteArt: PasteArt failed. errors: ${ec}`);hd(new ib.a(9,ee.Errors))}else ee.Result?(ec=ee.Result,e.ULS.sendTraceTag(537167874,0,50,"ArtCopyPasteUtils.PasteArt: PasteArt succeeded."),this.i8i(Yb,ec.FloatingObjectId,ee.StateId),nd(Ke.mnd(ec.FloatingObjectId))):(e.ULS.sendTraceTag(537167873,0,10,"ArtCopyPasteUtils.PasteArt: PasteArt failed, result returned from server is null."),hd(new ib.a(9,ee.Errors)))},
ee=>{Ib.serverRequestTimeInMs=Ib.commandParameters.stopwatch.zc-Ud;ee=oa.a.Oe(ee.data);e.ULS.sendTraceTag(537167872,0,10,`ArtCopyPasteUtils.PasteArt: PasteArt failed. errors: ${Xa.a.sc(ee)}`);hd(new ib.a(9,ee))},Pa,vc,Zc)})}i8i($a,Zb,Da){const Pa=this.$.da.za(277);if(Pa){const tb=Kc.a.Az($a,Ke.mnd(Zb));Pa.D_b(()=>!!Vd.a(this.$).Tq(tb),Da,"PasteArt")}}r0d($a,Zb){Zb&&this.ypb.r0d($a,Kc.a.Az($a.type,Zb))}DLf($a){return this.kgi($a.ribbonCommandInfo,$a.destination,$a.aMe,$a.NQb,$a.Z0,$a.pasteContext,
$a.item.type,$a.HDe,$a.item.isFromCurrentSession(this.$)).then(Zb=>Zb,Zb=>{this.r0d($a.item,$a.HDe);return Promise.reject(Zb)})}tQd($a,Zb,Da){$a||($a=P.v(Y.h(this.$).ha.ra.activeCell,this.$));Y.h(this.$).Djc(P.D($a),1)?Vd.a(this.$).Yna(Da,Zb,!0):Y.h(this.$).ha.Ra.cIa($a,Zb,Da).continueWith(Pa=>{Pa.result?e.ULS.sendTraceTag(537167843,5,50,`ArtCopyPasteUtils.SelectPastedObject: Selection succeeded in async manner for object ID [${Zb}]`):e.ULS.sendTraceTag(537167842,5,10,`ArtCopyPasteUtils.SelectPastedObject: Selection failed in async manner for object ID [${Zb}]`)})}RQd($a,
Zb,Da,Pa,tb,Ib,Yb,vc,Zc=!0){const nd=this.$.pa.ya.Wb(),hd={};hd.ShadowWorkbookBase64=Zb.shadowWorkbookBase64;hd.FloatingObjectId=Pa;hd.DestinationRanges=Da?P.s(Da):null;hd.CopyPasteTargetType=2;hd.ClientEstimationFloatingObjectId=vc;Da=new Ra.a(503,0,(Ud,ee,ec)=>{vc||this.$.Qy();return Ga(this.$.pa.ya,hd,kb.b(Ud,tb),kb.a(ee,Ib),ec,null,nd,Yb)},void 0,()=>{if(Zc){let Ud;Ud=oe.a.li(oe.a.hc(hd));Ud.FloatingObjectId=Zb.floatingObjectId;hd.DestinationRanges||(Ud.DestinationRanges=P.p(this.$.xa.na.sheetName,
"",0,0,0,0));return new De(Ud,Zc,0,0)}return new De(hd,Zc,0,0)});Da.flags=65;this.$.userOperationManager.Kc(Da,$a)}static mnd($a){return`${$a.length+2}.{${$a.toUpperCase()}}`}}Object(c.a)(Ke,"ArtCopyPasteUtils",null,[448]);var rd=a(213);class bf{constructor($a){this.e5c=this.Pta=null;this.Zab=15;this.$=$a}sHd($a,Zb){this.Pta=$a;this.e5c=Zb}e9c(){if(!this.Pta||!this.e5c)return e.ULS.sendTraceTag(537167841,0,15,"ArtPasteClientEstimation.DoPasteClientEstimation: copiedFloatingObjectControl and/or copiedEffectsExtents is null, aborting client side estimation."),
"";const $a=dd.a.zrb(new Kc.a(this.Pta));$a.Id=Ke.mnd(l.a.create().toString());$a.Version=-1;$a.Name="";$a.IsClientEstimation=!0;var Zb=this.yhi($a);if(!Zb)return null;const Da=new Kc.a($a);Zb.block.Ki.add(Da);Da.OKb();const Pa=Vd.a(this.$);Pa.a6b(Da,Zb);Zb=Pa.Tq(Kc.a.iXh($a));!Zb||Zb.floatingObject.wNa||Zb.floatingObject.QNa||Zb.MSa(this.e5c);Pa.Yna($a.Type,$a.Id,!0);return $a.Id}t7f($a){return r.EwaSettings.ma(220)&&$a.isFromCurrentSession(this.$)&&!Y.h(this.$).rtl&&!Y.h(this.$).ib.tj}r0d($a,Zb){this.t7f($a)&&
($a=Vd.a(this.$).Tq(Zb))&&(e.ULS.sendTraceTag(537167840,5,50,`ArtPasteClientEstimation.UndoPasteClientEstimation: undoing client-side estimation. Removing floating object with ID: [${Zb}] of type [${$a.floatingObject.type}]`),Vd.a(this.$).deleteFloatingObject($a,15,!0),$a.Yi&&$a.tcb($a.Yi,!1))}yhi($a){if(!$a)return e.ULS.sendTraceTag(537167839,0,15,"ArtPasteClientEstimation.InitializeFloatingObjectLocation: Called with null FloatingObjectData."),null;if(Y.h(this.$).ha.Ra.activeFloatingObjectControlId){var Zb=
Y.h(this.$).ha.Ra.hB.floatingObject;$a.OriginDeltaX=Zb.offsetX+this.Zab;$a.OriginDeltaY=Zb.offsetY+this.Zab;$a.AbsoluteLeft+=this.Zab;$a.AbsoluteTop+=this.Zab;$a.AbsoluteRight+=this.Zab;$a.AbsoluteBottom+=this.Zab;$a.ZOrder=Zb.kC+1;return Y.h(this.$).ha.Ra.hB.Yi}if(!this.$.na||!this.$.na.activeCell)return e.ULS.sendTraceTag(537167838,0,15,"ArtPasteClientEstimation.InitializeFloatingObjectLocation: ActiveItem/ActiveCell is null - cannot perform estimation for grid paste."),null;var Da=this.$.na.activeCell;
Zb=Y.h(this.$).C1(Da);if(!Zb)return e.ULS.sendTraceTag(537167837,0,15,`ArtPasteClientEstimation.InitializeFloatingObjectLocation: gridViewBlock for range ${Da.toString()} is null.`),null;const Pa=xa.HelperMethods.qxb(Zb.domElement,Zb.$i.domElement);Da=Zb.gridView.ag(Da,2);if(!Pa||!Da)return e.ULS.sendTraceTag(537167836,0,15,`ArtPasteClientEstimation.InitializeFloatingObjectLocation: blockPositionRelativeToGridOrigin is null: ${!Pa}. cellPositionRelativeToGridOrigin is null: ${!Da} .`),null;$a.OriginDeltaX=
Da.topLeft.x-Pa.x;$a.OriginDeltaY=Da.topLeft.y-Pa.y;$a.AbsoluteLeft=Da.topLeft.x;$a.AbsoluteTop=Da.topLeft.y;$a.AbsoluteRight=$a.AbsoluteLeft+Math.abs(this.Pta.AbsoluteRight-this.Pta.AbsoluteLeft);$a.AbsoluteBottom=$a.AbsoluteTop+Math.abs(this.Pta.AbsoluteBottom-this.Pta.AbsoluteTop);$a.ZOrder=this.Pta.ZOrder+100;return new rd.a(Zb.gridView.Ea.Dl(Zb.hashCode),Zb.hashCode)}}Object(c.a)(bf,"ArtPasteClientEstimation",null,[447]);class cc{create(){const $a=window.clipboardPlatform;return $a?$a.createClipboardItems():
null}}Object(c.a)(cc,"ClipboardItemsFactory",null,[446]);class Wc{}Wc.undefined="Undefined";Object(c.a)(Wc,"CCPTelemetryConsts",null,[]);class id{}id.cells="Cells";id.floatingObject="FloatingObject";id.unknown="Unknown";Object(c.a)(id,"ActiveSelection",null,[]);class Tc{}Tc.boh="DisplayNotInvoked";Tc.X8c="Displayed";Tc.s8i="PrerequisitesNotReady";Object(c.a)(Tc,"PasteIndicationDisplayStatus",null,[]);var Gd=a(109);class Wd{constructor($a){this.qHc=this.ARc=null;this.$=$a}get yJd(){if(!this.ARc){const $a=
this.$.da.za(254,!0);$a&&(this.ARc=new Pb(this.$,$a,new cc))}return this.ARc}get uZc(){if(!this.qHc&&this.$.da.za(254,!0)){const $a=new bf(this.$);this.qHc=new Jd(this.$,new cc,new Ke(this.$,$a),$a)}return this.qHc}getCopyFlowHandler($a){const Zb=this.SSh(Y.h(this.$).Ne);$a.commandParameters.copyPasteHandlerName=Zb.name;return Zb}getPasteFlowHandler($a){var Zb=$a.copyContextSnapshot;Zb=S($a)?this.uZc:M($a)?this.yJd:(null===Zb||void 0===Zb?0:Zb.sourceItem)&&Object.getType(Zb.sourceItem)===L?this.uZc:
this.yJd;$a.commandParameters.copyPasteHandlerName=Zb.name;return Zb}initializePasteContext($a){if($a&&($a.isSameSession=!1,$a.isShadowWorkbookParsedSuccessfully=!1,$a.pasteResult=Wc.undefined,$a.payloadOrigin=Wc.undefined,$a.payloadType=Wc.undefined,$a.encounteredDeploymentErrors=!1,$a.shadowWorkbookSizeExceedsLimit=!1,$a.originalSourceRangesCountExceedsLimit=!1,$a.activeSelectionType=this.FOh(),$a.indicationDisplayScheduled=!1,$a.pasteDestinationHasMergedCells=!1,$a.pasteIndicationDisplayStatus=
Tc.boh,$a.copyContextSnapshot)){var Zb=$a.copyContextSnapshot;const Yb=C(Zb.sourceItem);var Da=Zb.sourceItem;var Pa=!!Da&&Object.getType(Da)===L;Da=0;var tb=!1;Yb?(tb=Zb.sourceItem,$a.isSameSession=tb.isFromCurrentSession(this.$),Da=1,tb=this.isi(tb,$a)):Pa&&($a.isSameSession=Zb.sourceItem.isFromCurrentSession(this.$),Da=2);if($a.copyContextSnapshot.commandParameters){const vc=-1985798686===Zb.commandParameters.ribbonCommandInfo.command;Pa=$a.commandParameters;var Ib=this.$;Zb?Ib&&Ib.va?Zb=Zb.sessionId===
Ib.va.UserSessionId:(e.ULS.shipAssertTag(537166211,0,!1,"ewaControl shouldn't be null"),Zb=!1):(e.ULS.shipAssertTag(537166212,0,!1,"copyContext shouldn't be null"),Zb=!1);Pa.clearSystemClipboard=Zb&&vc&&Yb&&!tb;$a.commandParameters.copyPasteTargetType=Da}}}getSessionId(){return this.$.va.UserSessionId}isi($a,Zb){const Da=Gd.b($a.ranges,Pa=>Pa.hf)&&Gd.b(Zb.commandParameters.originalDestinations,Pa=>1!==Pa.top);return Gd.b($a.ranges,Pa=>Pa.isRow)&&Gd.b(Zb.commandParameters.originalDestinations,Pa=>
1!==Pa.left)||Da}SSh($a){switch($a){case 1:return this.yJd;case 64:case 4:case 2:case 256:return this.uZc;default:throw Error.invalidOperation("Unsupported selection");}}FOh(){return Y.h(this.$).ha.Ne&470?id.floatingObject:1===Y.h(this.$).ha.Ne?id.cells:id.unknown}getDialogResponse(){}}Object(c.a)(Wd,"ExcelCopyPasteApplicationHost",null,[384]);var Dd=a(157);class Kd extends B.a{constructor($a,Zb){super($a);this.pp=null;this.pji=(Da,Pa)=>{1===Da?(Da=Kd.lnh[Pa[Kd.knh]],e.ULS.sendTraceTag(537167683,
0,50,`InsertCopiedCutCellsDialog.InsertCopiedCutCellsDialogHandler OK button pressed with valid input, shift direction = ${0===Da?"Horizontal":"Vertical"}`),this.pp.setResult(Da)):(e.ULS.sendTraceTag(537167682,0,50,"InsertCopiedCutCellsDialog.InsertCopiedCutCellsDialogHandler cancel button pressed"),this.pp.Rs())};this.dg(Zb)}get pc(){return"InsertCopiedCutCellsDialog"}dg($a){this.pp=new Dd.a;const Zb=A.a.instance.ga(16);$a=this.nN($a);this.initializeAndShow(Zb,this.pji,$a)}nN($a){return{[Kd.vu]:this.pc,
[Kd.Oti]:$a}}}Kd.knh="direction";Kd.Oti="isRtl";Kd.lnh={["Vertical"]:1,["Horizontal"]:0};Object(c.a)(Kd,"InsertCopiedCutCellsDialog",B.a,[]);class we{c6b($a,Zb){return(new Kd($a,Zb)).pp.task}}Object(c.a)(we,"InsertCopiedCutCellsDialogFactory",null,[380]);var We=a(87),Od=a(47),le=a(46);class de{constructor($a){this.b7b="";this.K2=this.rt=null;this.Fsc=!1;this.Pbf=(Zb=null,Da=null)=>{this.hide(Zb,Da)};this.gridView=Y.h($a);this.gridView.ha.kH(this.Pbf)}fOe(){this.Fsc||(e.ULS.sendTraceTag(537167680,
0,50,"PasteIndicationManager.DownloadPrerequisitesIfNeeded: Trying to get appChrome"),this.gridView.$.ny($a=>{$a.cba(0).then(()=>{this.Fsc=!0})}))}Wsj($a){var Zb=$a.commandParameters.id;e.ULS.sendTraceTag(537167651,0,50,`PasteIndicationManager.ScheduleDisplay: pasteCommandId = ${Zb}, cancelCtx is null = ${!this.rt}, PrerequisitesDownloaded = ${this.Fsc}`);this.fOe();this.b7b=Zb;Zb=!this.cxf();if(!this.rt||Zb)this.RAe(),this.rt=Od.a.instance.create(()=>{this.aoh($a)},void 0===$a.timeoutToShowSpinnerInMs||
null===$a.timeoutToShowSpinnerInMs?100:$a.timeoutToShowSpinnerInMs,le.a.E4i);this.K2=$a.commandParameters.originalDestinations}aoh($a){this.Fsc?(this.display($a.commandParameters.originalDestinations),$a.pasteIndicationDisplayStatus=Tc.X8c):(e.ULS.sendTraceTag(537167650,0,50,"PasteIndicationManager.DisplayIfPossible: Prerequisites were not ready, skipping display"),this.hide(),$a.pasteIndicationDisplayStatus=Tc.s8i)}display($a){e.ULS.sendTraceTag(537167649,0,50,"PasteIndicationManager.Display: started");
this.gridView.qb.nx(Na.a.Nea(Fa.d(this.gridView.$.na),$a),de.Jrc,!0);this.gridView.qb.Tn(de.Jrc)}amd($a){e.ULS.sendTraceTag(537167648,0,50,`PasteIndicationManager.HideForPasteId: pasteCommandId = ${$a}, currentPasteCommandId = ${this.b7b}`);$a&&fa.a.equals($a,this.b7b,!1)&&this.hide()}hide($a=null){this.K2&&$a&&this.cxf()&&e.ULS.sendTraceTag(537167647,0,15,"PasteIndicationManager.Hide: Triggered by a SelectionChanged event while indication is (or will be) active but active range did not change");
this.b7b="";this.RAe();this.K2=null;this.gridView.qb.Wg(de.Jrc);this.gridView.qb.Qi(null,de.Jrc)}cxf(){return P.Q(this.gridView.ha.ra.selectedRanges,this.K2)}RAe(){this.rt&&(We.a.Ia(this.rt),this.rt=null)}dispose(){this.hide();this.gridView.ha.mG(this.Pbf)}}de.Jrc=[30];Object(c.a)(de,"PasteIndicationManager",null,[379,2]);var Re=a(978),Ee=a(53),Te=a(695);class Ae extends f.a{constructor($a){super();this.$=$a;this.hm=A.a.instance;this.Fb()}create(){const $a=Ee.a.sR([74,75],4,this.Ya,void 0,void 0,
void 0,Ae.coa),Zb=aa.GetServiceTaskFactory.create(this.$.da,18,this.$.la,this.Ya);Ha.TaskExtensions.Aa(Ha.TaskExtensions.Fd([Zb,$a],this.la),()=>{const Da=new Re.a;let Pa=null;this.M8g(Da).then(tb=>{Pa=tb.MDe;const Ib=copyPasteInfra.createCopyPasteInfra(Pa,new Wd(this.$),Da,this.$);e.ULS.shipAssertTag(537167762,0,!!this.$.va,"CopyPasteInfrastructureFactory.Create: this.ewaControl.BootstrapContext should not be null");e.ULS.shipAssertTag(537167761,0,!!this.$.va&&!!this.$.va.DocumentHostInfo,"CopyPasteInfrastructureFactory.Create: this.ewaControl.BootstrapContext.DocumentHostInfo should not be null");
const Yb=Pa.getMetadataManager();var vc=Object(Te.a)(this.$.da,254,()=>new Mb(this.$,Yb,Zb.result,Ib,new Bc(this.$,Y.h(this.$)),new we,this.$.va.DocumentHostInfo.UserId,Pa.getInitializationError()));this.ob(vc);if(tb.d1a){vc=Mb.Xbc();const Zc=JSON.stringify(tb.d1a.dataClipboardCapabilities),nd=tb.d1a.clipboardStrategiesToInitialize[0].clipboardStrategyType===tb.d1a.dataClipboardStrategyType,hd=void 0===window.bsqmXLSPageLoadStartTime||null===window.bsqmXLSPageLoadStartTime?"-1":(Date.now()-window.bsqmXLSPageLoadStartTime.getTime()).toString();
e.ULS.sendTraceTag(41731933,0,50,`CopyPasteInfrastructureFactory.Create: Initialize CCP infra succeed. SliceName=${vc}, StrategyType=${tb.d1a.dataClipboardStrategyType}, StrategyCapabilities=${Zc}, IsBestStrategyTypeInitialized=${nd}, InfraLoadTimeMS=${hd}`)}else e.ULS.shipAssertTag(537167760,0,!1,"CopyPasteInfrastructureFactory.Create: initResult.ClipboardPlatformEnvironmentInitializationInfo should not be null")},tb=>{const Ib=Mb.Xbc();tb=tb?copyPasteInfra.getStringifiedError(tb):"null";e.ULS.shipAssertTag(38847436,
0,!1,`CopyPasteInfrastructureFactory.Create: error during call to clipboardPlatformEnvironment.Init(). Copy Paste operations will not be available in this session. SliceName: ${Ib} error: ${tb}`)})},this.la,3)}dispose(){super.dispose()}M8g($a){let Zb=null;var Da=window.clipboardPlatform;Da&&(Zb=Da.getClipboardPlatformEnvironment());if(!Zb)return e.ULS.shipAssertTag(537167759,0,!1,"CopyPasteInfrastructureFactory.ConfigureClipboardPlatformEnvironment: getClipboardPlatformEnvironment should have returned a valid object"),
Promise.reject(null);Da=this.$.va;const Pa=[Da.OfficeOnlineChromeExtensionId,Da.ChromeClipboardAccessExtensionId],tb=this.hm.Ua(5);var Ib=this.$.he.get(57);let Yb=!Ib&&this.$.he.get(5);const vc=this.$.ea.dc;vc&&(vc.inWebPart||vc.inViewerFromWebPart||vc.isDivSyndicated)&&(Yb=!1);Ib=this.ORh(Yb,!Ib);e.ULS.shipAssertTag(537167758,0,!!Da.DocumentHostInfo,"CopyPasteInfrastructureFactory.ConfigureClipboardPlatformEnvironment: bootstrapContext.DocumentHostInfo should not be null");return Zb.init(this.$,
$a,Pa,Da.SharedClipboardHostingApp,Da.SharedClipboardHostingApps,Da.SharedClipboardHostingEnvironments,Da.SharedClipboardOverrideOrigin,Da.SharedClipboardSchemaVersion,Da.SharedClipboardExpirationInMinutes,Da.ClipboardPromiseTimeoutInMinutes,tb,Da.MachineCluster,new fc(this.$),Ib,Da.DocumentHostInfo.UserId,Da.ClipboardTtlInMS,r.EwaSettings.ma(306),Da.UserSessionId).then(Zc=>Object(b.a)(new dc,{MDe:Zb,d1a:Zc}),Zc=>Promise.reject(Zc))}ORh($a,Zb){const Da=[];$a&&Zb&&Da.push(this.qhh());Zb&&(Da.push(this.M6c(7)),
Da.push(this.M6c(0)));$a&&Da.push(this.IIe());Da.push({clipboardStrategyType:4});const Pa=Da?Da.map(tb=>JSON.stringify(tb)).join(","):"[]";e.ULS.sendTraceTag(39978242,0,50,`CopyPasteInfrastructureFactory.GetClipboardStrategiesInitList: create clipboard stratgy initialization list: isBrowserStorageAllowed=${$a}, isSystemClipboardAllowed=${Zb}, result = ${Pa}`);return Da}IIe(){const $a=this.$.va,Zb={clipboardStrategyType:5};Zb.sessionId=$a.UserSessionId;Zb.useSharedClipboardIframe=!0;Zb.sharedClipboardHostingApp=
$a.SharedClipboardHostingApp;Zb.sharedClipboardHostingApps=$a.SharedClipboardHostingApps;Zb.sharedClipboardHostingEnvironments=$a.SharedClipboardHostingEnvironments;Zb.sharedClipboardOverrideOrigin=$a.SharedClipboardOverrideOrigin;Zb.sharedClipboardSchemaVersion=$a.SharedClipboardSchemaVersion;Zb.sharedClipboardExpirationInMinutes=$a.SharedClipboardExpirationInMinutes;Zb.wacCluster=$a.MachineCluster;return Zb}qhh(){const $a={clipboardStrategyType:6};$a.localStorageStrategyParameters=this.IIe();$a.systemClipboardStrategyParameters=
this.M6c(0);return $a}M6c($a){const Zb={};Zb.clipboardStrategyType=$a;Zb.skipFilesIfPlainTextExists=!0;return Zb}static ka($a){$a.da.Ga(373,new de($a));$a.da.Ga(Ae.coa,new Ae($a))}}Ae.coa=255;Object(c.a)(Ae,"CopyPasteInfrastructureFactory",f.a,[]);var kf=a(9);a.d(D,"a",function(){return Oe});const Oe=()=>{kf.a.Fa($a=>{Ae.ka($a)})}},1155:function(u,D,a){u=a(0);var c=a(15),b=a(682),e=a(553),f=a(84),d=a(82),h;(function(qa){qa[qa.applicationFeatureHelperHandler=0]="applicationFeatureHelperHandler";qa[qa.cloudPolicySettings=
1]="cloudPolicySettings";qa[qa.alternateAuthToken=2]="alternateAuthToken"})(h||(h={}));Object(u.b)("ApplicationFeatureHelperRequestType",h);class m{constructor(){this.message=null;this.cgc=0}}Object(u.a)(m,"HttpRequstToPromiseRejectData",null,[]);var l=a(97),v=a(80),t=a(240),z=a(30);class r{constructor(qa,aa){this.mb=qa;this.yh=aa}b6c(qa,aa,ia,Ha=null,Z=null,la=null,Xa=null,Za=null){const xa=h[ia],fa=xa+"RequestFailure";l.Health.instance.recordKpiUsage(fa,0,"jpittsdirects",null);return new Promise((ua,
sa)=>{c.ULS.sendTraceTag(50622688,3004,50,"HttpRequestToPromiseUtility.CreateHttpResponsePromise: Initializing HttpRequest {0}.",xa);const sb=null!=Xa?Xa:this.mb.ud("ApplicationFeatureHelperRequestQueueTimeout",15E3),hb=null!=Za?Za:this.mb.ud("ApplicationFeatureHelperRequestSentTimeout",3E4);this.yh.iha(qa,1,null,this.tXh(ia,Ha),la,!1,1,bb=>{c.ULS.sendTraceTag(50622689,3004,50,"HttpRequestToPromiseUtility.CreateHttpResponsePromise: HttpRequest {0} Succeeded.",xa);try{if(void 0===bb||null===bb||void 0===
bb.data||null===bb.data||void 0===bb.data.te||null===bb.data.te){l.Health.instance.recordKpiFailure(fa,"Invalid RequestSucceededEventArgs",!1,!0,null);let Fa=String.format("HttpRequestToPromiseUtility.CreateHttpResponsePromise: args or args.Data or args.Data.ResponseData is null or undefined request {0}",xa);sa(this.Fxb(Fa,bb))}else if(bb.data.httpStatus!==t.a.mP){l.Health.instance.recordKpiFailure(fa,"HttpStatusCode_"+bb.data.httpStatus.toString(),!1,!0,null);let Fa=String.format("HttpRequestToPromiseUtility.CreateHttpResponsePromise: ApplicationFeatureHelper Service token generation returned unexpected response code {0}, request {1}",
bb.data.httpStatus,xa);sa(this.Fxb(Fa,bb))}else{void 0!==Z&&null!==Z&&void 0!==bb.data.responseHeaders&&null!==bb.data.responseHeaders&&Z(bb.data.responseHeaders);var lb=aa(bb.data.te);if(lb)c.ULS.sendTraceTag(50622690,3004,50,"HttpRequestToPromiseUtility.CreateHttpResponsePromise: Successfully parsed response for request {0}",xa),ua(lb);else{l.Health.instance.recordKpiFailure(fa,"Parse Failure",!1,!0,null);let Fa=String.format("HttpRequestToPromiseUtility.CreateHttpResponsePromise: Failed to parse response for request {0}",
xa);sa(this.Fxb(Fa,bb))}}}catch(Fa){l.Health.instance.recordKpiFailure(fa,"Unexpected Failure",!1,!0,null),lb=String.format("HttpRequestToPromiseUtility.CreateHttpResponsePromise: Exception {0} for request {1}",Fa,xa),sa(this.Fxb(lb,bb))}},bb=>{if(bb.data){l.Health.instance.recordKpiFailure(fa,"HttpStatusCode_"+bb.data.httpStatus.toString(),!1,!0,null);var lb=z.a.V6e(bb.data.te||"No Data");lb=String.format("HttpRequestToPromiseUtility.CreateHttpResponsePromise: Request Failed: HttpStatus - {0}, ResponseData - {1} for Request - {2}",
bb.data.httpStatus,lb,xa)}else l.Health.instance.recordKpiFailure(fa,"Invalid RequestFailedEventArgs",!1,!0,null),lb=String.format("HttpRequestToPromiseUtility.CreateHttpResponsePromise: args or args.Data is null or undefined for request {0}",xa);sa(this.Fxb(lb,bb))},null,void 0,void 0,sb,hb)})}Fxb(qa,aa){const ia=new m;ia.message=qa;ia.cgc=aa&&aa.data?aa.data.httpStatus:-1;return ia}tXh(qa,aa){const ia={};ia["x-UserDataSignature"]=this.mb.Xa("UserDataSignature");ia["x-LicensingIsEnabled"]=this.mb.qa("LicensingIsEnabled").toString();
ia["x-CacheIsEnabled"]=this.mb.qa("LicensingRedisIsEnabled").toString();ia["x-OcpsIsEnabled"]=this.mb.qa("OcpsIsEnabled").toString();ia["x-LicensingAADIdIsEnabled"]=this.mb.qa("LicensingAadIdIsEnabled").toString();0===qa&&(ia["x-LicenseCheckOnTenantEnabled"]=this.mb.getBooleanFeatureGate("Microsoft.Office.SharedOnline.SafeLinksLicenseCheck",!1).toString(),ia["x-SupportUserConsentDependentFeatures"]="true",ia["x-AFHUserConsentGroupValue"]="0",ia["x-UseShellServiceForUserConsentGroup"]="true",ia["x-SMBUserLicensingEnabled"]=
"true",ia["x-AFHPIPLComplianceEnabled"]=v.a.ly(window.location.href,"wd_afhpipl")||"false");if(aa)for(let Ha of aa.keys)ia[Ha]=aa.oa(Ha);return ia}}Object(u.a)(r,"HttpRequestToPromiseUtility",null,[]);var n=a(4),w;(function(qa){qa[qa.loki=0]="loki";qa[qa.augloopACLP=1]="augloopACLP"})(w||(w={}));Object(u.b)("AlternateAuthSupportApp",w);var B=a(729),A=a(41);class y{constructor(){this.Token=null;this.ExpirationTime=0}}Object(u.a)(y,"WacAlternateAuthToken",null,[]);class x{constructor(qa,aa){this.fTj=
3E5;if(void 0===qa||null===qa||void 0===aa||null===aa)throw Error.argumentNull("appSettingsManager/clientRequestManager");this.mb=qa;this.qSb=new b.a(e.a.cl());this.Yjb=new r(qa,aa);void 0!==B.a.xxd&&null!==B.a.xxd&&void 0!==B.a.omc&&null!==B.a.omc&&0<B.a.omc&&(qa=new y,qa.Token=B.a.xxd,qa.ExpirationTime=B.a.omc,this.qSb.ia("loki",qa))}mPh(){let qa=null;this.qSb.lb(w[0])&&(qa=this.qSb.oa(w[0]));return void 0===qa||null===qa||this.Ktd(qa)?this.iGh():Promise.resolve(qa.Token)}Ktd(qa){return qa.ExpirationTime-
Date.now()<this.fTj}iGh(){const qa=new b.a(e.a.cl());qa.ia("X-AlternateAuthApp",w[0]);return this.Yjb.b6c(this.bwa("/afhs/AlternateAuthHelperHandler.ashx"),Object(f.a)(this,this.O3i,"parseAlternateAuthTokenResponse"),2,qa).then(aa=>{c.ULS.sendTraceTag(545821456,3004,50,"AlternateAuthHelper:FetchNewUserDataSignatureToken: Retrieved WacAlternateAuthToken for {0}",w[0]);this.qSb.ia(w[0],aa);return aa.Token},aa=>{aa=Object(d.a)(m,aa);c.ULS.sendTraceTag(545604827,3004,10,"AlternateAuthHelper:FetchNewUserDataSignatureToken: Error: {0}, status code: {1}",
aa.message,aa.cgc);return null})}O3i(qa){let aa=null;({At:aa}=A.d(qa));c.ULS.sendTraceTag(545821457,3004,aa?50:10,"ParseAlternateAuthTokenResponse: fetched WacAlternateAuthToken from {0}",qa);return aa}bwa(qa){return String.format("{0}{1}?{2}",this.mb.Xa("WebServiceBase"),qa,n.AFrameworkApplication.Zi)}}Object(u.a)(x,"AlternateAuthHelper",null,[229]);var F=a(458);class I{constructor(qa,aa,ia){this.featureName=null;this.isEnabled=!1;this.tierName=0;this.featureName=qa;this.isEnabled=aa;this.tierName=
ia}}Object(u.a)(I,"FeatureStateChangeArgs",null,[]);var L=a(135),X=a(252),P=a(27),G=a(111),C=a(170),H;(function(qa){qa[qa.Enabled=0]="Enabled";qa[qa.Disabled=1]="Disabled"})(H||(H={}));Object(u.b)("FeatureState",H);var J=a(83),M=a(25),S=a(189);class W{constructor(qa,aa,ia=null,Ha=null,Z=null){this.ova=this.GXb=this.aje=this.gra=this.IYb=null;this.Yjb=new r(qa,aa);this.mb=qa;this.Xzg=qa.ud("LicensingMaxRetryAttempts",0);this.ANc=qa.qa("IsO365ConsumerHost");this.zNc=qa.qa("IsO365CommercialHost");this.rVb=
qa.qa("PremiumUpsellIsEnabled");this.z7d=ia;this.ine=Ha;this.La=Z;this.fra=qa.qa("LicensingIsEnabled");this.oFa=qa.qa("OcpsIsEnabled")&&this.zNc;this.XUc=qa.qa("ShowPrivacyDialog")&&!!Ha;this.Ibe=qa.qa("IsAnonymousUser");this.dcd=new Promise(la=>{la(!1)});this.wCa=new Promise(la=>{la(!0)});this.nva=new b.a(e.a.cl());this.uZb=!0;this.oee=this.TYh();this.Qrd()&&!this.Ibe?(void 0!==n.AFrameworkApplication.sa&&null!==n.AFrameworkApplication.sa&&(this.IYb=n.AFrameworkApplication.sa.mE,void 0!==this.IYb&&
null!==this.IYb&&(this.gra=this.IYb.Ng("WebServiceCall","ApplicationFeatureHelperService"))),this.ova=this.Z_d()):this.ova=new Promise(la=>{la({})});this.ova.catch(la=>{c.ULS.sendTraceTag(42513088,3004,10,JSON.stringify(la))});this.uZb&&(this.rVb=!1,this.isFeatureEnabled("FreemiumUpsell",!0).then(la=>{this.rVb=this.mb.qa("PremiumUpsellIsEnabled")&&la;return null}))}TYh(){const qa=this.mb.$p("AllLicensedFeatures")?this.mb.Fw("AllLicensedFeatures"):[],aa=new F.a;for(let ia=0;ia<qa.length;ia++)aa.add(qa[ia]);
return aa}Qrd(){return this.zNc||this.ANc}Z_d(qa=0,aa=!1){c.ULS.sendTraceTag(51185368,3004,50,"ApplicationFeatureHelper_TryInitializeLicensing: forceRefresh = {0}",aa);const ia=L.a.hs();ia&&(ia.set("retryAttempt",qa.toString()),ia.set("forceRefresh",aa.toString()),ia.set("isO365ConsumerHost",this.ANc.toString()),ia.set("isO365CommercialHost",this.zNc.toString()),ia.set("isFreemiumUpsellEnabled",this.rVb.toString()));l.Health.instance.recordKpiUsageForAlertableKpi("AFHSLicensingFailedRequest","waclicensing",
ia);l.Health.instance.recordKpiUsage("AFHSLicensingSuccessfulRequest",1,"waclicensing",ia);void 0!==this.gra&&null!==this.gra&&this.gra.start();let Ha=null;aa&&(Ha=new b.a(e.a.cl()),Ha.ia("x-LicensingForceRefresh","true"));this.aje=new Date;return(this.fra?this.Yjb.b6c(this.bwa("/afhs/ApplicationFeatureHelperHandler.ashx"),Object(f.a)(this,this.R3i,"parseApplicationFeatureHelperResponse"),0,Ha,Object(f.a)(this,this.i9i,"processApplicationFeatureHelperResponseHeaders"),["Date"]):Promise.resolve({})).then(Z=>
{const la=Object.assign(new S.a,{durationMs:this.Kag()});la.extendedProperties=ia;la.extendedProperties&&Z&&(la.extendedProperties.set("featureCount",G.a.count(Z).toString()),la.extendedProperties.set("licensingTestFeatureEnabled",("LicensingTestFeature"in Z).toString()),la.extendedProperties.set("msoPremiumBadgeEnabled",("MsoPremiumBadge"in Z).toString()),this.GXb&&la.extendedProperties.set("fromCache",(this.GXb<this.aje).toString()));l.Health.instance.recordKpiSuccess("AFHSLicensingSuccessfulRequest",
la);return Z},Z=>{const la=Object.assign(new S.a,{durationMs:this.Kag()}),Xa=Object(d.a)(m,Z);if(!Xa)return c.ULS.sendTraceTag(51491471,3004,10,"ApplicationFeatureHelper_TryInitializeLicensing: Invalid cast to HttpRequestToPromiseRejectData"),l.Health.instance.recordKpiFailure("AFHSLicensingFailedRequest","InvalidCastToHttpRequestToPromiseRejectData",!1,!0,la),new Promise((Za,xa)=>{xa(Z)});la.extendedProperties=ia;la.extendedProperties&&la.extendedProperties.set("status",Xa.cgc.toString());l.Health.instance.recordKpiFailure("AFHSLicensingFailedRequest",
"RequestFailed",!1,!0,la);return 408===Xa.cgc&&++qa<=this.Xzg?this.Z_d(qa):new Promise((Za,xa)=>{xa(Xa)})})}R3i(qa){(qa=A.b(qa))?(c.ULS.sendTraceTag(50436170,3004,50,"ParseApplicationFeatureHelperResponse: Successfully fetched features"),c.ULS.sendTraceTag(50938594,3004,50,"{0}",qa)):c.ULS.sendTraceTag(50436171,3004,10,"ParseApplicationFeatureHelperResponse: ApplicationFeatureHelper Service returned a null feature set");return qa.Features}bwa(qa){var aa=String.format("{0}{1}",this.mb.Xa("WebServiceBase"),
qa);this.mb.$p("ApplicationFeatureHelperHttpCachingEnabled")&&this.mb.qa("ApplicationFeatureHelperHttpCachingEnabled")&&(qa=W.cdc(this.mb))&&0<qa.length&&(this.uZb&&(qa+="ucbf"),aa=new X.QueryStringBuilder(aa),aa.Xi("afhskey",qa),aa=aa.toString());return aa}isFeatureEnabled(qa,aa){if(!this.oFa&&!this.XUc&&!this.fra)return this.wCa;c.ULS.sendTraceTag(42513091,3004,50,"ApplicationFeatureHelper.IsFeatureEnabled: Call made to check if feature: {0} is enabled.",qa);if("ConnectedServices"===qa){var ia=
this.oFa?this.z7d.AF("ControllerConnectedServicesEnabled"):this.wCa;const la=this.XUc?this.ine.getSettings().then(Xa=>2!==Xa.su,()=>aa):this.wCa;return ia.then(Xa=>Xa?la:this.dcd)}ia=null;ia=this.oFa?this.z7d.isFeatureEnabled(qa):this.wCa;let Ha=null;Ha=this.fra?this.Woi(qa,aa):this.wCa;let Z=null;Z=this.XUc?this.ine.isFeatureEnabled(qa):this.wCa;return ia.then(la=>la?Z.then(Xa=>Xa?Ha:this.dcd):this.dcd).then(la=>{this.orf(qa,la,!0);return la},()=>{this.orf(qa,aa,!1);return aa})}orf(qa,aa,ia){c.ULS.sendTraceTag(526713106,
3004,50,"FeatureName={0}, IsEnabled={1}, IsSuccess={2}",qa,aa,ia)}getFeatureTier(qa,aa){if(!this.fra)return new Promise(ia=>{ia(2)});c.ULS.sendTraceTag(42804871,3004,50,"ApplicationFeatureHelper.GetFeatureTier: Call made to get Feature's Tier.",qa);return this.ova.then(ia=>this.eec(qa,ia,aa),()=>aa)}isFreemiumUpsellEnabled(){return this.rVb&&this.ANc&&!this.Ibe}launchUpsellExperience(qa,aa=null){c.ULS.sendTraceTag(594564814,3004,50,String.format("ApplicationFeatureHelper_LaunchUpsellExperience: Launching upsell experience for experienceId: {0}",
qa));var ia=L.a.hs();ia&&(ia.set("experienceId",qa),aa&&ia.set("campaignId",aa));l.Health.instance.recordKpiUsage("AFHCLaunchUpsellSuccess",1,"waclicensing",ia);if(ia=J.a.instance.Jh("Common.IInProductMessagingUIManager")){const Ha=Object(f.a)(this,this.y9h,"handleDimeTaskComplete");ia.wpf(qa,Ha,aa)}else c.ULS.sendTraceTag(594367561,3004,15,"InProductMessaging was not initialized"),l.Health.instance.recordKpiFailure("AFHCLaunchUpsellSuccess","InProductMessagingNotInitialized",!1,!0,null),this.La.ae(M.a.rbc,
2,{["experience"]:qa})}una(qa,aa){if(!this.fra)return null;if(!qa||!aa)return c.ULS.sendTraceTag(594564813,3004,10,"ApplicationFeatureHelper_RegisterFeatureStateChangeCallback: Invalid input."),null;const ia=C.a.create().toString();this.nva.lb(qa)||this.nva.ia(qa,new b.a(e.a.cl()));this.nva.oa(qa).add(ia,aa);c.ULS.sendTraceTag(594564812,3004,50,String.format("ApplicationFeatureHelper_RegisterFeatureStateChangeCallback: registered callback {0} for feature {1}",ia,qa));return ia}ELd(qa,aa){this.fra&&
(qa&&this.nva.lb(qa)?aa&&C.a.isValid(aa)?this.nva.oa(qa).lb(aa)?(c.ULS.sendTraceTag(594564808,3004,50,String.format("ApplicationFeatureHelper_RemoveFeatureStateChangeCallback: Removing callback {0} for feature {1}",aa,qa)),this.nva.oa(qa).remove(aa)):c.ULS.sendTraceTag(594564809,3004,15,String.format("ApplicationFeatureHelper_RemoveFeatureStateChangeCallback: callbackId {0} not registered for feature {1} ",aa,qa)):c.ULS.sendTraceTag(594564810,3004,10,String.format("ApplicationFeatureHelper_RemoveFeatureStateChangeCallback: invalid callbackId {0} for feature {1}",
aa,qa)):c.ULS.sendTraceTag(594564811,3004,10,String.format("ApplicationFeatureHelper_RemoveFeatureStateChangeCallback: invalid or non registered featureName {0}",qa)))}eec(qa,aa,ia){return this.uZb?qa in aa?aa[qa].LicenseTier:ia:qa in aa?this.n4i(aa[qa],ia):ia}n4i(qa,aa){switch(qa.toLowerCase()){case "unknown":return 0;case "basic":return 1;case "premium":return 2;default:return aa}}y9h(){c.ULS.sendTraceTag(594367560,3004,50,"ApplicationFeatureHelper_HandleDimeTaskComplete");this.ova.then(qa=>{this.NSf(qa)}).catch(()=>
{this.NSf({})})}NSf(qa){c.ULS.sendTraceTag(594051087,3004,50,"ApplicationFeatureHelper_RefreshLicensingAndNotifyUpdatedFeatures");const aa=this.Z_d(0,!0);aa.then(ia=>{this.ova=aa;G.a.count(ia)>G.a.count(qa)?l.Health.instance.recordKpiSuccess("AFHCLaunchUpsellSuccess",null):l.Health.instance.recordKpiFailure("AFHCLaunchUpsellSuccess","FeatureCountNotIncreased",!1,!0,null);for(let Ha of this.nva.keys)if(Ha in ia){const Z=this.eec(Ha,ia,0);Ha in qa?this.eec(Ha,qa,0)!==Z&&this.uBd(Ha,!0,Z):this.uBd(Ha,
!0,Z)}else Ha in qa&&this.uBd(Ha,!1,this.eec(Ha,qa,0))}).catch(ia=>{l.Health.instance.recordKpiFailure("AFHCLaunchUpsellSuccess","LicensingRefreshFailed",!1,!0,null);c.ULS.sendTraceTag(594051086,3004,10,JSON.stringify(ia))})}uBd(qa,aa,ia){c.ULS.sendTraceTag(594051085,3004,50,"ApplicationFeatureHelper_NotifyFeatureStateChanged: Notify feature state changed callbacks for feature {0}, {1}, {2}",qa,aa,ia);aa=new I(qa,aa,ia);ia=this.nva.oa(qa);for(let Ha of ia)try{Ha.value(aa)}catch(Z){c.ULS.sendTraceTag(594051084,
3004,10,String.format("ApplicationFeatureHelper_NotifyFeatureStateChanged: Exception when calling registered callback: feature: {0} callbackId: {1}, exception {2}",qa,Ha.key,Z.message))}}Td(qa,aa){if(this.fra){const ia=this.oee.contains(qa);let Ha=!0,Z="",la=!1;return this.ova.then(Xa=>{qa in Xa?(Xa=Xa[qa],Z=H[Xa.FeatureState],Ha=1!==Xa.FeatureState):Ha=!ia;this.xrf(qa,ia,Z,la,aa,Ha);return Ha},()=>{la=!0;ia&&(Ha=aa);this.xrf(qa,ia,Z,la,aa,Ha);return Ha})}return this.wCa}xrf(qa,aa,ia,Ha,Z,la){c.ULS.sendTraceTag(557389507,
3004,50,"featureName : {0}, isLicenseControlledFeature={1}, encounteredError = {2}, featureData={3}, fallbackValue={4}, isAllowed={5}",qa,aa,Ha,ia,Z,la)}Woi(qa,aa){if(this.uZb)return this.Td(qa,aa);if(this.fra){if(this.oee.contains(qa))return this.ova.then(ia=>qa in ia,()=>aa);c.ULS.sendTraceTag(590385821,3004,50,"ApplicationFeatureHelper_IsFeatureAllowedByUserLicense: Feature '{0}' requested while not in the licensed features set.",qa)}return this.wCa}i9i(qa){try{qa&&"Date"in qa&&(this.GXb=new Date(qa.Date),
c.ULS.sendTraceTag(578863817,3004,50,"ProcessApplicationFeatureHelperResponseHeaders Date {0}",this.GXb.toString()))}catch(aa){c.ULS.sendTraceTag(578863818,3004,10,"ProcessApplicationFeatureHelperResponseHeaders Exception {0}",aa)}}Kag(){if(void 0!==this.gra&&null!==this.gra){const qa=this.gra.zc;this.gra.stop();return qa}return null}static cdc(qa){try{if(P.a.vPj){const aa=qa.Xa("UserDataSignature").split(".");if(1<aa.length){const ia=window.self.atob(aa[1]),Ha=JSON.parse(ia).LocalStorageKey;if(void 0!==
Ha&&null!==Ha&&0<Ha.length)return Ha}}}catch(aa){c.ULS.sendTraceTag(578863816,3004,10,"GetLocalStorageCacheKey exception {0}",aa.toString())}return null}}Object(u.a)(W,"ApplicationFeatureHelper",null,[230]);var O=a(187);class T{constructor(qa,aa){this.PolicySettings=null;this.ExpirationTime=0;this.PolicySettings=qa.PolicySettings;qa=new Date;qa.setMinutes(qa.getMinutes()+aa);this.ExpirationTime=qa.getTime()}}Object(u.a)(T,"CloudPolicySettingsCacheData",null,[]);var Y=a(817),va=a(374),ca=a(228);class V{static R9f(){return n.AFrameworkApplication.fa.qa("SideCarIsEnabled")?
V.$wc&&V.lqd?new Promise(qa=>{qa(!0)}):new Promise((qa,aa)=>{V.$wc=ca.a.create(n.AFrameworkApplication.fa.Xa("SideCarUrl"));va.a.bja(V.$wc);V.$wc.j$((ia,Ha)=>{(V.lqd=Ha.succeeded)?qa(Ha.succeeded):aa(Ha.succeeded)})}):new Promise(qa=>{qa(!1)})}}V.lqd=!1;V.$wc=null;Object(u.a)(V,"SideCarLoader",null,[]);class ra{constructor(){this.ControllerConnectedServicesFeatureNames=this.PolicySettings=null}}Object(u.a)(ra,"CloudPolicySettingsData",null,[]);class N{constructor(qa,aa){this.tIc=0;this.H4b=null;this.Yjb=
new r(qa,aa);this.mb=qa;aa=qa.Xa("HostAuthType");this.oFa=qa.qa("OcpsIsEnabled")&&qa.qa("IsO365CommercialHost")&&!(void 0===aa||null===aa)&&"aad"===aa.toLowerCase();this.tge=A.b(qa.Xa("OcpsDefaultSettings")||"{}");this.Mkb=this.cdc();aa=this.mb.$p("ServicesControlsMicrosoftControllerServicesList")?this.mb.Fw("ServicesControlsMicrosoftControllerServicesList")||[]:[];this.qTb=new F.a;for(let ia=0;ia<aa.length;ia++)this.qTb.add(aa[ia]);this.oFa&&!qa.qa("IsAnonymousUser")&&qa.qa("SideCarIsEnabled")?this.H4b=
this.WVj():this.H4b=this.ipa(this.oFa,this.bwa("/afhs/CloudPolicySettings.ashx"),Object(f.a)(this,this.S3i,"parseCloudPolicySettingsResponse"));this.H4b.then(()=>null).catch(ia=>{c.ULS.sendTraceTag(50622685,3004,10,JSON.stringify(ia))})}AF(qa,aa=!0){if(!this.oFa){const la=this;return new Promise(Xa=>{Xa(la.pxb(qa))})}let ia=this,Ha=this;const Z=this.H4b.then(la=>{try{let Xa=null;la.PolicySettings&&"unknown"in la.PolicySettings&&(Xa=la.PolicySettings.unknown);if(Xa){if(qa in Xa&&void 0!==Xa[qa]&&null!==
Xa[qa])return new Promise(xa=>{xa("0"!==Xa[qa])});const Za=qa.toLowerCase();if(Za in Xa&&void 0!==Xa[Za]&&null!==Xa[Za])return new Promise(xa=>{xa("0"!==Xa[Za])});c.ULS.sendTraceTag(51512667,3004,50,"Policy"+qa+" not found, using default");return new Promise(xa=>{xa(ia.pxb(qa))})}return new Promise(Za=>{Za(ia.pxb(qa))})}catch(Xa){return c.ULS.sendTraceTag(50622686,3004,10,"Failed to get "+qa+" policy value. Error Message: {0}",Xa.message),ia.handleError(Xa.toString(),aa,ia.pxb(qa))}},la=>Ha.handleError(la,
aa,Ha.pxb(qa)));Z.then(la=>{c.ULS.sendTraceTag(50651667,3004,50,"CloudPolicySettingsHelper.GetBooleanPolicySetting: policy: {0}, value: {1}",qa,la);return null});return Z}isFeatureEnabled(qa,aa=!0){if(this.mb.getBooleanFeatureGate("Microsoft.Office.SharedOnline.UseApplicationFeatureHelperAPIForFeedbackAndSurvey",!1))return this.Yoi(qa,aa);let ia=new Promise(Z=>{Z(!0)}),Ha="";this.qTb.contains(qa)&&(Ha="ControllerConnectedServicesEnabled",ia=this.AF(Ha,aa));ia.then(Z=>{c.ULS.sendTraceTag(50651668,
3004,50,"CloudPolicySettingsHelper.IsFeatureEnabled: Feature: {0}, enabled or not: {1}, by policy: {2}",qa,Z,Ha);return null});return ia}Yoi(qa,aa=!0){let ia=new Promise(Z=>{Z(!0)}),Ha="";"mso_sendASmile"===qa?Ha="Enabled":"Survey"===qa||"FloodgateSurvey"===qa?Ha="SurveyEnabled":this.qTb.contains(qa)&&(Ha="ControllerConnectedServicesEnabled");""!==Ha&&(ia=this.AF(Ha,aa));ia.then(Z=>{c.ULS.sendTraceTag(558187080,3004,50,"CloudPolicySettingsHelper.IsFeatureEnabledV2: Feature: {0}, enabled or not: {1}, by policy: {2}",
qa,Z,Ha);return null});return ia}handleError(qa,aa,ia){return aa?new Promise(Ha=>{Ha(ia)}):new Promise((Ha,Z)=>{Z(qa)})}ipa(qa,aa,ia){if(!qa)return Promise.resolve(new ra);let Ha=!1,Z=null;l.Health.instance.recordKpiUsage("GetCloudPolicySettings",1,"jpittsdirects",null);let la=this.z5c("GetCloudPolicySettings");return(new Promise((Xa,Za)=>{if(void 0!==this.Mkb&&null!==this.Mkb&&0<this.Mkb.length){const xa=this.FVj();if(void 0!==xa&&null!==xa){Ha=!0;Xa(xa);return}}this.Yjb.b6c(aa,ia,1,null,Object(f.a)(this,
this.n9i,"processCloudPolicySettingsResponseHeaders"),["CheckIn-Interval"],this.mb.ud("CloudPolicySettingsRequestQueueTimeout",15E3),this.mb.ud("CloudPolicySettingsRequestSentTimeout",3E4)).then(xa=>{c.ULS.sendTraceTag(51662933,3004,50,"Retrieved CloudPolicySettingsData from OCPS");this.vWj(xa);Xa(xa);return xa},xa=>{Za(xa);return null})})).then(Xa=>{({stopwatch:la,returnValue:Z}=this.YAc(la));var Za=L.a.hs();Za&&Za.set("FromCache",Ha.toString());Za=Object.assign(new S.a,{durationMs:Z,extendedProperties:Za});
l.Health.instance.recordKpiSuccess("GetCloudPolicySettings",Za);return Xa})}WVj(){return V.R9f().then(()=>{c.ULS.sendTraceTag(593282845,3004,50,"CloudPolicySettingsHelper - Retrieving CloudPolicySettingsData Promise from Sidecar");return sidecar.cloudPolicy.GetCloudPolicySettingsData()})}bwa(qa){return String.format("{0}{1}",this.mb.Xa("WebServiceBase"),qa)}S3i(qa){let aa=null;({At:aa}=A.d(qa));c.ULS.sendTraceTag(50622687,3004,aa?50:10,"ParseCloudPolicySettingsResponse: fetched CloudPolicySettingsData from {0}",
qa);return aa}n9i(qa){try{if(void 0!==qa&&null!==qa&&"CheckIn-Interval"in qa){const aa=parseInt(qa["CheckIn-Interval"]);void 0!==aa&&null!==aa&&0<aa&&(this.tIc=aa)}}catch(aa){c.ULS.sendTraceTag(51662934,3004,10,"ProcessCloudPolicySettingsResponseHeaders Exception {0}",aa)}}pxb(qa){return qa in this.tge?"0"!==this.tge[qa]:!0}FVj(){try{const qa=Y.a.instance.getItem(this.Mkb);if(void 0===qa||null===qa)return c.ULS.sendTraceTag(51662936,3004,50,"TryGetCloudPolicySettingsDataFromCache data from LocalStorage is null"),
null;c.ULS.sendTraceTag(51662937,3004,50,"TryGetCloudPolicySettingsDataFromCache retrieved data {0} from LocalStorage",qa);const aa=JSON.parse(qa);if(void 0===aa||null===aa)return c.ULS.sendTraceTag(51662938,3004,15,"TryGetCloudPolicySettingsDataFromCache data from LocalStorage is null after parsing"),null;if(void 0===aa.ExpirationTime||null===aa.ExpirationTime)return c.ULS.sendTraceTag(51662939,3004,15,"TryGetCloudPolicySettingsDataFromCache ExpirationTime from LocalStorage is null after parsing"),
null;if((new Date(aa.ExpirationTime)).getTime()<Date.now())return c.ULS.sendTraceTag(51662940,3004,50,"TryGetCloudPolicySettingsDataFromCache Cache is expired"),null;const ia=new ra;ia.PolicySettings=aa.PolicySettings;ia.ControllerConnectedServicesFeatureNames=new O.a;this.mb.$p("ServicesControlsMicrosoftControllerServicesList")&&this.mb.Fw("ServicesControlsMicrosoftControllerServicesList");for(let Ha of this.qTb)ia.ControllerConnectedServicesFeatureNames.add(Ha);c.ULS.sendTraceTag(51662941,3004,
50,"TryGetCloudPolicySettingsDataFromCache data from LocalStorage retrieved");return ia}catch(qa){return c.ULS.sendTraceTag(51662942,3004,10,"TryGetCloudPolicySettingsDataFromCache exception {0}",qa.toString()),null}}vWj(qa){try{if(void 0===qa||null===qa||void 0===qa.PolicySettings||null===qa.PolicySettings)c.ULS.sendTraceTag(51662944,3004,15,"TrySetCloudPolicySettingsDataIntoCache data/PolicySettings is null");else if(0>=this.tIc)c.ULS.sendTraceTag(51662945,3004,15,"TrySetCloudPolicySettingsDataIntoCache _checkInInterval is Invalid");
else{const aa=new T(qa,this.tIc),ia=JSON.stringify(aa);c.ULS.sendTraceTag(51662946,3004,50,"TrySetCloudPolicySettingsDataIntoCache data to cache {0}",ia);Y.a.instance.setItem(this.Mkb,ia);c.ULS.sendTraceTag(51662947,3004,50,"TrySetCloudPolicySettingsDataIntoCache set data to cache")}}catch(aa){c.ULS.sendTraceTag(51662976,3004,10,"TrySetCloudPolicySettingsDataIntoCache exception {0}",aa.toString())}}cdc(){const qa=W.cdc(this.mb);return qa&&0<qa.length?"OCPS"+qa:null}z5c(qa){const aa=J.a.instance.Jh("Microsoft.Office.Telemetry.Usage.IStopwatchBuilder");
return void 0!==aa&&null!==aa?aa.Ac("WebServiceCall",qa):null}YAc(qa){if(void 0!==qa&&null!==qa){const aa=qa.zc;qa.stop();return{returnValue:aa,stopwatch:null}}return{returnValue:null,stopwatch:qa}}}Object(u.a)(N,"CloudPolicySettingsHelper",null,[227]);class ea{constructor(){this.$Ne=this.kkg=this.su=0;this.aOe=this.lkg=this.HIa="";this.HTc=this.ffa=2}clone(){const qa=new ea;qa.su=this.su;qa.kkg=this.kkg;qa.$Ne=this.$Ne;qa.HIa=this.HIa;qa.lkg=this.lkg;qa.aOe=this.aOe;qa.ffa=this.ffa;qa.HTc=this.src;
return qa}get src(){return this.HTc}serialize(qa=null){const aa={};if(!qa||qa.contains(ea.vPa))aa[ea.vPa]=this.su;if(!qa||qa.contains(ea.AFb))aa[ea.AFb]=this.HIa;if(!qa||qa.contains(ea.BFb))aa[ea.BFb]=this.ffa;return JSON.stringify(aa)}static create(qa,aa=null){const ia=new ea;ia.HTc=qa;void 0!==aa&&null!==aa&&(ea.vPa in aa&&(ia.su=aa[ea.vPa]),ea.AFb in aa&&(ia.HIa=aa[ea.AFb]),ea.BFb in aa&&(ia.ffa=aa[ea.BFb]));return ia}static deserialize(qa,aa){try{const ia=JSON.parse(qa);if(void 0!==ia&&null!==
ia)return ea.create(aa,ia);c.ULS.sendTraceTag(50860946,306,10,"UserPrivacySettings Deserialize: Unable to convert {0} to dict",qa);throw Error.argument("settingsData");}catch(ia){throw c.ULS.sendTraceTag(50860947,306,10,"UserPrivacySettings Deserialize Exception = {0}",ia.toString()),ia;}}}ea.vPa="CCS";ea.AFb="CCSTime";ea.BFb="OfficePrivacyRoamedNoticeShown";Object(u.a)(ea,"UserPrivacySettings",null,[]);var Ba=a(128);class ka{constructor(qa,aa){if(void 0===qa||null===qa||void 0===aa||null===aa)throw Error.argumentNull("appSettingsManager/clientRequestManager");
this.mb=qa;this.yh=aa;this.YSc=this.me=null}bwa(qa){var aa=String.format("{0}RoamingServiceHandler.ashx?action=",this.mb.appSettings.RoamingServiceHandlerWebServiceBase||"");aa=new Sys.StringBuilder(aa);aa.append(qa);aa.append("&");aa.append(n.AFrameworkApplication.Zi);return aa.toString()}executeRequest(qa,aa,ia,Ha=null){return this.yh.mob(qa,aa,Ha,null,ia,"33",!1,null,6E4)}saveSettings(qa){return new Promise((aa,ia)=>{try{if(void 0===this.me||null===this.me||void 0===qa||null===qa)c.ULS.sendTraceTag(51258443,
3004,15,"SaveUserPrivacySettings: Can't determine setting changes to save"),ia("Can't determine setting changes to save");else{var Ha=this.me.su!==qa.su;if(2===this.me.src&&Ha)this.psj(qa),aa(!0);else{var Z=this.cwj(qa);if(void 0===Z||null===Z||!Z.length)c.ULS.sendTraceTag(50917389,3004,15,"SaveUserPrivacySettings: returning since nothing changed"),ia("No changes to save");else if(1===this.me.src)aa(this.bgg(Z));else if(0===this.me.src){c.ULS.sendTraceTag(51258444,3004,50,"UserPrivacySettingsHelper: SaveSettings to Roaming {0}",
Z);const la=this.executeRequest(this.bwa("saveUserPrivacySettings"),2,"SaveUserPrivacySettingsRequest",Z);la.continueWith(()=>{if(la.Ch||la.Wf)c.ULS.sendTraceTag(50860929,3004,10,"SaveUserPrivacySettings: Roaming Request Cancelled/Failed"),aa(!1);else{var Xa=la.result;void 0!==Xa.Hg&&null!==Xa.Hg&&void 0!==Xa.Hg.data&&null!==Xa.Hg.data&&Xa.Hg.data.httpStatus===t.a.mP?(c.ULS.sendTraceTag(51258445,3004,50,"SaveUserPrivacySettings: Roaming Request Succeeded"),aa(!0)):(c.ULS.sendTraceTag(51258446,3004,
10,"SaveUserPrivacySettings: Roaming Request Failed"),aa(!1))}})}}}}catch(la){c.ULS.sendTraceTag(50860930,3004,10,"SaveUserPrivacySettings: Exception = {0}",la.toString()),aa(!1)}})}cwj(qa){if(void 0===this.me||null===this.me||void 0===qa||null===qa)throw Error.invalidOperation("User Privacy settings have not been initialized");const aa=new O.a;0===qa.src?(this.me.su!==qa.su&&(aa.add(ea.vPa),aa.add(ea.AFb)),this.me.ffa!==qa.ffa&&aa.add(ea.BFb)):1===qa.src&&this.me.su!==qa.su&&aa.add(ea.vPa);return aa.count?
qa.serialize(aa):(c.ULS.sendTraceTag(50860931,3004,50,"SaveUserPrivacySettings: returning since nothing changed"),null)}getSettings(){if(!this.YSc){const qa=this;this.YSc=new Promise(aa=>{try{qa.me?aa(qa.me.clone()):qa.OVj().then(ia=>{qa.me=ia;aa(qa.me.clone());return null},()=>{qa.MVj().then(ia=>{qa.me=ia;aa(qa.me.clone());return null},()=>{qa.NVj().then(ia=>{qa.me=ia;aa(qa.me.clone());return null},()=>{c.ULS.sendTraceTag(50967430,3004,10,"UserPrivacySettings TryGetSettingsFromQueryParams returned an error)");
qa.me=new ea;aa(qa.me.clone());return null});return null});return null})}catch(ia){c.ULS.sendTraceTag(50860932,3004,10,"UserPrivacySettings GetSettings: Exception = {0}",ia.toString()),qa.me=new ea,aa(qa.me.clone())}})}return this.YSc}OVj(){return new Promise((qa,aa)=>{try{const Ha=-1!==window.location.href.indexOf("&wd_pn=2");if(this.mb.qa("PrivacyDialogShouldCheckRoaming")||Ha){var ia=this.executeRequest(this.bwa("getUserPrivacySettings"),1,"GetUserPrivacySettingsRequest");ia.continueWith(()=>{try{if(ia.Ch||
ia.Wf)c.ULS.sendTraceTag(50860934,3004,10,"UserPrivacySettings TryGetSettingsFromRoaming: Request failure");else{const Z=ia.result;if(Z&&Z.Hg&&Z.Hg.data)if(Z.Hg.data.httpStatus!==t.a.mP)c.ULS.sendTraceTag(50860936,3004,10,"UserPrivacySettings TryGetSettingsFromRoaming: Received error response {0}",Z.Hg.data.httpStatus);else{if(Z.Hg.data.te){qa(ka.parse(Z.Hg.data.te,0));c.ULS.sendTraceTag(51258447,3004,50,"UserPrivacySettings TryGetSettingsFromRoaming: Success, Settings {0}",Z.Hg.data.te);return}c.ULS.sendTraceTag(50860937,
3004,10,"UserPrivacySettings TryGetSettingsFromRoaming: ResponseData is null")}else c.ULS.sendTraceTag(50860935,3004,10,"UserPrivacySettings TryGetSettingsFromRoaming: Data is null");aa("UserPrivacySettings TryGetSettingsFromRoaming Request Faillure")}}catch(Z){c.ULS.sendTraceTag(50860938,3004,10,"UserPrivacySettings TryGetSettingsFromRoaming Exception handling request {0}",Z.toString()),aa("UserPrivacySettings TryGetSettingsFromRoaming Request Exception")}})}else c.ULS.sendTraceTag(50860933,3004,
50,"UserPrivacySettings TryGetSettingsFromRoaming: Roaming should not be used"),aa("Roaming should not be used")}catch(Ha){c.ULS.sendTraceTag(50860939,3004,10,"TryGetSettingsFromRoaming Exception = {0}",Ha.toString()),aa("UserPrivacySettings TryGetSettingsFromRoaming Exception")}})}MVj(){return new Promise((qa,aa)=>{try{const ia=Ba.a.get("WacUPToggleState");let Ha=null;void 0!==ia&&null!==ia&&0<ia.length&&(Ha=decodeURIComponent(ia));if(void 0!==Ha&&null!==Ha&&0<Ha.length){const Z=ka.parse(Ha,1);c.ULS.sendTraceTag(51258448,
3004,50,"TryGetSettingsFromCookie: UserPrivacySettings retrieved from cookie {0}",Z.toString());qa(Z)}else{const Z=ea.create(1),la=new O.a;la.add(ea.vPa);const Xa=Z.serialize(la);this.bgg(Xa)?(c.ULS.sendTraceTag(51258449,3004,50,"TryGetSettingsFromCookie: UserPrivacySettings initialized and retrieved from cookie {0}",Xa),qa(Z)):(c.ULS.sendTraceTag(51258450,3004,15,"TryGetSettingsFromCookie: Failure initializing cookie with settings {0}",Xa),aa("UserPrivacySettings TryGetSettingsFromCookie Failure in TrySaveSettingsToCookie"))}}catch(ia){c.ULS.sendTraceTag(50860941,
3004,10,"TryGetSettingsFromCookie from Cookie Exception = {0}",ia.toString()),aa("UserPrivacySettings TryGetSettingsFromCookie Eception")}})}NVj(){return new Promise(qa=>{try{var aa=-1!==window.location.href.indexOf("&wdccsoff=1");let ia=ea.create(2);aa?(ia.su=2,n.AFrameworkApplication.HMe(),c.ULS.sendTraceTag(51258451,3004,50,"TryGetSettingsFromQueryParams: Retrieved from query param {0}",ia.toString())):(ia.su=1,c.ULS.sendTraceTag(51258452,3004,50,"TryGetSettingsFromQueryParams: Initialized with query param as data source for {0}",
ia.toString()));qa(ia)}catch(ia){c.ULS.sendTraceTag(50967431,3004,50,"TryGetSettingsFromCookie from Query Params Exception = {0}",ia.toString()),aa=ea.create(2),aa.su=1,qa(aa)}})}psj(qa){c.ULS.sendTraceTag(51258453,3004,50,"UserPrivacySettingsHelper: SaveSettingsToQueryParam");2===qa.su?n.AFrameworkApplication.HMe():n.AFrameworkApplication.ish();c.ULS.sendTraceTag(51258454,3004,50,"SaveSettingsToQueryParam saved settings = {0}",qa)}bgg(qa){try{c.ULS.sendTraceTag(51258455,3004,50,"UserPrivacySettingsHelper: TrySaveSettingsToCookie Saving settings {0}",
qa);const aa=this.mb.Xa("PrivacyCookieDomain")||"";if(!aa||!aa.length)throw Error.invalidOperation("PrivacyCookieDomain is null or empty");c.ULS.sendTraceTag(51258456,3004,50,"SaveUserPrivacySettings to Cookie {0}",qa);return Ba.a.USd("WacUPToggleState",qa,Ba.a.ZV,"/",aa)}catch(aa){return c.ULS.sendTraceTag(50860942,3004,50,"SaveUserPrivacySettings to Cookie Exception = {0}",aa.toString()),!1}}isFeatureEnabled(qa){return this.getSettings().then(aa=>{const ia=this.mb.$p("ServicesControlsMicrosoftControllerServicesList")?
this.mb.Fw("ServicesControlsMicrosoftControllerServicesList"):[],Ha=new F.a;for(let Z=0;Z<ia.length;Z++)Ha.add(ia[Z]);return Ha.contains(qa)?2!==aa.su:!0},()=>{c.ULS.sendTraceTag(50860945,3004,10,"Failed to get privacy setting for feature {0}",qa);return!0})}static parse(qa,aa){try{return c.ULS.sendTraceTag(50860943,3004,50,"Parsing user privacy settings {0} from {1}",qa,aa),ea.deserialize(qa,aa)}catch(ia){throw c.ULS.sendTraceTag(50860944,3004,10,"GetUserPrivacySettings Exception = {0}",ia.toString()),
ia;}}}Object(u.a)(ka,"UserPrivacySettingsHelper",null,[228]);var Ka=a(248);class Oa{constructor(){this.gb=null}get name(){return"Common.App.ApplicationFeatureHelper.ApplicationFeatureHelperPackage"}Vh(qa){this.gb=qa;this.gb.register(227,"Common.App.ApplicationFeatureHelper.ICloudPolicySettingsHelper").xc().Fc(()=>new N(n.AFrameworkApplication.fa,n.AFrameworkApplication.Bd));this.gb.register(228,"Common.App.ApplicationFeatureHelper.IUserPrivacySettingsHelper").xc().Fc(()=>new ka(n.AFrameworkApplication.fa,
n.AFrameworkApplication.Bd));this.gb.register(229,"Common.App.ApplicationFeatureHelper.IAlternateAuthHelper").xc().Fc(()=>new x(n.AFrameworkApplication.fa,n.AFrameworkApplication.Bd));this.gb.register(230,"Common.App.ApplicationFeatureHelper.IApplicationFeatureHelper").xc().Fc(()=>new W(n.AFrameworkApplication.fa,n.AFrameworkApplication.Bd,this.gb.resolve("Common.App.ApplicationFeatureHelper.ICloudPolicySettingsHelper"),this.gb.resolve("Common.App.ApplicationFeatureHelper.IUserPrivacySettingsHelper"),
n.AFrameworkApplication.ub))}init(){n.AFrameworkApplication.fa.Fv(()=>{const qa=this.gb.resolve("Common.App.ApplicationFeatureHelper.IApplicationFeatureHelper");n.AFrameworkApplication.fa.qa("LicensingIsEnabled")&&(qa.isFeatureEnabled("LicensingTestFeature",!1).then(aa=>{c.ULS.sendTraceTag(42513092,3004,50,"ApplicationFeatureHelperPackage.Init: LicensingTestFeature returned IsFeatureEnabled as {0}. IsAnonymousUser : {1}.",aa,n.AFrameworkApplication.fa.Xa("IsAnonymousUser"));return null}),qa.getFeatureTier("LicensingTestFeature",
0).then(aa=>{c.ULS.sendTraceTag(42804872,3004,50,"ApplicationFeatureHelperPackage.Init: LicensingTestFeature returned GetFeatureTier as {0}. IsAnonymousUser : {1}.",aa,n.AFrameworkApplication.fa.Xa("IsAnonymousUser"));return null}));this.gb.resolve("Common.App.ApplicationFeatureHelper.IAlternateAuthHelper");this.OQj()})}dispose(){}OQj(){try{n.AFrameworkApplication.fa.qa("SideCarIsEnabled")&&V.R9f().then(qa=>{c.ULS.sendTraceTag(594057429,3004,50,"Sidecar Loader attempted to load Sidecar.  SideCarIsAvailable:{0}",
qa);return qa})}catch(qa){}}static main(){Ka.a.instance.Ei(new Oa)}}Object(u.a)(Oa,"ApplicationFeatureHelperPackage",null,[4,5]);a.d(D,"a",function(){return wa});const wa=()=>{Type.registerNamespace("Common");Type.registerNamespace("Common.App.ApplicationFeatureHelper");Oa.main()}},1158:function(u,D,a){var c=a(9);u=a(0);var b=a(222),e=a(15),f=a(1361),d=a(635),h=a(549),m=a(27),l=a(87),v=a(30),t=a(157),z=a(8),r=a(58),n=a(154),w=a(345),B=a(47),A=a(46),y=a(29),x=a(1),F=a(22),I=a(13),L=a(103),X=a(82),
P=a(84),G=a(146),C=a(4),H=a(14),J=a(95),M=a(45),S=a(1075);class W extends G.a{constructor(Na,Mb=!0){super(!1,!1,W.Wu);this.jYa=null;this.t$d=!1;this.sn=[];this.Qj=null;this.nZb=Na;this.DDg=Mb;this.cw=this.Yle=!1;this.Vga=null;this.FKc=!1;this.ng=this.Pmh;this.Ee="InsertFileDialog";this.oc(1,this.MZb);W.Wu?(this.jYa={["id"]:this.Ee,["bodyControls"]:{["uploadButtonProps"]:{["label"]:CommonUIStrings.l_DialogChooseFile,["onExecute"]:Object(P.a)(this,this.R0i,"onUploadButtonClick")}},["uploadStatusLabel"]:CommonUIStrings.l_DialogNoFileChosen,
["onFrameReady"]:Object(P.a)(this,this.vSi,"onFrameReady")},this.initializeAndShow(this.titleText,Object(P.a)(this,this.Rgc,"insertDialogHandler"),this.jYa),this.RTb=!0):(this.showDialog(this.titleText,Object(P.a)(this,this.Rgc,"insertDialogHandler")),Mb&&this.H5f(),(Na=this.rK(1))&&this.sn.push(Na),(Na=this.rK(0))&&this.sn.push(Na),this.Mig(),this.RTb=!1)}get V1j(){return this.nZb}validate(){this.Qj.uF||e.ULS.sendTraceTag(25798091,322,10,"UploadFrame.FileInputElement is null");return this.Qj.uF.value?
!0:(W.jA(CommonUIStrings.l_FileUploadNoFileSpecified),!1)}vSi(Na){this.DDg&&(this.Qj=this.G5f(Na,this.nZb))}R0i(){this.Qj&&this.Qj.uF&&(this.t$d||(this.Qj.Xfj(Object(P.a)(this,this.kDd,"onFileChosen")),this.t$d=!0),this.Qj.hXe())}kDd(Na){this.jYa.uploadStatusLabel=Na;this.YUa(this.titleText,Object(P.a)(this,this.Rgc,"insertDialogHandler"),this.jYa)}Rgc(Na){1===Na&&this.isEnabled()?W.Wu&&this.Qj.uF&&!this.Qj.uF.value?(this.jYa.uploadStatusLabel=CommonUIStrings.l_FileUploadNoFileSpecified,this.YUa(this.titleText,
Object(P.a)(this,this.Rgc,"insertDialogHandler"),this.jYa)):(this.Wyb(),this.nZb.finalizeUpload(this.Qj,Object(P.a)(this,this.dispose,"dispose"))):0===Na&&this.hide()}H5f(){this.FKc=!1;this.Qj=this.G5f(document.getElementById("uploadFrameContainer"),this.nZb);C.AFrameworkApplication.fa.qa("InsertPictureDialogFocusLoopFixIsEnabled")&&(this.Vga=Object(P.a)(this,this.aFd,"onUploadFrameLoad"),M.a.addHandler(this.Qj.iFrame,"load",this.Vga));this.Qj.uF||e.ULS.sendTraceTag(25798092,322,15,"UploadFrame.FileInputElement is null");
this.OOf()}aFd(){this.OOf()}OOf(){if(this.Qj&&!this.FKc){var Na=this.Qj.uF;Na&&(M.a.addHandler(Na,H.a.Ob,Object(P.a)(this,this.onKeyDown,"onKeyDown")),Na=[Na],this.sn=Na.concat.apply(Na,this.sn),this.Mig(),this.FKc=!0)}}dispose(){if(this.Qj&&!W.Wu){const Na=this.Qj.uF;Na&&M.a.removeHandler(Na,H.a.Ob,Object(P.a)(this,this.onKeyDown,"onKeyDown"));this.Vga&&M.a.removeHandler(this.Qj.iFrame,"load",this.Vga)}this.Qj=null;super.dispose()}Mig(){if(0<this.sn.length){const Na=new S.a(this.sn),Mb=J.FocusManager.instance().OQ();
Mb&&(this.sn[0].focus(),Mb.jf=Na,Mb.S_=!0)}}onKeyDown(Na){4!==J.FocusManager.instance().QOf(Na)&&Na.preventDefault()}static get Wu(){return C.AFrameworkApplication.sa.Pa.Jv&&C.AFrameworkApplication.sa.Pa.elf}static jA(Na){const Mb=document.getElementById("errorText");Mb.innerText=Na;Mb.style.display="inline-block"}}Object(u.a)(W,"InsertFileDialog",G.a,[]);class O{static get ng(){return G.a.iq(O.pl,CommonUIStrings.l_ImageUploadDialogText,CommonUIStrings.l_ImageUploadNoFileSpecified)}}O.pl="<div class='WACDialogRow' id='block1'> <label id='labelText' class='WACDialogLabel' >{0}</label> </div> <div class='WACDialogRowNoBreak' id='block2'> <div id='uploadFrameContainer'></div> <div class='WACDialogError' id='errorText' role='alert'>{1}</div> </div>";
Object(u.a)(O,"InsertImageDialogHtml",null,[]);class T extends W{constructor(Na,Mb=!0){super(Na,Mb)}get MZb(){return CommonUIStrings.l_ImageUploadButtonText}get titleText(){return CommonUIStrings.l_ImageUploadingTitle}get Pmh(){return O.ng}validate(){this.Qj.uF||e.ULS.sendTraceTag(25798095,322,10,"UploadFrame.FileInputElement is null");const Na=Object(X.a)(f.a,this.V1j),Mb=Na.Kkg(this.Qj.uF.value);return 0!==Mb?(W.jA(Na.z2e(Mb)),!1):!0}}Object(u.a)(T,"InsertImageDialog",W,[]);var Y=a(554);const va=
(Na,Mb,dc)=>{if(Na){var Cb=0;do{try{Na();break}catch(Tb){if(e.ULS.sendTraceTag(50946190,306,10,"RetryOnException: [Retries: {0}] [Caller: {1}] [Exception: {2}] [Callstack: {3}].",Cb,dc,Tb.message,Tb.stack),Cb>=Mb)break}Cb++}while(1)}};var ca=a(106),V=a(86),ra=a(41),N=a(252),ea=a(200),Ba=a(80),ka=a(464),Ka=a(170);class Oa{constructor(Na,Mb,dc,Cb,Tb,Jb,eb,za,ha=!0,fb=null,rb=!1){this.nXe="FileUpload.ashx";this.ro=null;this._initialized=!1;this.Gg=this.sjb=this.EKc=this.Vga=this.qUb=this.qr=this.ft=
null;this.Nm=!1;this.uE=this.rUb=this.TUc=null;this._parent=Na;this.tyg=Mb;this.UCg=dc;this.Z$d=Tb;this.VSc=eb;this.f5d=za;this.c7d=fb;this.SUc=!1;this.Qyg=Cb.qa("CanaryRenewalForFileUploadIsEnabled");this.akg=!1;(this.vra=rb)||this.gbh(Jb);ha&&this.Vef()}get UYf(){return this.UCg}get sessionId(){return this.VSc}get iFrame(){return this.ro}get uF(){return this.qr}get l$a(){return C.AFrameworkApplication.fa?C.AFrameworkApplication.fa.qa("NativeFileOpenDialogIsEnabled"):!1}get iXe(){return C.AFrameworkApplication.fa?
C.AFrameworkApplication.fa.qa("FileInputDescriptionAccessibilityIsEnabled"):!1}get Xqi(){return this.vra?!1:ea.b(this.ro.contentWindow.location.pathname,this.nXe,0)}get VQg(){return!m.a.sla&&C.AFrameworkApplication.fa.qa("AllowMultipleImageInsertFromLocalDevice")}Vef(){this.uE=Ka.a.create().toString();this.vra?this.E$c():this.XRg()}gbh(Na){this.ro=document.createElement("iframe");this.ro.className=Na;this.ro.id=Na;this.Z$d&&(this.ro.style.visibility="visible",this.ro.style.height="30px",this.ro.setAttribute("frameborder",
"0"));this.Vga=Object(P.a)(this,this.aFd,"onUploadFrameLoad");M.a.addHandler(this.ro,"load",this.Vga)}M8b(Na=null){C.AFrameworkApplication.sa.Csc();if(!this.qr)return e.ULS.sendTraceTag(25798093,322,50,"_fileInput is null"),"";M.a.addHandler(this.qr,"change",()=>{this.AGh(Na)});va(Object(P.a)(this,this.hXe,"fileInputClick"),1,"DoFileOpenDialog");return this.qr.value}AGh(Na){Na&&Na(this.qr.value)}BGh(){this.qUb&&(this.qUb.innerText=this.S3e())}Xfj(Na){M.a.addHandler(this.qr,"change",()=>{Na(this.S3e())})}S3e(){let Na=
null;if(this.qr.value){const Mb=this.qr.value,dc=Mb.lastIndexOf("\\");0<dc&&(Na=Mb.substring(dc+1,Mb.length))}return Na?Na:""}hXe(){try{e.ULS.sendTraceTag(35939520,322,50,"UploadFrame.FileInputClick - Clicking on File input element."),this.qr.click()}catch(Na){throw e.ULS.sendTraceTag(36783331,322,10,"UploadFrame.FileInputClick Exception: {0}",Na.message),Na;}}HOj(){this.kui()?this.zbg():(this.N1d(),this.ft.submit())}kui(){return(this.Qyg||this.vra)&&!(void 0===window.self.FormData||null===window.self.FormData)}Y1f(Na){if(Na){const Mb=
this.tHe();this.Gg=new XMLHttpRequest;this.Gg.open("POST",Mb);this.Gg.setRequestHeader("X-CorrelationId",this.uE);this.wCi(Na);this.Gg.onreadystatechange=Object(P.a)(this,this.vpa,"uploadResponseReceived");this.Gg.send(Na)}}wCi(Na){if(!m.a.sla&&Na.get){var Mb=Na.get("ImageId");Na=window.self.navigator;Mb={["CorrelationId"]:this.uE,["Canary"]:C.AFrameworkApplication.canary,["ImageNodeId"]:Mb};Na&&(Na=Na.connection?Na.connection:Na.mozConnection?Na.mozConnection:Na.webkitConnection?Na.webkitConnection:
null)&&(Mb.effectiveType=Na.effectiveType,Mb.downlink=Na.downlink,Mb.type=Na.type,Mb.rtt=Na.rtt);e.ULS.sendTraceTag(573345858,322,50,"LogFileUploadStatistics: FileUpload {0}",Mb)}}zbg(){try{this.N1d();e.ULS.sendTraceTag(594888409,322,50,"SubmitFormWithRequest is preparing to send an upload request");const Na=new (Type.parse("FormData"))(this.ft);this.Y1f(Na)}catch(Na){e.ULS.sendTraceTag(594888407,322,10,"SubmitFormWithRequest failed to send the request with exception "+Na.message),this.yab(null)}}ybg(Na){try{if(this.N1d(),
e.ULS.sendTraceTag(594888406,322,50,"SubmitFormWithBlob is preparing to send an upload request"),this.h3j(Na)){this.rUb=Na;this.ft.contains(this.qr)&&this.ft.removeChild(this.qr);var Mb=new (Type.parse("FormData"))(this.ft);Mb.append("applicationfileInput",Na.blob,Na.filename);this.Y1f(Mb)}else this.yab(null)}catch(dc){e.ULS.sendTraceTag(591267743,322,10,"SubmitFormWithBlob failed to send the request with exception "+dc.message),this.yab(null)}}h3j(Na){return Na&&void 0!==Na.blob&&null!==Na.blob&&
void 0!==Na.filename&&null!==Na.filename&&""!==Na.filename?void 0===window.self.FormData||null===window.self.FormData?(e.ULS.sendTraceTag(578380442,322,10,"FormData isn't supported"),!1):!0:(Na=Na?String.format("[isNull: false] [blobIsNullorEmpty: {0}] [filenameIsNullOrEmpty: {1}]",void 0===Na.blob||null===Na.blob,void 0===Na.filename||null===Na.filename||""===Na.filename):"[isNull: true] [blobIsNullorEmpty: false] [filenameIsNullOrEmpty: false]",e.ULS.sendTraceTag(578380441,322,10,String.format("Content of the blob is empty {0}",
Na)),!1)}vpa(){if(4===this.Gg.readyState)if(200===this.Gg.status){e.ULS.sendTraceTag(594888405,322,50,"UploadResponseReceived received a successful response. CorrelationId: {0}",this.uE);const Na=this.Gg.getResponseHeader("X-NewKey"),Mb=this.Omi(this.Gg);let dc=!1;if(void 0!==Na&&null!==Na&&Mb&&(dc=this.X2j(Na),!this.SUc&&dc)){e.ULS.sendTraceTag(594888404,322,50,"UploadResponseReceived resubmitting the upload request with a fresh canary. correlationId: {0}",this.uE);this.SUc=!0;void 0!==this.rUb&&
null!==this.rUb?this.ybg(this.rUb):this.zbg();return}e.ULS.sendTraceTag(594888403,322,50,"UploadResponseReceived processing the response [retried: {0}] [canaryInvalid: {1}] [gotNewCanary: {2}] [canaryRenewed: {3}] [CorrelationId: {4}]",this.SUc,Mb,!(void 0===Na||null===Na),dc,this.uE);this.yab(this.Gg.responseText)}else e.ULS.sendTraceTag(42874946,322,15,"Upload request failed with status: {0} [isResponseNull: {1}] [correlationId: {2}]",this.Gg.status,this.Gg.responseText?!1:!0,this.uE),this.yab(null)}Omi(Na){try{const Mb=
ra.a(Na.responseText).Responses;if(void 0!==Mb&&null!==Mb&&1===Mb.length){const dc=Mb[0];if(void 0!==dc&&null!==dc&&2===dc.length&&28===dc[1].StatusCode)return!0}}catch(Mb){}return!1}X2j(Na){ka.a.Lhg(Na);return C.AFrameworkApplication.canary!==Na?!1:!0}N1d(){this.TUc||(this.TUc=new Date)}dispose(){this.Nm||(this.vra?this._parent.removeChild(this.ft):(this._parent.removeChild(this.ro),M.a.removeHandler(this.ro,"load",this.Vga),this.Vga=null),this.EKc&&(M.a.removeHandler(this.qr,"change",this.EKc),
this.EKc=null),this.iXe&&(this.sjb&&(M.a.removeHandler(this.qr,"change",this.sjb),this.sjb=null),this.qUb=null),this.qr=this.ft=this._parent=this.ro=null,this.Nm=!0,this.TUc=null,e.ULS.sendTraceTag(25798094,322,50,"UploadFrame disposed"))}delayedDispose(){this.dispose()}Mdh(Na){if(this.ft){var Mb;(Mb=this.ft.querySelector("input[name=__REQUESTDIGEST]"))?Mb.value=Na:(Mb=this.e6c(),Mb.type="hidden",Mb.id="__REQUESTDIGEST",Mb.name="__REQUESTDIGEST",Mb.value=Na,this.ft.appendChild(Mb))}}e6c(){return this.vra?
document.createElement("input"):this.ro.contentWindow.document.createElement("input")}aFd(){try{if(!this.ro.contentWindow.document.body)return}catch(Mb){this.Xai();return}if(!(this._initialized||this.l$a&&m.a.VF))this.E$c();else if(!this.l$a||!m.a.VF||this.Xqi){let Mb;Mb=m.a.Hv?this.ro.contentWindow.document.body.innerText:this.akg?this.ro.contentWindow.document.body.firstChild.innerText:this.ro.contentWindow.document.body.firstChild.innerHTML;var Na=this.ro.contentWindow.document.body.innerText.toLowerCase();
const dc=0<=Na.indexOf("responses")||0<=Na.indexOf("wopisrc");Na=0<=Na.indexOf("http error");!dc&&Na&&e.ULS.sendTraceTag(42551183,322,15,"Couldn't obtain a valid response but the frame contains: "+this.ro.contentWindow.document.body.innerText);this.yab(Mb)}}E$c(){if(!this._initialized){var Na=this.ga("uploadForm");const Mb=this.ga("fileInput"),dc=this.tHe();this.rdh();this.ft.id=Na;this.ft.method="post";this.ft.encoding="multipart/form-data";this.ft.action=dc;this.qr.type="file";this.f5d&&(this.qr.accept=
this.f5d,this.c7d&&(this.qr.capture=this.c7d));this.qr.id=Mb;this.qr.name=Mb;this.VQg&&(this.qr.multiple=!0);!this.iXe||m.a.Hv||m.a.bI||(this.sjb=Object(P.a)(this,this.BGh,"fileInputChangedHandleAccessibility"),M.a.addHandler(this.qr,"change",this.sjb),this.qUb=V.a.Que(this.ft,this.qr,"InputFileDescription"));this.Z$d&&(this.vra||(Na=this.ro.contentWindow.document.body,Na.style.margin="0",Na.style.overflow="hidden"),Na=C.AFrameworkApplication.sa,this.qr.style.fontFamily=Na.s1,this.qr.style.fontSize=
Na.aDc,this.qr.style.margin="0");(Na=document.getElementById("__REQUESTDIGEST"))&&this.Mdh(Na.value);this.ft.appendChild(this.qr);this._initialized=!0;this.tyg(this)}}rdh(){if(this.vra)this.ft=document.createElement("form"),this._parent.appendChild(this.ft),this.qr=document.createElement("input");else{this.ft=this.ro.contentWindow.document.createElement("form");const Na=this.ro.contentWindow.document;Na.body.appendChild(this.ft);this.qr=Na.createElement("input")}}XRg(){this._parent.appendChild(this.ro);
this.l$a&&m.a.VF&&this.E$c()}tHe(){var Na=new N.QueryStringBuilder(this.nXe);C.AFrameworkApplication.xZa(Na);this.Twj(Na);Na=Na.toString();if(m.a.fg||m.a.VF||m.a.bI)Na=Ba.a.M_e(Na);return Na}vpe(){const Na=new ca.a(2,1,0,Object(P.a)(this,this.delayedDispose,"delayedDispose"),4);C.AFrameworkApplication.Fi.Cg(Na)}}Object(u.a)(Oa,"UploadFrame",null,[2]);var wa=a(42),qa=a(116),aa=a(21);class ia extends Oa{constructor(Na,Mb,dc,Cb,Tb,Jb,eb=!1){super(Na,Mb,dc,Cb,Tb,"UploadFrame",Jb.ea.sessionId,"image/*",
!1,null,eb);this.$=Jb;this.akg=!0;this.Vef()}ga(Na){return Na}Twj(Na){e.ULS.shipAssertTag(526399105,0,!!this.sessionId,"SessionId shouldn't be null.");qa.a.QYc(Na,this.$.va);Na.g$(z.a.sessionId,this.sessionId);var Mb=aa.h(this.$).ha;Mb=wa.o(Mb.ra.E4,this.$);Na.g$(z.a.x$i,this.$.xa.na.name);Na.g$(z.a.w$i,Mb.FirstRow.toString());Na.g$(z.a.v$i,Mb.FirstColumn.toString())}Xai(){this.UYf("ServerUploadError")}yab(Na){this.UYf(Na)}static Uoi(Na){return!Na||F.a.equals(Na,"ServerUploadError",!1)}}Object(u.a)(ia,
"UploadFrameWrapper",Oa,[]);class Ha extends T{constructor(Na,Mb,dc){super(Na,!1);this.UU=null;this.XBa=!1;this.fpc=()=>{this.$0d("");this.oDc();return!1};this.$=Mb;this.AEc=Na;this.bR=Y.a.instance;this.fa=dc;this.H5f();this.eod();this.$.rb.yy=!0}G5f(Na,Mb){return new ia(Na,Object(P.a)(Mb,Mb.YGb,"onUploadFrameInitialized"),Object(P.a)(Mb,Mb.vpa,"uploadResponseReceived"),this.fa,!0,this.$)}dispose(){this.oDc();this.bR=this.AEc=null;super.dispose()}hide(){super.hide();this.$.rb.yy=!1}validate(){var Na=
this.AEc.t2d(this.Qj.uF.value,this.AEc.Hfg(this.Qj));return 0!==Na?(Na=this.AEc.qgd(Na).Description,this.$0d(Na),this.SXd(),!1):!0}isEnabled(){return!0}$0d(Na){this.UU.innerHTML=Na}eod(){this.UU=document.getElementById("errorText");this.UU.style.display="inline-block";this.XBa=!1;this.$0d("");this.vJa.style.maxWidth=this.vJa.currentStyle.minWidth}SXd(){this.bR.ta(H.a.click,this.Qj.uF,this.fpc);this.bR.ta(H.a.Ob,this.Qj.uF,this.fpc);this.XBa=!0}oDc(){this.XBa&&(this.bR.Ba(H.a.click,this.Qj.uF,this.fpc),
this.bR.Ba(H.a.Ob,this.Qj.uF,this.fpc),this.XBa=!1)}}Object(u.a)(Ha,"InsertImageDialogWrapper",T,[]);var Z=a(51),la=a(55);class Xa extends f.a{constructor(Na,Mb,dc,Cb,Tb=!0){super(null,Mb,dc);this.mja=this.Yt=null;this.A8a=!1;this.FGd=null;this.vpa=Jb=>{this.k3d.stop();this.P1b.cancel();if(ia.Uoi(Jb))this.pCc?this.g$e(4):(Jb=new d.a(0,2,null,null,!1,null,null,null),Jb.status=8,this.B_d(new h.a(Jb),null,"InsertPictureWebMethod")),e.ULS.sendTraceTag(526399121,0,50,`Http Error occurred, isTimeoutError: ${this.pCc}`);
else{const eb=Xa.o3j(Jb);0!==eb?(e.ULS.sendTraceTag(526399122,0,50,`Server returned error, response: ${Jb}`),this.g$e(eb)):this.Jai(Jb)}this.Rqc();this.dispose()};this.ORi=Jb=>{this.TCa(Jb,this.Qj)&&this.finalizeUpload(this.Qj,null)};this.YGb=Jb=>{e.ULS.sendTraceTag(526399120,0,50,"Upload frame initialized");this.Qj=Jb;if(!this.D2a){if(this.V1d){if(this.BAe()||this.l$a&&m.a.VF){Jb.M8b(this.ORi);return}const eb=Jb.M8b(null);if(!this.TCa(eb,Jb))return}this.finalizeUpload(Jb,null)}};this.n0i=()=>{this.pCc=
!0};this.jb=Na;this.k3d=Na.Jb.Ng("WebServiceCall","InsertPictureOperation");this.P1b=B.a.instance.create(this.n0i,1E5,A.a.uVg,!1);this.pCc=!1;this.Rmc=this.$.va.InsertPictureMaxFileSizeBytes;Cb&&(this.A8a="TestOnly"in Cb);Tb&&this.showDialog()}get $(){return this.jb}get LGi(){return this.Rmc/1024/1024}dispose(){l.a.Ia(this.P1b);this.Qj&&this.Qj.vpe();this.Qj=this.P1b=this.jb=null}edj(Na){if(!this.$)return e.ULS.sendTraceTag(526399119,0,50,"ReadPictureAsDataURLTask: EwaControl is null"),la.Task.Ta(!0);
if(!this.$.Zba)return la.Task.Ta(!0);const Mb=new t.a,dc=new FileReader;Na=Na.uF.files[0];const Cb=()=>{Mb.qx(!0)};dc.onload=()=>{this.FGd=dc.result;Mb.qx(!0)};dc.onerror=Cb;dc.onabort=Cb;dc.readAsDataURL(Na);return Mb.task}Hfg(Na){let Mb=-1;Na=Na.uF;(null===Na||void 0===Na?0:Na.files)&&0<Na.files.length&&(Mb=Na.files[0].size);return Mb}t2d(Na,Mb){let dc=Xa.dah(f.a.TCa(Na));0===dc?-1!==Mb&&(e.ULS.sendTraceTag(526399118,0,50,`Validating picture, pictureSize: ${Mb}, maxAllowedSize: ${this.Rmc}, remainingWorkbookSize: ${this.$.ea.apf}`),
Mb>this.Rmc?dc=3:Mb>this.$.ea.apf&&(dc=7)):6===dc&&this.zEi(Na);e.ULS.sendTraceTag(526399117,0,50,`Validated file on client, validation result: ${dc}`);return dc}TCa(Na,Mb){Na=this.t2d(Na,this.Hfg(Mb));return 0!==Na?(this.D2a||1===Na||this.tVd(Na),!1):!0}afg(Na){Na.HOj()}qgd(Na){let Mb=0,dc=1,Cb=-1100324317,Tb="InsertPictureUnknownError",Jb=null;switch(Na){case 1:Mb=1747;dc=0;Cb=940870981;Tb="InsertPictureNoFileSelected";break;case 3:dc=0;Cb=1250467391;Tb="InsertPicturePictureTooBig";Jb=String.format(I.a.instance.nb(181),
this.LGi.toLocaleString());break;case 6:Mb=1751;dc=0;Cb=1380041209;Tb="InsertPictureUnsupportedFormat";break;case 7:Mb=1748;dc=0;Cb=-903115058;Tb="InsertPictureExceedWorkbookSize";break;case 4:Mb=1749;dc=0;Cb=1218352119;Tb="InsertPictureUploadTimeout";break;case 5:Mb=1750,dc=0,Cb=1979899005,Tb="InsertPictureServiceNonDeterministicError"}Na=Xa.Zc(Mb,dc,Cb,Tb);Jb&&(Na.Description=Jb);return Na}showDialog(){this.BAe()?(this.D2a=!1,this.Qj=new ia(this.$.domElement,this.YGb,this.vpa,this.fa,!1,this.$,
!0)):(e.ULS.sendTraceTag(526399115,0,50,"Showing Insert Picture dialog"),!this.A8a&&(m.a.vy||m.a.VF&&72>m.a.JCe)?(this.D2a=!1,this.Qj=new ia(this.$.domElement,this.YGb,this.vpa,this.fa,!1,this.$)):(this.D2a=!0,this.Qj=(new Ha(this,this.$,this.fa)).Qj))}Jai(Na){let Mb={};try{if(Mb=r.a.li(Na),Z.b().UA(this.k3d.id,Mb.ServerCorrelationId,"actions","ServerActions"),!y.a.Zf(Mb.Errors)&&Mb.Result){this.$.ea.BX(Mb.StateId,"BasePictureUploaderWrapper.UploadResponseReceived");const dc=Mb.Result;L.a(this.$).Yna(1,
dc);const Cb=this.$.da.za(277);Cb&&Cb.IWc(this.$,1,Mb.Result,Mb,"InsertPicture");e.ULS.sendTraceTag(526399114,0,50,"Insert picture completed successfully :)")}}catch(dc){e.ULS.sendTraceTag(526399113,0,50,`BasePictureUploaderWrapper.HandleSuccessCallback: got exception while try to JSON.Parse string length: ${Na?Na.length:-1}, errror: ${dc}`)}this.QCc(Mb,null,"InsertPictureWebMethod")}g$e(Na){Na=this.qgd(Na);const Mb={};Mb.Errors=[Na];this.QCc(Mb,null,"InsertPictureWebMethod")}QCc(Na,Mb,dc){this.Yt(Na,
Mb,dc)}B_d(Na,Mb,dc){this.mja(Na,Mb,dc)}tVd(Na){Na=this.qgd(Na);x.EwaSettings.Mz()?new w.a(this.$,Na):(new n.ErrorDialog(this.$,Na)).ug()}zEi(Na){const Mb=this.$.va.InsertPicturUnsupportedExtensionsForLogging;Na=v.a.vl(Na);for(let dc=0;dc<Mb.length;++dc)if(Na.endsWith(Mb[dc])){e.ULS.sendTraceTag(526399112,0,50,`Insert picture blocked invalid extension: ${Mb[dc]}`);break}}static o3j(Na){return!Na||F.a.equals(Na,z.a.insertPictureUnknownError,!0)?2:F.a.equals(Na,z.a.insertPictureNoFileSelectedError,
!0)?1:F.a.equals(Na,z.a.zji,!0)?3:F.a.equals(Na,z.a.Aji,!0)?5:0}static Zc(Na,Mb,dc,Cb){return y.a.Zc(1,0,0,Na,Mb,dc,Cb)}static dah(Na){switch(Na){case 1:return 1;case 2:return 6}return 0}BAe(){return this.A8a||void 0===window.self.FormData||null===window.self.FormData?!1:!0}}Object(u.a)(Xa,"BasePictureUploaderWrapper",f.a,[2]);class Za extends Xa{constructor(Na,Mb,dc,Cb,Tb,Jb=!0){super(Na,Mb,dc,Cb,!1);this.GGh=Tb;this.qac=Na.Jb.Ng("LoadResource","FileReaderUploaderLoadResource");Jb&&this.showDialog()}oIj(){this.Rmc=
28E5;this.tVd(3)}Ecd(Na){e.ULS.sendTraceTag(526399111,0,50,"FileReaderUploaderWrapper.finalizeUploadImpl - Start function.");const Mb=new FileReader;Na=Na.uF.files;if(0==Na.length)e.ULS.sendTraceTag(526399110,0,15,"FileReaderUploaderWrapper.finalizeUploadImpl - No image file found.");else{var dc=Na[0];Mb.onload=()=>{this.qac.stop();this.GGh.E_i(Mb.result,this);e.ULS.sendTraceTag(526399109,0,50,`FileReaderUploaderWrapper.finalizeUploadImpl - End function. Type:${dc.type}, Size:${dc.size.toString()}`)};
Mb.onerror=()=>{this.qac.stop();e.ULS.sendTraceTag(526399108,0,10,`FileReaderUploaderWrapper.finalizeUploadImpl - Can't read image. Type:${dc.type}, Size:${dc.size.toString()}`)};Mb.onabort=()=>{this.qac.stop();e.ULS.sendTraceTag(526399107,0,10,`FileReaderUploaderWrapper.finalizeUploadImpl - Aborted read image. Type:${dc.type}, Size:${dc.size.toString()}`)};this.qac.start();Mb.readAsDataURL(dc)}}finalizeUpload(Na,Mb){this.Ecd(Na,Mb)}}Object(u.a)(Za,"FileReaderUploaderWrapper",Xa,[457]);var xa=a(371),
fa=a(188);class ua{constructor(Na,Mb){this.dataUri=this.sheetName=null;this.sheetName=Na;this.dataUri=Mb}getSheetName(){return this.sheetName}}Object(u.a)(ua,"MacroRecorderPictureInsertedPayload",null,[125]);class sa extends Xa{constructor(Na,Mb,dc,Cb,Tb,Jb=!0){super(Na,dc,Cb,Tb,!1);this.Wd=Mb;Jb&&this.showDialog()}Ecd(Na,Mb){super.finalizeUpload(Na,Mb);xa.a(this.$.userOperationManager,(dc,Cb)=>{this.Yt=dc;this.mja=Cb;this.k3d.start();this.P1b.tq();this.pCc=!1;this.afg(Na);return this.edj(Na)},dc=>
{const Cb={};this.$.jk(Cb);const Tb=Cb.SheetName;dc=new fa.a(510,0,dc,72,()=>new ua(Tb,this.FGd?this.FGd:""));dc.uBa(()=>!0);dc.Wd=this.Wd;return dc},this.Wd)}finalizeUpload(Na,Mb){this.Ecd(Na,Mb)}}Object(u.a)(sa,"PictureUploaderWrapper",Xa,[]);class sb{constructor(Na,Mb){this.filename=Na;this.blob=Mb}}Object(u.a)(sb,"UploadBlobParameters",null,[]);class hb extends sa{constructor(Na,Mb,dc,Cb,Tb,Jb,eb){super(Na,Mb,dc,Cb,Tb,!1);this.V1d=!1;this.i1=eb;this.mgc=hb.DMh(Jb);Na=this.t2d(this.mgc.name,this.mgc.size);
0!==Na?(this.tVd(Na),this.i1.setException(Error.create("DataUrlUploaderWrapper: Invlid data url")),this.dispose()):this.Qj=new ia(this.$.domElement,this.YGb,this.vpa,Cb,!1,this.$)}B_d(Na,Mb,dc){super.B_d(Na,Mb,dc);this.i1.setException(Error.create("DataUrlUploaderWrapper.TriggerFailedCallback: File upload request failed"))}QCc(Na,Mb,dc){super.QCc(Na,Mb,dc);y.a.Zf(Na.Errors)?this.i1.setException(Error.create(`DataUrlUploaderWrapper.TriggerSuccessCallback: File upload request returned with errors: ${y.a.sc(Na.Errors)}`)):
this.i1.setResult(!0)}afg(Na){const Mb=new sb(this.mgc.name,this.mgc);Na.ybg(Mb)}static DMh(Na){var Mb=Na.split(",");Na=Mb[0].includes("base64")?window.self.atob(Mb[1]):window.self.decodeURI(Mb[1]);Mb=Mb[0].split(":")[1].split(";")[0];const dc=new Uint8Array(Na.length);for(let Cb=0;Cb<Na.length;Cb++)dc[Cb]=Na.charCodeAt(Cb);Na=new Blob([dc],{type:Mb});Na.name="Image.png";return Na}}Object(u.a)(hb,"DataUrlUploaderWrapper",sa,[]);class bb{constructor(){}kii(Na,Mb,dc,Cb,Tb){new sa(Na,Mb,dc,Cb,Tb,!0)}khi(Na,
Mb,dc,Cb,Tb,Jb){new hb(Na,null,Mb,dc,Cb,Tb,Jb)}vhi(Na,Mb,dc,Cb,Tb){new Za(Na,Mb,dc,Cb,Tb,!0)}}Object(u.a)(bb,"UploaderCreator",null,[363]);class lb extends b.a{constructor(Na){super();this.$=Na;this.Fb()}static ka(Na){Na.da.Ga(485,new lb(Na))}create(){var Na;this.ob(null!==(Na=this.$.da.za(484))&&void 0!==Na?Na:this.$.da.Ga(484,new bb))}}Object(u.a)(lb,"UploaderCreatorFactory",b.a,[]);a.d(D,"a",function(){return Fa});const Fa=()=>{c.a.Fa(Na=>{lb.ka(Na)})}},1191:function(u,D,a){var c=a(9);u=a(0);var b=
a(692),e=a(157),f=a(102),d=a(4),h=a(183),m=a(15),l=a(1361),v=a(30),t=a(97),z=a(83),r=a(556),n=a(170),w=a(42),B=a(371),A=a(188),y=a(283),x=a(29),F=a(282),I=a(11),L=a(13),X=a(281),P=a(103),G=a(21),C=a(146),H=a(86),J=a(95),M=a(164),S=a(180),W=a(89),O=a(154),T=a(345),Y=a(1),va=a(1239),ca=a(80);class V extends va.a{constructor(la,Xa){super(la,ca.a.oba(Xa))}duc(la,Xa){this.isEnabled()&&this.CGa(this.targetOrigin)&&(this.uo(la),this.em(la,Xa))}}Object(u.a)(V,"InsertMediaCrossDocumentMessenger",va.a,[432,
324,2]);var ra=a(7);class N{}Object(u.a)(N,"OnlineMediaSearchResult",null,[]);var ea=a(315);class Ba extends C.a{constructor(la,Xa,Za,xa,fa,ua){super();this.Hic=!1;this.mDb=this.PR=this.jxa=null;this.DOi=()=>{this.lva(this.i0a)};this.Oud=sa=>{sa.keyCode===Sys.UI.Key.tab&&("KeepFocusDiv"!==sa.target.id||sa.shiftKey?"KeepFocusStartDiv"===sa.target.id&&sa.shiftKey&&(sa.preventDefault(),document.getElementById("KeepFocusDiv").focus()):(sa.preventDefault(),document.getElementById("KeepFocusStartDiv").focus()))};
this.TVi=()=>{this.Zob&&(this.Zob.launchUpsellExperience("stockimages"),m.ULS.sendTraceTag(537155807,0,50,"OnLaunchM365Upsell: Launched Dime Upsell flow"))};this.Ql=ua;this.$=la;this.kff=Xa;this.Zob=Za;this.dBa=[];this.evf=xa;this.Qmh=fa;this.Ite=this.$.va.InsertOnlinePictureMaxCountOfImagesToInsert;this.ng=this.$dh()}OIj(la){this.Hic=!1;this.showDialog(this.Ql,null);this.jxa=document.getElementById(this.mi("InsertMediaFrame"));if(!this.jxa)throw this.lva(this.i0a),Error.invalidOperation("Couldn't get InsertMediaIframe.");
var Xa=document.getElementById(this.mi("WACDialogPanel"));Xa&&Xa.setAttribute(H.a.Ld,H.a.z_a);Xa=document.createElement("div");Xa.id="KeepFocusStartDiv";Xa.tabIndex=0;Xa.className="keep-focus-start";this.jxa.parentNode.insertBefore(Xa,this.jxa.parentNode.firstChild);Xa=document.createElement("div");Xa.id="KeepFocusDiv";Xa.tabIndex=0;Xa.className="keep-focus";this.jxa.parentNode.appendChild(Xa);$addHandler(this.vJa,"keydown",this.Oud);this.jxa.src=this.kff;this.jxa.frameBorder="0";Xa=document.getElementById(this.mi("WACDialogButtonPanel"));
if(!Xa)throw Error.invalidOperation("Couldn't get WACDialogButtonPanel.");Xa.className="display-none";Xa=document.getElementById(this.mi("WACDialogTitleText"));if(!Xa)throw Error.invalidOperation("Couldn't get WACDialogTitleText.");Xa.className="display-none";2===this.evf&&(document.getElementById(this.mi("WACDialogTitlePanel")).className="display-none",document.getElementById(this.mi("WACDialogBodyPanel")).className="padding-zero");J.FocusManager.instance().OQ().scope.MN=!0;this.PR=new V(this.jxa.contentWindow,
this.kff);this.PR.duc(M.a.qJg,Za=>{this.sNi(Za,la.vpa)});this.PR.duc(M.a.insert,()=>{this.fVi(la.vpa)});this.PR.duc(M.a.h1c,this.DOi);2===this.evf&&0===this.Qmh&&(this.PR.duc(M.a.czi,this.TVi),this.mDb=this.Zob.una("MsoPremiumStockImages",Za=>{m.ULS.sendTraceTag(537155811,0,50,"OnCompleteM365Upsell: Upsell completed from stock images");Za.isEnabled?this.PR.Oj(M.a.P1j,{["LicenseTier"]:Za.toString()}):m.ULS.sendTraceTag(537155810,0,10,"OnCompleteM365Upsell: Upsell completed but license tier didn't upgrade.")}))}dispose(){this.dBa=
null;this.Zob&&this.mDb&&this.Zob.ELd("MsoPremiumStockImages",this.mDb);this.PR&&(this.PR.dispose(),this.PR=null);super.dispose()}hide(){super.hide();W.a.pyc(this.$)}get G4(){return S.a.f8b+"/InsertMediaDialog"}get TY(){return!1}sNi(la,Xa){la=la&&la.Values?(la=la.Values)?Object(ra.a)(new N,{Action:la.action||"",Caption:la.caption||"",ContentType:la.contentType||"",FileExtension:la.extension||"",PageUrl:la.pageUrl||"",SourceUrl:la.sourceUrl||"",ThumbnailUrl:la.thumbnailUrl||"",LicenseUrl:la.licenseUrl||
"",LicenseDisplayName:la.licenseDisplayName||"",Height:la.height||0,Width:la.width||0}):null:null;la&&(this.dBa.push(la),this.Hic&&(m.ULS.sendTraceTag(537155809,0,50,"InsertMediaDialog.OnAddItem: Insert Message handling was pending"),Xa(this.dBa),this.Hic=!1,this.lva(this.i0a)))}fVi(la){this.dBa&&0<this.dBa.length?this.dBa.length<=this.Ite?(la(this.dBa),this.lva(this.i0a)):(this.jA(),m.ULS.sendTraceTag(537155808,0,10,"OnInsert : Tried to insert more than allowed limit of items."),this.dBa.length=
0):this.Hic=!0}$dh(){const la=document.createElement("div");la.id="InsertMediaDialog";la.className=Y.EwaSettings.getBooleanFeatureGate("Microsoft.Office.ExcelOnline.InsertMediaDialog.ZoomFixHorizonalScroll",!0)?"insert-media-dialog":"insert-media-dialog-old";const Xa=document.createElement("div");Xa.id="InsertMediaPanel";Xa.className=Y.EwaSettings.getBooleanFeatureGate("Microsoft.Office.ExcelOnline.InsertMediaDialog.ZoomFixCancelButton",!0)?"insert-media-panel":"insert-media-panel-old";const Za=document.createElement("iframe");
Za.id="InsertMediaFrame";Za.className="insert-media-frame";la.appendChild(Xa);Xa.appendChild(Za);return ea.b(la)}jA(){const la=x.a.Zc(1,0,0,0,0,466721363,"InsertPictureExceededAllowedCount");la.Description=String.format(L.a.instance.nb(206),this.Ite.toLocaleString());Y.EwaSettings.Mz()?new T.a(this.$,la):(new O.ErrorDialog(this.$,la)).ug()}}Object(u.a)(Ba,"InsertMediaDialog",C.a,[]);var ka=a(461),Ka=a(377);class Oa extends l.a{constructor(la,Xa,Za,xa,fa,ua){super(null,Za,xa);this.Fsf=0;this.vpa=sa=>
{if(sa){var sb=Array(sa.length);for(var hb=0;hb<sa.length;hb++){const Fa=sa[hb];sb[hb]={};sb[hb].SourceUrl=Fa.SourceUrl;v.a.Lxa(Fa.LicenseUrl)&&v.a.Lxa(Fa.PageUrl)&&(sb[hb].LicenseUrl=Fa.LicenseUrl,sb[hb].LicenseDisplayName=Fa.LicenseDisplayName,sb[hb].PageUrl=Fa.PageUrl);sb[hb].AltText=-2053056795===this.Wd.command?Fa.Caption:""}var bb=-2009825598===this.Wd.command?"bing":"M365";hb=G.h(this.$);var lb=w.o(hb.ha.ra.activeCell,this.$);B.a(this.$.userOperationManager,(Fa,Na,Mb)=>y.s(this.$.pa.ya,lb,
sb,bb,X.b(Fa,this.HXi),X.a(Na,this.GXi),Mb,null),Fa=>new A.a(595,0,Fa),this.Wd);I.HelperMethods.x_?(hb=new Map,hb.set("MediaProvider",bb),hb.set("ImagesCount",sa.length.toString()),hb.set("TimeTakenToOpenDialog",this.Fsf.toString()),t.Health.instance.recordKpiUsage(Ka.a.wji,1,ka.a.Wcg,hb)):m.ULS.sendTraceTag(537155805,0,15,"OnlinePictureUploaderWrapper.UploadResponseReceived: KPI Usage not supported.");this.Rqc()}else m.ULS.sendTraceTag(537155806,0,10,"OnlinePictureUploaderWrapper.UploadResponseReceived: Response is null")};
this.HXi=sa=>{F.a(sa)?m.ULS.sendTraceTag(537155799,0,10,`OnlinePictureUploaderWrapper.OnPictureUploadSuccess: Operation succeeded with errors. Errors: ${x.a.sc(sa.Errors)}`):(m.ULS.sendTraceTag(537155801,0,50,"OnlinePictureUploaderWrapper.OnPictureUploadSuccess: Operation succeeded."),sa.Result?P.a(this.$).Yna(1,sa.Result):m.ULS.sendTraceTag(537155800,0,10,"OnlinePictureUploaderWrapper.OnPictureUploadSuccess:Result.result is null"))};this.GXi=()=>{m.ULS.sendTraceTag(537155798,0,10,"OnlinePictureUploaderWrapper.OnPictureUploadFailed: Operation failed")};
this.$=la;this.Wd=Xa;this.i1=ua;this.wue=z.a.instance.Ub("Common.App.ApplicationFeatureHelper.IApplicationFeatureHelper");this.showDialog()}dispose(){this.$=null}showDialog(){let la=null;la=this.$.Jb.Ac("UserAction","showOnlineImagesDialogTimeStopwatch");switch(this.Wd.command){case -2009825598:this.YHj();break;case -2053056795:this.wue.execute(Xa=>{Xa.isFeatureEnabled("MsoPremiumStockImages",!1).catch(Za=>m.ULS.sendTraceTag(557200643,0,10,`OnlinePictureUploaderWrapper::ShowDialog - Failed to load the premium state from application feature helper: ${Za}`)).then(Za=>
{this.ZHj(Za);return null})})}la.stop();this.Fsf=la.zc}YHj(){let la=this.$.va.BingPictureEndpoint;const Xa=r.a.uK(d.AFrameworkApplication.lcid),Za=n.a.create();la?(la=0<la.search(RegExp("insertmedia.bing.office.net","gi"))?String.format(la,1,1):String.format(la,1,d.AFrameworkApplication.lcid,Xa?Xa.name:"en-us",d.AFrameworkApplication.buildVersion,Za.toString(),1,this.$.va.DocumentHostInfo.LoggableUserId),this.c6b(la,1,-1,L.a.instance.ga(1753))):(m.ULS.sendTraceTag(537155804,0,10,"OnlinePictureUploaderWrapper::ShowDialogForBingPictures - Can't access the Bing service endpoint"),
this.i1.setException(Error.create("Failed to access the Bing service endpoint")))}ZHj(la){var Xa=this.$.va.M365PictureEndpoint,Za=n.a.create();if(Xa){var xa=this.$.va.DocumentHostInfo.UserId;xa=xa?v.a.qw(xa).toString():"0";var fa=this.wue.instance.isFreemiumUpsellEnabled();la=la?1:fa?0:-1;Za=Za.toString();fa=r.a.uK(d.AFrameworkApplication.lcid).name;Xa=String.format(Xa,d.AFrameworkApplication.lcid,fa,d.AFrameworkApplication.buildVersion,Za,1,xa,la,1);this.c6b(Xa,2,la,L.a.instance.ga(1752))}else m.ULS.sendTraceTag(537155803,
0,10,"OnlinePictureUploaderWrapper::ShowDialogForStockImages - Can't access the M365 service endpoint"),this.i1.setException(Error.create("Failed to access the M365 service endpoint"))}c6b(la,Xa,Za,xa){try{(new Ba(this.$,la,z.a.instance.Jh("Common.App.ApplicationFeatureHelper.IApplicationFeatureHelper"),Xa,Za,xa)).OIj(this),this.i1.setResult(!0)}catch(fa){m.ULS.sendTraceTag(537155802,0,10,`OnlinePictureUploaderWrapper::CreateAndShowDialog failed [Exception : ${fa}] [MediaProvider : ${Xa}] [DialogLicenseTier : ${Za}]`),
this.i1.setException(fa)}}}Object(u.a)(Oa,"OnlinePictureUploaderWrapper",l.a,[2]);var wa=a(55);class qa{constructor(la,Xa){this.$=la;this.uploaderCreator=Xa}executeCommand(la,Xa,Za){la=Xa.command;switch(la){case 1403967063:if(Za&&"dataUrl"in Za)return Xa=new e.a,this.uploaderCreator&&this.uploaderCreator.khi(this.$,f.a.instance,d.AFrameworkApplication.fa,Za,Za.dataUrl,Xa),Xa.task;this.uploaderCreator&&this.uploaderCreator.kii(this.$,Xa,f.a.instance,d.AFrameworkApplication.fa,Za);return wa.Task.Ta(!0);
case -2053056795:case -2009825598:return la=new e.a,new Oa(this.$,Xa,f.a.instance,d.AFrameworkApplication.fa,Za,la),la.task;default:return h.a(la)}}wc(la,Xa){if(la=this.$.isEditMode)switch(Xa.command){case 1403967063:la=!0;break;case -2053056795:la=!0;break;case -2009825598:la=!0;break;default:la=!1}return la}Jc(){return!1}nc(){return!1}}Object(u.a)(qa,"PictureCommandHandler",null,[165]);var aa=a(37),ia=a(50);class Ha extends b.a{constructor(la){super(la)}nd(){aa.TaskExtensions.Aa(ia.GetServiceTaskFactory.Oa(this.$.da,
484,485,1),la=>{this.Yc([new qa(this.$,la.result)])},this.$.la,3)}static ka(la){b.a.Nd(90,new Ha(la))}}Object(u.a)(Ha,"PictureCommandHandlerFactory",b.a,[]);a.d(D,"a",function(){return Z});const Z=()=>{c.a.Fa(la=>{Ha.ka(la)})}},1215:function(u,D,a){var c=a(9);u=a(0);var b=a(222),e=a(15),f=a(511),d=a(38),h=a(4),m=a(60);class l{}l.Jgd="GetFontPreviewData";Object(u.a)(l,"FontWebServiceMethods",null,[]);const v=(I,L,X,P,G=null)=>{const C=l.Jgd;G=I.Na(5,G);G.locale=h.AFrameworkApplication.uiCulture;return m.g(I,
C,G,L,X,P,null,644)};var t=a(11),z=a(1),r=a(39),n=a(116),w=a(29);const B={xlyellow:"xlyellow"};class A extends d.a{constructor(I,L){super();this.$=I;this.yv=L;this.Ava={};this.UO={};this.bwe=!1;this.styles=null;this.pSi=(X,P,G)=>{e.ULS.sendTraceTag(520710152,1,50,`FontServiceManager.onFontPreviewRequestComplete: Attempt to request FontUrl method: ${G} has succeeded.`);this.Y7i(X);this.bwe=!0;e.ULS.sendTraceTag(512340116,1,50,"FontServiceManager.onFontPreviewRequestComplete: timeFromAppInteractive to fonts download {0} ms",
r.PageLoadTrackingInfo.instance.twa(new Date));this.Oaj()};this.qSi=(X,P,G)=>{X=n.a.Oe(X.data);X=w.a.sc(X);e.ULS.sendTraceTag(520710151,1,10,`FontServiceManager.onFontPreviewRequestFailed: Encountered errors: ${X} for method: ${G}`)};this.Lnj=()=>{this.Gl&&this.Jgd(this.pSi,this.qSi)};this.Gl=z.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.FontServiceIntegration",!1);this.Lnj()}Y7i(I){if(this.kwi(I)){var L=t.HelperMethods.y6(()=>{const X=I.Result;this.styles=`@font-face{font-family:"msofpNew";font-style:normal;font-weight:normal;src:url('${X.PreviewUrl}') format('truetype')}`;
const P=X.FontFacePropertiesList;let G,C,H;X.FontNameList.forEach((J,M)=>{this.Ava[J]=P[M].Codepoint;let S=`https://fs.microsoft.com/fs/${X.CatalogVersion}/rawguids/${P[M].FontGuid}`;this.styles=this.Pue(this.styles,J,S,P[M].FontWeight);this.UO[J]=P[M].LocalizedFontName;"Segoe UI Semibold"===J&&(G=P[M].FontFamily,C=S,H=P[M].FontWeight)});G&&(this.styles=this.Pue(this.styles,G,C,H));f.a.Mi(this.styles)});10<L&&e.ULS.sendTraceTag(520710159,1,50,`FontServiceManager.prepareFontCodepointMap: Duration for prepareFontCodepointMap the model, duration=${L}`)}}kwi(I){if(!I.Result)return e.ULS.sendTraceTag(520710158,
1,15,"FontServiceManager.isValidFontPreviewData: Result in EwaResult is Null."),!1;I=I.Result;return I?I.PreviewUrl?I.FontFacePropertiesList?I.FontNameList?0===I.FontFacePropertiesList.length||I.FontFacePropertiesList.length!==I.FontNameList.length?(e.ULS.sendTraceTag(520710153,1,15,"FontServiceManager.isValidFontPreviewData: Mismatch in length of FontFacePropertiesList and FontNameList in fontListPreviewData."),!1):!0:(e.ULS.sendTraceTag(520710154,1,15,"FontServiceManager.isValidFontPreviewData: FontNameList in fontListPreviewData is Null."),
!1):(e.ULS.sendTraceTag(520710155,1,15,"FontServiceManager.isValidFontPreviewData: FontFacePropertiesList in fontListPreviewData is Null."),!1):(e.ULS.sendTraceTag(520710156,1,15,"FontServiceManager.isValidFontPreviewData: PreviewUrl in fontListPreviewData is Null."),!1):(e.ULS.sendTraceTag(520710157,1,15,"FontServiceManager.isValidFontPreviewData: fontListPreviewData is Null."),!1)}Pue(I,L,X,P){return I+`@font-face{font-family:"${L}";src:url('${X}');font-weight:${P};}`}Jgd(I,L){return v(this.yv,
I,L,null,this.yv.Wb())}Oaj(){this.pic&&this.raiseEvent(A.hZe)}get tBc(){return this.UO}get hKh(){return this.Ava}get pic(){return this.bwe}isFontSupported(I){return this.Gl&&this.UO&&(!!this.UO[I]||!!B[I.replace(/\s/g,"").toLowerCase()])}ase(I){this.addHandler(A.hZe,I)}}A.hZe="fsmFD";Object(u.a)(A,"FontServiceManager",d.a,[274]);var y=a(695);class x extends b.a{constructor(I){super();this.$=I;this.Fb()}static ka(I){I.da.Ga(505,new x(I))}create(){this.ob(Object(y.a)(this.$.da,504,()=>new A(this.$,
this.$.pa.yv)))}}Object(u.a)(x,"FontServiceManagerFactory",b.a,[]);a.d(D,"a",function(){return F});const F=()=>{c.a.Fa(I=>{x.ka(I)})}},1253:function(u,D,a){u=a(0);var c=a(107),b=a(222),e=a(15),f=a(14),d=a(38),h=a(174),m=a(91),l=a(1),v=a(21),t=a(5);class z extends d.a{constructor(A,y,x){super();this.statusBarManager=null;this.OMe=()=>{this.s8b()};this.tnh=()=>{this.s8b()};this.NMe=F=>{10===F&&this.s8b()};this.onKeyDown=F=>13===F.Ca.keyCode?(F=new m.a(237279923,1,2,6,null),this.$.Ka.Lb(F,{[t.a.skipClipboardAccess]:!0,
[t.a.JQe]:!0}),!0):!1;this.$=A;this.Go=y;this.Im=x;this.Q$c=!1;(this.S7f=l.EwaSettings.getBooleanFeatureGate(h.a.HQa,!1))&&this.$.da.$a(29,F=>{this.statusBarManager=F;F.JJ(this)})}dispose(){this.$j();this.Im=this.Go=this.$=null;this.statusBarManager&&(this.statusBarManager.lG(this),this.statusBarManager=null)}Hn(){return this.S7f}rs(A,y){if("QueryPasteShortcutEnabledLabel"!==A&&!z.WNj.includes(A))return!1;const x=this.Fo();"QueryPasteShortcutEnabledLabel"===A?(y.Visible=x,e.ULS.sendTraceTag(537167636,
0,100,`PasteShortcutManager.ExecuteRootCommand: Setting visible to ${x} for commandId ${A}`)):(y.Visible=!x,e.ULS.sendTraceTag(537167635,0,100,`PasteShortcutManager.ExecuteRootCommand: Setting visible to ${!x} for commandId ${A}`));return!0}nsh(){this.Kj();this.raiseEvent("pasteShortcutStatusChanged")}s8b(){this.$j();this.raiseEvent("pasteShortcutStatusChanged")}Fo(){return this.Q$c}Mq(A){this.addHandler("pasteShortcutStatusChanged",A)}hr(A){this.removeHandler("pasteShortcutStatusChanged",A)}Kj(){if(!this.Fo()){this.Q$c=
!0;v.h(this.$).zi.Xk(this.OMe);this.Im.ka("blur",this.tnh);const A=this.$.da.za(65);A&&A.G3&&A.G3.registerForCommentEvents(this.NMe);this.Go.Ns(f.a.Ob,this.$.ru,this.onKeyDown,!0)}}$j(){if(this.Fo()){this.Q$c=!1;v.h(this.$).zi.Fk(this.OMe);this.Im.detach("blur");const A=this.$.da.za(65);A&&A.G3&&A.G3.unregisterForCommentEvents(this.NMe);this.Go.Ws(f.a.Ob,this.$.ru,this.onKeyDown,!0)}}}z.WNj=["QuerySheetNumberButton","QueryWorkbookStatisticsButton"];Object(u.a)(z,"PasteShortcutManager",d.a,[376,161,
162,2]);var r=a(127);class n extends b.a{constructor(A){super();this.$=A;this.Fb()}create(){const A=this.$;this.ob(A.da.za(478)||this.$.da.Ga(478,new z(A,c.KeyInputManager.instance,r.a.instance.wH())))}static ka(A){A.da.Ga(479,new n(A))}}Object(u.a)(n,"PasteShortcutManagerFactory",b.a,[]);var w=a(9);a.d(D,"a",function(){return B});const B=()=>{w.a.Fa(A=>{n.ka(A)})}},1254:function(u,D,a){var c=a(9);u=a(0);var b=a(107),e=a(222),f=a(127),d=a(7),h=a(15),m=a(4),l=a(1400),v=a(14),t=a(5),z=a(899),r=a(47),
n=a(28),w=a(21),B=a(1),A=a(42),y=a(64),x=a(343),F=a(37),I=a(50);class L{constructor(G,C,H,J){this.recoveryUI=null;this.R6=()=>{this.HV()&&(this.grid.Fcb(this.R6),this.bfg())};this.bfg=()=>{var M=y.d(this.$.xa.na);M=new x.a(this.pasteRange,M);this.K_d(M)};this.cjg=()=>{this.recoveryUI&&(this.X2d=n.a.Qa.ue.m,this.hide(),r.a.instance.create(()=>{this.z0j()},250,"RecoveryUI.UpdatePositionOnVisibleAreaChanged",void 0,!0))};this.bNe=M=>{10===M&&this.Aua()};this.Lnh=()=>{if(this.recoveryUI){const M=document.getElementById("PasteRecoveryUI");
M&&t.a.xk===M.getAttribute(t.a.LY)&&M.click();this.documentHidden=!0;this.Aua()}};this.cNe=()=>{this.Aua()};this.dNe=()=>{this.Aua()};this.onKeyUp=M=>{if(this.recoveryUI){if(this.O_)return!1;if(17===M.Ca.keyCode&&this.T$b){M=document.getElementById("PasteRecoveryUI");if(!M)return h.ULS.shipAssertTag(537154070,0,!1,"RecoveryUIController.OnKeyUp: recoveryUIElement is null."),!1;const S=M.getAttribute(t.a.LY)||"";if(t.a.zr===S)return M.click(),!0}}return!1};this.onKeyDown=M=>{if(this.recoveryUI){this.T$b=
!1;this.O_=M.ctrlKey;M=M.Ca.keyCode;if(27===M)return this.Aua(),B.EwaSettings.isChangeGateEnabled("OfficeVSO:6022397_ClearStateWhileHidingRecoveryUI")&&(M=this.$.da.za(254))&&M.Cr("RecoveryUIController.onKeyDown",!0,!0).catch(()=>{}),!0;if(17===M)return this.T$b=!0}return!1};this.ZN=(M,S)=>{this.ECb=M=S.Wd;if(B.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.OptimizeCellTableBigHammerSlowOperationsTeachingCallout",!1)){switch(M.command){case -1027730316:case -1059615499:if(S.properties&&
S.properties.launcherId===this.m4e())return;break;case -847286761:if(S.properties&&(13===S.properties.CalloutName||18===S.properties.CalloutName))return}this.Aua()}else-1027730316!==M.command&&-1059615499!==M.command?this.Aua():(S=S.properties)&&S.launcherId!==this.m4e()&&this.Aua()};this.$=G;this.Atc=C;this.Go=H;this.Im=J;this.ilc=this.ECb=this.Wud=null;this.O_=this.T$b=this.x8b=this.Dfc=!1;this.X2d=0;this.documentHidden=!1;this.grid=w.h(this.$);this.pasteRange=null;B.EwaSettings.ol()||this.$.da.Ga(406,
this)}dispose(){this.Wgg();this.bhg();this.ilc=this.Wud=this.recoveryUI=this.Im=this.Go=this.Atc=this.$=null;this.X2d=0}VVg(G){this.recoveryUI=G;this.Wud=G.PPg;this.ilc=G.lej}Aua(){this.recoveryUI&&(this.pasteRange=A.K(this.recoveryUI.dFh),this.KLj(),this.hide(),this.Wgg(),this.recoveryUI=null)}KLj(){const G=[1868184698,-1985798686,753331043,2137617149,237279923,1804571062,1766348718,42074747,-875588320,-958589048,-185374993,-111689794,-1502853784,-1096627081,1441131127,-1027730316,-847286761];m.AFrameworkApplication.Rt("XLS-SmartView-OnPasteEnabled-Control;XLS-SmartView-OnPasteEnabled-Treatment");
B.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.SmartView.OnPasteEnabled",!1)&&this.pasteRange&&(h.ULS.sendTraceTag(523622037,0,50,"RecoveryUIController:smartViewOnPaste RecoveryUI is being dismissed."),null!=this.ECb&&G.includes(this.ECb.command)?(h.ULS.sendTraceTag(526758984,306,50,`RecoveryUIController:smartViewOnPaste Table hand raise is not triggered. Last command was ${z.a[this.ECb.command]}`),this.ECb=null):this.documentHidden?(h.ULS.sendTraceTag(523833603,306,50,"RecoveryUIController:smartViewOnPaste Table hand raise is not triggered. User clicked outside of document."),
this.documentHidden=!1):this.HV()?this.bfg():(h.ULS.sendTraceTag(520725721,306,50,"RecoveryUIController:smartViewOnPaste Grid is not in consistent state."),this.grid.LZa(this.R6)))}HV(){return this.grid.Ea.HN(4,this.$.na)}jti(){return!!this.recoveryUI&&this.Atc.jpi}JJj(G){this.recoveryUI?this.show(G):h.ULS.shipAssertTag(537154072,0,!1,"RecoveryUIController.ShowRecoveryUI: recoveryUI is null.")}m4e(){return this.recoveryUI?this.recoveryUI.tzi:null}show(G){const C=this.recoveryUI.pUh();C?(this.Atc.showFloatie(Object(d.a)(new l.a,
{x:C.x,y:C.y}),this.recoveryUI.fLa(),G),this.Kj()):h.ULS.sendTraceTag(537154071,0,100,"RecoveryUIController.Show: point is null.")}hide(){this.jti()&&this.Atc.lD();this.bhg()}Kj(){if(!this.x8b){var G=w.h(this.$);G.view.nt(this.cjg);G.zi.Xk(this.cNe);this.Im.ka("blur",this.Lnh);this.$.Ka.Asa(this.ZN);this.$.xa.Uf(this.dNe);(G=this.$.da.za(65))&&G.G3&&G.G3.registerForCommentEvents(this.bNe);this.x8b=!0}this.Dfc||(this.Go.Ns(v.a.Ob,this.$.domElement,this.onKeyDown,!0),this.Go.Ns(v.a.Dd,this.$.domElement,
this.onKeyUp,!0),this.Dfc=!0)}Wgg(){if(this.x8b){var G=w.h(this.$);G.view.ir(this.cjg);G.zi.Fk(this.cNe);this.Im.detach("blur");this.$.Ka.HAa(this.ZN);this.$.xa.Bg(this.dNe);(G=this.$.da.za(65))&&G.G3&&G.G3.unregisterForCommentEvents(this.bNe);this.x8b=!1}}bhg(){this.Dfc&&(this.Go.Ws(v.a.Ob,this.$.domElement,this.onKeyDown,!0),this.Go.Ws(v.a.Dd,this.$.domElement,this.onKeyUp,!0),this.Dfc=this.O_=this.T$b=!1)}z0j(){this.recoveryUI&&250<=n.a.Qa.ue.m-this.X2d&&this.show(-1)}K_d(G){F.TaskExtensions.Aa(I.GetServiceTaskFactory.Oa(this.$.da,
426,427,1),C=>{void C.result.Uea(G,"Paste");h.ULS.sendTraceTag(523622036,0,50,"RecoveryUIController.triggerTableInvitationHandRaise: IntelligentMetadataOverlayManager is triggered.")},this.$.la,3)}}Object(u.a)(L,"RecoveryUIController",null,[249,2]);class X extends e.a{constructor(G){super();this.$=G;this.Fb()}create(){if(B.EwaSettings.ol())this.JKi();else{const G=this.$;G.ny(C=>{C.ygc().then(H=>{this.ob(this.$.da.za(406)||new L(G,H,b.KeyInputManager.instance,f.a.instance.wH()))})})}}JKi(){const G=
this.$;let C=this.$.da.za(406);C?this.ob(C):G.ny(H=>{H.ygc().then(J=>{C=new L(G,J,b.KeyInputManager.instance,f.a.instance.wH());this.$.da.Ga(406,C);this.ob(C)})})}static ka(G){G.da.Ga(405,new X(G))}}Object(u.a)(X,"RecoveryUIControllerFactory",e.a,[]);a.d(D,"a",function(){return P});const P=()=>{c.a.Fa(G=>{X.ka(G)})}},1264:function(u,D,a){u=a(0);var c=a(58),b=a(15),e=a(252);class f{constructor(l,v){this.testName=null;this.startTimeMs=0;this.isSuccess=!1;this.caller=this.errorStatusCode=this.errorMessage=
null;this.reqTotalDurationMs=0;this.browserResourceTiming=null;this.testIteration=0;this.testName=l;this.caller=v;this.reset()}reset(){this.isSuccess=!1;this.startTimeMs=-1;this.errorStatusCode=this.errorMessage="";this.reqTotalDurationMs=-1;this.browserResourceTiming=null}}Object(u.a)(f,"NetworkTestResult",null,[]);var d=a(580);class h{constructor(l,v,t,z,r){this.url="";this.G6a=!1;this.r8=-1;this.testIteration=0;this.baseUrl=t;this.LAf=z;this.Bmd=v;this.result=new f(v,r)}runTest(){try{if(this.G6a)return b.ULS.sendTraceTag(537155206,
0,50,`NetworkTestReq.RunTest: a test for the host ${this.Bmd} is already mid way, not starting a new one.`),!1;this.reset();this.G6a=!0;this.result.startTimeMs=Date.now();const l=new e.QueryStringBuilder(this.baseUrl);l.g$("tid",this.result.startTimeMs.toString());this.url=l.toString();this.Luj();this.testIteration++;this.result.testIteration=this.testIteration;return!0}catch(l){return this.pvb("Exeption: "+l.message),!1}}reset(){this.url="";this.result.reset();this.G6a=!1;this.r8=-1}clearTimeout(){-1!==
this.r8&&(window.clearTimeout(this.r8),this.r8=-1)}Luj(){try{const l=new XMLHttpRequest;l.onreadystatechange=()=>{4===l.readyState&&(200===l.status?this.xIh():this.pvb(`Error when downloading resource. status code: ${l.status}, status text: ${l.statusText}`,l.status.toString()))};l.onerror=()=>{this.pvb(`Client error when attempting to download resource. status code: ${l.status}, response: ${l.statusText}`)};this.r8=window.setTimeout(()=>{this.r8=-1;this.pvb("Request timeout")},1E4);l.open("GET",
this.url,!0);l.send(null)}catch(l){this.pvb("Exeption: "+l.message)}}xIh(){this.G6a&&(this.result.reqTotalDurationMs=Date.now()-this.result.startTimeMs,this.clearTimeout(),this.result.browserResourceTiming=d.a(this.url),this.result.isSuccess=!0,this.a5b())}pvb(l,v=null){this.G6a&&(this.clearTimeout(),this.result.errorMessage=l,this.result.isSuccess=!1,this.result.errorStatusCode=v,this.a5b())}a5b(){this.G6a=!1;this.LAf&&this.LAf(this.result,this.Bmd)}}Object(u.a)(h,"NetworkTestReq",null,[]);a.d(D,
"a",function(){return m});class m{static Ged(l,v,t,z=null){m.Lnc||(m.Lnc=Array.isArray(c.a.li(t.va.NetworkMeasurementUrlList))?c.a.li(t.va.NetworkMeasurementUrlList):null);const r=[];for(let n=0;n<m.Lnc.length;n++){const w=m.Lnc[n];let B=w.key;B||(B=w.Key);if(z&&!z.includes(B))continue;let A=w.value;A||(A=w.Value);B&&A&&r.push(new h(t,B,A,l,v))}return r}}m.Lnc=null;Object(u.a)(m,"NetworkConnectionHelpers",null,[])},1361:function(u,D,a){u=a(0);var c=a(15),b=a(84);a(106);var e=a(27);class f{constructor(z,
r,n){this.Qj=this.$Ed=null;this.JFa=this.P9=0;this.sUb=null;this.aT=z;this.fe=r;this.mb=n;this.D2a=!1;this.V1d=!0;this.Eoj();this.l$a=this.fa.qa("NativeFileOpenDialogIsEnabled")}get context(){return this.aT}get fa(){return this.mb}get retryCount(){return this.P9}get QOd(){return this.JFa}YGb(z){this.Qj=z;if(!this.D2a){if(this.V1d){if(this.l$a&&e.a.VF){this.sUb=z.M8b(Object(b.a)(this,this.kDd,"onFileChosen"));return}this.sUb=z.M8b(null);if(!this.TCa(this.sUb,z))return}this.finalizeUpload(z,null)}}kDd(z){if(this.TCa(z,
this.Qj)){if(e.a.VF||e.a.fg)this.sUb=z;this.finalizeUpload(this.Qj,null)}}Rqc(){this.$Ed&&this.$Ed()}Eoj(){this.P9=0;this.JFa=this.fa.ud("Box4UploadRetryDelayStart",200);this.Qj&&(this.Qj.dispose(),this.Qj=null)}}Object(u.a)(f,"FileUploader",null,[]);var d=a(4),h=a(320),m=a(783),l=a(134),v=a(30);a.d(D,"a",function(){return t});class t extends f{constructor(z,r,n){super(z,r,n);this.XWb=this.dsa=null}get TO(){return d.AFrameworkApplication.sa.mE}z2e(z){switch(z){case 1:return CommonUIStrings.l_ImageUploadNoFileSpecified;
case 2:return CommonUIStrings.l_ImageUploadUnsupportedFileType;default:return""}}Kkg(z){return t.TCa(z,this.Y6h())}Y6h(){return t.mne}TCa(z,r=null){z=this.Kkg(z);return 0!==z?(r&&r.vpe(),2===z&&this.vj(0,this.z2e(z)),!1):!0}finalizeUpload(z,r){c.ULS.sendTraceTag(36783360,322,50,"PictureUploader.FinalizeUpload");this.$Ed=r;this.WIj();h.a.mark(5576);this.XWb=this.TO.Ac("LoadResource","PictureUploadTime")}vj(z,r){const n=new l.StandardDialog;n.Rb=0;n.jA(z,CommonUIStrings.l_ImageUploadFailedTitle,r,null)}Rqc(){c.ULS.sendTraceTag(36783361,
322,50,"PictureUploader.OnUploadComplete");super.Rqc();this.XWb&&(this.XWb.stop(),this.XWb=null);this.d6g()}WIj(){this.dsa=(new m.a).create();this.dsa.message=CommonUIStrings.l_ImageUploadWait;this.dsa.Rb=5;this.dsa.Jt=!1;this.dsa.LBa(null,null,null)}d6g(){this.dsa&&(this.dsa.close(),this.dsa=null)}static gci(z,r){z=v.a.vl(z);for(let n=0;n<r.length;++n)if(z.endsWith(r[n]))return!0;return!1}static TCa(z,r=null){r||(r=t.mne);return z?t.gci(z,r)?0:2:1}}t.mne=".jpg .jpeg .png .gif .bmp .tif .tiff".split(" ");
Object(u.a)(t,"PictureUploader",f,[])},1434:function(u,D,a){a.r(D);var c=a(1155),b=a(0),e=a(15),f=a(4),d=a(119),h=a(397);class m extends h.a{constructor(ec){super(ec)}get S5b(){return!1}createElement(){const ec=document.createElement("link");ec.setAttribute("rel","stylesheet");ec.setAttribute("type","text/css");ec.setAttribute("href",this.Vt);return ec}$5c(){return null}ouc(){this.element.setAttribute("href","");this.element.setAttribute("href",this.cA.Vt)}}Object(b.a)(m,"CssResource",h.a,[]);var l=
a(374),v=a(228),t=a(30),z=a(55);class r{constructor(){this.cXb=this.xUb=null}AAi(){this.xUb||(e.ULS.sendTraceTag(21030598,324,50,"InProductMessagingDependenciesLoad usage"),this.xUb=z.Task.WAA(r.FAi(),r.xAi()),this.xUb.continueWith(ec=>{e.ULS.sendTraceTag(21030599,324,10,"{0}",t.a.rgd(ec.exception))},5));return this.xUb}CAi(){if(!this.cXb)try{e.ULS.sendTraceTag(39978390,324,50,"InProductMessagingFreemiumDependenciesLoad usage"),this.cXb=z.Task.WAA(r.x$c(v.a.create(f.AFrameworkApplication.fa.Xa("DimeUrl"),
null,null))),this.cXb.continueWith(ec=>{e.ULS.sendTraceTag(39978391,324,10,"{0}",t.a.rgd(ec.exception))},5)}catch(ec){e.ULS.sendTraceTag(594874951,324,10,"{0}",t.a.rgd(ec))}return this.cXb}static FAi(){var ec=r.gec("inproductmessaging.js");ec=v.a.create(ec,null,null);return r.x$c(ec)}static xAi(){var ec=r.gec("inproductmessaging.css");ec=new m(ec);return r.x$c(ec)}static gec(ec){return d.a.Z4b(String.format("ipm/{0}",ec))}static x$c(ec){l.a.bja(ec);return ec.v9a}}Object(b.a)(r,"DependencyDownloader",
null,[460]);class n{}n.Z2i="inProductMessagingOverlayDiv";n.R5i="PlayButtonImage";n.Cmj="ReplayButtonImage";Object(b.a)(n,"Constants",null,[]);class w{constructor(){this.ele=this.zfe=this.f6d=!0;this.Dmj=this.S5i=null;this.LJi=!1;this.locale=null;this.sgg={}}get sxe(){return this.f6d}set sxe(ec){this.f6d=ec}get Pvf(){return this.zfe}set Pvf(ec){this.zfe=ec}get T8f(){return this.ele}set T8f(ec){(this.ele=ec)&&this.tAj()}tAj(){this.Mqe(n.R5i,this.S5i);this.Mqe(n.Cmj,this.Dmj)}Mqe(ec,Vc){Vc&&(this.sgg[ec]=
Vc)}}Object(b.a)(w,"FirstRunExperienceUISettings",null,[459]);class B{constructor(){this.completed=this.ehj=!1}}Object(b.a)(B,"FirstRunExperienceViewData",null,[421]);var A=a(84),y=a(175),x=a(105),F=a(25);class I{constructor(ec,Vc,ud){this.La=ec;this.ef=Vc;this.aVb=ud}Fg(){this.La.Me(F.a.TIh,x.a.frame,Object(A.a)(this,this.RIh,"firstRunExperienceHandler"),64);this.La.Mb(F.a.rYe,x.a.frame,Object(A.a)(this,this.Wei,"inProductMessagingTabHandler"));this.La.Mb(F.a.qYe,x.a.frame,Object(A.a)(this,this.Vei,
"inProductMessagingShiftTabHandler"));this.La.Mb(F.a.gnh,x.a.frame,Object(A.a)(this,this.hnh,"dimeLaunchHandler"));this.La.Mb(F.a.iXf,x.a.frame,y.ActionManager.og);this.La.Mb(F.a.anj,x.a.frame,y.ActionManager.og);this.La.Mb(F.a.bnj,x.a.frame,y.ActionManager.og);this.ef&&this.ef.updateCommandUI()}RIh(ec,Vc,ud,ke,te){2===ud&&this.aVb.azi(te);return 32}hnh(ec,Vc,ud,ke,te){2===ud&&this.aVb.Yyi(te);return 32}Wei(ec,Vc,ud){return 2===ud?this.aVb.Qzd():32}Vei(ec,Vc,ud){return 2===ud?this.aVb.Ozd():32}}Object(b.a)(I,
"InProductMessagingActor",null,[]);var L=a(82);class X{constructor(){this.KTf=this.KYf=this.Jcg=this.ylc=this.instance=null}}Object(b.a)(X,"DimeExperienceUISettings",null,[]);var P=a(136),G=a(466);class C{constructor(ec,Vc,ud,ke,te){this.qbc=!1;this.Gtb=null;this.La=ec;this.dGa=Vc;this.DXb=ud;this.J1=ke;this.iHc=te}Khi(ec){P.b("getHeaderApi")?ec.isFeatureEnabled("MsoPremiumBadge",!0).then(Vc=>{const ud=ec.isFreemiumUpsellEnabled();ud&&(appChrome.getHeaderApi().then(ke=>{ke.updatePremiumStatus(Vc,
ud);return null}),ec.una("MsoPremiumBadge",ke=>{appChrome.getHeaderApi().then(te=>{te.updatePremiumStatus(ke.isEnabled,ud);return null})}));return null}):e.ULS.sendTraceTag(593859840,324,10,"getHeaderApi not available")}azi(ec){this.DXb.AAi().continueWith(()=>{this.dGa.lKj(ec)})}Yyi(ec){let Vc="gopremium",ud=null,ke=()=>{};ec?(ec.experience&&""!==Object(L.a)(String,ec.experience)&&(Vc=Object(L.a)(String,ec.experience)),ec.onTaskComplete&&(ke=ec.onTaskComplete),ec.campaignId&&""!==Object(L.a)(String,
ec.campaignId)&&(ud=Object(L.a)(String,ec.campaignId))):e.ULS.sendTraceTag(51675402,324,50,"Experience not given, using default experience");this.wpf(Vc,ke,ud)}wpf(ec,Vc,ud=null){if(this.qbc&&this.Gtb){const ke={};ke.experience=ec||"gopremium";ke.campaignId=ud||G.b(this.J1,this.iHc,Object(L.a)(String,ke.experience),!0);this.La.processAction(F.a.iXf,2);e.ULS.sendTraceTag(51675403,324,50,"Launching Freemium Upsell dialog: "+ke.experience);try{const te=Object.assign(new X,{instance:this.Gtb,ylc:ke,Jcg:Vc||
(()=>{}),KYf:pe=>{e.ULS.sendTraceTag(51675405,324,50,"Dime launch result: "+pe.status)},KTf:()=>{e.ULS.sendTraceTag(51675406,324,10,"Dime launch error");this.qbc=!1;this.Gtb=null}});this.dGa.zIj(te)}catch(te){e.ULS.sendTraceTag(51675407,324,10,"Dime launch error: "+te.message),this.qbc=!1,this.Gtb=null,this.La.ae(F.a.rbc,2,{["experience"]:ke.experience})}}else e.ULS.sendTraceTag(39978392,324,10,"FreemiumUpsellDialogDependencies not loaded"),this.La.ae(F.a.rbc,2,{["experience"]:ec})}lqf(){this.DXb.CAi().continueWith(()=>
{try{var ec=t.a.vl(f.AFrameworkApplication.uiCulture);const ke=G.c(this.J1);if(ke){var Vc={};Vc.partnerId=ke;Vc.language=ec;Vc.sessionId=f.AFrameworkApplication.userSessionId;Vc.authHint=f.AFrameworkApplication.fa.Xa("UserPrincipalName");var ud=f.AFrameworkApplication.fa.Xa("Puid")||"";""!==ud&&(ec={},ec.puid=ud,Vc.userInfo=ec);this.Gtb=new Dime(Vc);this.qbc=!0;e.ULS.sendTraceTag(592721856,324,50,"Dime initialized")}else e.ULS.sendTraceTag(51675409,324,15,"App not supported")}catch(ke){e.ULS.sendTraceTag(51675410,
324,10,"FreemiumUpsellDialogDependencies failed: "+ke.message)}},3)}Qzd(){return this.dGa.Qzd()}Ozd(){return this.dGa.Ozd()}}Object(b.a)(C,"InProductMessagingUIManager",null,[458]);class H{constructor(){this.Dme=0;this.IXa=Array(5);this.IXa[0]=10;this.IXa[1]=15;this.IXa[2]=50;this.IXa[3]=100;this.IXa[4]=200}Init(ec){this.Dme=ec}SendTrace(ec,Vc){e.ULS.sendTraceTag(34182235,this.Dme,this.IXa[ec],"{0}",Vc)}}Object(b.a)(H,"DefaultNetworkingManager",null,[442]);var J=a(260),M=a(316),S=a(95);class W{constructor(ec){this.Yb=
ec}lKj(ec){ec&&(InProductMessaging.Networking.NetworkingMgr=new H,InProductMessaging.Networking.NetworkingMgr.Init(387),InProductMessaging.Init(ec.T8f,ec.Pvf,ec.sxe,ec.LJi,ec.locale,Object(A.a)(this,this.QQi,"onDismissFirstRunExperience"),ec.sgg),this.RSa(n.Z2i,!0))}zIj(ec){if(ec&&ec.instance&&ec.ylc){let Vc=document.getElementById("wacDimeContainer");Vc||(Vc=document.createElement("div"),Vc.id="wacDimeContainer",document.body.appendChild(Vc));f.AFrameworkApplication.fa.qa("DimeFocusManagerIsEnabled")&&
this.RSa("wacDimeContainer",!1);ec.ylc.parentElementId="wacDimeContainer";ec.instance.launch(ec.ylc,ec.Jcg).then(ud=>{this.JJb();document.body.removeChild(Vc);ec.KYf(ud)}).catch(ud=>{this.JJb();document.body.removeChild(Vc);ec.KTf(ud)})}else throw Error.argument("DimeExperienceUISettings");}RSa(ec,Vc){if(this.Yb&&ec&&(ec=document.getElementById(ec),this.Chi(ec),ec=this.Yb.oN("InProductMessagingFocusId"))){const ud=this.Yb.gi;ud&&"InProductMessagingFocusId"===ud.name||this.Yb.TR("InProductMessagingFocusId",
!1);Vc&&this.RRf(ec.scope)}}Chi(ec){var Vc=this.Yb.Bi("InProductMessagingFocusId");Vc.parent=J.AFrame.XT;const ud=new M.DOMFocusListing(()=>ec);ud.scb=!1;ud.vo(3);ud.vo(2);ud.vo(4);Vc=this.Yb.dta(()=>ec,Vc,ud);Vc.BJb();Vc.S_=!0;Vc.AIa=!0}RRf(ec){ec.Gk(S.FocusManager.instance().y2);ec.Gk(S.FocusManager.instance().z2);ec.bindAction(S.FocusManager.instance().y2,F.a.rYe);ec.bindAction(S.FocusManager.instance().z2,F.a.qYe)}JJb(){this.Yb&&(this.Yb.rda("InProductMessagingFocusId"),this.Yb.vRa("InProductMessagingFocusId"))}QQi(ec,
Vc){this.JJb();ec=Object.assign(new B,{completed:ec,ehj:Vc});f.AFrameworkApplication.ub.ae(F.a.QIh,2,ec)}Qzd(){const ec=document.activeElement,Vc=this.Yb.OQ();return ec&&Vc&&Vc.jf&&ec===Vc.jf.Ow?(Vc.jf.Ml(ec),Vc.Yya()?32:8):4}Ozd(){const ec=document.activeElement,Vc=this.Yb.OQ();return ec&&Vc&&Vc.jf&&ec===Vc.jf.firstElement?(Vc.jf.Ml(ec),Vc.kPa()?32:8):4}}Object(b.a)(W,"InProductMessagingUIWrapper",null,[402]);var O=a(137),T=a(248),Y=a(27);class va{constructor(){this.gb=null}get name(){return"Common.App.InProductMessaging"}Vh(ec){ec.register(r,
"Common.App.InProductMessaging.DependencyDownloader").as("Common.App.InProductMessaging.IDependencyDownloader").xc().Fc(()=>new r);ec.register(W,"Common.App.InProductMessaging.InProductMessagingUIWrapper").as("Common.IInProductMessagingUIWrapper").xc().Fc(()=>new W(S.FocusManager.instance()));ec.register(C,"Common.App.InProductMessaging.InProductMessagingUIManager").as("Common.IInProductMessagingUIManager").xc().Fc(()=>new C(f.AFrameworkApplication.ub,ec.resolve("Common.IInProductMessagingUIWrapper"),
ec.resolve("Common.App.InProductMessaging.IDependencyDownloader"),f.AFrameworkApplication.sa.Pa.Fj,f.AFrameworkApplication.sa.Pa.H6));ec.register(I,"Common.App.InProductMessaging.InProductMessagingActor").xc().Fc(()=>new I(f.AFrameworkApplication.ub,f.AFrameworkApplication.sa,ec.resolve("Common.IInProductMessagingUIManager")));ec.register(w,"Common.App.InProductMessaging.FirstRunExperienceUISettings").as("Common.IFirstRunExperienceUISettings").xc().Fc(()=>new w);ec.register(B,"Common.App.InProductMessaging.FirstRunExperienceViewData").as("Common.IFirstRunExperienceViewData").xc().Fc(()=>
new B);this.gb=ec}init(){this.gb.resolve("Common.App.InProductMessaging.InProductMessagingActor").Fg();f.AFrameworkApplication.fa.Fv(()=>{f.AFrameworkApplication.sa.Pa.Fs&&O.a.get_instance().Ck(15,()=>{this.gb.Ub("Common.App.ApplicationFeatureHelper.IApplicationFeatureHelper").execute(ec=>{this.gb.resolve("Common.App.InProductMessaging.InProductMessagingUIManager").Khi(ec)})});f.AFrameworkApplication.fa.qa("FreemiumUpsellShowDialogIsEnabled")&&G.a()&&!Y.a.sla&&1!==f.AFrameworkApplication.sa.Pa.Fj&&
this.gb.Ub("Common.App.ApplicationFeatureHelper.IApplicationFeatureHelper").execute(ec=>{ec.isFeatureEnabled("MsoPremiumBadge",!0).then(Vc=>{!Vc&&ec.isFreemiumUpsellEnabled()&&this.gb.resolve("Common.App.InProductMessaging.InProductMessagingUIManager").lqf();return null})})})}dispose(){}static main(){T.a.instance.Ei(new va)}}Object(b.a)(va,"InProductMessagingPackage",null,[4,5]);var ca=a(187),V=a(41);class ra{constructor(ec,Vc,ud,ke=null,te=null){this.fw=ec;this.Mjb=Vc;this.Ijb=ud;this.Whe=ke;this.Rlb=
te}M$b(ec){const Vc=new Sys.StringBuilder(this.fw.gLb);Vc.append("RoamingServiceHandler.ashx?action=");Vc.append("getFirstRunExperienceSettings");Vc.append("&");Vc.append(this.pid(ec));Vc.append("&");Vc.append(f.AFrameworkApplication.Zi);f.AFrameworkApplication.Bd.Rm(Vc.toString(),1,null,null,!0,2,Object(A.a)(this,this.oka,"getRequestSuccessCallback"),Object(A.a)(this,this.L4,"getRequestFailureCallback"),null)}G3a(ec){var Vc=new Sys.StringBuilder(this.fw.gLb);Vc.append("RoamingServiceHandler.ashx?action=");
Vc.append("saveFirstRunExperienceSettings");Vc.append("&");Vc.append(f.AFrameworkApplication.Zi);Vc=Vc.toString();ec=V.c(ec);f.AFrameworkApplication.Bd.Rm(Vc,2,ec,null,!0,4,Object(A.a)(this,this.p7i,"postRequestSuccessCallback"),Object(A.a)(this,this.uW,"postRequestFailureCallback"),null)}oka(ec){let Vc=!1,ud=null;try{if(0<ec.data.te.length){const ke=Object(L.a)(Object,V.a(ec.data.te)),te=ke?ke[this.fw.LYc]:null;te&&(ud=Object(L.a)(Object,V.a(te.toString())))}Vc=!0}catch(ke){this.L4(null)}Vc&&this.Mjb&&
this.Mjb(ec.data,ud)}L4(ec){this.Ijb&&this.Ijb(ec?ec.data:null)}p7i(ec){this.Whe&&this.Whe(ec?ec.data:null)}uW(ec){this.Rlb&&this.Rlb(ec?ec.data:null)}pid(ec){const Vc=new Sys.StringBuilder("requestedsettings=");for(let ud=0;ud<ec.count;ud++)Vc.append(ec.oa(ud)),ud<ec.count-1&&Vc.append(";");return Vc.toString()}}Object(b.a)(ra,"FirstRunExperienceRequestHandler",null,[]);var N=a(232),ea=a(83);class Ba{constructor(){this.zjb=this.yUb=this.fw=null}nVd(ec){ec?(this.fw=ec,this.lri()&&(e.ULS.sendTraceTag(51675532,
306,50,"Initiating call to get FRE data for current user from Roaming Settings Service"),ec=new ca.a,ec.add(this.fw.LYc),this.yUb=new ra(this.fw,Object(A.a)(this,this.oka,"getRequestSuccessCallback"),Object(A.a)(this,this.L4,"getRequestFailureCallback"),null,Object(A.a)(this,this.uW,"postRequestFailureCallback")),this.yUb.M$b(ec)),(this.fw.A8a||f.AFrameworkApplication.fa.getBooleanFeatureGate("Microsoft.Office.SharedOnline.FirstRunExperienceUITest",!1))&&this.oVd()):e.ULS.sendTraceTag(51675531,306,
10,"Invalid launcherSettings")}lri(){try{if(this.fw.A8a)return!0;if(!f.AFrameworkApplication.fa.getBooleanFeatureGate("Microsoft.Office.SharedOnline.FirstRunExperienceEnabled",!0)||f.AFrameworkApplication.fa.qa("IsAnonymousUser"))return!1;if(this.fw.$ni||this.fw.C8a||f.AFrameworkApplication.fa.qa("IsO365ConsumerHost"))return!0;const ec=f.AFrameworkApplication.fa.Xa("FlightId");return-1!==(ec?ec.toString().toLowerCase():"").indexOf("firstrunexperienceui")}catch(ec){e.ULS.sendTraceTag(576582624,306,
10,"Error checking setting {0}",ec?ec.toString():null)}return!1}S_f(ec){const Vc={},ud={};ud.FREDisplayedDate=(new Date).toUTCString();ud.VersionDisplayed=ec;ud.RemindMeLater=!1;Vc[this.fw.LYc]=V.c(ud);e.ULS.sendTraceTag(51675533,306,50,"Initiating call to save FRE data for current user from Roaming Settings Service");this.yUb&&this.yUb.G3a(Vc)}oka(ec,Vc){ec=ec?+ec.J3-+ec.PF:-1;ec>this.fw.IZf?e.ULS.sendTraceTag(51675534,306,50,"Call to Roaming Settings Service took {0}ms. This is more than the {1}ms threshold. A new attempt will be made next time the user starts a new session.",
ec,this.fw.IZf):Vc?this.mHj(Vc)?(e.ULS.sendTraceTag(51675536,306,50,"FRE data already exists for current user. FRE UI should be displayed again. User selected 'Remind me later' option more than {0} hours ago.",this.fw.Gvf),this.oVd()):(this.S8c(!1),e.ULS.sendTraceTag(51675537,306,100,"Current user has already seen this version of the FRE. No further action required.")):(e.ULS.sendTraceTag(51675535,306,50,"No FRE data found for current user. FRE UI should be displayed."),this.oVd())}L4(ec){this.S8c(!1);
e.ULS.sendTraceTag(51675541,306,10,"First Run Experience failed to GET data from Roaming Settings Service with status: {0}",ec?ec.httpStatus:-1)}uW(ec){e.ULS.sendTraceTag(51675542,306,10,"First Run Experience failed to POST data to Roaming Settings Service with status: {0}",ec?ec.httpStatus:-1)}oVd(){this.S8c(!0);var ec=ea.a.instance.Jh("Common.ISystemInitiatedFeedback");ec?this.G8f(ec):(e.ULS.sendTraceTag(51675543,306,50,"Error resolving ISystemInitiatedFeedback"),f.AFrameworkApplication.fa.getBooleanFeatureGate("Microsoft.Office.SharedOnline.FirstRunExperienceUIResolveFuture",
!0)&&((ec=ea.a.instance.Ub("Common.ISystemInitiatedFeedback"))?ec.execute(Vc=>{this.G8f(Vc)}):e.ULS.sendTraceTag(539494111,306,50,"Error resolving ISystemInitiatedFeedback Future")))}G8f(ec){if(ec){var Vc=this.fw.eJh;Vc&&(f.AFrameworkApplication.zya(Vc),f.AFrameworkApplication.Rt(Vc));e.ULS.sendTraceTag(51675544,306,50,"Attempting to display First Run Experience UI using floodgate.",Vc);ec.logActivity("ShowFirstRunExperienceUIV2",null);window.addEventListener?(this.zjb=Object(A.a)(this,this.XRi,"onFirstRunExperienceCampaignEvent"),
window.addEventListener("FGWebSurfaceEvent",this.zjb,!0),window.addEventListener("FRELaunchedEvent",this.zjb,!0)):(e.ULS.sendTraceTag(51675545,306,50,"FRE V2 UI triggered. Attempting to save FRE data."),this.S_f(this.fw.currentVersion))}else e.ULS.sendTraceTag(539494112,306,50,"Invalid ISystemInitiatedFeedback")}XRi(ec){if(ec){var Vc=ec.detail;ec=ec.type;var ud=this.fw&&this.fw.campaignId?this.fw.campaignId.split("-")[0]:null;if("FRELaunchedEvent"===ec||ud&&Vc&&Vc.id&&-1!==Vc.id.indexOf(ud))Vc.success&&
(e.ULS.sendTraceTag(51675546,306,50,"FRE V2 UI has been launched. Attempting to save FRE data."),this.S_f(this.fw.currentVersion)),window.removeEventListener&&(window.removeEventListener("FGWebSurfaceEvent",this.zjb,!0),window.removeEventListener("FRELaunchedEvent",this.zjb,!0))}}mHj(ec){if("RemindMeLater"in ec&&"FREDisplayedDate"in ec){if("true"===ec.RemindMeLater.toString()&&(+new Date-+new Date(ec.FREDisplayedDate.toString()))/36E5>this.fw.Gvf)return!0}else if(f.AFrameworkApplication.fa.qa("WacShowVersionBasedFREToAllUsers")&&
"VersionDisplayed"in ec&&ec.VersionDisplayed<this.fw.currentVersion)return e.ULS.sendTraceTag(528262853,306,50,"Current version is higher so FRE V2 UI should be displayed again."),!0;return!1}S8c(ec){f.AFrameworkApplication.fa.isChangeGateEnabled("Microsoft.Office.SharedOnline.ChangeGate.DispatchFREDecisionEvent")&&N.a.dispatch("FREDecisionEvent",{["show"]:ec})}}Object(b.a)(Ba,"FirstRunExperienceLauncher",null,[338]);class ka{constructor(){this.gb=null}get name(){return"Common.App.FirstRunExperienceLauncher"}Vh(ec){this.gb=
ec;this.gb.register(338,"Common.App.FirstRunExperienceLauncher.IFirstRunExperienceLauncher").xc().Fc(()=>new Ba)}init(){}dispose(){}static main(){T.a.instance.Ei(new ka)}}Object(b.a)(ka,"FirstRunExperienceLauncherPackage",null,[4,5]);var Ka=a(1111),Oa=a(1112),wa=a(1139),qa=a(1253),aa=a(9),ia=a(222);class Ha{constructor(ec){this.$=ec}get LYc(){return"Excel"}get campaignId(){return"aed9de6b-d4e7-4878-988a-9dfec66fed9e"}get version(){return 1}get currentVersion(){return 0}get $ni(){return this.isEnabled()&&
this.$.ma(332)}get C8a(){return this.isEnabled()&&this.$.ma(334)}get A8a(){return this.$.ma(333)}get eJh(){return null}get Gvf(){return 24}get IZf(){return 4E3}get gLb(){return this.$.va.WebServiceBase||""}isEnabled(){if(f.AFrameworkApplication.fa?f.AFrameworkApplication.fa.qa("IsAnonymousUser"):1)return!1;const ec=f.AFrameworkApplication.Pb?Object(L.a)(String,f.AFrameworkApplication.Pb.AudienceGroup):"";return"Unknown"!==ec&&"Automation"!==ec}}Object(b.a)(Ha,"FirstRunExperienceLauncherSettings",
null,[378]);class Z{constructor(ec,Vc){this.sYe=ec;this.SIh=Vc}nVd(){this.sYe&&this.sYe.nVd(this.SIh)}}Object(b.a)(Z,"FirstRunExperienceManager",null,[377]);var la=a(695);class Xa extends ia.a{constructor(ec){super();this.$=ec;this.Fb()}create(){const ec=Object(la.a)(this.$.da,311,()=>this.kdh());this.ob(ec)}kdh(){var ec=new Ha(this.$);ec=new Z(ea.a.instance.resolve("Common.App.FirstRunExperienceLauncher.IFirstRunExperienceLauncher"),ec);ec.nVd();return ec}static ka(ec){ec.da.Ga(312,new Xa(ec))}}
Object(b.a)(Xa,"FirstRunExperienceManagerFactory",ia.a,[]);var Za=a(59);class xa extends ia.a{constructor(ec){super();this.wnd=null;this.$=ec;this.Fb()}create(){const ec=Object(la.a)(this.$.da,361,()=>this.Ydh());this.ob(ec)}Ydh(){this.wnd=ea.a.instance.Jh("Common.IInProductMessagingUIManager");Za.a.yg.Fs?O.a.get_instance().Ck(16,()=>{this.Yef()}):this.Yef();return this.wnd}Yef(){ea.a.instance.Ub("Common.App.ApplicationFeatureHelper.IApplicationFeatureHelper").execute(ec=>{ec.isFeatureEnabled("MsoPremiumBadge",
!0).then(Vc=>{!Vc&&ec.isFreemiumUpsellEnabled()&&this.wnd.lqf();return null})})}static ka(ec){ec.da.Ga(362,new xa(ec))}}Object(b.a)(xa,"InProductMessagingManagerFactory",ia.a,[]);var fa=a(1191),ua=a(1114),sa=a(47),sb=a(416),hb=a(78),bb=a(1),lb=a(528),Fa=a(21),Na=a(574);class Mb extends lb.a{constructor(ec){super(1);this.cga=!1;this.bAf=()=>{this.refresh()};this.cAf=()=>{this.refresh()};this.gridView=Fa.h(ec);this.gridView.Vb.Xk(this.cAf);this.gridView.Vb.sm(this.bAf);this.refresh()}get vI(){return this.hnc(this.cga)}ZSd(ec){this.cga!==
ec&&(this.cga=ec,this.LIb())}get name(){return Na.a.cellEdit}dispose(){this.gridView.Vb.Fk(this.cAf);this.gridView.Vb.Il(this.bAf);this.gridView=null;super.dispose()}LIb(){this.uJd(this.cga)}refresh(){this.ZSd(!this.gridView.eb)}}Object(b.a)(Mb,"CellEditSafeStatePublisher",lb.a,[]);var dc=a(38),Cb=a(109);class Tb{constructor(ec,Vc){this.handler=null;this.publisher=ec;this.vI=Vc}}Object(b.a)(Tb,"SafeStatePublisherState",null,[]);var Jb=a(609);const eb=ec=>ec?`${ec.Current} / ${ec.Pending} @${ec.SuspensionStartTimestamp}`:
null,za=ec=>(null===ec||void 0===ec?void 0:ec.SuspensionStartTimestamp)&&ec.Pending>ec.Current;class ha extends dc.a{constructor(ec,Vc){super();this.cpf=null;this.c9a=!1;this.qGb=(ud,ke)=>{3===ke.svf&&this.c9a&&e.ULS.sendTraceTag(520480204,0,15,"ClientStateMonitor.onMergeDidntOccur: Aborted merge occurred after another aborted merge.");this.c9a=!0;this.Sbb()};this.hSa=new ca.a;this.Tya=ec;this.cna=Vc;this.tAb=bb.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.DoPendingMergeWhenUnsafe",!1);
this.i8a=bb.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.RetryDoPendingMergeAfterBailout",!1);this.tAb&&(this.cna.PZa(this.zza.bind(this)),this.i8a?this.Tya.Rre(this.qGb):this.Tya.FNg(this.REf.bind(this)))}get gYj(){return Cb.f(Cb.c(this.hSa.toArray(),ec=>0!=ec.vI),ec=>ec.publisher.name)}x0b(ec){this.addHandler(ha.gSa,ec)}hvc(ec){this.removeHandler(ha.gSa,ec)}DAa(ec,Vc){const ud=new Tb(ec,Vc);this.hSa.add(ud);Vc=(ke,te)=>{ud.vI=te.vI;this.Sbb()};ec.x0b(Vc);ud.handler=Vc;this.Sbb()}F0d(ec){let Vc=
null;for(let ud of this.hSa)if(ud.publisher===ec){this.rhg(ud);Vc=ud;break}Vc&&(this.hSa.remove(Vc),this.Sbb())}dispose(){for(let ec of this.hSa)this.rhg(ec);this.hSa.clear();this.tAb&&(this.cna.Icb(this.zza.bind(this)),this.i8a?this.Tya.QVf(this.qGb):this.Tya.qkj(this.REf.bind(this)));super.dispose()}Pbc(){let ec=db.Pbc(this.hSa.toArray().map(Vc=>Vc.vI));return this.c9a&&1===ec?2:ec}rhg(ec){ec.publisher.hvc(ec.handler)}Sbb(){const ec=this.Pbc();ec!==this.cpf&&(this.raiseEvent(ha.gSa,new Jb.a(ec)),
this.cpf=ec)}REf(){this.c9a&&e.ULS.sendTraceTag(523317957,0,15,"ClientStateMonitor.onMergeWasAborted: Aborted merge occurred after another aborted merge.");this.c9a=!0;this.Sbb()}zza(ec,Vc){ec=Vc.Ica;(Vc=!za(ec))||(Vc=this.tyi,Vc=(null===ec||void 0===ec?void 0:ec.SuspensionStartTimestamp)!==(null===Vc||void 0===Vc?void 0:Vc.SuspensionStartTimestamp));Vc&&(this.c9a=!1);this.tyi=ec;this.Sbb()}}ha.gSa="SSC";Object(b.a)(ha,"ClientStateMonitor",dc.a,[]);var fb=a(6),rb=a(69);class pa extends lb.a{constructor(ec,
Vc=null){super(1);this.cga=!1;this.bO=()=>{this.refresh()};this.gBf=()=>{this.refresh()};this.$=ec;this.Yae=Vc||rb.a(ec).MQ(fb.a.idle);rb.a(ec).oXc(this.gBf);this.w6a.Mq(this.bO);this.refresh()}get vI(){return this.hnc(this.cga)}ZSd(ec){ec!==this.cga&&(this.cga=ec,this.LIb())}get name(){return Na.a.w6a}get w6a(){return this.Yae}dispose(){rb.a(this.$).Ouc(this.gBf);this.w6a.hr(this.bO);this.Yae=null;super.dispose()}LIb(){this.uJd(this.cga)}refresh(){this.ZSd(1===this.w6a.zu||rb.a(this.$).fi===this.w6a)}}
Object(b.a)(pa,"IdleActivitySafeStatePublisher",lb.a,[]);var Ma=a(317),Ja=a(3),Ga=a(22);class La extends hb.a{constructor(){super()}nc(){return!1}executeCommand(){return z.Task.Ta(!0)}wc(ec,Vc){return 1905775613===Vc.command}Jc(){return!1}}Object(b.a)(La,"ToggleMergeSuspensionSafeState",hb.a,[165]);class nb extends dc.a{constructor(ec,Vc){super();this.statusBarManager=null;this.TAd=!1;this.zza=(ud,ke)=>{ud=`${ke.Ica.Current===ke.Ica.Pending?"\u26ad":"\u26ae"}${ke.Ica.Current}`;Ga.a.equals(this.Onc,
ud,!1)||(this.Onc=ud,this.Sz())};this.UPa=(ud,ke)=>{ud=0==ke.vI;this.TAd!==ud&&(this.TAd=ud,this.Sz())};this.mergeSuspensionManager=Vc;this.mergeSuspensionManager.cna.PZa(this.zza);this.Onc="";Ma.a.d$(1905775613,Ja.a.jc,0,1);this.Ka=ec.Ka;this.wPb=new La;ec.da.$a(29,ud=>{this.mergeSuspensionManager&&(this.statusBarManager=ud,ud.JJ(this),this.mergeSuspensionManager.hia.x0b(this.UPa))});this.Ka.P2(this.wPb)}Mq(ec){this.addHandler(nb.szd,ec)}hr(ec){this.removeHandler(nb.szd,ec)}Sz(){this.raiseEvent(nb.szd)}Hn(ec){return ec===
nb.E$i&&!!this.mergeSuspensionManager}rs(ec,Vc){if(!this.Hn(ec))return!1;this.mergeSuspensionManager&&(Vc.LabelText=this.Onc,Vc.On=this.TAd);return!0}dispose(){this.wPb&&(this.Ka.vcb(this.wPb),this.wPb.dispose(),this.wPb=null);this.mergeSuspensionManager&&(this.mergeSuspensionManager.cna.Icb(this.zza),this.mergeSuspensionManager.hia.hvc(this.UPa),this.mergeSuspensionManager=null);this.statusBarManager&&(this.statusBarManager.lG(this),this.statusBarManager=null);this.Onc=null;super.dispose()}}nb.szd=
"MSMSC";nb.E$i="QueryMergeSuspensionStatus";Object(b.a)(nb,"MergeSuspensionIndicatorManager",dc.a,[161,162,2]);var Lb=a(7),ac=a(874);class ib extends Sys.EventArgs{constructor(ec){super();this.Qxa=ec}}Object(b.a)(ib,"TogglePendingMergeBlockedByClientEventArgs",Sys.EventArgs,[]);class Ra{}Object(b.a)(Ra,"SuspensionState",null,[]);class ya extends Ra{constructor(ec){super();this.Gte=!1;this.Gte=ec}}Object(b.a)(ya,"ReadyForPendingMergeState",Ra,[]);const Va=new Ra,oa=new Ra,kb=new ya(!1),Sa=new ya(!0);
var U=a(875);class ta extends U.a{constructor(ec,Vc,ud){super(ec);this.WQg=Vc;this.TKj=ud}}Object(b.a)(ta,"ReadyForPendingMergesUpdatedEventArgs",U.a,[]);class ub extends dc.a{constructor(ec,Vc,ud){super();this.zza=(ke,te)=>{ke=this.getState();const pe=this.Y_;this.Y_=te.Ica;te=this.getState();this.uDi(ke,te,pe);this.raiseEvent(ub.nzd);this.cYe(ke,te)};this.UPa=(ke,te)=>{ke=this.getState();this.vI=te.vI;te=this.getState();this.cYe(ke,te)};this.qGb=(ke,te)=>{this.i8a&&4===te.svf&&(e.ULS.sendTraceTag(520480203,
0,50,"MergeSuspensionStateHandler.onMergeDidntOccur: Retry DoPendingMerge after bailout. Current merge counter: {0}, Response merge counter: {1}",eb(this.Y_),eb(te.Y_)),this.oQf(this.getState(),!0))};this.tAb=bb.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.DoPendingMergeWhenUnsafe",!1);this.i8a=bb.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.RetryDoPendingMergeAfterBailout",!1);this.hia=ec;this.hia.x0b(this.UPa);this.cna=Vc;this.cna.PZa(this.zza);this.i8a&&(this.Tya=ud,this.Tya.Rre(this.qGb));
this.Y_=Object(Lb.a)(new ac.a,{Pending:0,Current:0,SuspensionStartTimestamp:null});this.vI=this.$fi()}$fi(){return Object(sb.a)(ha,this.hia)?Object(L.a)(ha,this.hia).Pbc():1}C0b(ec){this.addHandler(ub.NZd,ec)}lvc(ec){this.removeHandler(ub.NZd,ec)}tOg(ec){this.addHandler(ub.fKd,ec)}Tkj(ec){this.removeHandler(ub.fKd,ec)}ENg(ec){this.addHandler(ub.nzd,ec)}pkj(ec){this.removeHandler(ub.nzd,ec)}Abj(){this.rJd(this.getState()===oa)}dispose(){this.hia.hvc(this.UPa);this.hia=null;this.cna.Icb(this.zza);this.cna=
null;this.i8a&&(this.Tya.QVf(this.qGb),this.Tya=null);super.dispose()}Bhd(){return Object(Lb.a)(new ac.a,{Current:this.Y_.Current,Pending:this.Y_.Pending,SuspensionStartTimestamp:this.Y_.SuspensionStartTimestamp})}getState(){return za(this.Y_)?0==this.vI?Sa:this.tAb&&1==this.vI?kb:oa:Va}cYe(ec,Vc){ec!==Vc&&(Vc===oa?this.rJd(!0):ec===oa&&this.rJd(!1));this.oQf(Vc)}oQf(ec,Vc=!1){ec instanceof ya&&this.raiseEvent(ub.fKd,new ta(this.Y_,ec.Gte||!this.tAb,Vc))}uDi(ec,Vc,ud){ec===Va&&Vc!==Va?(ec=Vc===oa,
Vc=Vc===kb,e.ULS.sendTraceTag(252760283,0,50,`MergeSuspensionStateHandler.LogPendingMergesStatusChanged: Pending changes exist. IsBlocking: ${Vc} publisher: ${Vc||ec?this.hia.gYj.join(","):""} counter: ${eb(this.Y_)} isBlockingAllMerges: ${ec}`)):ec!==Va&&Vc===Va&&e.ULS.sendTraceTag(252760284,0,50,`MergeSuspensionStateHandler.LogPendingMergesStatusChanged: No pending changes. counter: ${eb(ud)}`)}rJd(ec){this.raiseEvent(ub.NZd,new ib(ec))}}ub.NZd="TPMBBC";ub.fKd="RFPMU";ub.nzd="MCC";Object(b.a)(ub,
"MergeSuspensionStateHandler",dc.a,[]);class hc extends dc.a{constructor(ec){super();this.l2=null;this.dlc=0;this.vEb=(Vc,ud)=>{(null===ud||void 0===ud?0:ud.Ica)&&this.PPa(ud.Ica,hc.n3d)};this.Rxc=()=>{this.yYf();this.eQf(this.l2,hc.voj)};this.W$a=(Vc,ud)=>{ud.Qrb&&this.l2.SuspensionStartTimestamp&&e.ULS.sendTraceTag(17318084,0,50,`PendingMergeMonitor.OnEditCellEnded: committed with counter ${eb(this.l2)}`)};this.yYf();this.$=ec;this.$.ea.Tj(this.Rxc);this.$.ea.zM(this.Rxc);Fa.h(this.$).Vb.sm(this.W$a);
this.$.da.$a(292,Vc=>{Vc.PZa(this.vEb);e.ULS.sendTraceTag(588276809,0,50,"PendingMergeMonitor initialized")})}PZa(ec){this.addHandler("MCU",ec)}Icb(ec){this.removeHandler("MCU",ec)}get Y_(){return this.l2}PPa(ec,Vc=""){const ud=this.l2.Current<ec.Current||this.l2.Pending<ec.Pending;if(ec.SuspensionStartTimestamp&&this.dlc!==ec.SuspensionStartTimestamp){if(this.dlc>ec.SuspensionStartTimestamp){ud&&e.ULS.sendTraceTag(553736149,0,50,`PendingMergeMonitor.OnMergeCounterReceivedFromServer: skipping a higher stale counter received via ${Vc}. S: ${hc.uEb(ec)}, C: ${hc.uEb(this.l2)}`);
return}ud||e.ULS.sendTraceTag(553736148,0,50,`PendingMergeMonitor.OnMergeCounterReceivedFromServer: recovering from a potentially stale counter. S: ${hc.uEb(ec)}, C: ${hc.uEb(this.l2)}`)}else if(!ud)return;this.l2=ec;this.eQf(ec,Vc)}dispose(){this.$.ea.qk(this.Rxc);this.$.ea.ZR(this.Rxc);Fa.h(this.$).Vb.Il(this.W$a);const ec=this.$.da.za(292);ec&&ec.Icb(this.vEb);super.dispose()}eQf(ec,Vc=""){za(ec)&&ec.SuspensionStartTimestamp>this.dlc&&(e.ULS.sendTraceTag(537155416,0,50,`PendingMergeMonitor.RaiseMergeCounterUpdated: Merge suspension requested. MergeCounter: ${eb(ec)}, Origin: ${Vc}`),
this.dlc=ec.SuspensionStartTimestamp);this.raiseEvent("MCU",new U.a(ec))}yYf(){e.ULS.sendTraceTag(588276808,0,50,`PendingMergeMonitor.ResetMergeCounter : Last counter was ${hc.uEb(this.l2)}`);this.l2=Object(Lb.a)(new ac.a,{Pending:0,Current:0,SuspensionStartTimestamp:null})}static uEb(ec){return ec?`(${ec.Current}/${ec.Pending} @${ec.SuspensionStartTimestamp})`:"null"}}hc.n3d="PMM.RTC";hc.k9b="PMM.EwaResult";hc.voj="PMM.resetMergeCounter";Object(b.a)(hc,"PendingMergeMonitor",dc.a,[]);class Bc{}Object(b.a)(Bc,
"ClientRevisions",null,[]);var Qa=a(46),na=a(60);const ab=(ec,Vc,ud,ke,te,pe,rf,cf=null)=>{cf=ec.Na(1,cf);cf.viewportState=Vc;cf.allowViewAdjustment=ud;return na.g(ec,"DoPendingMerge",cf,ke,te,pe,rf,0)},Gb=(ec,Vc,ud,ke,te,pe,rf=null)=>{rf=ec.Na(1,rf);rf.suspensionStartTimestamp=Vc;return na.g(ec,"KeepBlockingPendingMerges",rf,ud,ke,te,pe,0)};class fc extends dc.a{constructor(ec,Vc,ud,ke){super();this.DJa=null;this.sCb=0;this.tCb=this.S8a=null;this.AGf=(te,pe)=>{this.DJa.sUg(pe.Ica,pe.WQg,pe.TKj)};
this.UGb=(te,pe)=>{pe.Qxa?this.fNj():this.aBc()};this.QEf=()=>{this.sCb=0};this.O1f=()=>{const te=this.z6.Bhd();Gb(this.ya,null!=te.SuspensionStartTimestamp?te.SuspensionStartTimestamp:0,null,()=>{this.FVi(te)},null,null,this.ya.Wb())};this.bDa=(te,pe)=>{if(pe){pe.Pob.MergeCount=this.z6.Bhd();let rf;({min:te,max:rf}=Fa.h(this.$).vIi());bb.EwaSettings.isChangeGateEnabled("OfficeVSO:5524817_LogOnMergeRaceCondition2")?pe.Pob.ClientRevisions=Object(Lb.a)(new Bc,{Min:te,Max:rf,MaxFromBlockCache:Fa.h(this.$).Ea.Suf}):
pe.Pob.ClientRevisions=Object(Lb.a)(new Bc,{Min:te,Max:rf})}};this.$=ec;this.G_a=ud;this.z6=Vc;this.z6.tOg(this.AGf);this.z6.C0b(this.UGb);this.z6.ENg(this.QEf);this.$.pa.qha(this.bDa);this.ya=this.$.pa.ya;this.ONd=this.$.va.MergeSuspensionRequestThrottlingTimeInMs;this.Oxi=this.$.va.KeepBlockingPendingMergesRequestIntervalMs;this.DJa=ke;e.ULS.sendTraceTag(588276807,0,50,"RequestController initialized")}dispose(){this.$.pa.Fna(this.bDa);this.aBc();this.z6.Tkj(this.AGf);this.z6.lvc(this.UGb);this.z6.pkj(this.QEf);
this.z6=null;super.dispose()}fNj(){this.aBc();if(this.AMe()){const ec=this.z6.Bhd();e.ULS.sendTraceTag(537155414,0,50,`RequestController.StartKeepBlockingPendingMergesTimer: Prevented starting StartKeepBlockingPendingMergesTimer because of repeated failure in counter ${eb(ec)} fail count: ${this.sCb}`)}else this.tCb=this.G_a.create(this.O1f,this.ONd,Qa.a.tCb),this.S8a=this.G_a.eD(this.O1f,this.Oxi,Qa.a.S8a)}aBc(){this.S8a&&(this.tCb.cancel(),this.S8a.cancel(),this.S8a=this.tCb=null)}FVi(ec){let Vc;
Vc=" fail count: "+this.sCb;this.sCb++;this.AMe()&&this.aBc();e.ULS.sendTraceTag(542229773,0,10,`RequestController.OnKeepBlockingPendingMergesRequestFailed: request failed ${eb(ec)}${Vc}`)}AMe(){return this.sCb>fc.bHi}}fc.bHi=5;Object(b.a)(fc,"RequestController",dc.a,[]);var pb=a(157),Ea=a(196),xb=a(28),bc=a(281);class zb extends Sys.EventArgs{constructor(ec,Vc){super();this.svf=ec;this.Y_=Vc}}Object(b.a)(zb,"MergeDidntOccurEventArgs",Sys.EventArgs,[]);class Ub extends dc.a{constructor(ec,Vc,ud=null,
ke=null,te=null){super();this.clc=null;this.gFd=0;this.documentVisibilityObserver=null;this.uof=!1;this.fnc=null;this.ya=ec;this.ONd=Vc.va.MergeSuspensionRequestThrottlingTimeInMs;const pe=Vc.va.GetRangeContentPrefetchDelayForMergeInMs;this.Qy=()=>{Vc.y0f(pe)};this.Mh=ud||xb.a.Qa;this.tkg=0;this.PL=ke;this.eBa=te;Vc.da.$a(291,rf=>{this.documentVisibilityObserver=rf})}get WMa(){return 0<this.gFd}FNg(ec){this.addHandler(Ub.tzd,ec)}qkj(ec){this.removeHandler(Ub.tzd,ec)}Rre(ec){this.addHandler(Ub.ozd,
ec)}QVf(ec){this.removeHandler(Ub.ozd,ec)}get isDocumentHidden(){return!!this.documentVisibilityObserver&&this.documentVisibilityObserver.si}sUg(ec,Vc,ud=!1){this.CNb(ec,Vc,ud)?(new pb.a).setResult(!0):(Vc=this.W4i(ec,Vc),this.clc=ec,this.gFd++,Vc.continueWith(()=>{this.UQi()},0,Ea.a.none,this.PL))}W4i(ec,Vc){this.tkg=this.Mh.gfa;this.uof=Vc;e.ULS.sendTraceTag(554767493,0,50,`DoPendingMergeSender.performDoPendingMergeInternal: Sending DoPendingMerge ${ec.Current} / ${ec.Pending} @${ec.SuspensionStartTimestamp}. allowSelectionAdjustment: ${Vc}`);
this.isDocumentHidden||this.Qy();return this.Uuj(Vc,ec)}CNb(ec,Vc,ud=!1){if(this.eBa&&!Vc&&!this.eBa.Uui())return e.ULS.sendTraceTag(523317956,0,50,"DoPendingMergeSender.shouldThrottle: We can't retrieve selection and selection adjustments are disallowed."),!0;if(!this.clc||ec.SuspensionStartTimestamp>this.clc.SuspensionStartTimestamp)return this.WMa&&e.ULS.sendTraceTag(523551556,0,50,`DoPendingMergeSender.shouldThrottle: Allowing request for new suspension while previous is ongoing, new counter: ${ec.Current} / ${ec.Pending} @${ec.SuspensionStartTimestamp}`),
!1;if(this.WMa)return!0;if(ud)return!1;ud=this.clc;const ke=this.Mh.gfa-this.tkg<this.ONd;Vc=this.uof===Vc;return(ec||ud?ec&&ud?ec.Current===ud.Current&&ec.Pending===ud.Pending&&ec.SuspensionStartTimestamp===ud.SuspensionStartTimestamp:!1:!0)&&ke&&Vc}Uuj(ec,Vc){const ud=this.ya.Wb(),ke=()=>{e.ULS.sendTraceTag(588276806,0,10,`DoPendingMergeSender.sendDoPendingMergeRequest: request failed ${Vc.Current} / ${Vc.Pending} @${Vc.SuspensionStartTimestamp}`)};return this.eBa?this.eBa.Crj(this.sUh(ec,ke,ud)):
this.mAe(null,!0,void 0,ke,ud)}sUh(ec,Vc,ud){return(ke,te,pe)=>{let rf=void 0;e.ULS.shipAssertTag(523317955,0,null!=ke||ec,"!allowSelectionAdjustment requires a non-null initialViewportState.");rf=this.VQi.bind(this);te&&(rf=bc.b.call(null,cf=>{const wf=cf.Result;let Ge=null===wf||void 0===wf?void 0:wf.AdjustedViewportState;3===(null===wf||void 0===wf?void 0:wf.MergeResultState)&&(Ge=void 0);te(Ge,cf.StateId)},rf));pe&&(Vc=bc.a.call(null,pe,Vc));return this.mAe(ke,ec,rf,Vc,ud)}}mAe(ec,Vc,ud,ke,te){return ab(this.ya,
ec,Vc,ud,ke,null,null,te)}VQi(ec){var Vc=ec.Result;void 0!=Vc&&(Vc=Vc.MergeResultState,bb.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.RetryDoPendingMergeAfterBailout",!1)&&2!==Vc?this.fnc=[Vc,ec.MergeCount]:3===Vc&&(e.ULS.sendTraceTag(523317954,0,50,"DoPendingMergeSender.onDoPendingMergeSucceeded: Aborted merge."),this.cbj()))}cbj(){this.raiseEvent(Ub.tzd,new Sys.EventArgs)}bbj(ec,Vc){this.raiseEvent(Ub.ozd,new zb(ec,Vc))}UQi(){this.gFd--;if(this.fnc){const ec=this.fnc;this.fnc=null;
this.bbj(...ec)}}}Ub.tzd="MWA";Ub.ozd="MDO";Object(b.a)(Ub,"DoPendingMergeSender",dc.a,[454,455]);class wc{constructor(ec=!1){this.divergenceOnResponse=this.adjustedDidntChangeWithDivergence=this.editBoxDivergence=this.differentSheetAdjust=this.parallel=this.errors=this.nonContinuous=this.divergenceOnViewportReady=this.adjusted=this.adjustedDidntChange=0;this.Tei=ec}get reportName(){return this.Tei?"SelectionAdjustInHiddenDocument":"SelectionAdjust"}}Object(b.a)(wc,"SelectionAdjustSessionEndsReport",
null,[225]);var mb=a(42);class Db{constructor(ec,Vc,ud,ke,te,pe){this.jb=ec;this.OG=Vc;this.R9=ud;this.kYb=ke;this.p5d=te;this.kM=pe}get activeCell(){return this.OG}get selectedRanges(){return this.R9}get Cs(){let ec=!1;if(null===this.kM||void 0===this.kM)ec=!0;else if(this.kM>=this.selectedRanges.length||!this.selectedRanges[this.kM].contains(this.activeCell))e.ULS.sendTraceTag(521200010,0,50,`SelectionState.indexOfActiveRange: the index of the adjusted active range has changed. indexOfActiveRange: ${this.kM}, selectedRangesLength: ${this.selectedRanges.length}`),
ec=!0;ec&&(this.kM=this.o0g());return this.kM}get activeRange(){return 0>this.Cs?this.activeCell:this.selectedRanges[this.Cs]}get sheetName(){return this.kYb}get activeItemName(){return this.p5d}get Xpg(){return 1===this.selectedRanges.length}xlg(ec){let Vc=this.selectedRanges.map(ud=>this.DVj(ud,this.p5d));for(let ud of Vc)if(ud)for(let ke of ud)if(ke.Pk&&ke.oe.Revision<ec)return!1;return!0}JSj(){var ec;return{SheetName:this.sheetName,ActiveCell:null===(ec=this.activeCell)||void 0===ec?void 0:ec.toString(),
TopLeft:void 0,SelectedRanges:mb.r(this.selectedRanges,this.jb)}}toString(){var ec,Vc;return`active cell: ${null!==(Vc=null===(ec=this.activeCell)||void 0===ec?void 0:ec.toString())&&void 0!==Vc?Vc:"null"} selection: ${Cb.f(this.selectedRanges,ud=>{var ke;return null!==(ke=null===ud||void 0===ud?void 0:ud.toString())&&void 0!==ke?ke:"null"}).join(",")}`}equals(ec){return ec?this.activeCell.equals(ec.activeCell)&&mb.Q(this.selectedRanges,ec.selectedRanges)&&this.sheetName===ec.sheetName:!1}o0g(){for(let [ec,
Vc]of this.selectedRanges.entries())if(null===Vc||void 0===Vc?0:Vc.contains(this.activeCell))return ec;return-1}DVj(ec,Vc){var ud;const ke=Fa.h(this.jb).Ea.G4a(ec,Vc);ke||e.ULS.sendTraceTag(522803340,0,50,`SelectionState.tryGetBlockCacheItemsFromRange: no items found. range: ${null!==(ud=null===ec||void 0===ec?void 0:ec.toString())&&void 0!==ud?ud:"null"} ; activeItemNameIsDefined: ${!!Vc}`);return ke}}Object(b.a)(Db,"SelectionState",null,[]);var Ic=a(201),Hc=a(737);class Ab{constructor(ec){this.WAc=
0;this.lH=this.MF=null;this.F5d=new wc;this.G5d=new wc(!0);this.lI=0;this.TQj=!1;this.zIi=1E4;this.ed=()=>{this.zJe()};this.Gj=()=>{this.NZc(!0,!1)};this.O$a=()=>{this.NZc(!1,!1)};this.$=ec;this.gridView=Fa.h(this.$);this.gridView.Ea.jw(this.Gj);this.gridView.Ea.mt(this.O$a);this.gridView.Ea.Zqe(this.O$a);this.gridView.Ea.mha(this.O$a);this.$.nl(this.ed);this.zJe()}Crj(ec){let Vc=null,ud=null,ke=()=>{this.uNi()};this.sgf()?(this.OP.parallel++,e.ULS.sendTraceTag(526390086,0,15,`SelectionAdjustManager.runRequestWithSelectionAdjust: Skipping parallel request. Current adjustedSelection is defined : ${!!this.lH}`)):
(Vc=(te,pe)=>{this.vNi(te,pe)},ud=this.yAj());return null===ec||void 0===ec?void 0:ec(ud,Vc,ke)}Uui(){return!this.sgf()&&this.gba().Xpg}yAj(){var ec;e.ULS.shipAssertTag(525135961,0,0===this.lI,"SelectionAdjustManager.setPreRequestState: unexpected state");this.lH&&(this.OP.errors++,e.ULS.sendTraceTag(526960090,0,10,`SelectionAdjustManager.setPreRequestState: About to ignore a defined Adjusted selection: ${this.lH.toString()}`));this.lH=null;this.MF=this.gba();let Vc=null;const ud=null===(ec=this.MF)||
void 0===ec?void 0:ec.JSj();ud&&(Vc={ActiveSheetName:this.MF.sheetName,SheetViewportStateChanges:[ud]});this.lI=1;return Vc}uNi(){e.ULS.shipAssertTag(525135960,0,1===this.lI,"SelectionAdjustManager.onAdjustedRequestFailed: unexpected state");this.OP.errors++;this.lI=2;this.Cr()}vNi(ec,Vc){try{e.ULS.shipAssertTag(525135959,0,1===this.lI,"SelectionAdjustManager.onAdjustedSelectionReady: unexpected state"),this.WAc=Vc,Vc=2,this.MF?ec?(this.lH=this.WDj(ec))?(Vc=7,this.MF.equals(this.lH)?this.MF.equals(this.gba())?
(this.OP.adjustedDidntChange++,Vc=4):(this.OP.adjustedDidntChangeWithDivergence++,Vc=5):this.MF.sheetName!=this.lH.sheetName?(this.OP.differentSheetAdjust++,Vc=10):this.MF.equals(this.gba())||(this.OP.divergenceOnResponse++,Vc=6,this.dXf())):this.OP.errors++:(this.OP.errors++,e.ULS.sendTraceTag(537155412,0,15,`SelectionAdjustManager.OnAdjustedSelectionReady: Adjusted returned null, initialSelection: ${this.MF.toString()}`)):(this.OP.errors++,e.ULS.sendTraceTag(537155413,0,10,`SelectionAdjustManager.OnAdjustedSelectionReady: Adjusted selection results returned when not waiting for them, adjusted:  ActiveCell: ${null===
ec||void 0===ec?void 0:ec.ActiveCell}`)),this.lI=Vc}catch(ud){this.lI=12,e.ULS.sendTraceTag(525135958,0,10,`SelectionAdjustManager.OnAdjustedSelectionReady: caught Exception ${ud}`)}finally{7!=this.lI?this.Cr():this.NZc(!1,!0)}}dispose(){this.gridView.Ea.ix(this.Gj);this.gridView.Ea.gr(this.O$a);this.gridView.Ea.eVf(this.O$a);this.gridView.Ea.zcb(this.O$a);this.$.Kl(this.ed)}sgf(){return 1===this.lI||7===this.lI}WDj(ec){let Vc;if(!({range:Vc}=mb.Z(ec.ActiveCell,this.$.xa)).returnValue)return e.ULS.sendTraceTag(537155411,
0,10,`SelectionAdjustManager.sheetViewportStateToSelectionState: Unable to extract active cell ${ec.ActiveCell}`),null;let ud=[];const ke=this.$.na,te=!!ke&&2===ke.wG;if(ec.SelectedRanges)ud=mb.g(ec.SelectedRanges.Ranges);else if(!te)return e.ULS.sendTraceTag(522826913,0,10,`SelectionAdjustManager.sheetViewportStateToSelectionState: SelectedRanges is null, active sheet exists: ${!!ke}`),null;return new Db(this.$,Vc,ud,ec.SheetName,this.MF.activeItemName,this.MF.Cs)}gba(){const ec=this.$.na;if((null===
ec||void 0===ec?0:ec.activeCell)&&ec.selectedRanges&&ec.sheetName)return new Db(this.$,ec.activeCell,ec.selectedRanges,ec.sheetName,this.$.activeItemName,ec.Cs);e.ULS.sendTraceTag(525135957,0,15,`SelectionAdjustManager.getCurrentSelection: invalid activeItem. activeItem null: ${!ec}, activeCell null: ${!(null===ec||void 0===ec?0:ec.activeCell)}, selectedRanges null: ${!(null===ec||void 0===ec?0:ec.selectedRanges)}, sheetName null: ${!(null===ec||void 0===ec?0:ec.sheetName)}`);return null}zJe(){this.$.da.$a(276,
()=>{const ec=Ic.a(this.$);ec.EY(this.F5d);ec.EY(this.G5d)})}NZc(ec,Vc){var ud;if(this.eti(ec))if(8===this.lI)e.ULS.sendTraceTag(523106438,0,15,"SelectionAdjustManager.attemptAdjustSelection: skipping as was already adjusted");else{Vc&&e.ULS.sendTraceTag(524039250,0,50,"SelectionAdjustManager.attemptAdjustSelection: viewport ready on response");try{e.ULS.shipAssertTag(525135956,0,7===this.lI,"SelectionAdjustManager.attemptAdjustSelection: unexpected state"),this.MF.equals(this.gba())?(null===(ud=
this.gridView)||void 0===ud?0:ud.eb)?(this.OP.editBoxDivergence++,this.lI=11):(ec=0,ec=this.lH.Cs,-1==ec?(this.OP.errors++,e.ULS.sendTraceTag(522826912,0,10,"SelectionAdjustManager.attemptAdjustSelection: invalid indexOfActiveRange")):(this.OP.adjusted++,this.lI=8,this.gridView.ha.ox(this.lH.selectedRanges,ec,this.lH.activeCell,0,void 0,"SelectionAdjust"))):(this.OP.divergenceOnViewportReady++,this.dXf(),this.lI=9)}catch(ke){this.lI=12,e.ULS.sendTraceTag(525135955,0,10,`SelectionAdjustManager.attemptAdjustSelection: caught Exception ${ke}`)}finally{this.Cr()}}}eti(ec){if(!this.lH)return!1;
if(!this.MF)return e.ULS.sendTraceTag(537155409,0,10,`SelectionAdjustManager.attemptAdjustSelection: initialSelection is null while adjustedSelection isn't null, adjustedSelection: ${this.lH.toString()}`),!1;if(Fa.h(this.$).Ea.Suf<this.WAc)return!1;if(ec||this.TQj)e.ULS.sendTraceTag(528590295,0,15,"SelectionAdjustManager.attemptAdjustSelection: got to blockCacheConsistent while pending for selection adjust");else if(!this.MF.xlg(this.WAc)||!this.lH.xlg(this.WAc))return!1;return!0}Cr(){this.MF=this.lH=
null;this.lI=0}dXf(){const ec=this.gba();e.ULS.sendTraceTag(537155408,0,50,`SelectionAdjustManager.ReportDivergence: initial: ${this.MF.toString()} current: ${ec?ec.toString():""} adjusted: ${this.lH.toString()} sheetSameBetweenInitialAndAdjusted: ${this.MF.sheetName===this.lH.sheetName} sheetSameBetweenInitialAndCurrent: ${this.MF.sheetName===(ec?ec.sheetName:null)}`)}get OP(){return Hc.a.CD(this.zIi)?this.G5d:this.F5d}}Object(b.a)(Ab,"SelectionAdjustManager",null,[403,2]);class db extends hb.a{constructor(ec,
Vc,ud=null){super();this.LDa=this.vgc=this.x6a=this.N0a=null;e.ULS.sendTraceTag(537155417,0,50,"MergeSuspensionManager.ctor started");this.$=ec;this.bYa=new hc(ec);this.eBa=new Ab(this.$);this.DJa=new Ub(this.$.pa.ya,this.$,void 0,void 0,this.eBa);this.ugi(ec,ud);this.kga=new ub(this.LDa,this.bYa,this.DJa);this.JNd=new fc(ec,this.kga,Vc,this.DJa);bb.EwaSettings.ma(252)&&(this.vgc=new nb(ec,this));e.ULS.sendTraceTag(588276810,0,50,"MergeSuspensionManager created")}C0b(ec){this.kga.C0b(ec)}lvc(ec){this.kga&&
this.kga.lvc(ec)}get hia(){return this.LDa}get cna(){return this.bYa}get z6(){return this.kga}DAa(ec,Vc){this.LDa.DAa(ec,Vc)}F0d(ec){this.LDa.F0d(ec)}PPa(ec,Vc=""){this.bYa.PPa(ec,Vc)}dispose(){this.vgc&&(this.vgc.dispose(),this.vgc=null);this.eBa&&this.eBa.dispose();this.DJa.dispose();this.JNd&&(this.JNd.dispose(),this.JNd=null);this.kga&&(this.kga.dispose(),this.kga=null);this.bYa.dispose();this.bYa=null;this.LDa.dispose();this.LDa=null;this.N0a&&(this.N0a.dispose(),this.N0a=null);this.x6a&&(this.x6a.dispose(),
this.x6a=null);this.$=null;super.dispose()}LIb(){this.kga.Abj()}static Pbc(ec){let Vc=0;for(let ud of ec){if(2==ud)return 2;1==ud&&(Vc=1)}return Vc}ugi(ec,Vc){this.LDa=new ha(this.DJa,this.bYa);Vc?Object(sb.a)(pa,Vc)?this.DAa(Vc,Object(L.a)(pa,Vc).vI):Object(sb.a)(Mb,Vc)?this.DAa(Vc,Object(L.a)(Mb,Vc).vI):this.DAa(Vc,0):(this.N0a=new Mb(ec),this.x6a=new pa(ec),this.DAa(this.N0a,this.N0a.vI),this.DAa(this.x6a,this.x6a.vI))}}Object(b.a)(db,"MergeSuspensionManager",hb.a,[365,2]);class Pb extends ia.a{constructor(ec){super();
this.Lc=ec;this.Fb()}create(){e.ULS.sendTraceTag(537155419,0,50,"MergeSuspensionFactory.Create");this.ob(this.Lc.da.za(343)||this.Lc.da.Ga(343,new db(this.Lc,sa.a.instance)))}static ka(ec){e.ULS.sendTraceTag(537155418,0,50,"MergeSuspensionFactory.Attach");ec.da.Ga(344,new Pb(ec))}}Object(b.a)(Pb,"MergeSuspensionFactory",ia.a,[]);var td=a(50),Vb=a(37),Ac=a(87),Kc=a(97),dd=a(58),Vd=a(13);class Jd{}Jd.oAi=3;Jd.connected=0;Object(b.a)(Jd,"ConnectionStateConstants",null,[]);var oe=a(110),De=a(118),Ke=
a(44);class rd{constructor(ec,Vc,ud){var ke;this.type=0;this.startTime=null;this.blockedOperationsCount=this.durationMs=0;this.blockedActions=null;this.blockedUserOperationsWhileToastShown=this.durationUntilToastShownMs=0;this.toastRaiser=null;this.wasUserActiveOnPIEnd=this.wasUserActiveOnPIStart=this.hasTabbedOut=this.isToastShown=!1;this.durationUntilUserInactive=-1;this.isTaskPaneCollapsed=this.isTaskPaneShown=this.isDialogShown=!1;this.Mzf=(te,pe)=>{this.blockedOperationsCount++;te=`${pe.componentName}_${pe.actionName}_${pe.details})`;
this.blockedActions[te]=this.blockedActions[te]?this.blockedActions[te]+1:1;this.isToastShown&&this.blockedUserOperationsWhileToastShown++};this.cFd=te=>{this.durationUntilUserInactive=oe.getElapsedSeconds(this.startTime,xb.a.Qa.zb);te.RMd(this.cFd)};this.dW=()=>{this.hasTabbedOut=!0};this.eda=(te,pe)=>{pe.xLf!==this.type||this.isToastShown||(this.durationUntilToastShownMs=De.a(xb.a.Qa,this.startTime),this.toastRaiser=pe.toastRaiser,this.isToastShown=!0)};this.startTime=ec;this.durationUntilToastShownMs=
0;this.blockedActions={};this.isToastShown=ud;if(null===(ke=Vc.ea)||void 0===ke?0:ke.Re)this.wasUserActiveOnPIStart=Vc.ea.Re.Jr;this.Kj(Vc);this.isDialogShown=0<Vc.rb.KR;ec=Vc.da.za(183);this.isTaskPaneShown=!!ec&&ec.isVisible&&!ec.isCollapsed;this.isTaskPaneCollapsed=!!ec&&ec.isVisible&&ec.isCollapsed}E3f(){this.durationMs=De.a(xb.a.Qa,this.startTime)}jEd(ec){var Vc;this.E3f();Ke.a(ec).fvc(this.Mzf);Ke.a(ec).Xf.gvc(this.eda);ec.da.$a(291,ud=>{ud.Bcb(this.dW)});if(null===(Vc=ec.ea)||void 0===Vc?0:
Vc.Re)ec.ea.Re.RMd(this.cFd),this.wasUserActiveOnPIEnd=ec.ea.Re.Jr}Kj(ec){Ke.a(ec).s0b(this.Mzf);this.isToastShown?this.toastRaiser="Immediate":Ke.a(ec).Xf.GXc(this.eda);ec.da.$a(291,Vc=>{this.hasTabbedOut=Vc.si;Vc.KGa(this.dW)});this.wasUserActiveOnPIStart&&ec.ea.Re.Gse(this.cFd)}}Object(b.a)(rd,"PartialInteractivityData",null,[]);var bf=a(1116);class cc extends rd{constructor(ec,Vc,ud,ke,te,pe){super(ec,Vc,ke);this.swappedOffline=this.swappedByOffline=!1;this.lastFailedRequestToOnlineTimeGapSec=
this.longestDurationBetweenFailedRequestsSec=this.averageDurationBetweenFailedRequestsSec=0;this.errorDataDuringConnectivityIssuesMode=this.disconnectionSource=null;this.failedRequests=[];this.triggeringRequest=null;this.type=4;this.swappedOffline=ud;this.disconnectionSource=Enum.toString(bf.a,te);this.triggeringRequest=pe}QPi(ec,Vc){this.swappedByOffline=Vc;this.jEd(ec)}pyj(ec){this.errorDataDuringConnectivityIssuesMode=ec}Mdj(ec){10>this.failedRequests.length&&(ec=ec+"_"+oe.getElapsedSeconds(this.startTime,
xb.a.Qa.zb).toString(),this.failedRequests.push(ec))}}Object(b.a)(cc,"ConnectivityIssuesData",rd,[]);var Wc=a(159),id=a(124),Tc=a(112);class Gd{}Gd.mqh="DuringWork";Gd.connectivityIssues="ConnectivityIssues";Gd.offline="Offline";Object(b.a)(Gd,"UnavailabilityTypes",null,[]);var Wd=a(51);class Dd{constructor(ec){this.Xkc=this.data=null;this.acd=0;this.fGe=null;this.VAf=(Vc,ud)=>{ud.uM?(this.data=new cc(xb.a.Qa.zb,this.$,5===ud.Qoa,0!==ud.Qoa,this.$.Te.disconnectionSource,this.fGe),this.Xkc=this.$.Te.kpf,
this.acd=1,this.$.pa.Te.vPg(this.Bm),Wc.a(this.$).pXc(this.Q_f)):(this.data.QPi(this.$,5===ud.Qoa),this.$.pa.Te.mWf(this.Bm),this.data.lastFailedRequestToOnlineTimeGapSec=oe.getElapsedSeconds(this.Xkc,xb.a.Qa.zb),bb.EwaSettings.isChangeGateEnabled("OfficeVSO:5690761_AvailabilityUTRDuringWork_7pzab_ConnectivityIssues")?Wd.b().gMb(557682689,0,50,Gd.connectivityIssues,this.data.durationMs,"ConnectivityIssuesTelemetryManager.OnConnectivityIssuesEnded: this partial interactivity's info: {0}",dd.a.hc(this.data)):
e.ULS.sendTraceTag(557682689,0,50,`ConnectivityIssuesTelemetryManager.OnConnectivityIssuesEnded: this partial interactivity's info: ${dd.a.hc(this.data)}`),this.data&&this.data.isToastShown&&Kc.Health.instance.recordQosError(id.a.v5g,[Tc.a.Ilc],!0,!1,!1,!1,null),Wc.a(this.$).mMd(this.Q_f),this.data=null)};this.Q_f=(Vc,ud)=>{this.data.pyj(ud.TU)};this.Bm=(Vc,ud)=>{this.data.Mdj(ud.context.methodName);Vc=xb.a.Qa.zb;ud=oe.getElapsedSeconds(this.Xkc,Vc);this.Xkc=Vc;ud>this.data.longestDurationBetweenFailedRequestsSec&&
(this.data.longestDurationBetweenFailedRequestsSec=ud);this.acd++;this.data.averageDurationBetweenFailedRequestsSec=this.c0g(ud)};this.SAf=(Vc,ud)=>{this.fGe=ud.bVj};this.$=ec;Ke.a(this.$).Xf.ire(this.VAf);this.$.Te.hre(this.SAf)}dispose(){this.$&&(Ke.a(this.$).Xf.pVf(this.VAf),this.$.Te&&this.$.Te.oVf(this.SAf));this.data&&this.$.pa.Te.mWf(this.Bm);this.$=null}c0g(ec){const Vc=this.acd-1;return(this.data.averageDurationBetweenFailedRequestsSec*(Vc-1)+ec)/Vc}}Object(b.a)(Dd,"ConnectivityIssuesTelemetryManager",
null,[2]);var Kd=a(850),we=a(8),We=a(1264),Od=a(1115);class le{constructor(ec){this.TZf=null;this.cvd=this.Bzd=this.uFb=this.vFb=0;this.tUd=!1;this.j4c=this.NTa=this.yAc=this.r$a=null;this.x4c=0;this.Puj=()=>{if(12E4>this.$.ea.Re.Nfb)for(let Vc of this.yAc)Vc.runTest();else this.uXd("UserInactive")};this.xnj=Vc=>{Vc=Sys.Serialization.JavaScriptSerializer.serialize(Vc);e.ULS.sendTraceTag(388821830,0,50,Vc)};this.Pmj=Vc=>{if(Vc){var ud=this.j4c[Vc.testIteration.toString()];ud?ud.push(Vc):(ud=[Vc],this.j4c[Vc.testIteration.toString()]=
ud);if(ud.length===this.TZf.length){ud=Sys.Serialization.JavaScriptSerializer.serialize(ud);if(this.$&&this.$.Te){if(Vc.EstimatedLatency=this.$.Te.xxe,this.$.Te.xxe>this.$.pv.ExcelRountripThresholdMs){e.ULS.sendTraceTag(570712144,0,50,`Periodic ping tests results when network is slow: ${ud}, consequtive slow ping iteration #: ${this.x4c++}`);return}}else e.ULS.sendTraceTag(537155209,0,50,"EwaControl/ConnectivityObserver is null when conducting slow connection speed tests");e.ULS.sendTraceTag(570712142,
0,50,`Periodic ping tests results: ${ud}`);this.x4c=1}}};this.fh=(Vc,ud)=>{Vc=ud.context.methodName;if(Vc===we.a.Bxb||Vc===we.a.swa)this.uFb++,Vc=Date.now(),this.zFj(Vc)&&(this.uFb=0,this.cvd=Vc,this.yNj())};this.dda=()=>{this.XWd("OnThrottledUserActivity")};this.dW=()=>{this.uXd("OnDocumentHidden")};this.DR=()=>{this.XWd("OnDocumentUnhidden")};this.$=ec;if(this.uUd=this.H3g())this.TZf=[Od.a.QFc],this.x4c=1,this.j4c={},this.$.ea.Re.pha(this.dda),this.$.da.$a(291,Vc=>{Vc.KGa(this.dW);Vc.LGa(this.DR)})}dispose(){this.$&&
(this.tUd&&this.$.pa&&0<this.r$a.count&&this.$.pa.Nr(this.fh),this.uUd&&(this.uXd("Dispose"),this.$.ea.Re.KAa(this.dda)))}Zfi(){bb.EwaSettings.ma(210)&&this.M7i();this.uUd&&this.N7i()}vgi(){this.uFb=this.vFb;this.cvd=0;var ec={};if(!this.r$a){this.r$a=new ca.a;const Vc=We.a.Ged(this.xnj,"InitSampleMeasurement",this.$);for(const ud of Vc)ec[ud.Bmd]=ud.baseUrl,this.r$a.add(ud)}ec=Sys.Serialization.JavaScriptSerializer.serialize(ec);e.ULS.sendTraceTag(537155210,0,50,`Init Network measurement: numberOfRequestToWaitPerNetworkMeasurement: ${this.vFb}, numberOfRequestFromTheLastNetworkMeasurement: ${this.uFb}, testParams: ${ec} `);
0<this.r$a.count&&this.$.pa.Nq(this.fh)}yNj(){for(let ec of this.r$a)ec.runTest()}XWd(ec){this.NTa&&this.NTa.Gp||(e.ULS.sendTraceTag(537155208,0,50,`NetworkMeasurement.StartConnectionSpeedTest: starting ping tests. caller: ${ec}`),this.NTa=sa.a.instance.eD(this.Puj,5E3,Qa.a.xLj),this.NTa.BV())}uXd(ec){this.NTa&&this.NTa.Gp&&(e.ULS.sendTraceTag(537155207,0,50,`NetworkMeasurement.StopConnectionSpeedTest: stopping ping tests. caller: ${ec}`),this.NTa.cancel())}zFj(ec){return this.uFb>=this.vFb&&ec-this.cvd>
this.Bzd}H3g(){return le.JZf(this.$.va.SlowNetworkMeasurementsSamplePercentage)}M7i(){this.vFb=this.$.va.NumberOfRequestToWaitPerNetworkMeasurement;this.Bzd=1E3*this.$.va.MinTimeBetweenNetworkMeasurementInSec;const ec=this.$.va.NetworkMeasurementsSamplePercentage;0<this.vFb&&0<this.Bzd&&(this.tUd=le.JZf(ec))&&this.vgi()}N7i(){if(!this.yAc){this.yAc=new ca.a;const ec=We.a.Ged(this.Pmj,"PrepareAndInitSlowNetworkTests.ConnectionSpeedTest",this.$,[Od.a.QFc]);for(const Vc of ec)this.yAc.add(Vc);this.$.ea.Re.Jr&&
this.XWd("PrepareAndInitSlowNetworkTests")}}static JZf(ec){return 100*Math.random()<ec}}Object(b.a)(le,"NetworkMeasurement",null,[2]);var de=a(127),Re=a(750);class Ee{constructor(ec){this._count=0;this.sessionID=this.allOfflinePartialInteractivitiesDataInSession=null;this.allOfflinePartialInteractivitiesDataInSession=[];this.sessionID=ec}get count(){return this._count}get vU(){return this.allOfflinePartialInteractivitiesDataInSession[this.allOfflinePartialInteractivitiesDataInSession.length-1]}BZj(){this.vU&&
this.vU.E3f()}UJg(ec){this.allOfflinePartialInteractivitiesDataInSession.push(ec);this._count++}}Object(b.a)(Ee,"OfflinePartialInteractivitiesDataForLog",null,[]);class Te extends rd{constructor(ec,Vc,ud){super(ec,Vc,ud);this.timeFromLastOffline=0;this._errorDataDuringOfflineMode=null;this.timeFromLastOffline=-1;this.type=5}SBj(ec){this.timeFromLastOffline=ec}qyj(ec){this._errorDataDuringOfflineMode=ec}}Object(b.a)(Te,"OfflinePartialInteractivityData",rd,[]);class Ae{constructor(ec,Vc){this.wPa=this.vU=
null;this.aId=-1;this.Fvb=null;this.epf=z.Task.delay(0);this.mab=(ud,ke)=>{ke.uM?this.kXi(ke.Qoa):this.lXi()};this.eda=(ud,ke)=>{5===ke.xLf&&this.$3a()};this.R_f=(ud,ke)=>{this.vU.qyj(ke.TU)};this.$3a=()=>{this.wPa.BZj();this.usj(Ae.fGd,Sys.Serialization.JavaScriptSerializer.serialize(this.wPa))};this.nnj=ud=>{if(ud=ud.result)this.Plg=!0,e.ULS.sendTraceTag(576811915,0,50,`OfflineModeTelemetryManager.ReportOfflinePartialInteractivityDataFromIDB: Previous session's offline partial interactivy data: ${ud}`)};
this.Bhj=()=>{this.Plg&&(this.$?Vb.TaskExtensions.Aa(this.indexedDB.U7b(Ae.fGd),()=>{e.ULS.sendTraceTag(537155204,0,50,"OfflineModeTelemetryManager.RemoveDataFromIDB: Previous session's offline partial interactivy data successfuly removed from IDB.")},this.$.la):e.ULS.sendTraceTag(537155203,0,10,"OfflineModeTelemetryManager.RemoveDataFromIDB: EwaControl is null when attempting to remove offline mode data stored in IDB."))};this.CPa=()=>{if(this.wPa&&0<this.wPa.count){const ud=Sys.Serialization.JavaScriptSerializer.serialize(this.wPa);
e.ULS.sendTraceTag(560791644,0,50,`OfflineModeTelemetryManager.OnBeforeUnload: This session's offline partial interactivy data: ${ud}`)}};this.$=ec;this.indexedDB=Vc;this.Plg=!1;this.indexedDB.re()&&(this.indexedDB.initialize(Ae.wzb,Ae.xzb),this.Kmj(),this.wPa=new Ee(this.$.va.UserSessionId),Ke.a(this.$).Xf.yXc(this.mab));this.Im=de.a.instance.wH();this.Im.ka("beforeunload",this.CPa)}dispose(){this.$&&Ke.a(this.$)&&Ke.a(this.$).Xf.xMd(this.mab);Ac.a.Ia(this.Fvb);this.$=this.Fvb=null}kXi(ec){this.vU=
new Te(xb.a.Qa.zb,this.$,0!==ec);this.vU.SBj(-1!==this.aId?window.performance.now()-this.aId:-1);this.wPa.UJg(this.vU);Ke.a(this.$).Xf.GXc(this.eda);this.$3a();this.Fvb=sa.a.instance.eD(this.$3a,Ae.AJh,Qa.a.$3a);Wc.a(this.$).pXc(this.R_f)}lXi(){this.vU.jEd(this.$);this.$3a();Ac.a.Ia(this.Fvb);this.Fvb=null;this.aId=window.performance.now();Ke.a(this.$).Xf.gvc(this.eda);Wc.a(this.$).mMd(this.R_f);this.Qmj()}usj(ec,Vc){this.$?this.epf=Vb.TaskExtensions.Aa(this.epf,()=>{this.indexedDB.Tna(new Re.a(ec,
Vc))},this.$.la):e.ULS.sendTraceTag(537155205,0,15,"OfflineModeTelemetryManager.SaveToIndexedDBSequential: EwaControl is null when attempting to write to IDB")}Kmj(){const ec=this.$.la;Vb.TaskExtensions.Aa(Vb.TaskExtensions.Aa(this.indexedDB.bka(Ae.fGd),this.nnj,ec),this.Bhj,ec)}Qmj(){if(this.vU){const ec=Sys.Serialization.JavaScriptSerializer.serialize(this.vU);bb.EwaSettings.isChangeGateEnabled("OfficeVSO:5690761_AvailabilityUTRDuringWork_71qb3_Offline")?Wd.b().gMb(560791645,0,50,Gd.offline,this.vU.durationMs,
"OfflineModeTelemetryManager.ReportCurrentOfflinePartialInteractivityData: Ending offline partial interactivy data: {0}",ec):e.ULS.sendTraceTag(560791645,0,50,`OfflineModeTelemetryManager.ReportCurrentOfflinePartialInteractivityData: Ending offline partial interactivy data: ${ec}`)}this.vU&&this.vU.isToastShown&&Kc.Health.instance.recordQosError(id.a.v2j,[Tc.a.Ilc],!0,!1,!1,!1,null)}}Ae.wzb="NetworkAvailability";Ae.xzb="NetworkAvailabilityData";Ae.fGd="partialInteractivityData";Ae.AJh=3E3;Object(b.a)(Ae,
"OfflineModeTelemetryManager",null,[2]);class kf{constructor(ec,Vc){this.mma=this.GAd=this.Fyf=null;this.$=ec;bb.EwaSettings.isChangeGateEnabled("OfficeVSO:4956381_DisableNetworkLoggingInFirefox")&&Y.a.fg||(this.Fyf=new Ae(ec,Vc));bb.EwaSettings.ma(210)&&(this.GAd=new le(this.$),this.GAd.Zfi());!bb.EwaSettings.ma(550)||bb.EwaSettings.isChangeGateEnabled("OfficeVSO:4956381_DisableNetworkLoggingInFirefox")&&Y.a.fg||(this.mma=new Kd.NetworkConnectionHealthChecker(this.$));this.i9g=new Dd(this.$)}dispose(){Ac.a.Ia(this.Fyf);
Ac.a.Ia(this.GAd);Ac.a.Ia(this.mma);Ac.a.Ia(this.i9g);this.$=null}}Object(b.a)(kf,"NetworkConnectionTelemetryManager",null,[2]);class Oe extends rd{constructor(ec,Vc,ud,ke){super(ec,Vc,ud);this.wasInteruptedByOfflineMode=!1;this.type=ke;this.wasInteruptedByOfflineMode=!1}mab(){this.wasInteruptedByOfflineMode=!0}}Object(b.a)(Oe,"SilentReopenData",rd,[]);class $a{constructor(ec){this.e8=null;this.wIf=(Vc,ud)=>{this.tIf(ud,3)};this.KEf=(Vc,ud)=>{this.tIf(ud,2)};this.$=ec;this.Xf=Ke.a(this.$).Xf;this.Xf.Ore(this.KEf);
this.Xf.YOg(this.wIf)}dispose(){this.Xf.OVf(this.KEf);this.Xf.tlj(this.wIf);this.e8=this.Xf=this.$=null}tIf(ec,Vc){ec.uM?this.e8=new Oe(xb.a.Qa.zb,this.$,0!==ec.Qoa,Vc):(5===ec.Qoa&&(this.e8.wasInteruptedByOfflineMode=!0),3!==ec.Qoa&&2!==ec.Qoa||e.ULS.sendTraceTag(537155202,0,10,"SilentReopenPartialInteractivityTelemetryManager.OnSilentReopen: BackToWork/DuringWork partial interactivity has been swapped to DuringWork/BackToWork."),this.e8.jEd(this.$),2===Vc?bb.EwaSettings.isChangeGateEnabled("OfficeVSO:5690761_AvailabilityUTRDuringWork_8dtae_B2W")?
Wd.b().hMb(571289604,0,50,Gd.offline,this.e8.durationMs,this.e8):e.ULS.sendTraceTag(571289604,0,50,dd.a.hc(this.e8)):bb.EwaSettings.isChangeGateEnabled("OfficeVSO:5690761_AvailabilityUTRDuringWork_6w9lg_DuringWork")?Wd.b().hMb(542782150,0,50,Gd.mqh,this.e8.durationMs,this.e8):e.ULS.sendTraceTag(542782150,0,50,dd.a.hc(this.e8)),this.e8=null)}}Object(b.a)($a,"SilentReopenPartialInteractivityTelemetryManager",null,[2]);class Zb extends dc.a{constructor(ec,Vc,ud=!0){super();this.c1=this.n5b=this.xPa=
this.Aoa=this.ITa=null;this.Rwf=0;this.kuc=this.pcb=this.qcb=!1;this.Swf=this.documentVisibilityObserver=null;this.Uqa=!1;this.ynd=this.p8=0;this.xBb=!1;this.a$f=0;this.lUd=!1;this.o1=null;this.uFf=()=>{e.ULS.sendTraceTag(537155219,0,50,"NetworkConnectionStateManager.OnNetworkDownEvent: Network down.");this.qnc(1,!1)};this.DR=()=>{this.lla||this.PDb?window.setTimeout(()=>{this.MZd()},this.Rwf):this.MZd();this.documentVisibilityObserver.xRa(this.DR);this.xBb=!1};this.Nf=()=>{e.ULS.sendTraceTag(537155218,
0,50,`NetworkConnectionStateManager.OnEditEnded: Edit ended. IsInOfflineMode:${this.PDb}, IsInDuringWorkSilentReopenMode:${this.pmc&&!this.Uqa}`);this.PDb&&this.joe();this.pmc&&!this.Uqa&&this.goe();Fa.h(this.$).fc.Il(this.Nf);this.qcb=this.pcb=!1};this.vFf=()=>{e.ULS.sendTraceTag(537155213,0,50,"NetworkConnectionStateManager.OnNetworkResumedEvent: network was resumed.");this.qnc(1,!0);this.pcb&&!this.qcb&&Fa.h(this.$).fc.Il(this.Nf);this.pcb=!1};this.dda=(ke,te)=>{this.ynd=this.p8;this.p8=te.kCc};
this.vIf=()=>{this.$&&(this.kuc||(rb.a(this.$).MQ(fb.a.eQa).FMg(this.EFf),this.$.nl(this.ed),this.kuc=!0),this.Uqa=this.lmi(),this.qnc(2,!1))};this.EFf=()=>{var ke=rb.a(this.$).fi;const te=ke.NSg();ke=Cb.f(ke.$s.fd.errors,pe=>pe.MessageIdName);e.ULS.sendTraceTag(545842889,0,50,`NetworkConnectionStateManager.OnOpenWebMethodErrorUserAlertExecuting: IsStateUnrecoverable:${te}, IsB2W:${this.Uqa}, Errors: ${dd.a.hc(ke)}`);te&&(this.ITa?(this.Uqa=!1,this.WKe(),this.lDc()):this.Aoa&&(this.XKe(),this.lDc()))};
this.ed=()=>{this.$?(e.ULS.sendTraceTag(541193955,0,50,"NetworkConnectionStateManager.OnWorkbookOpened: Workbook opened."),this.Uqa=!1,this.c1&&this.c1.Gp&&(Ac.a.Ia(this.c1),this.c1=null),this.o1&&this.o1.Gp&&(Ac.a.Ia(this.o1),this.o1=null),this.qnc(2,!0),this.lDc()):e.ULS.sendTraceTag(537155212,0,10,"NetworkConnectionStateManager.OnWorkbookOpened: bug monitoring: EwaControl is null.")};this.TAf=()=>{this.Qvf(!0)};this.UAf=()=>{this.Qvf(!1)};this.cYb=Jd.oAi;this.t4c=Jd.connected;this.$=ec;this.Te=
ec.pa.Te;ud&&(this.Swf=new kf(ec,Vc));this.$.da.$a(291,ke=>{this.documentVisibilityObserver=ke});this.Rwf=this.$.va.ExcelNetworkCheckAfterTabActivationDelayMs;this.Te.Ure(this.uFf);this.Te.wob(this.vFf);this.Te.hre(this.TAf);this.Te.kMg(this.UAf);new $a(this.$,this);this.xsf=this.$.va.LongInactivityTimePeriodSeconds;this.$.ea.RXc(this.vIf);this.$.ea.Re.pha(this.dda);this.a$f=this.$.va.SilentReopenDuringWorkDelayMs}get qoi(){return this.Uqa}get PDb(){return!(this.cYb&1)}get pmc(){return!(this.cYb&
2)}get lla(){return!!(this.t4c&2)}dispose(){this.Te&&(this.Te.TVf(this.uFf),this.Te.gKb(this.vFf),this.Te.oVf(this.TAf),this.Te.gjj(this.UAf));this.xBb&&this.documentVisibilityObserver&&(this.documentVisibilityObserver.xRa(this.DR),this.xBb=!1);this.$&&(this.kuc&&this.lDc(),this.$.ea&&(this.$.ea.fWf(this.vIf),this.$.ea.Re&&this.$.ea.Re.KAa(this.dda)));this.o1&&(this.o1.dispose(),this.o1=null);Ac.a.Ia(this.Swf);this.$=null;super.dispose()}zGi(){this.lUd=!0}goe(){this.Aoa||(this.Aoa=Ke.a(this.$).Xf.oZa(3,
"NetworkConnectionStateManager.ActivateDuringWorkSilentReopenPartialInteractivity"))}lmi(){if(this.lUd)return this.lUd=!1,!0;const ec=this.p8>this.xsf||this.ynd>this.xsf&&10>this.p8;e.ULS.sendTraceTag(537155223,0,50,`NetworkConnectionStateManager.IsBackToWorkSilentReopen: Inactivity duration: Time from last activity:${this.p8}, Time gap between last two activities: ${this.ynd}. return value:${ec}`);return ec}znj(){this.o1=sa.a.instance.create(()=>{Kc.Health.instance.recordQosError(id.a.CLj,[Tc.a.Ilc],
!0,!0,!1,!1,null)},6E3,"ReportLongSilentReopenBackToWorkVeto",void 0,!0)}uHg(){this.Aoa||this.c1?e.ULS.sendTraceTag(542782155,0,10,"NetworkConnectionStateManager.ActivateSilentReopenDuringWorkWhenNeeded: Trying to activate during-work partial interactivity when we are already in this partial interactivity or there is a running timer that's going to do it soon."):this.c1=sa.a.instance.create(()=>{this.$?this.Aoa?e.ULS.sendTraceTag(537155221,0,15,"NetworkConnectionStateManager.ActivateSilentReopenDuringWorkWhenNeeded: Tried to activate SilentReopenDuringWork PI when there is already an DuringWorkSilentReopen partial interactivity object"):
Fa.h(this.$).eb?(this.pcb||(Fa.h(this.$).fc.sm(this.Nf),e.ULS.sendTraceTag(541893722,0,50,"NetworkConnectionStateManager.ActivateSilentReopenDuringWorkWhenNeeded: Registered OnEditEnded while during-work silent reopen")),this.qcb=!0,e.ULS.sendTraceTag(537155220,0,50,"NetworkConnectionStateManager.ActivateSilentReopenDuringWorkWhenNeeded: Need to init during-work silent reopen partial interactivity but the user is during a cell edit. Registered to OnEditEnded event.")):this.goe():e.ULS.sendTraceTag(537155222,
0,50,"NetworkConnectionStateManager.ActivateSilentReopenDuringWorkWhenNeeded: EwaControl is null")},this.a$f,Qa.a.zKj,void 0,!0)}Qvf(ec){this.t4c=this.Sze(2,ec,!0);this.dte()}qnc(ec,Vc){this.cYb=this.Sze(ec,Vc,!1);this.dte()}Sze(ec,Vc,ud){ud=ud?this.t4c:this.cYb;return Vc?ud|ec:ud&~ec}MZd(){const ec=!!this.xPa,Vc=!!this.ITa,ud=!!this.Aoa,ke=!!this.n5b;this.PDb&&!ec?this.tHg():!this.PDb&&ec&&this.Njh();!this.pmc||Vc||ud?this.pmc||(Vc?this.WKe():(ud||this.c1&&this.c1.Gp)&&this.XKe()):this.Uqa?this.rHg():
this.c1||this.uHg();this.lla&&!ke?this.feg(!0):!this.lla&&ke&&this.feg(!1)}tHg(){this.$?this.xPa?e.ULS.sendTraceTag(537155215,0,15,"NetworkConnectionStateManager.ActivateOfflinePartialInteractivityIfNeeded: Tried to activate offline PI when there is already an offline partial interactivity object"):Fa.h(this.$).eb?(this.qcb||(Fa.h(this.$).fc.sm(this.Nf),e.ULS.sendTraceTag(537155217,0,50,"NetworkConnectionStateManager.ActivateOfflinePartialInteractivityIfNeeded: Registered OnEditEnded during offline mode")),
this.pcb=!0,e.ULS.sendTraceTag(537155216,0,50,"NetworkConnectionStateManager.ActivateOfflinePartialInteractivityIfNeeded: Turned offline while user is editing a cell, registered to OnEditEnded event.")):this.joe():e.ULS.sendTraceTag(537155214,0,50,"NetworkConnectionStateManager.ActivateOfflinePartialInteractivityIfNeeded: EwaControl is null")}joe(){this.xPa||(this.xPa=Ke.a(this.$).Xf.oZa(5,"NetworkConnecStateManager.ActivateOfflinePartialInteractivity"))}Njh(){this.xPa&&(Ac.a.Ia(this.xPa),this.xPa=
null)}WKe(){this.ITa&&(Ac.a.Ia(this.ITa),this.ITa=null);this.o1&&this.o1.Gp&&this.o1.cancel();this.o1=null}XKe(){this.Aoa&&(Ac.a.Ia(this.Aoa),this.Aoa=null);this.c1&&(Ac.a.Ia(this.c1),this.c1=null);this.qcb&&!this.pcb&&Fa.h(this.$).fc.Il(this.Nf);this.qcb=!1}rHg(){this.ITa||(this.ITa=Ke.a(this.$).Xf.oZa(2,"NetworkConnectionStateManager.ActivateLongInactivitySilentReopenPartialInteractivity",void 0,Vd.a.instance.ga(2180)));this.znj()}feg(ec){ec?(this.n5b=Ke.a(this.$).Xf.oZa(4,"NetworkConnectionStateManager.ConnectivityIssues"),
this.F$i()):(Ac.a.Ia(this.n5b),this.n5b=null)}F$i(){if(this.$&&this.$.pa){const ec=this.$.pa.ya.Wb();na.I(this.$.pa.ya,null,null,null,ec)}}lDc(){rb.a(this.$).MQ(fb.a.eQa).hr(this.EFf);this.$.Kl(this.ed);this.kuc=!1}dte(){this.documentVisibilityObserver||e.ULS.sendTraceTag(537155211,0,15,"NetworkConnectionStateManager.AdjustPartialInteractivityStateWhenPossible: Document visibility observer is null while it shouldn't be.");this.documentVisibilityObserver&&this.documentVisibilityObserver.si?this.xBb||
(this.documentVisibilityObserver.LGa(this.DR),this.xBb=!0,e.ULS.sendTraceTag(541193954,0,50,"NetworkConnectionStateManager.AdjustPartialInteractivityStateWhenPossible: tabbed out user, will update the partial interactivity state when the user will be back.")):this.MZd()}}Object(b.a)(Zb,"NetworkConnectionStateManager",dc.a,[373,2]);class Da extends ia.a{constructor(ec){super();this.$=ec;this.Fb()}create(){Vb.TaskExtensions.Aa(td.GetServiceTaskFactory.Oa(this.$.da,395,396,this.Ya),ec=>{let Vc=Object(la.a)(this.$.da,
400,()=>new Zb(this.$,ec.result));this.ob(Vc)},this.$.la,3)}static ka(ec){ec.da.Ga(401,new Da(ec))}}Object(b.a)(Da,"NetworkConnectionStateManagerFactory",ia.a,[]);var Pa=a(1254),tb=a(1158),Ib=a(1215),Yb=a(120),vc=a(106),Zc=a(147),nd=a(323);class hd{constructor(ec){this.VDb=this.gyd=this.WOa=this.Bmc=0;this.$xd=this.Itf=null;ec?(this.Jmc=ec,this.rtb=Date.now,this.vfh(),this.dgj()):e.ULS.sendTraceTag(520955213,209,10,"Can not initialize PenMinutesManager because TaskManager is null")}mAj(){this.Itf=
"Office.Excel.Online.Data.Activity.PenMinutes"}dgj(){window.document.body.addEventListener("pointerenter",Object(A.a)(this,this.kqc,"onPointerEnter"));window.document.body.addEventListener("pointerleave",Object(A.a)(this,this.k0,"onPointerLeave"))}kqc(ec){"pen"!==ec.pointerType||this.WOa||(this.WOa=Math.floor(this.rtb()/1E3),this.WOa<=this.Bmc&&(this.WOa=this.Bmc),this.gyd=0)}k0(ec){"pen"===ec.pointerType&&(ec=Math.ceil(this.rtb()/1E3),this.WOa&&ec>this.Bmc&&(this.gyd=ec,this.VDb+=this.gyd-this.WOa),
this.Bmc=ec,this.WOa=0)}vfh(){this.$xd=new vc.a(4,2,6E4,Object(A.a)(this,this.tDi,"logPenUsage"));this.Jmc.Cg(this.$xd)}tDi(){0<this.VDb&&this.rvj(this.VDb);this.VDb=0}rvj(ec){const Vc=new nd.a;Vc.name=this.Itf;const ud=[];(ec=Yb.a.oh("PenInputSec",ec.toString(),3))&&Array.add(ud,ec);Vc.dataFields=ud;Zc.a.sendActivityEvent(Vc)}dispose(){this.Jmc.np(this.$xd)}}Object(b.a)(hd,"PenMinutesManager",null,[287]);class Ud{constructor(){this.SQc=this.gb=null}get name(){return"Common.App.PenMinutesManager"}Vh(ec){this.gb=
ec;const Vc=f.AFrameworkApplication.Fi;this.gb.register(287,"Common.App.PenMinutesManager.IPenMinutesManager").xc().Fc(()=>new hd(Vc))}init(){this.SQc=this.gb.resolve("Common.App.PenMinutesManager.IPenMinutesManager")}dispose(){this.SQc&&this.SQc.dispose()}static main(){T.a.instance.Ei(new Ud)}}Object(b.a)(Ud,"PenMinutesManagerPackage",null,[4,5]);class ee extends ia.a{constructor(ec){super();this.$=ec;this.Fb()}static ka(ec){ec.da.Ga(514,new ee(ec))}create(){this.ob(Object(la.a)(this.$.da,513,()=>
{Type.registerNamespace("Common.App.PenMinutesManager");Ud.main();const ec=ea.a.instance.resolve("Common.App.PenMinutesManager.IPenMinutesManager");ec.mAj();return ec}))}}Object(b.a)(ee,"PenMinutesFactory",ia.a,[]);Type.registerNamespace("Microsoft.Office.Excel.WebUI.Client.InsertPicture");Type.registerNamespace("_Ewa");Object(c.a)();Object(Ka.a)();Object(Oa.a)();Object(wa.a)();Object(qa.a)();Object(fa.a)();Object(ua.a)();Object(Ib.a)();Type.registerNamespace("Common.App.InProductMessaging");va.main();
Type.registerNamespace("Common.App.FirstRunExperienceLauncher");ka.main();(()=>{aa.a.Fa(()=>{aa.a.Fa(Xa.ka)})})();(()=>{aa.a.Fa(()=>{aa.a.Fa(xa.ka)})})();aa.a.Fa(Pb.ka);aa.a.Fa(Da.ka);(()=>{aa.a.Fa(ec=>{ee.ka(ec)})})();Object(Pa.a)();Object(tb.a)()},850:function(u,D,a){a.r(D);u=a(0);var c=a(7),b=a(15),e=a(321),f=a(29),d=a(11),h=a(314);class m{constructor(){this.scenario=null;this.timeElapsed=0;this.isNewSession=!1;this.rawData=null}}Object(u.a)(m,"ConnectionErrorLogInfo",null,[]);var l=a(1115),v=
a(1264);class t{constructor(r){this.Kmd=[l.a.vng,l.a.QFc];this.Yn=(n,w)=>{this.yO[w]=n;this.Vbi()&&this.snj("OnNetworkDownImmediatePing"===n.caller)};this.mma=r;this.$=r.$;this.yO={}}Myi(){const r=v.a.Ged(this.Yn,"OnNetworkDownImmediatePing",this.$,this.Kmd);for(const n of r)n.runTest()}Vbi(){for(const r of this.Kmd)if(void 0===this.yO[r]||null===this.yO[r])return!1;return!0}snj(r){const n=this.$.Te.H5;r&&this.vOj(n);for(var w of this.Kmd)this.yO[w]=Sys.Serialization.JavaScriptSerializer.serialize(this.yO[w]);
r=Date.now();w=this.mma.Cjd(a(850).NetworkConnectionHealthChecker.ZEb).returnValue;const B=this.mma.Cjd(a(850).NetworkConnectionHealthChecker.jMb).returnValue;this.yO.isOfflineMode=n;this.yO.networkDownBBAge=-1===w?w:r-w;this.yO.transientServerCommunicationFailuresBBAge=-1===B?B:r-B;this.mma.businessBar?(this.yO.isNetworkDownBBShown=this.mma.businessBar.cF(56).toString(),this.yO.isServerErrorBBShown=this.mma.businessBar.cF(21).toString()):(this.yO.isNetworkDownBBShown="unknown",this.yO.isServerErrorBBShown=
"unknown");b.ULS.sendTraceTag(537155224,0,50,`ConnectionHealthTestsRunner.ReportPingResults: ${Sys.Serialization.JavaScriptSerializer.serialize(this.yO)}`)}vOj(r){const {NetworkConnectionHealthChecker:n}=a(850),w={};for(const B of Object.keys(this.yO)){const A=this.yO[B];w[A.testName]=A.isSuccess}w.isOfflineMode=r;this.mma.JXd(n.s4c,Sys.Serialization.JavaScriptSerializer.serialize(w))}}Object(u.a)(t,"ConnectionHealthTestsRunner",null,[]);a.d(D,"NetworkConnectionHealthChecker",function(){return z});
class z{constructor(r){this.businessBar=this.a9a=null;this.oOi=(n,w)=>{w.X8c?this.qOi(w):this.pOi(w)};this.fh=(n,w)=>{n=w.context.methodName;this.a9a&&n===this.a9a&&(b.ULS.sendTraceTag(537155230,0,50,`NetworkConnectionHealthChecker.OnWebMethodSuccess: Failed web method "${this.a9a}" has now succeeded. Querying local storage for BB showings.`),this.z9a(z.jMb,!0),this.a9a=null);this.Krf(!1);this.m5b=!1};this.Bm=(n,w)=>{f.a.ah(w.errors,[-1387426400])&&!this.m5b&&(this.m5b=!0,this.q7f()&&window.performance.mark(z.Eyf),
(new t(this)).Myi())};this.rg=()=>{this.Krf(!0);this.z9a(z.ZEb,!1);this.z9a(z.jMb,!1)};this.Aza=()=>{b.ULS.sendTraceTag(537155225,0,50,"NetworkConnectionHealthChecker.OnNetworkResumed: Network resumed for session. Querying local storage for BB showings.");this.z9a(z.ZEb,!0)};this.$=r;this.pa=this.$.pa;this.localStorage=new h.a;this.m5b=!1;this.$.ea.Kk(this.rg);this.pa.Te.wob(this.Aza);this.pa.Nq(this.fh);this.$.da.$a(5,n=>{this.businessBar=n;n.RLg(this.oOi)});this.pa.kw(this.Bm)}dispose(){this.$&&
(this.$.ea&&this.$.ea.lo(this.rg),this.pa&&(this.pa.Te.gKb(this.Aza),this.pa.jx(this.Bm),this.pa.Nr(this.fh)))}qOi(r){const n={};n.Timestamp=Date.now().toString();switch(r.r0a){case 21:this.a9a=r.data.FailedMethod;n.FailedMethod=this.a9a;this.JXd(z.jMb,JSON.stringify(n));break;case 56:this.JXd(z.ZEb,JSON.stringify(n))}}pOi(r){switch(r.r0a){case 21:this.z9a(z.jMb,!0);break;case 56:this.z9a(z.ZEb,!0)}}JXd(r,n){try{this.localStorage.re()&&this.localStorage.setItem(r,n)}catch(w){b.ULS.sendTraceTag(537155231,
0,15,`NetworkConnectionHealthChecker.StoreDataInLocalStorage: Failed to set item to local storage. reason: ${w.message||"Unknown"}`)}}Cjd(r){if(this.localStorage.re()&&(r=this.localStorage.h5a(r))&&"null"!==r){var n=JSON.parse(r);r=parseInt(n.Timestamp,10);n=Sys.Serialization.JavaScriptSerializer.serialize(n);return{returnValue:r,rawData:n}}return{returnValue:-1,rawData:null}}Krf(r){if(this.localStorage.re()){const n=this.localStorage.h5a(z.s4c);if(n&&"null"!==n){let w=-1;this.m5b&&(w=this.EUh(z.Eyf,
z.ZMi));b.ULS.sendTraceTag(537155229,0,50,`NetworkConnectionHealthChecker.LogPingResultsFromLocalStorage: Ping Results: ${Sys.Serialization.JavaScriptSerializer.serialize(n)}, Period offline: ${w}, New session: ${r}`);this.localStorage.removeItem(z.s4c)}}}EUh(r,n){if(!this.q7f())return-1;window.performance.measure(n,r);r=window.performance.getEntriesByName(n);return r.length&&r[r.length-1]?r[r.length-1].duration:(b.ULS.sendTraceTag(537155228,0,10,`NetworkConnectionHealthChecker.LogPingResultsFromLocalStorage: measure name ${n} returned no measures.`),
-1)}z9a(r,n){try{let w;const B=({rawData:w}=this.Cjd(r)).returnValue;if(-1!==B){const A=Object(c.a)(new m,{timeElapsed:Date.now()-B,scenario:r,isNewSession:!n,rawData:w});b.ULS.sendTraceTag(537155227,0,50,`NetworkConnectionHealthChecker.LogNetworkIssueBBShown: ${JSON.stringify(A)}`)}this.localStorage.removeItem(r)}catch(w){b.ULS.sendTraceTag(537155226,0,15,`NetworkConnectionHealthChecker.LogNetworkIssueBBShown: Failed to get item from local storage. reason: ${w.message||"Unknown"}`)}}q7f(){return d.HelperMethods.Y_c&&
e.a.mqb}}z.ZEb="NetworkDownBBShown";z.jMb="ServerCommunicationFailureBBShown";z.s4c="ConnectionHealthPingRsults";z.Eyf="offMoStMa";z.ZMi="offMoDuMea";Object(u.a)(z,"NetworkConnectionHealthChecker",null,[2])}}]);

//# sourceMappingURL=https://artifacts.dev.azure.com/office/_apis/symbol/symsrv/EwaDSEsNext.pi.js.map/853ccd451e09c5764bd4cbfb653c81f4/EwaDSEsNext.pi.js.map