'use strict';(window.dullscriptWebpackJsonp=window.dullscriptWebpackJsonp||[]).push([[60],{1442:function(u,D,a){a.r(D);u=a(0);var c=a(15);D=a(692);var b=a(76),e=a(37),f=a(1),d=a(471);class h{constructor(Ra,ya){this.officeScriptsCommandManager=Ra;this.$=ya}nc(){return!1}executeCommand(Ra,ya,Va){Ra=e.TaskExtensions.Rj();ya=ya.command;switch(ya){case -1342227603:f.EwaSettings.getBooleanFeatureGate(d.a.m$a,!1)||this.officeScriptsCommandManager.Blc(ya,null);break;case 1845457202:case -45542983:case 1904816141:case 1606046412:case 1043696663:case 971811139:case -2126202430:case 1623358083:this.$.Xc(2045014907,
-1,0,null),this.officeScriptsCommandManager.Blc(ya,1904816141===ya?Va[b.a.Ic].toString():null)}return Ra}wc(Ra,ya){Ra=!1;switch(ya.command){case -1342227603:Ra=!f.EwaSettings.getBooleanFeatureGate(d.a.m$a,!1)&&this.$.JV;break;case 1845457202:case -45542983:case 971811139:case -2126202430:case 1623358083:case 1904816141:case 1043696663:case 1606046412:Ra=this.$.JV}return Ra}Jc(Ra,ya,Va){return"PopulateAutomateGalleryMenu"===ya&&this.$.JV?(this.officeScriptsCommandManager.Jc(ya,Va),!0):!1}}Object(u.a)(h,
"OfficeScriptsCommandHandler",null,[165]);var m=a(460);class l extends D.a{constructor(Ra){super(Ra)}nd(){m.a(this.$,374,375,this.Ya,()=>{m.a(this.$,519,518,this.Ya,Ra=>{Ra?this.Yc([new h(Ra,this.$)]):c.ULS.sendTraceTag(512303312,0,15,"OfficeScriptsCommandManager failed to initialize.")})})}static ka(Ra){Ra.da.Ga(525,new l(Ra))}}Object(u.a)(l,"OfficeScriptsCommandHandlerFactory",D.a,[]);var v=a(222),t=a(7),z=a(4),r=a(120);class n{constructor(){this.token=null;this.timeStamp=0}}Object(u.a)(n,"AuthContext",
null,[]);var w=a(223),B=a(132),A=a(110),y=a(28),x=a(764),F=a(145),I=a(72),L=a(19);class X{constructor(Ra,ya){this.currentUserMlapiToken=this.currentUserToken=null;this.currentUserToken=Ra;this.currentUserMlapiToken=ya}}Object(u.a)(X,"UserInfo",null,[]);var P=a(188),G=a(60),C=a(33),H=a(281);class J{static yNa(Ra){return"TestHost"===Ra.va.DocumentHostInfo.HostTier}static Qqe(Ra,ya){ya.WacTaskPaneInfra=C.a.gd(Ra);ya.TaskpanelessRFB=!0;ya.SharedScriptsButton=J.xwa();ya.OfficeScriptsAutomateTask=!0;ya.DeferAdminCheck=
!0}static xwa(){return f.EwaSettings.getBooleanFeatureGate(w.a.ETd,!1)}static SMb(Ra,ya){J.yNa(Ra)&&(f.EwaSettings.getBooleanFeatureGate(w.a.ema,!1)||makerstorage.useLocalStorage(!0),makerstorage.setStorageEnvironmentOverride("local"));makerstorage.setSessionId(Ra.va.UserSessionId);makerstorage.setUserAccessInfo(new X(ya,null));makerstorage.setFlightValue(makerstorage.restApiVersionFlightKey,"1")}static K7e(Ra){if(J.yNa(Ra))return f.EwaSettings.getBooleanFeatureGate(w.a.ema,!1)?"makerservicelocal":
"localstorage";Ra=w.a.wLa();return w.a.Mxb(Ra)}static u4(Ra,ya,Va,oa,kb){const Sa=Ra.userOperationManager,U=Ra.pa;let ta=null,ub=null,hc=null;const Bc=()=>{if(Sa.Hta()||0<U.ya.XU||0<U.Mk.XU)return!1;ta&&Sa.mo(ta);ub&&U.Nr(ub);hc&&U.jx(hc);Sa.pD(new P.a(507,0,(Qa,na,ab)=>G.g(U.ya,"ExecuteRichApiRequest",oa,H.b(Qa,ya),H.a(na,Va),ab,null,0),80));return!0};Bc()||(ta=()=>{Bc()},ub=()=>{Bc()},hc=()=>{Bc()},Sa.xr(ta),U.Nq(ub),U.kw(hc));return kb.task}static IHa(Ra){Ra=Ra.pa.ya.Na(1);Ra.request={HttpMethod:"Get",
PathAndQuery:"customXmlParts/byNamespace(namespaceUri=@v)/onlyItem/xml?@v='http://schemas.microsoft.com/office/extensibility/maker/v1.0'",RequestHeaders:null,RequestBody:"",RequestFlags:256};return Ra}static Xgd(Ra){return C.a.gd(Ra)?Ra.isChromeRtl?L.a.DSe:L.a.CSe:L.a.bKa}static Djd(Ra){return C.a.gd(Ra)?L.a.Had:L.a.Gad}static wait(Ra){return new Promise(ya=>window.setTimeout(ya,Ra))}static Di(Ra,ya){ya&&Ra.push(ya)}}Object(u.a)(J,"OfficeScriptsUtil",null,[]);class M{constructor(Ra,ya){var Va,oa;
this.$=Ra;this.oAuthManager=ya;this.f3=new n;this.Ppb=null!==(oa=null===(Va=this.oAuthManager)||void 0===Va?void 0:Va.cNa())&&void 0!==oa?oa:!1}getAuthContext(){return this.f3}mba(){const Ra=y.a.Qa.zb,ya=[];if(this.oAuthManager)ya.push(Object(t.a)(new I.a,{name:"IsAuthSupported",bool:this.Ppb}));else return this.mva(ya,Ra,"need_OAuthManager","No OAuthManager");if(z.AFrameworkApplication.fa.qa("IsAnonymousUser"))return this.mva(ya,Ra,"need_user","Anonymous User");if(33E5>Date.now()-this.f3.timeStamp)return ya.push(Object(t.a)(new I.a,
{name:"UsedCachedToken",bool:!0})),F.a(B.a.H$a,!0,0,ya),Promise.resolve(Object(t.a)(new x.a,{IsSuccess:!0,Token:this.f3.token}));ya.push(Object(t.a)(new I.a,{name:"UsedCachedToken",bool:!1}));let Va=1;const oa=(kb,Sa)=>(new Promise(U=>{window.setTimeout(()=>{U(kb)},Sa)})).then(U=>{J.Di(ya,r.a.oh("Error"+Va,U.ErrorMessage,2));J.Di(ya,r.a.oh("ErrorCode"+Va,U.ErrorCode,2));Va++;return this.TPb()});return this.TPb().catch(kb=>oa(kb,200)).catch(kb=>oa(kb,400)).then(kb=>{kb.IsSuccess?(this.f3.token=kb.Token,
this.f3.timeStamp=Date.now()):(J.Di(ya,r.a.oh("Error"+Va,kb.ErrorMessage,2)),J.Di(ya,r.a.oh("ErrorCode"+Va,kb.ErrorCode,2)));ya.push(Object(t.a)(new I.a,{name:"Attempts",int64:Va}));J.Di(ya,r.a.oh("Error",kb.ErrorMessage,2));J.Di(ya,r.a.oh("ErrorCode",kb.ErrorCode,2));F.a(B.a.H$a,kb.IsSuccess,A.getElapsedMilliseconds(Ra,y.a.Qa.zb),ya);return Promise.resolve(kb)}).catch(kb=>{J.Di(ya,r.a.oh("Error"+Va,kb.ErrorMessage,2));J.Di(ya,r.a.oh("ErrorCode"+Va,kb.ErrorCode,2));ya.push(Object(t.a)(new I.a,{name:"Attempts",
int64:Va}));return this.mva(ya,Ra,kb.ErrorCode,kb.ErrorMessage)})}mva(Ra,ya,Va,oa){J.Di(Ra,r.a.oh("Error",oa,2));J.Di(Ra,r.a.oh("ErrorCode",Va,2));F.a(B.a.H$a,!1,A.getElapsedMilliseconds(ya,y.a.Qa.zb),Ra);return Promise.resolve(Object(t.a)(new x.a,{IsSuccess:!1,ErrorMessage:oa,ErrorCode:Va}))}TPb(){var Ra=w.a.Fjd();let ya=0;Ra=this.oAuthManager.UL("Maker",Ra).then(Va=>{if(Va)return!Va.IsSuccess&&this.CUd(Va)?Promise.reject(Va):Promise.resolve(Va);Va=Object(t.a)(new x.a,{IsSuccess:!1,ErrorMessage:"Missing result object",
ErrorCode:"need_result"});return Promise.reject(Va)}).catch(Va=>{let oa=new x.a;Object.getType(Va)===Object.getType(oa)?oa=Va:(oa.ErrorMessage=Va.toString(),oa.ErrorCode="exception");return Promise.reject(oa)});return Promise.race([Ra,new Promise((Va,oa)=>{ya=window.setTimeout(()=>{oa(Object(t.a)(new x.a,{IsSuccess:!1,ErrorCode:"Timeout",ErrorMessage:"Timed out waiting auth token promise"}))},2E4)})]).then(Va=>{window.clearTimeout(ya);return Va})}CUd(Ra){return"interaction_required"===Ra.ErrorCode||
"InitFailed"===Ra.ErrorCode||"invalid_resource"===Ra.ErrorCode||"login_required"===Ra.ErrorCode&&Ra.ErrorMessage.startsWith("AADSTS500341")?!1:!0}}Object(u.a)(M,"OfficeScriptsAuth",null,[368]);var S=a(815);class W{constructor(){this.Mu=null}}Object(u.a)(W,"OfficeScriptsGalleryBase",null,[]);var O=a(375),T=a(558),Y=a(1393),va=a(53),ca=a(13);a(313);var V=a(576);class ra{constructor(Ra,ya){this.officeScriptsCommandManager=Ra;this.$=ya}Led(Ra){const ya=this.officeScriptsCommandManager.Va.cq().QC();if(!J.xwa()){var Va=
ra.jF(Ra,ca.a.instance.ga(2129));this.IGa(Va,w.a.UEd,this.officeScriptsCommandManager.Od,w.a.IBd,ca.a.instance.ga(2125),this.officeScriptsCommandManager.Va);ya.MenuSectionList.push(Va)}Va=ra.jF(Ra,ca.a.instance.ga(2130));this.IGa(Va,w.a.hAd,w.a.Uw?this.officeScriptsCommandManager.Qh.nvb(this.officeScriptsCommandManager.Od):this.officeScriptsCommandManager.tg.nvb(this.officeScriptsCommandManager.Od),w.a.rFb,ca.a.instance.ga(2126),this.officeScriptsCommandManager.Va);ya.MenuSectionList.push(Va);Va=
ra.jF(Ra,ca.a.instance.ga(2131));this.IGa(Va,w.a.APd,this.officeScriptsCommandManager.Tk,w.a.rFb,"",this.officeScriptsCommandManager.Va);ya.MenuSectionList.push(Va);Va=Object(t.a)(new O.a,{Id:w.a.Rob,ExternalId:w.a.Rob,Command:"1606046412",LabelText:ca.a.instance.ga(2122),Alt:ca.a.instance.ga(2123),Image16by16:va.a.Ge(16),Image16by16Class:L.a.Kad,Visible:!0});Ra=ra.jF(Ra,null);Ra.ControlsId="myScriptsSection.Controls";if(J.xwa()){const oa=Object(t.a)(new O.a,{Id:w.a.bNb,ExternalId:w.a.bNb,Command:"1043696663",
LabelText:ca.a.instance.ga(2132),Alt:ca.a.instance.ga(2132),ExternalImageId:"PeopleSharedIcon_16",Visible:!0});Ra.ControlList.push(oa)}Ra.ControlList.push(Va);ya.MenuSectionList.push(Ra);return ya}IGa(Ra,ya,Va,oa,kb,Sa){if(Va&&0<Va.length){ya=Sa.gB(ya,1,"Size150by20").rqb();kb={};Sa={};Sa.root=ra.lZ(320,30);Sa.flexContainer=ra.Q5c(!1);Sa.label=ra.i6c(!1);kb.galleryButtonInExpanded=Sa;ya.GalleryStyle=kb;for(kb=0;kb<Va.length&&kb<oa;kb++)Sa=Va.Hw(kb),ya.GalleryItems.push(ra.RIa(Sa.id,Sa));Ra.ControlList.push(ya)}else Va=
Object(t.a)(new V.a,{Id:ya,ExternalId:ya,LabelText:kb}),Ra.ControlsId=Va.Id+".Controls",Ra.ControlList.push(Va)}static jF(Ra,ya){return Object(t.a)(new T.a,{Id:Ra,Title:ya,MenuSectionTitleFocusable:!0,ShowMenuSectionTitleBackground:!0,ShowMenuSectionTitleIcon:!0,ControlList:[]})}static RIa(Ra,ya){const Va=w.a.D_d,oa=w.a.UPd,kb=w.a.E_d,Sa=w.a.VPd;return ya?ra.Dsb(ya.shareId||ya.id,"1904816141",ya.name,ya.isShared&&!J.xwa()?Va:oa,Ra,Ra,ya.isShared&&!J.xwa()?kb:Sa):ra.Dsb("","1904816141","","",Ra,Ra)}static Dsb(Ra,
ya,Va,oa,kb=null,Sa=null,U=null){const ta={},ub={};ta.root=ra.lZ(20,20);ub.root=ra.lZ(20,20);return Object(t.a)(new Y.a,{Id:Ra,ExternalId:kb||Ra,MenuItemId:Sa||Ra,Command:ya,Icon:oa,Image:va.a.Ge(16),ImageClass:U,LabelText:Va,FullIconStyle:ta,PreviewIconStyle:ub,Alt:Va})}static Q5c(Ra){const ya={display:"flex"};Ra?ya.flexDirection="column":(ya.height="100%",ya.flexWrap="nowrap",ya.justifyContent="left",ya.alignItems="left",ya.lineHeight="normal");return ya}static i6c(Ra){const ya={margin:"0px 3px"};
Ra&&(ya["max-width"]="68px");return ya}static lZ(Ra,ya){const Va={};Va.width=Ra;Va["min-width"]=Ra;Va.height=ya;return Va}}Object(u.a)(ra,"OfficeScriptsRenderer",null,[]);class N{constructor(Ra,ya){this.scripts=Ra;this.hOb=ya}get length(){return this.scripts.length}pN(Ra){for(let ya=0;ya<this.scripts.length;ya++)if(this.scripts[ya].id===Ra||this.scripts[ya].shareId===Ra)return ya;return-1}sort(){this.hOb(this.scripts)}Lh(Ra){return-1===this.pN(Ra.id)?(this.scripts.push(Ra),!0):!1}HGa(Ra){return-1===
this.pN(Ra.id)?(this.scripts=[Ra].concat(this.scripts),!0):!1}Tzd(Ra){Ra=this.pN(Ra.id);if(-1!==Ra){for(var ya=this.scripts[Ra].lU();0<Ra;)this.scripts[Ra]=this.scripts[Ra-1],Ra--;this.scripts[0]=ya}}CX(Ra){const ya=this.pN(Ra.id);if(-1!==ya){const Va=this.scripts[ya].shareId;this.scripts[ya]=Ra;this.scripts[ya].shareId=Va}}dBb(Ra){const ya=this.pN(Ra.id);return-1!==ya?Ra.name===this.scripts[ya].name:!1}DU(Ra){Ra=this.pN(Ra);return-1!==Ra?(this.scripts.splice(Ra,1),!0):!1}clear(){this.scripts=[]}getScripts(){return this.scripts}Wm(Ra){Ra=
this.pN(Ra);return-1!==Ra?this.scripts[Ra]:null}Hw(Ra){return 0<=Ra&&this.length>Ra?this.scripts[Ra]:null}nvb(Ra){const ya=new N([],this.hOb);for(let Va=0;Va<this.scripts.length;Va++){const oa=this.scripts[Va];Ra.Wm(oa.id)||ya.Lh(oa)}return ya}wX(){const Ra=[];for(const ya of this.scripts)Ra.push(ya.Qfb());return Ra}}Object(u.a)(N,"ScriptCollection",null,[]);var ea=a(193);class Ba{constructor(Ra){this.xz=ea.b(Ra)||{};this.shareId=this.shareId||null}get id(){return this.xz.id}get shareId(){return this.xz.shareId}set shareId(Ra){this.xz.shareId=
Ra||null}get name(){return this.xz.name}get qtb(){return this.xz.dateLastPublished}get body(){return this.xz.body}get description(){return this.xz.description}get kAb(){return this.xz.isCreator}get isShared(){return!!this.shareId&&0<this.shareId.length}lU(){return new Ba(this.xz)}Qfb(){return this.xz}}Object(u.a)(Ba,"ScriptCore",null,[]);var ka=a(41);class Ka extends W{constructor(Ra,ya){super();this.$=Ra;this.Ze=ya}GLa(Ra){switch(Ra){case "1":case "2":case "3":case "4":case "5":case "6":return this.Mu.Hw(parseInt(Ra,
10)-1);default:return this.Ze.Qh.Wm(Ra)||this.Ze.tg.Wm(Ra)||this.Ze.Od.Wm(Ra)||this.Ze.Tk.Wm(Ra)}}pLa(Ra,ya){let Va=null;if(this.Ze.sV)switch(Ra){case "1":case "2":case "3":case "4":case "5":case "6":Va=this.Mu.Hw(parseInt(Ra,10)-1);break;default:Va=this.Mu.Wm(Ra)}ya[S.a.GalleryButtonProps]=ra.RIa(Ra,Va);ya[S.a.Alt]=Va?Va.name:""}Pp(Ra){this.Mu=this.aRa();this.$.af();const ya=[];J.Di(ya,r.a.oh("Operation",Ra,2));ya.push(Object(t.a)(new I.a,{name:"HasReadRecentCachedScripts",bool:this.Ze.Fka}));ya.push(Object(t.a)(new I.a,
{name:"ReadScriptsDone",bool:this.Ze.jMa}));ya.push(Object(t.a)(new I.a,{name:"ReadSamplesScriptsDone",bool:this.Ze.v7}));ya.push(Object(t.a)(new I.a,{name:"SamplesScriptCount",int64:this.Ze.Tk.length}));ya.push(Object(t.a)(new I.a,{name:"ReadRecentScriptsDone",bool:this.Ze.HW}));ya.push(Object(t.a)(new I.a,{name:"RecentScriptCount",int64:this.Ze.Qh.length}));ya.push(Object(t.a)(new I.a,{name:"ReadWorkbookScriptsDone",bool:this.Ze.Ls}));ya.push(Object(t.a)(new I.a,{name:"WorkbookScriptCount",int64:this.Ze.Od.length}));
F.a(B.a.woc,!0,0,ya)}eMa(Ra){let ya=!1,Va="";const oa=new Ba(Ra.scriptMetadata),kb={Operation:"HandleRefreshRibbonGallery"};kb.RefreshOperation=Ra.operationName;switch(Ra.operationName){case w.a.nJb:({message:Va,returnValue:ya}=this.dMa(oa));break;case w.a.lJb:({message:Va,returnValue:ya}=this.bMa(oa));break;case w.a.kJb:({message:Va,returnValue:ya}=this.aMa(oa));break;case w.a.mJb:({message:Va,returnValue:ya}=this.cMa(oa));break;case w.a.JKd:({message:Va,returnValue:ya}=this.Xkd(oa))}(kb.GalleryUpdated=
ya)?(c.ULS.sendTraceTag(512303306,0,50,`OfficeScriptsGallery: Calling UpdateToolbarsAndRibbons. Message: ${Va}`),this.Pp("RefreshGallery")):c.ULS.sendTraceTag(512303305,0,15,`OfficeScriptsGallery: Something went wrong while trying to refresh ribbon gallery.  Message: ${Va}`);kb.Message=Va;c.ULS.sendTraceTag(512303304,0,50,ka.c(kb))}aRa(){const Ra=new N([],()=>{}),ya=this.Ze.Od?this.Ze.Od.length:0,Va=this.Ze.Qh?this.Ze.Qh.length:0,oa=this.Ze.Tk?this.Ze.Tk.length:0;let kb=0,Sa=w.a.oIb;for(let U=0;U<
Sa;U++)if(U<ya)Ra.Lh(this.Ze.Od.Hw(U));else if(U-ya+kb<Va){const ta=this.Ze.Qh.Hw(U-ya+kb);this.Ze.Od.Wm(ta.id)?(kb++,U--):Ra.Lh(ta)}else U-ya-Va+kb<oa&&Ra.Lh(this.Ze.Tk.Hw(U-ya+kb-Va));return Ra}dMa(Ra){let ya;if(this.Ze.Qh.HGa(Ra))ya="";else{ya="";const Va=Ra.lU();this.Ze.Od.CX(Va);this.Ze.Od.sort();this.Ze.Qh.CX(Ra)}return{returnValue:!0,message:ya}}bMa(Ra){this.Ze.Od.DU(Ra.id);return this.Ze.Qh.DU(Ra.id)?{returnValue:!0,message:""}:{returnValue:!1,message:"Deleting a script but script could not be found in recent script collection."}}aMa(Ra){const ya=
Ra.lU();ya.shareId=null;this.Ze.Qh.HGa(ya);return this.Ze.Od.Lh(Ra)?(this.Ze.Od.sort(),{returnValue:!0,message:""}):{returnValue:!1,message:"Could not attach a script that is already attached."}}cMa(Ra){return this.Ze.Od.DU(Ra.id)?{returnValue:!0,message:""}:{returnValue:!1,message:"Detaching a script but the script could not be found in the collection."}}Xkd(Ra){const ya=Ra.lU();let Va=!1;this.Ze.Od.dBb(ya)&&(this.Ze.Od.CX(ya),this.Ze.Od.sort(),Va=!0);this.Ze.Qh.HGa(Ra)?Va=!0:this.Ze.Qh.dBb(Ra)&&
(this.Ze.Qh.CX(Ra),this.Ze.Qh.Tzd(Ra),Va=!0);return{returnValue:Va,message:""}}}Object(u.a)(Ka,"OfficeScriptsGallery",W,[]);var Oa=a(83);class wa{constructor(){this.Io=null}}Object(u.a)(wa,"OfficeScriptsLicensingBase",null,[]);class qa{constructor(Ra,ya,Va=null,oa="",kb=""){this.value=Ra;this.isSuccess=ya;this.timeStamp=Va;this.errorCode=oa;this.errorMessage=kb}}Object(u.a)(qa,"BoolResultWrapper",null,[]);class aa extends wa{constructor(Ra){super();this.$=Ra}sta(){const Ra=y.a.Qa.zb,ya=[];J.yNa(this.$)&&
(this.Io=new qa(!0,!0));return this.Io?Promise.resolve(this.Io.value):new Promise(Va=>{Oa.a.instance.Ub("Common.App.ApplicationFeatureHelper.IApplicationFeatureHelper").execute(oa=>{oa.isFeatureEnabled("ExcelOfficeScripting",!1).then(kb=>{ya.push(Object(t.a)(new I.a,{name:"IsLicensed",bool:kb}));F.a(B.a.soc,!0,A.getElapsedMilliseconds(Ra,y.a.Qa.zb),ya);this.Io=new qa(kb,!0);Va(kb)}).catch(kb=>{ya.push(Object(t.a)(new I.a,{name:"IsLicensed",bool:!1}));J.Di(ya,r.a.oh("Error",kb.toString(),2));J.Di(ya,
r.a.oh("ErrorCode","exception",2));F.a(B.a.soc,!1,A.getElapsedMilliseconds(Ra,y.a.Qa.zb),ya);this.Io=new qa(!1,!1,void 0,"exception",kb.toString());Va(!1)})})})}}Object(u.a)(aa,"OfficeScriptsLicensing",wa,[]);var ia=a(1305),Ha=a(1303),Z=a(1302),la=a(1304),Xa=a(1394),Za=a(27),xa=a(170),fa=a(570),ua=a(314);class sa{constructor(Ra,ya,Va,oa){this.q6a=Ra;this.U$b=ya;this.jW=Va;this.fZ=oa}}Object(u.a)(sa,"LaunchSDXParams",null,[]);class sb{constructor(Ra,ya,Va,oa,kb){this.actionName=Ra;this.shapeId=ya;
this.scriptLink=Va;this.clickId=oa;this.buttonText=kb}}Object(u.a)(sb,"RunfromButtonParameters",null,[]);var hb=a(58),bb=a(750),lb=a(51),Fa=a(157),Na=a(22);class Mb{constructor(){this.Qh=null;this.a5=this.v7=this.Ls=this.GW=this.VQa=this.WIb=this.UQa=this.HW=this.Fka=!1;this.n8=this.Tk=this.Od=this.tg=null}get sV(){const Ra=w.a.Uw?this.Fka:this.a5;return this.v7||Ra||this.jMa}get jMa(){return(w.a.Uw?this.HW:this.GW)&&this.Ls&&this.v7}static EWd(Ra){Ra.sort((ya,Va)=>Va.qtb-ya.qtb)}static Foa(Ra){Ra.sort((ya,
Va)=>Na.a.compare(ya.name,Va.name,!0))}static jjd(Ra){let ya,Va;Va=ya=null;if(Ra){const oa=Ra.indexOf(":");if(-1!==oa)return ya=Ra.substr(0,oa),Va=Ra.substr(oa+1),{returnValue:!0,uOb:ya,shareId:Va}}return{returnValue:!1,uOb:ya,shareId:Va}}static Sid(Ra,ya){const Va={};Va[w.a.zRb]=encodeURIComponent(Ra.workbookContext.WorkbookFileName);Va[w.a.HLb]=ya.wX();return ka.c(Va)}static YIb(Ra,ya){return e.TaskExtensions.XJ(ya.bka(w.a.Dpa),Va=>{Va=Va.result;if(""!==Va){var oa=ka.b(Va);Va=oa[w.a.HLb];if(oa[w.a.zRb]===
encodeURIComponent(Ra.workbookContext.WorkbookFileName)){oa=new N([],kb=>{Mb.Foa(kb)});for(const kb of Va)oa.Lh(new Ba(kb));oa.sort();return oa}}},Ra.la,3)}static bri(){return"undefined"!==typeof makerstorage}}Object(u.a)(Mb,"OfficeScriptsStorageBase",null,[]);var dc=a(116),Cb=a(98);class Tb extends Mb{constructor(Ra,ya){super();this.$=Ra;this.Gua=new DOMParser;this.cache=new ua.a;this.indexedDB=ya;ya.re()&&this.indexedDB.initialize("Scripts","OfficeScriptingCache");this.a5=!1;this.tg=new N([],Va=>
{Mb.EWd(Va)});this.Od=new N([],Va=>{Mb.Foa(Va)});this.Tk=new N([],Va=>{Mb.Foa(Va)});this.Qh=new N([],()=>{});this.n8=new N([],Va=>{Mb.Foa(Va)})}Jze(Ra,ya){if(this.cache.re()){const Va={};Va.TimeStamp=y.a.Qa.zb;Va.IsEnabled=ya;this.cache.vyc(Ra,hb.a.hc(Va))}}J0e(Ra){let ya=!1,Va=!1,oa=null;this.cache.re()&&(Ra=ka.b(this.cache.h5a(Ra)))&&(Va=Ra.IsEnabled,oa=new Date(Ra.TimeStamp),ya=!0);return new qa(Va,ya,oa)}XIb(Ra){const ya=y.a.Qa.zb,Va=[];return e.TaskExtensions.XJ(this.indexedDB.bka(w.a.sO),oa=>
{const kb=!this.HW||!this.Qh.length;oa=oa.result;Va.push(Object(t.a)(new I.a,{name:"ExistingScriptCount",int64:this.Qh.length}));if(""!==oa&&(oa=ka.b(oa),Va.push(Object(t.a)(new I.a,{name:"CachedScriptCount",int64:oa.length})),kb)){for(const Sa of oa)this.Qh.Lh(new Ba(Sa));this.Fka=!0;this.UQa=0<oa.length;F.a(B.a.uoc,kb,A.getElapsedMilliseconds(ya,y.a.Qa.zb),Va);this.gRa(Ra);return!0}F.a(B.a.uoc,kb,A.getElapsedMilliseconds(ya,y.a.Qa.zb),Va);return!1},this.$.la,3)}$Jd(Ra){f.EwaSettings.getBooleanFeatureGate(w.a.wHa,
!1)&&!J.xwa()&&this.cKd(Ra);w.a.Uw?this.XIb(Ra):this.YJd(Ra)}Aid(Ra,ya,Va){const oa=y.a.Qa.zb,kb=[];if(Ra&&Ra.IsSuccess){J.SMb(this.$,Ra.Token);var Sa=fa.a.create().toString();J.Di(kb,r.a.oh("CorrelationId",Sa,2));makerstorage.getRecentScripts(Sa).then(U=>{kb.push(Object(t.a)(new I.a,{name:"HasReadCachedScripts",bool:this.Fka}));this.Qh.clear();for(const ta of U)this.Qh.Lh(new Ba(ta));this.HW=this.UQa=!0;this.indexedDB.re()&&(U=hb.a.hc(this.Qh.wX()),this.indexedDB.Tna(new bb.a(w.a.sO,U)));kb.push(Object(t.a)(new I.a,
{name:"ScriptCount",int64:this.Qh.length}));F.a(B.a.Rca,!0,A.getElapsedMilliseconds(oa,y.a.Qa.zb),kb);ya.Pp(w.a.sO)}).catch(U=>{Object.getType(U)===makerstorage.StorageServiceError?(J.Di(kb,r.a.oh("Error",U.message,2)),J.Di(kb,r.a.oh("ErrorCode",`makerstorage_${U.errorCode.toString()}_${U.status.toString()}`,2)),17===U.errorCode&&Va.LJb(w.a.ZKa(this.$))):(J.Di(kb,r.a.oh("Error",U.toString(),2)),J.Di(kb,r.a.oh("ErrorCode","exception",2)));F.a(B.a.wyf,!1,A.getElapsedMilliseconds(oa,y.a.Qa.zb),kb);this.HW=
!0;ya.Pp(w.a.sO)})}else Sa=Ra?Ra.ErrorCode:"need_token",Ra=Ra?Ra.ErrorMessage:"No Access Token",kb.push(Object(t.a)(new I.a,{name:"ServiceChecked",bool:!1})),J.Di(kb,r.a.oh("Error",Ra,2)),J.Di(kb,r.a.oh("ErrorCode",Sa,2)),F.a(B.a.Rca,!1,A.getElapsedMilliseconds(oa,y.a.Qa.zb),kb),this.HW=!0,ya.Pp(w.a.sO)}ZJd(Ra,ya){const Va=new Fa.a,oa=J.IHa(this.$);J.u4(this.$,kb=>{if((kb=kb.Result)&&200===kb.ResponseStatusCode)kb=kb.ResponseBody.join(""),kb=JSON.parse(kb),Ra(this.dGd(kb.value)),Va.setResult(!0);
else{kb=kb?"RichApi_"+kb.ResponseStatusCode:"RichApiError";const Sa=[];J.Di(Sa,r.a.oh("Error","Failed to read shared script ids from document",2));J.Di(Sa,r.a.oh("ErrorCode",kb,2));this.Ls=!0;this.jU(ya,y.a.Qa.zb,0,Sa);Va.setResult(!1)}},kb=>{kb=dc.a.Oe(kb.data);c.ULS.sendTraceTag(512303303,0,15,"REST API failed to fetch the CustomXmlPart for Automate Gallery.");const Sa=[];J.Di(Sa,r.a.oh("Error","Failure using rich api: "+kb,2));J.Di(Sa,r.a.oh("ErrorCode","RichApiFailure",2));this.Ls=!0;this.jU(ya,
y.a.Qa.zb,0,Sa);Va.setResult(!1)},oa,Va)}Yid(Ra,ya,Va){const oa=y.a.Qa.zb;let kb=0,Sa=0;this.Ls=kb===Ra.count;const U=[];U.push(Object(t.a)(new I.a,{name:"ScriptIds",int64:Ra.count}));if(Ra.count)if(ya&&ya.IsSuccess){J.SMb(this.$,ya.Token);for(var ta of Ra){const ub=fa.a.create().toString();makerstorage.getSharedScript(ta.value,ub).then(hc=>{const Bc=[];Bc.push(Object(t.a)(new I.a,{name:"BodySize",int64:hc.body.length}));J.Di(U,r.a.oh("CorrelationId",ub,2));F.a(B.a.voc,!0,A.getElapsedMilliseconds(oa,
y.a.Qa.zb),Bc);kb++;hc=new Ba(hc);hc.shareId=Ra.oa(hc.id);this.Od.Lh(hc);this.Ls=kb===Ra.count;this.VQa=!0;this.jU(Va,oa,Sa,U)}).catch(hc=>{Object.getType(hc)===makerstorage.StorageServiceError?(J.Di(U,r.a.oh("Error",hc.message,2)),J.Di(U,r.a.oh("ErrorCode",`makerstorage_${hc.errorCode.toString()}_${hc.status.toString()}`,2))):(J.Di(U,r.a.oh("Error",hc.toString(),2)),J.Di(U,r.a.oh("ErrorCode","exception",2)));J.Di(U,r.a.oh("CorrelationId",ub,2));F.a(B.a.voc,!1,A.getElapsedMilliseconds(oa,y.a.Qa.zb),
[]);kb++;Sa++;this.Ls=kb===Ra.count;this.jU(Va,oa,Sa,U)}).finally(()=>{if(f.EwaSettings.getBooleanFeatureGate(w.a.wHa,!1)&&this.indexedDB.re()&&this.Ls){const hc=Mb.Sid(this.$,this.Od);this.indexedDB.Tna(new bb.a(w.a.Dpa,hc))}})}}else ta=ya?ya.ErrorCode:"need_token",J.Di(U,r.a.oh("Error",ya?ya.ErrorMessage:"No Access Token",2)),J.Di(U,r.a.oh("ErrorCode",ta,2)),this.Ls=!0,this.jU(Va,oa,Sa,U);else this.Ls=this.VQa=!0,this.jU(Va,oa,Sa,U),f.EwaSettings.getBooleanFeatureGate(w.a.wHa,!1)&&e.TaskExtensions.XJ(Mb.YIb(this.$,
this.indexedDB),ub=>{ub.result&&(this.indexedDB.U7b(w.a.Dpa),this.Od.clear(),Va.Pp("CachedScripts"))},this.$.la,3)}Kid(Ra){const ya={id:"samples-6"};ya.name=ca.a.instance.ga(2136);this.Tk.Lh(new Ba(ya));ya.id="samples-8";ya.name=ca.a.instance.ga(2137);this.Tk.Lh(new Ba(ya));ya.id="samples-2";ya.name=ca.a.instance.ga(2133);this.Tk.Lh(new Ba(ya));ya.id="samples-4";ya.name=ca.a.instance.ga(2134);this.Tk.Lh(new Ba(ya));ya.id="samples-5";ya.name=ca.a.instance.ga(2135);this.Tk.Lh(new Ba(ya));ya.id="samples-9";
ya.name=ca.a.instance.ga(2138);this.Tk.Lh(new Ba(ya));this.v7=!0;Ra.Pp("SampleScripts")}wjd(){const Ra={};Ra.id=w.a.bPb;Ra.name=ca.a.instance.ga(2139);this.n8.Lh(new Ba(Ra));Ra.id=w.a.cPb;Ra.name=ca.a.instance.ga(2140);this.n8.Lh(new Ba(Ra))}Kzj(){const Ra=w.a.wLa();Ra&&makerstorage.setStorageEnvironmentOverride(Ra)}dGd(Ra){const ya=new Cb.a;if(Ra=this.Gua.parseFromString(Ra,"text/xml").querySelector('[id="script-ids-node-id"]')){Ra=Ra.getElementsByTagName("scriptId");for(let Va=0;Va<Ra.length;Va++){const oa=
Ra[Va].getAttribute("id");if(oa){let kb,Sa;({uOb:kb,shareId:Sa}=Mb.jjd(oa)).returnValue&&ya.ia(kb,Sa)}}}return ya}cKd(Ra){const ya=y.a.Qa.zb,Va=[];e.TaskExtensions.XJ(Mb.YIb(this.$,this.indexedDB),oa=>{oa=oa.result;Va.push(Object(t.a)(new I.a,{name:"ExistingScriptCount",int64:this.Od.length}));if(oa){Va.push(Object(t.a)(new I.a,{name:"CachedScriptCount",int64:oa.length}));const kb=!this.Ls||0===this.Od.length;if(kb){for(const Sa of oa.getScripts())this.Od.Lh(Sa);this.Od.sort();F.a(B.a.G$a,kb,A.getElapsedMilliseconds(ya,
y.a.Qa.zb),Va);this.gRa(Ra);return!0}F.a(B.a.G$a,kb,A.getElapsedMilliseconds(ya,y.a.Qa.zb),Va)}else F.a(B.a.G$a,!1,A.getElapsedMilliseconds(ya,y.a.Qa.zb),Va);return!1},this.$.la,3)}YJd(Ra){const ya=y.a.Qa.zb,Va=[];e.TaskExtensions.XJ(this.indexedDB.bka(w.a.AW),oa=>{const kb=!this.GW||!this.tg.length;oa=oa.result;Va.push(Object(t.a)(new I.a,{name:"ExistingScriptCount",int64:this.tg.length}));if(""!==oa&&(oa=ka.b(oa),Va.push(Object(t.a)(new I.a,{name:"CachedScriptCount",int64:oa.length})),kb)){for(const Sa of oa)this.tg.Lh(new Ba(Sa));
this.tg.sort();F.a(B.a.toc,kb,A.getElapsedMilliseconds(ya,y.a.Qa.zb),Va);this.gRa(Ra);return!0}F.a(B.a.toc,kb,A.getElapsedMilliseconds(ya,y.a.Qa.zb),Va);return!1},this.$.la,3)}jU(Ra,ya,Va,oa){this.Ls&&(oa.push(Object(t.a)(new I.a,{name:"ScriptCount",int64:this.Od.length})),oa.push(Object(t.a)(new I.a,{name:"ScriptErrorCount",int64:Va})),F.a(B.a.xyf,!Va,A.getElapsedMilliseconds(ya,y.a.Qa.zb),oa),this.Od.sort(),Ra.Pp(w.a.Dpa))}gRa(Ra){this.a5=!0;Ra.Pp("CachedScripts")}}Object(u.a)(Tb,"OfficeScriptsStorage",
Mb,[]);class Jb{constructor(Ra,ya,Va,oa,kb,Sa,U,ta,ub){this.cache=new ua.a;this.w_=!1;this.BM={};this.$=Ra;this.pmb=Va;this.indexedDB=oa;this.CFb=kb;this.Sca=Sa;this.jza=U;this.Ze=ta;this.KD=ub;this.XMi=new ra(this,Ra);this.DMc=y.a.Qa.zb;this.vOb="";oa.re()&&(this.w_=!0,this.indexedDB.initialize(w.a.wzb,w.a.xzb));Za.a.X_c?(this.afd(),Tb.bri()&&this.G8a&&(this.vOb=J.K7e(this.$),J.yNa(this.$)?(J.SMb(this.$,"localstorageToken"),this.Sca.sta().catch(()=>{})):(this.Ze.Kzj(),this.Sca.sta().then(hc=>hc&&
this.jza.mba()).catch(hc=>{c.ULS.sendTraceTag(512303310,0,15,`OfficeScriptsCommandManager: Something went wrong while trying to check the license or fetch token. Exception: ${hc.message}`)})),this.rIj())):c.ULS.sendTraceTag(512303311,0,15,"IsOfficeScriptingEnabled: Turning off office scripting since fetch api is not supported by current browser.")}get tg(){return this.Ze.tg}get Od(){return J.xwa()?new N([],()=>{}):this.Ze.Od}get Tk(){return this.Ze.Tk}get Qh(){return this.Ze.Qh}get Va(){return this.pmb}get sV(){return this.Ze.sV}get initTime(){return this.DMc}get kR(){const Ra=
!!this.Sca.Io&&this.Sca.Io.isSuccess&&this.Sca.Io.value;return this.G8a&&Ra}get G8a(){const Ra="TestHost"===this.$.va.DocumentHostInfo.HostTier;var ya=z.AFrameworkApplication.fa.Xa("UserPrincipalName");ya=!z.AFrameworkApplication.fa.qa("IsAnonymousUser")&&!!ya&&!ya.includes("ext#")&&!ya.includes("guest#");return!Za.a.z5&&(Ra||this.jza.Ppb&&ya)}Hlf(){return this.G8a?this.Sca.sta():Promise.resolve(!1)}Jc(Ra,ya){if(!ya)return!1;ya.MenuItems=this.XMi.Led(ya.MenuId);return!0}SGd(){this.w_&&(w.a.Uw?this.Ze.XIb(this.KD).continueWith(Ra=>
{Ra.result&&this.KD.Pp(w.a.sO)}):this.Ze.$Jd(this.KD));J.yNa(this.$)?this.Hxb(Object(t.a)(new x.a,{IsSuccess:!0,Token:"FakeToken"})):this.jza.mba().then(Ra=>{this.Hxb(Ra)}).catch(()=>{})}pLa(Ra,ya,Va){if(w.a.Uw)this.KD.pLa(Ra,ya,Va);else{Va=null;if(this.Ze.sV)switch(Ra){case "1":case "2":case "3":case "4":case "5":case "6":Va=this.KD.Mu.Hw(parseInt(Ra,10)-1);break;default:Va=this.KD.Mu.Wm(Ra)}ya[S.a.GalleryButtonProps]=ra.RIa(Ra,Va);ya[S.a.Alt]=Va?Va.name:""}}eMa(Ra){if(w.a.Uw)this.KD.eMa(Ra);else{let ya=
!1,Va="";const oa=new Ba(Ra.scriptMetadata),kb={Operation:"HandleRefreshRibbonGallery"};kb.RefreshOperation=Ra.operationName;switch(Ra.operationName){case w.a.nJb:({message:Va,returnValue:ya}=this.dMa(oa));break;case w.a.lJb:({message:Va,returnValue:ya}=this.bMa(oa));break;case w.a.kJb:({message:Va,returnValue:ya}=this.aMa(oa));break;case w.a.mJb:({message:Va,returnValue:ya}=this.cMa(oa))}(kb.GalleryUpdated=ya)?(c.ULS.sendTraceTag(512303309,0,50,`OfficeScriptsCommandManager: Calling UpdateToolbarsAndRibbons. Message: ${Va}`),
this.Pp("RefreshGallery")):c.ULS.sendTraceTag(512303308,0,15,`OfficeScriptsCommandManager: Something went wrong while trying to refresh ribbon gallery.  Message: ${Va}`);kb.Message=Va;c.ULS.sendTraceTag(512303307,0,50,ka.c(kb))}}$kd(Ra,ya,Va,oa){if(f.EwaSettings.isChangeGateEnabled("OfficeVSO:6254340_ExitCellEditModeOnRFBClick")||this.$.Zp(null,!1,1023))Ra=new sb(w.a.qLb,Ra,ya,Va,oa),this.CFb.Lwa(Ra)}iyb(Ra,ya,Va){Ra=new sb(w.a.P2d,Ra,ya,Va);this.CFb.Lwa(Ra)}zkd(Ra){this.CFb.ZLa(w.a.QVd,Ra)}ykd(Ra){this.CFb.ZLa(w.a.A4c,
Ra)}Akd(Ra){this.CFb.ZLa(w.a.AXd,Ra)}Blc(Ra,ya){var Va=lb.b().uj(Ra);const oa=[];J.Di(oa,r.a.oh("SessionId",this.$.va.UserSessionId,2));J.Di(oa,r.a.oh("MenuItemId",ya,2));oa.push(Object(t.a)(new I.a,{name:"WorkbookScriptCount",int64:this.Od.length}));oa.push(Object(t.a)(new I.a,{name:"PublishedScriptCount",int64:this.tg.length}));oa.push(Object(t.a)(new I.a,{name:"RecentScriptCount",int64:this.Qh.length}));J.Di(oa,r.a.oh("Command",Va,2));ya=this.Nid(Ra,ya);if(Va=this.shd(Ra,Va,ya))J.Di(oa,r.a.oh(w.a.XC,
Va.jW.dh[w.a.XC],2)),ia.a.instance.j6(Va.U$b,"Taskpane",Va.fZ,Va.q6a,Va.jW),1904816141===Ra&&(J.Di(oa,r.a.oh("ScriptId",ya.id,2)),J.Di(oa,r.a.oh("ShareId",ya.shareId,2)),oa.push(Object(t.a)(new I.a,{name:"IsPreviewGallery",bool:!!this.KD.Mu.Wm(ya.id)})),oa.push(Object(t.a)(new I.a,{name:"IsOwner",bool:ya.kAb||!!this.tg.Wm(ya.id)})),this.$.af());F.a(B.a.zyf,void 0,void 0,oa)}shd(Ra,ya,Va){let oa=null;const kb=w.a.wq,Sa=new Ha.a(w.a.axa,w.a.Bva,w.a.locale),U=new Z.a(w.a.solutionId,OSF.StoreType.Sdx,
OSF.StoreType.Sdx,w.a.qSa),ta=new la.a;ta.dh.AdminPolicyForFeedback=ka.c(this.BM);ta.dh.DocumentHostInfo=hb.a.hc(this.$.va.DocumentHostInfo);ta.dh.CodeEditorUrl=w.a.RZ(this.$);ta.dh.MakerTestService=f.EwaSettings.getBooleanFeatureGate(w.a.ema,!1);ta.dh[w.a.fLb]=w.a.fV(this.$);ta.dh.StorageModePreference=this.vOb||"";ta.dh.Source="Ribbon";ta.dh[w.a.XOb]=hb.a.hc(kb);ta.dh[w.a.fqb]=this.$.roc?"true":"false";ta.dh[w.a.XC]=xa.a.create().toString();var ub=J.Xgd(this.$);const hc=J.Djd(this.$);ta.optionalProperties.HeaderCssClass=
ub;ta.optionalProperties.TitleCssClass=hc;ta.dh[w.a.Hyb]=ub;ta.dh[w.a.tPb]=hc;ub={};ub.ribbonCommand=ya;ub[w.a.tOb]=this.jza.getAuthContext();ub[w.a.AW]=this.Ze.WIb?this.tg.wX():null;ub[w.a.z3d]=this.Ze.VQa?this.Od.wX():null;w.a.Uw&&(ub[w.a.sO]=this.Ze.UQa?this.Qh.wX():null);ta.dh[w.a.Szb]=hb.a.hc(ub);ya={};J.Qqe(this.$,ya);ta.dh[w.a.zvb]=hb.a.hc(ya);switch(Ra){case -45542983:ta.dh.Script="";ta.dh.Destination="Editor";ta.dh.IsOwner=!0;ta.optionalProperties[Xa.a.Ri]=ca.a.instance.ga(2118);ta.optionalProperties[Xa.a.taskPaneWidth]=
kb;ta.optionalProperties[Xa.a.sourceLocationOverrideResourceId]=w.a.RZ(this.$);oa=w.a.nia;break;case -1342227603:ta.optionalProperties[Xa.a.Ri]=ca.a.instance.ga(2120);ta.optionalProperties[Xa.a.taskPaneWidth]=kb;ta.optionalProperties[Xa.a.sourceLocationOverrideResourceId]=w.a.xxb(this.$);break;case 971811139:case 1606046412:ta.dh.Script="";ta.dh.Destination="BackStage";ta.dh.IsOwner=!0;ta.optionalProperties[Xa.a.Ri]=ca.a.instance.ga(2118);ta.optionalProperties[Xa.a.taskPaneWidth]=kb;ta.optionalProperties[Xa.a.sourceLocationOverrideResourceId]=
w.a.RZ(this.$);oa=w.a.nia;break;case 1043696663:ta.dh.Script="";ta.dh.Destination="BackStage_Workbook";ta.optionalProperties[Xa.a.Ri]=ca.a.instance.ga(2118);ta.optionalProperties[Xa.a.taskPaneWidth]=kb;ta.optionalProperties[Xa.a.sourceLocationOverrideResourceId]=w.a.RZ(this.$);oa=w.a.nia;break;case 1845457202:ta.optionalProperties[Xa.a.Ri]=ca.a.instance.ga(2119);ta.optionalProperties[Xa.a.taskPaneWidth]=kb;ta.optionalProperties[Xa.a.sourceLocationOverrideResourceId]=w.a.Hdc(this.$);oa=w.a.XPd;break;
case -2126202430:case 1623358083:case 1904816141:if(Va)ta.dh.Script=hb.a.hc(Va.Qfb()),ta.dh.Destination="Details",ta.dh.IsOwner=Va.kAb||!!this.tg.Wm(Va.id),ta.optionalProperties[Xa.a.Ri]=ca.a.instance.ga(2118),ta.optionalProperties[Xa.a.taskPaneWidth]=kb,ta.optionalProperties[Xa.a.sourceLocationOverrideResourceId]=w.a.RZ(this.$),oa=w.a.nia;else return null;break;default:return null}return new sa(Sa,U,ta,oa)}rIj(){this.Hlf().then(Ra=>{Ra&&this.Ze.wjd()}).catch(()=>{})}Nid(Ra,ya){switch(Ra){case -2126202430:Ra=
this.Ze.n8.Wm(w.a.bPb);break;case 1623358083:Ra=this.Ze.n8.Wm(w.a.cPb);break;default:Ra=ya?this.GLa(ya):null}return Ra}afd(){Oa.a.instance.Ub("Common.App.ApplicationFeatureHelper.ICloudPolicySettingsHelper").execute(Ra=>{this.BM.FeedbackEnabled=!0;this.BM.ScreenshotEnabled=!0;this.BM.EmailEnabled=!0;Ra.AF("Enabled").then(ya=>{this.BM.FeedbackEnabled=ya},()=>{});Ra.AF("IncludeScreenshot").then(ya=>{this.BM.ScreenshotEnabled=ya},()=>{});Ra.AF("IncludeEmail").then(ya=>{this.BM.EmailEnabled=ya},()=>{})})}Hxb(Ra){this.Ze.Kid(this.KD);
w.a.Uw?this.Ze.Aid(Ra,this.KD,this.cache):this.nid(Ra);J.xwa()||this.Ze.ZJd(ya=>{this.Ze.Yid(ya,Ra,this.KD)},this.KD)}nid(Ra){const ya=y.a.Qa.zb,Va=[];if(Ra&&Ra.IsSuccess){J.SMb(this.$,Ra.Token);var oa=fa.a.create().toString();J.Di(Va,r.a.oh("CorrelationId",oa,2));makerstorage.getScripts(oa).then(kb=>{Va.push(Object(t.a)(new I.a,{name:"HasReadCachedScripts",bool:this.Ze.a5}));this.tg.clear();for(const Sa of kb)this.tg.Lh(new Ba(Sa));this.tg.sort();this.Ze.WIb=!0;this.Ze.GW=!0;this.w_&&(kb=hb.a.hc(this.tg.wX()),
this.indexedDB.Tna(new bb.a(w.a.AW,kb)));Va.push(Object(t.a)(new I.a,{name:"ScriptCount",int64:this.tg.length}));F.a(B.a.Rca,!0,A.getElapsedMilliseconds(ya,y.a.Qa.zb),Va);this.Pp(w.a.AW)}).catch(kb=>{Object.getType(kb)===makerstorage.StorageServiceError?(J.Di(Va,r.a.oh("Error",kb.message,2)),J.Di(Va,r.a.oh("ErrorCode",`makerstorage_${kb.errorCode.toString()}_${kb.status.toString()}`,2)),17===kb.errorCode&&this.cache.LJb(w.a.ZKa(this.$))):(J.Di(Va,r.a.oh("Error",kb.toString(),2)),J.Di(Va,r.a.oh("ErrorCode",
"exception",2)));F.a(B.a.Rca,!1,A.getElapsedMilliseconds(ya,y.a.Qa.zb),Va);this.Ze.GW=!0;this.Pp(w.a.AW)})}else oa=Ra?Ra.ErrorCode:"need_token",Ra=Ra?Ra.ErrorMessage:"No Access Token",Va.push(Object(t.a)(new I.a,{name:"ServiceChecked",bool:!1})),J.Di(Va,r.a.oh("Error",Ra,2)),J.Di(Va,r.a.oh("ErrorCode",oa,2)),F.a(B.a.Rca,!1,A.getElapsedMilliseconds(ya,y.a.Qa.zb),Va),this.Ze.GW=!0,this.Pp(w.a.AW)}GLa(Ra){if(w.a.Uw)return this.KD.GLa(Ra);switch(Ra){case "1":case "2":case "3":case "4":case "5":case "6":return this.KD.Mu.Hw(parseInt(Ra,
10)-1);default:return this.tg.Wm(Ra)||this.Od.Wm(Ra)||this.Tk.Wm(Ra)}}dMa(Ra){let ya;if(this.tg.Lh(Ra))this.tg.sort(),ya="";else{ya="";const Va=Ra.lU();this.Od.CX(Va);this.Od.sort();this.tg.CX(Ra);this.tg.sort()}return{returnValue:!0,message:ya}}bMa(Ra){this.Od.DU(Ra.id);return this.tg.DU(Ra.id)?{returnValue:!0,message:""}:{returnValue:!1,message:"Deleting a script but script could not be found in published collection."}}aMa(Ra){const ya=Ra.lU();ya.shareId=null;this.tg.Lh(ya)&&this.tg.sort();return this.Od.Lh(Ra)?
(this.Od.sort(),{returnValue:!0,message:""}):{returnValue:!1,message:"Could not attach a script that is already attached."}}cMa(Ra){return this.Od.DU(Ra.id)?{returnValue:!0,message:""}:{returnValue:!1,message:"Detaching a script but the script could not be found in the collection."}}Pp(Ra){if(w.a.Uw)this.KD.Pp(Ra);else{this.aRa();this.$.af();const ya=[];J.Di(ya,r.a.oh("Operation",Ra,2));ya.push(Object(t.a)(new I.a,{name:"HasReadCachedScripts",bool:this.Ze.a5}));ya.push(Object(t.a)(new I.a,{name:"ReadScriptsDone",
bool:this.Ze.jMa}));ya.push(Object(t.a)(new I.a,{name:"ReadSamplesScriptsDone",bool:this.Ze.v7}));ya.push(Object(t.a)(new I.a,{name:"SamplesScriptCount",int64:this.Tk.length}));ya.push(Object(t.a)(new I.a,{name:"ReadPublishedScriptsDone",bool:this.Ze.GW}));ya.push(Object(t.a)(new I.a,{name:"PublishedScriptCount",int64:this.tg.length}));ya.push(Object(t.a)(new I.a,{name:"ReadWorkbookScriptsDone",bool:this.Ze.Ls}));ya.push(Object(t.a)(new I.a,{name:"WorkbookScriptCount",int64:this.Od.length}));F.a(B.a.woc,
!0,0,ya)}}aRa(){this.KD.Mu=new N([],()=>{});const Ra=this.Od?this.Od.length:0,ya=this.tg?this.tg.length:0,Va=this.Tk?this.Tk.length:0;let oa=0;const kb=w.a.oIb;for(let Sa=0;Sa<kb;Sa++)if(Sa<Ra)this.KD.Mu.Lh(this.Od.Hw(Sa));else if(Sa-Ra+oa<ya){const U=this.tg.Hw(Sa-Ra+oa);this.Od.Wm(U.id)?(oa++,Sa--):this.KD.Mu.Lh(U)}else Sa-Ra-ya+oa<Va&&this.KD.Mu.Lh(this.Tk.Hw(Sa-Ra+oa-ya))}}Object(u.a)(Jb,"OfficeScriptsCommandManager",null,[361]);var eb=a(1360),za=a(1307),ha=a(249),fb=a(857),rb=a(50),pa=a(103),
Ma=a(21),Ja=a(1062);class Ga{constructor(Ra,ya,Va,oa){this.OV=!1;this.Tca=()=>{this.vNb()?(this.gIb(),Ma.h(this.$).Ea.WJb(this.Tca)):this.OV&&Ma.h(this.$).Ea.WJb(this.Tca)};this.SCd=(kb,Sa)=>{Object.getType(Sa)===String&&Sa.toString().endsWith(w.a.qba(this.$))&&(this.OV=!1)};this.$=Ra;this.jza=ya;this.Sca=Va;this.businessBarManager=oa;this.gTd()}Lwa(Ra){const ya=[];ya.push(Object(t.a)(new I.a,{name:"isSharedRuntimeInstanceInitialized",bool:this.OV}));J.Di(ya,r.a.oh("actionName",Ra.actionName,2));
J.Di(ya,r.a.oh(w.a.XC,Ra.clickId.toString(),2));this.OV?this.YLb(Ra):this.Mkd(Ra);F.a(B.a.Ayf,void 0,void 0,ya)}ZLa(Ra,ya){const Va={};Va[w.a.XC]=ya;this.BSa(Ra,Va)}gTd(){this.vNb()?this.gIb():Ma.h(this.$).Ea.eXc(this.Tca)}vNb(){if(this.OV||J.yNa(this.$))return!1;const Ra=pa.a(this.$);return Ma.h(this.$).Ea.Qob&&Ra.wgf()}gIb(){this.Sca.Io?this.Sca.Io.value&&this.jza.mba().catch(()=>{}):this.Sca.sta().then(Ra=>{Ra&&this.jza.mba().catch(()=>{})}).catch(()=>{});F.a(B.a.vyf)}PQd(){const Ra=xa.a.create().toString();
var ya={};J.Qqe(this.$,ya);const Va={};Va[w.a.tOb]=this.jza.getAuthContext();const oa={};oa[w.a.zvb]=hb.a.hc(ya);oa[w.a.Szb]=hb.a.hc(Va);oa[w.a.j9c]=hb.a.hc(this.$.va.DocumentHostInfo);oa[w.a.EXd]=J.K7e(this.$);oa[w.a.XOb]=hb.a.hc(w.a.wq);oa[w.a.fqb]=this.$.roc?"true":"false";oa[w.a.fLb]=w.a.fV(this.$);oa[w.a.Hyb]=J.Xgd(this.$);oa[w.a.tPb]=J.Djd(this.$);oa[w.a.XC]=Ra;ya=[];J.Di(ya,r.a.oh(w.a.XC,Ra,2));F.a(B.a.yyf,void 0,void 0,ya);this.BSa(w.a.$nd,oa)}Mkd(Ra){this.$Ud(Ra);J.yNa(this.$)&&J.SMb(this.$,
"localstorage");e.TaskExtensions.Aa(rb.GetServiceTaskFactory.Oa(this.$.da,374,375,1),ya=>{this.owd(ya.result).continueWith(()=>{this.OQd(Ra)});this.OV=!0},this.$.la,3)}owd(Ra){const ya={};ya.SolutionId=w.a.solutionId;ya.Version=w.a.qSa;ya.StoreType=OSF.StoreType.Sdx;ya.StoreId=OSF.StoreType.Sdx;f.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.OSFSolutionIdRefactor",!1)?(ya.AssetId=null,ya.AssetStoreId=null):(ya.AssetId=w.a.solutionId,ya.AssetStoreId=OSF.StoreType.Sdx);ya.TargetType=1;ya.SharedRuntimeId=
w.a.qba(this.$);ya.SourceLocationOverrideResourceId=w.a.qba(this.$);ya.IsToBePersisted=!1;const Va=new eb.a;Va.Ri=ca.a.instance.ga(2142);Va.taskPaneWidth=w.a.wq;const oa=new fb.a;oa.AUa=J.Djd(this.$);oa.e_=J.Xgd(this.$);return Ra.CLb(ya,Va,void 0,void 0,oa)}OQd(Ra){this.PQd();ha.a(this.$)&&ha.a(this.$).nXc(this.SCd);this.YLb(Ra)}YLb(Ra){const ya={};ya[w.a.uPd]=Ra.shapeId;ya[w.a.tPd]=Ra.scriptLink;ya[w.a.XC]=Ra.clickId.toString();ya[w.a.sPd]=Ra.buttonText;this.BSa(Ra.actionName,ya)}BSa(Ra,ya){const Va=
new Z.a(w.a.solutionId,OSF.StoreType.Sdx,OSF.StoreType.Sdx,w.a.qSa),oa=new Ha.a(w.a.axa,w.a.Bva,this.$.va.UICultureTag),kb=new la.a;kb.optionalProperties[Xa.a.Ri]=ca.a.instance.ga(2142);kb.optionalProperties[Xa.a.sourceLocationOverrideResourceId]=w.a.qba(this.$);kb.optionalProperties[Xa.a.LZb]=ya;kb.optionalProperties[Xa.a.taskPaneWidth]=w.a.wq;ia.a.instance.j6(Va,za.a.action,Ra,oa,kb)}$Ud(Ra){Ra.actionName===w.a.qLb&&(Ra=new Ja.a(Ra.scriptLink,"initializing",Ra.clickId.toString(),Ra.buttonText),
this.businessBarManager.TWc(64,Ra))}}Object(u.a)(Ga,"OfficeScriptsRunFromButton",null,[224]);var La=a(695);class nb extends v.a{constructor(Ra){super();this.$=Ra;this.Fb()}create(){const Ra=rb.GetServiceTaskFactory.Oa(this.$.da,349,350,this.Ya),ya=va.a.loadScript(133,4,this.Ya,void 0,void 0,518),Va=rb.GetServiceTaskFactory.create(this.$.da,102,this.$.la,this.Ya),oa=rb.GetServiceTaskFactory.create(this.$.da,396,this.$.la,this.Ya),kb=rb.GetServiceTaskFactory.Oa(this.$.da,5,4,this.Ya);e.TaskExtensions.Aa(e.TaskExtensions.Fd([Ra,
ya,Va,oa,kb],this.la,3),()=>{const Sa=Ra.result,U=oa.result;var ta=kb.result;const ub=new aa(this.$),hc=new M(this.$,Sa),Bc=new Tb(this.$,U),Qa=new Ka(this.$,Bc),na=new Ga(this.$,hc,ub,ta);f.EwaSettings.isChangeGateEnabled("OfficeVSO:6143820_MoveServiceRegistrationFromFAM_V2")?(ta=Object(La.a)(this.$.da,519,()=>new Jb(this.$,Sa,Va.result,U,na,ub,hc,Bc,Qa)),this.ob(ta)):this.ob(this.$.da.za(519)||new Jb(this.$,Sa,Va.result,U,na,ub,hc,Bc,Qa))},this.la,3)}static ka(Ra){Ra&&Ra.da.Ga(518,new nb(Ra))}}
Object(u.a)(nb,"OfficeScriptsCommandManagerFactory",v.a,[]);var Lb=a(9);class ac{constructor(Ra){this.$=Ra}nc(){return!1}executeCommand(Ra,ya){Ra=e.TaskExtensions.Rj();switch(ya.command){case -1342227603:this.R$h()}return Ra}wc(Ra,ya){Ra=!1;switch(ya.command){case -1342227603:Ra=!0}return Ra}Jc(){return!1}R$h(){const Ra=new Ha.a(d.a.axa,d.a.Bva,d.a.locale),ya=new Z.a(d.a.KFd,OSF.StoreType.Sdx,OSF.StoreType.Sdx,d.a.LFd),Va=new la.a;Va.optionalProperties[Xa.a.sourceLocationOverrideResourceId]=d.a.k3i;
ia.a.instance.j6(ya,"Taskpane",d.a.j3i,Ra,Va);F.a(B.a.hNf)}}Object(u.a)(ac,"PowerAutomateCommandHandler",null,[165]);class ib extends D.a{constructor(Ra){super(Ra)}nd(){m.a(this.$,374,375,this.Ya,()=>{this.Yc([new ac(this.$)])})}static ka(Ra){Ra.da.Ga(526,new ib(Ra))}}Object(u.a)(ib,"PowerAutomateCommandHandlerFactory",D.a,[]);Type.registerNamespace("_Ewa");(()=>{Lb.a.Fa(Ra=>{l.ka(Ra);nb.ka(Ra)})})();(()=>{Lb.a.Fa(Ra=>{ib.ka(Ra)})})()}}]);

//# sourceMappingURL=https://artifacts.dev.azure.com/office/_apis/symbol/symsrv/EwaDSEsNext.automate.js.map/8d11c888ae4dc91c4013ad8c48710a92/EwaDSEsNext.automate.js.map