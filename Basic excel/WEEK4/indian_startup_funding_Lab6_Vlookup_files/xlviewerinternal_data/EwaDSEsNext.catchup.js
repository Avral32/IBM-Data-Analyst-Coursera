'use strict';(window.dullscriptWebpackJsonp=window.dullscriptWebpackJsonp||[]).push([[23],{1261:function(u,D,a){u=a(0);var c=a(15),b=a(80),e=a(820),f=a(82),d=a(187),h=a(8),m=a(209),l=a(64),v=a(42),t=a(188),z=a(109),r=a(282),n=a(1),w=a(11),B=a(99),A=a(13),y=a(281),x=a(21),F=a(343);class I{constructor(J,M,S){this.yGa=J;this.Ok=M;this.HEc=S}}Object(u.a)(I,"UserActivityLocation",null,[]);var L=a(983),X=a(60);const P=(J,M,S,W,O,T=null)=>{T=J.Na(1,T);return X.g(J,"GetVersionHistoryHighlightActivitiesData",
T,M,S,W,O,4)};var G=a(760),C=a(55);a.d(D,"a",function(){return H});class H{constructor(J,M,S,W){this.authorColor=this.D2=this.efa=null;this.v8a=!1;this.i2a=-1;this.h7c=0;this.rJa=100;this.a6=-1;this.C2d=null;this.Ypb=h.a.L3j;this.eLe=h.a.M3j;this.bFb=!1;this.fh=O=>{(O=r.a(O)?null:O.Result)?O.OperationWaitingForFileDownload?20>this.h7c?(this.rJa*=2,C.Task.delay(this.rJa).continueWith(()=>{this.T_d()})):(this.XDc(),c.ULS.sendTraceTag(537150406,0,50,"VersionHistoryHighlightManager::OnWebMethodSuccess Next Operation enqueue failed")):
O.ActivityList?(this.initialize(O.ActivityList,O.VersionAuthors),n.EwaSettings.isChangeGateEnabled("OfficeVSO:4844740_ExcelVersionHistoryHighlightChangesFix")?this.$Pa():this.MNb(!0),this.C2d.stop(),c.ULS.sendTraceTag(41743369,0,50,`VersionHistoryHighlightManager: Time taken For showing diffs in Ms:${this.C2d.zc.toString()}`)):(this.XDc(),c.ULS.sendTraceTag(537150407,0,50,"VersionHistoryHighlightManager::OnWebMethodSuccess no activity list found.")):(this.rJa*=2,C.Task.delay(this.rJa).continueWith(()=>
{this.T_d()}),c.ULS.sendTraceTag(537150408,0,10,"VersionHistoryHighlightManager::OnWebMethodSuccess call returned null result."))};this.Kza=()=>{this.XDc();c.ULS.sendTraceTag(537150405,0,10,"VersionHistoryHighlightManager::OnWebMethodFailure service call failed.")};this.wud=O=>{c.ULS.sendTraceTag(537150400,0,50,`VersionHistoryHighlightManager.IterateMessageHandler called with MessageID:${O.MessageId}`);switch(O.MessageId){case L.a.iterateNext:this.iterateNext();this.a6=(this.a6+1)%this.NO.length;
this.bMb(L.a.setCurrentChangeCount,this.a6+1);break;case L.a.fya:this.fya();this.a6=0>this.a6?0:this.a6;this.a6=(this.a6+this.NO.length-1)%this.NO.length;this.bMb(L.a.setCurrentChangeCount,this.a6+1);break;case L.a.xPb:this.MNb(O.Values.ToggleValue)}};this.e8g=(O,T)=>this.$4b(O.Ok,T.Ok);this.c8g=(O,T)=>this.$4b(O.Ok,T);this.Pc=()=>{n.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.XlOnlineVHRemovingDeselectOnSelectionChanged",!1)||this.X7b()};this.Mn=()=>{this.X7b()};this.rh=()=>{this.X7b()};
c.ULS.sendTraceTag(537150411,0,50,"VersionHistoryHighlightManager::Constructor.");this.$=J;this.ariaLiveNotifier=W;this.gridView=x.h(this.$);this.gridView.ha.kH(this.Pc);this.gridView.IC(this.Mn);this.gridView.Vb.Xk(this.rh);this.z_j();this.bFb=n.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.XlOnlineVHNewIterationAlgorithm",!1);M&&(this.C2d=J.Jb.Ac("UserAction","VersionHistoryDiffManagerStopWatch"),this.T_d());if(this.Bs=S)J=b.a.oba(this.$.va.VersionHistoryActionUrl)||G.a.v$,J!==G.a.v$&&
this.Bs.CGa(J),this.Bs.uo(L.a.iterateNext),this.Bs.uo(L.a.fya),this.Bs.uo(L.a.xPb),this.Bs.em(L.a.iterateNext,this.wud),this.Bs.em(L.a.fya,this.wud),this.Bs.em(L.a.xPb,this.wud)}get dhb(){return this.D2}get WLb(){return-1===this.i2a?null:this.NO[this.i2a]}get NO(){this.v8a||(this.efa.sort(this.e8g),this.v8a=!0);return this.efa}dispose(){this.pRa();this.efa=this.D2=null;this.gridView&&(this.gridView.ha&&this.gridView.ha.mG(this.Pc),this.gridView.cE(this.Mn),this.gridView.Vb&&this.gridView.Vb.Fk(this.rh),
this.Bs&&(this.Bs.npa(L.a.fya),this.Bs.npa(L.a.iterateNext),this.Bs.npa(L.a.xPb)))}initialize(J,M){J?(this.pRa(),this.i2a=-1,this.efa=[],this.v8a=!1,this.D2={},this.authorColor={},this.nGi(M),this.Q6c(J)):c.ULS.shipAssertTag(537150410,0,!1,"VersionHistoryHighlightManager.Initialize - userActivityList was Null")}T_d(){c.ULS.sendTraceTag(537150409,0,50,`VersionHistoryHighlightManager: TryFetchUserActivityandTriggerDiff triggered: ${this.h7c.toString()} --${this.rJa.toString()}`);this.h7c++;this.$.userOperationManager.Kc(new t.a(537,
0,(J,M,S)=>P(this.$.pa.ya,y.b(J,this.fh),y.a(M,this.Kza),S,null),80),null)}MNb(J){const M=this.D2;for(let W in M){var S=W;const O=M[W];O?O.ONb(J):c.ULS.shipAssertTag(537150404,0,!1,"VersionHistoryHighlightManager.ShowOrHideAllHighlights -"+S+"view was Null")}}pRa(){const J=this.D2;for(let S in J){var M=S;const W=J[S];W?W.HLd():c.ULS.shipAssertTag(537150403,0,!1,"VersionHistoryHighlightManager.RemoveAllHighlights -"+M+"view was Null")}this.efa=this.D2=null}n1f(J){let M;if(this.bFb)M=J?this.$4e(this.a6):
this.b6e(this.a6),J=this.NO[M];else if(!({$df:M,ikg:J}=this.u_h(J,this.i2a)).returnValue)return;c.ULS.shipAssertTag(537150402,0,!!J,"VersionHistoryHighlightManager.SelectNextOrPreviousChange - userActivityLocation is null");this.X7b();if(J.yGa.toString()in this.D2){this.D2[J.yGa.toString()].ouj(J.Ok);var S=v.D(J.Ok);this.ariaLiveNotifier.setEnabled(!1);this.ariaLiveNotifier.setEnabled(!0);this.ariaLiveNotifier.readText(String.format(A.a.instance.nb(158),M+1,this.NO.length,S.Cz(!1),J.HEc.DisplayName));
this.i2a=M}else c.ULS.shipAssertTag(537150401,0,!1,`VersionHistoryHighlightManager.SelectNextOrPreviousChange - ${J.yGa.toString()} view not present in views dictionary`)}bMb(J,M){if(n.EwaSettings.ma(315))if(this.Bs){var S={};S.count=M;J=new e.a(J);J.Values=S;this.Bs.send(J)}else c.ULS.sendTraceTag(537150370,0,10,"VersionHistoryHighlightManager.SendIteratorTextUpdateMessage hostPostmessenger is null");else c.ULS.sendTraceTag(537150371,0,50,"VersionHistoryHighlightManager.SendIteratorTextUpdateMessage VersionHistoryIterator BRS is turned off")}u_h(J,
M){let S,W=!1;S=null;let O=0;for(;!W&&O<this.NO.length;){M=J?this.$4e(M):this.b6e(M);S=this.NO[M];const T=Object(f.a)(B.a,this.$.xa.getItemByName(S.Ok.SheetName));if(!T)return c.ULS.shipAssertTag(537150369,0,!1,"VersionHistoryHighlightManager.GetNextorPreviousUserActivityLocationFromIndex - useractivitylocation contains sheetrange with null sheet"),{returnValue:!1,$df:M,ikg:S};T.visible&&(W=!0);O++}return{returnValue:W,$df:M,ikg:S}}$4e(J){return this.bFb||-1!==J?(J+1)%this.NO.length:this.V4e()}b6e(J){this.bFb&&
-1===J?J=0:-1===J&&(J=this.V4e());return J=(J+this.NO.length-1)%this.NO.length}Q6c(J){this.Qhh(J);this.v6c()}I6h(J,M){const S=[];if(!J.RangeList)return c.ULS.shipAssertTag(537150368,0,!1,"VersionHistoryHighlightManager.GetUserActivityLocationFromRangeActivityLocation - ActivityLocationType.Range RangeList Null "),S;for(const W of J.RangeList)if(!W||!this.$.xa.Qk(W.SheetName))c.ULS.shipAssertTag(537150367,0,!1,"Invalid sheet name "+W.SheetName);else if(!this.bFb||this.$.xa.getItemByName(W.SheetName).visible)J=
new I(0,W,M),S.push(J);return S}Qhh(J){for(const M of J)if(!M||z.e(M.LocationList))c.ULS.sendTraceTag(537150366,0,50,"Empty Location list");else for(const S of M.LocationList)if(S)switch(S.Type){case 0:this.efa.push(...this.I6h(S,M.Person));break;default:c.ULS.sendTraceTag(537150364,0,50,"VersionHistoryHighlightManager.CreateViews Failed. Invalid ActivityLocationType")}else c.ULS.shipAssertTag(537150365,0,!1,"VersionHistoryHighlightManager.CreateUserActivityLocationList - LocationList contains Null")}v6c(){var J=
{};const M=new d.a,S=[];for(const W of this.efa){M.contains(W.HEc)||M.add(W.HEc);if(0!==W.yGa)continue;const O=new F.a(v.D(W.Ok),l.d(this.$.xa.getItemByName(W.Ok.SheetName))),T=H.fzc(O);T in J||S.push(O);J[T]=this.XRh(W.HEc)}c.ULS.sendTraceTag(42541534,0,15,`VersionHistoryHighlightManager.CreateRangeHighlightView. Total activities : ${this.efa.length}, Highlightable activities: ${S.length},Total userlist in activities : ${this.efa.length}, Total userlist from pane: ${S.length} `);this.XDc();0<S.length&&
(J=new (a(1365).RangeVersionHistoryHighlightView)(this.$,S,J,this.Ypb),this.D2["0"]=J)}XDc(){const J=this.efa?this.NO.length:0;this.bMb(L.a.setCurrentChangeCount,0);this.bMb(L.a.setTotalChangesCount,J)}$Pa(){this.bMb(L.a.$Pa,0)}nGi(J){if(J)for(let O=0;O<J.length;++O)if(n.EwaSettings.isChangeGateEnabled("OfficeVSO:5140301_HandleEmptyInitialsColor")&&!J[O].InitialsColor)c.ULS.sendTraceTag(537150362,0,15,"VersionHistoryHighlightManager.MapAuthorColorInfo: InitialsColor is null or empty for a version author");
else{var M=J[O].EmailAddress;var S=J[O].UserName;var W=null;if(J[O].LoginName){const T=J[O].LoginName.split("|");3===T.length&&(W=T[2])}W?this.authorColor[W]=J[O].InitialsColor:M?(c.ULS.sendTraceTag(537150361,0,15,"VersionHistoryHighlightManager Map Author Color: LoginName is null"),this.authorColor[M]=J[O].InitialsColor):S?(c.ULS.sendTraceTag(537150360,0,15,"VersionHistoryHighlightManager Map Author Color: Email Address is null"),this.authorColor[S]=J[O].InitialsColor):c.ULS.sendTraceTag(537150359,
0,10,"VersionHistoryHighlightManager Map Author Color: User name is null")}else c.ULS.sendTraceTag(537150363,0,15,"VersionHistoryHighlightManager.MapAuthorColorInfo: versionAuthors is null")}z_j(){if(this.$.va.VersionHistoryHighlightsSettings){var J=Array.isArray(Sys.Serialization.JavaScriptSerializer.deserialize(this.$.va.VersionHistoryHighlightsSettings))?Sys.Serialization.JavaScriptSerializer.deserialize(this.$.va.VersionHistoryHighlightsSettings):null;for(let S=0;S<J.length;S++){var M=J[S];const W=
M.key?M.key:M.Key?M.Key:"";M=M.value?M.value:M.Value?M.Value:"";"DefaultColor"===W?this.eLe=M:"InitialTint"===W?this.Ypb=M:c.ULS.sendTraceTag(537150357,0,15,"VersionHistoryHighlightManager.UpdateHighlightSettings Highlight Settings are incorrect")}}else c.ULS.sendTraceTag(537150358,0,15,"VersionHistoryHighlightManager.UpdateHighlightSettings Highlight Settings are null")}XRh(J){if(J.Email in this.authorColor)return this.authorColor[J.Email];if(J.DisplayName in this.authorColor)return this.authorColor[J.DisplayName];
c.ULS.sendTraceTag(537150356,0,15,"VersionHistoryHighlightManager GetColorFromPerson - unable to associate corresponding author in dictionary");return this.eLe}$4b(J,M){var S=Object(f.a)(B.a,this.$.xa.getItemByName(J.SheetName));const W=Object(f.a)(B.a,this.$.xa.getItemByName(M.SheetName));return S&&W?(S=(S=w.HelperMethods.LB(S.index,W.index))||w.HelperMethods.LB(J.FirstRow,M.FirstRow))||w.HelperMethods.LB(J.FirstColumn,M.FirstColumn):(c.ULS.sendTraceTag(537150355,0,10,"VersionHistoryHighlightManager.CompareSharedSheetRange - null sheet"),
0)}V4e(){var J=v.m(this.gridView.ha.ra.activeRange,this.$.xa.na);if(!J)return c.ULS.sendTraceTag(537150354,0,10,"VersionHistoryHighlightManager.GetNearestLocationIndexFromCurrentSelection - SelectedSharedSheetRange is null "),0;J=w.HelperMethods.lw(new m.a(this.NO),0,this.NO.length,J,this.c8g);0>J&&(J=~J);return J%this.NO.length}X7b(){if(this.WLb){if(!(this.WLb.yGa.toString()in this.D2)){c.ULS.shipAssertTag(537150353,0,!1,`VersionHistoryHighlightManager.DeselectCurrentlySelectedView - ${this.WLb.yGa.toString()} view not present in views dictionary`);
return}this.D2[this.WLb.yGa.toString()].Ilh(this.WLb.Ok)}this.i2a=-1}iterateNext(){this.n1f(!0)}fya(){this.n1f(!1)}static fzc(J){return`${J.range}${J.sheetId}`}}Object(u.a)(H,"VersionHistoryHighlightManager",null,[691,2])},1365:function(u,D,a){a.r(D);u=a(0);var c=a(15),b=a(8);class e{}e.bAh="ewa-vhr-rectinnerborder";Object(u.a)(e,"CssClassNames",null,[]);var f=a(64),d=a(42),h=a(198),m=a(21),l=a(343),v=a(1261);a.d(D,"RangeVersionHistoryHighlightView",function(){return t});class t{constructor(z,r,n,
w){this.Ojb=null;this.$=z;this.IDg=r;this.hTa=n;this.iTa={};this.Ypb=w;this.Cii()}get JF(){return[t.e5]}get qb(){return this.Ojb||(this.Ojb=m.h(this.$).qb)}ONb(z){z?this.qb.Tn(this.JF):this.qb.Wg(this.JF)}HLd(){this.ONb(!1);this.qb.SSa(new l.a(null,f.d(this.$.na)),this.JF)}ouj(z){if(this.hTa){var r=new l.a(d.D(z),f.d(this.$.xa.getItemByName(z.SheetName))),n=v.a.fzc(r);if(n in this.hTa)if(n in this.iTa){r=h.a.xp(this.hTa[n]);n=this.iTa[n];for(let w in n)n[w].style.backgroundColor=`rgba(${r.r},${r.g},${r.b},${b.a.N3j})`;
m.h(this.$).ha.Ra.zH(null);m.h(this.$).z9e(z,60,!0,"RangeVersionHistoryHighlightViewSelectView.SelectView")}else c.ULS.sendTraceTag(537150426,0,10,"RangeVersionHistoryHighlightView.SelectView sheetRangeToDivMap doesn't contain entry for "+n);else c.ULS.sendTraceTag(537150427,0,10,"RangeVersionHistoryHighlightView.SelectView sheetRangeToColorMap doesn't contain entry for "+n)}else c.ULS.sendTraceTag(537150428,0,10,"RangeVersionHistoryHighlightView.SelectView sheetRangeToColorMap is null")}Ilh(z){z=
new l.a(d.D(z),f.d(this.$.xa.getItemByName(z.SheetName)));var r=v.a.fzc(z);if(r in this.iTa)if(r in this.hTa){z=h.a.xp(this.hTa[r]);r=this.iTa[r];for(let n in r)r[n].style.backgroundColor=`rgba(${z.r},${z.g},${z.b},${this.Ypb})`}else c.ULS.sendTraceTag(537150424,0,10,"RangeVersionHistoryHighlightView.DeselectView sheetRangeToColorMap doesn't contain entry for "+r);else c.ULS.sendTraceTag(537150425,0,10,"RangeVersionHistoryHighlightView.DeSelectView sheetRangeToDivMap doesn't contain entry for "+r)}Cii(){this.qb.nx(this.IDg,
[t.e5],!1,(z,r)=>{if(z&&z.range&&z.sheetId&&r){var n=new l.a(z.range,z.sheetId);n=v.a.fzc(n);n in this.iTa||(this.iTa[n]={});this.iTa[n][z.paneType.toString()]=r;n in this.hTa?(z=this.hTa[n],n=h.a.xp(z),r.style.borderColor=z,r.style.backgroundColor=`rgba(${n.r},${n.g},${n.b},${this.Ypb})`,z=document.createElement("div"),z.className=e.bAh,r.appendChild(z)):c.ULS.sendTraceTag(537150419,0,10,"RangeVersionHistoryHighlightView.InitializeSheetRangeList sheetRangeToColorMap doesn't contain entry for "+n)}else c.ULS.shipAssertTag(537150423,
0,!!z,"RangeVersionHistoryHighlightView.AddSheetRangeList: state is null"),c.ULS.shipAssertTag(537150422,0,!z||!!z.range,"RangeVersionHistoryHighlightView.AddSheetRangeList: state.Range is null"),c.ULS.shipAssertTag(537150421,0,!z||!!z.sheetId,"RangeVersionHistoryHighlightView.AddSheetRangeList: state.SheetId is null"),c.ULS.shipAssertTag(537150420,0,!!r,"RangeVersionHistoryHighlightView.AddSheetRangeList: div is null")})}}t.e5=23;Object(u.a)(t,"RangeVersionHistoryHighlightView",null,[729])},1430:function(u,
D,a){a.r(D);var c=a(9),b=a(0),e=a(4),f=a(222),d=a(15),h=a(114),m=a(145),l=a(41);class v extends h.a{constructor(ba,cb,Kb,lc,Qc){super(ba,cb);this.executionContext=null;this.retryCount=0;this.DYi=Rc=>{({EOd:Rc}=this.LVj(Rc)).returnValue?Rc.Success?(m.c(2138207060,!0),d.ULS.sendTraceTag(42287318,0,15,"RestoreVersionActivity:onRestoreSuccessCallback Restore version is successful")):(m.c(2138207060,!1),d.ULS.sendTraceTag(42287317,0,10,`RestoreVersionActivity:onRestoreSuccessCallback Restore version failed with message ${Rc.Output}`),
this.hh(this.lK)):(m.c(2138207060,!1),this.hh(this.lK));(Rc=this.executionContext.activityState[v.qxd])&&Rc();this.Kp();this.executionContext.PM()};this.CYi=()=>{if(0<this.retryCount)d.ULS.sendTraceTag(537150418,0,15,`RestoreVersionActivity:onRestoreFailureCallback Retrying version restore, retry count : ${this.retryCount}`),this.retryCount--,this.eZf();else{d.ULS.sendTraceTag(42287320,0,10,"RestoreVersionActivity:onRestoreFailureCallback Restore version failed");m.c(2138207060,!1);this.hh(this.lK);
var Rc=this.executionContext.activityState[v.qxd];Rc&&Rc();this.Kp();this.executionContext.PM()}};this.lK=Kb;this.B3=lc;this.baseUrl=Qc}execute(ba){this.executionContext=ba;this.retryCount=3;this.eZf();return 1}eZf(){var ba=this.executionContext.activityState[v.ktc];const cb=`${this.baseUrl}${"restoreversion.ashx"}`,Kb={};Kb.VersionId=this.executionContext.activityState[v.klg];Kb.QuerySignature=ba;ba=l.c(Kb);this.B3.Rm(cb,2,ba,{"Content-Type":"application/json; charset=utf-8"},!1,2,this.DYi,this.CYi,
null)}LVj(ba){let cb;cb=null;ba=ba?ba.data?ba.data.te:null:null;return ba&&ba.length?({At:cb}=l.d(ba)).returnValue?{returnValue:!0,EOd:cb}:(d.ULS.sendTraceTag(537150416,0,10,"RestoreVersionActivity:TryGetRestoreResult Failed in deserialization of returned data from restore version"),{returnValue:!1,EOd:cb}):(d.ULS.sendTraceTag(537150417,0,10,"RestoreVersionActivity:TryGetRestoreResult data returned from restoreversion call is null or empty"),{returnValue:!1,EOd:cb})}}v.klg="RVAvi";v.ktc="RVAqs";v.qxd=
"RVlvrt";Object(b.a)(v,"RestoreVersionActivity",h.a,[]);var t=a(6);class z extends f.a{constructor(ba,cb,Kb){super();this.activityName=ba;this.dK=cb;this.lK=Kb;this.Fb()}create(){this.ob(new v(this.activityName,this.dK,this.lK,e.AFrameworkApplication.Bd,e.AFrameworkApplication.sa.Pa.$V))}static ka(ba){ba.da.Ga(320,new z(t.a.HOd,t.a.jj,t.a.IOd))}}Object(b.a)(z,"RestoreVersionActivityFactory",f.a,[]);class r extends h.a{constructor(ba,cb){super(ba,cb)}execute(ba){(0,ba.activityState[r.x9f])(()=>{this.Kp();
ba.PM()});return 1}}r.x9f="RVEAssea";Object(b.a)(r,"RestoreVersionErrorActivity",h.a,[]);class n extends f.a{constructor(ba,cb){super();this.activityName=ba;this.dK=cb;this.Fb()}create(){this.ob(new r(this.activityName,this.dK))}static ka(ba){ba.da.Ga(321,new n(t.a.IOd,t.a.jj))}}Object(b.a)(n,"RestoreVersionErrorActivityFactory",f.a,[]);var w=a(80),B=a(692),A=a(50),y=a(37),x=a(183),F=a(372),I=a(55);class L{constructor(ba,cb){this.$=ba;this.Q3j=cb}nc(){return e.AFrameworkApplication.fa.qa("IsAnonymousUser")?
(d.ULS.sendTraceTag(537150415,0,15,"Verison History Command Handler: Anonymous user."),!0):!1}executeCommand(ba,cb){d.ULS.sendTraceTag(537150414,0,50,"VersionHistoryCommandHandler:ExecuteCommand called.");ba=!1;switch(cb.command){case -1112508866:F.a(this.$)&&this.$.da.za(423).aAc(!1),ba=this.Q3j.oKj()}d.ULS.sendTraceTag(537150413,0,50,`VersionHistoryCommandHandler:ExecuteCommand response${ba}.`);return ba?I.Task.Ta(ba):x.a(cb.command)}wc(ba,cb){return-1112508866===cb.command&&this.$.isVersionHistoryEnabled()}Jc(){return!1}}
Object(b.a)(L,"VersionHistoryCommandHandler",null,[165]);var X=a(7),P=a(252),G=a(164),C=a(383);class H{static addAppPLTEventToLog(ba){try{Microsoft.VersionHistory.VersionHistoryLogHelper.addAppPLTEventToLog(ba)}catch(cb){}}static setIsPageLoadForFirstTime(ba){try{Microsoft.VersionHistory.VersionHistoryLogHelper.setIsPageLoadForFirstTime(ba)}catch(cb){}}}Object(b.a)(H,"VersionHistoryLogConnector",null,[]);var J=a(27),M=a(820),S=a(1239),W=a(154),O=a(91),T=a(29),Y=a(1),va=a(44),ca=a(250),V=a(983),ra=
a(259),N=a(247),ea=a(12);class Ba{constructor(ba){this.Zw=ba}ai(){ra.a(this.Zw.$).vB(this.de)||ra.a(this.Zw.$).ai(this)}z8(){ra.a(this.Zw.$).vB(this.de)&&ra.a(this.Zw.$).aA(this)}get de(){return N.a.hlg}get mc(){return document.querySelector('[id="vhHeader"]')}get Ff(){return!0}lh(ba){return ea.DOMElementExtensions.xf(this.mc,ba)}sj(){this.Zw.$.frame.Le.tk(this.Zw.$.frame.Le.qF)}Wj(){}gg(ba,cb){cb||this.Zw.VPb.then(Kb=>{Kb.enterHeaderFocusTrapZone();return null});return!cb}}Object(b.a)(Ba,"VersionHistoryHeader",
null,[39]);class ka{constructor(ba){this.Zw=ba}ai(){ra.a(this.Zw.$).vB(this.de)||ra.a(this.Zw.$).ai(this)}z8(){ra.a(this.Zw.$).vB(this.de)&&ra.a(this.Zw.$).aA(this)}get de(){return N.a.ilg}get mc(){return document.querySelector('[aria-describedby="versionHistoryPane"]')}get Ff(){return!0}lh(ba){return ea.DOMElementExtensions.xf(this.mc,ba)}sj(){this.Zw.$.frame.Le.tk(this.Zw.$.frame.Le.qF)}Wj(){}gg(ba,cb){cb||this.Zw.VPb.then(Kb=>{Kb.enterFocusTrapZone();return null});return!cb}}Object(b.a)(ka,"VersionHistoryPane",
null,[39]);class Ka{constructor(ba){this.Zw=ba}ai(){ra.a(this.Zw.$).vB(this.de)||ra.a(this.Zw.$).ai(this)}z8(){ra.a(this.Zw.$).vB(this.de)&&ra.a(this.Zw.$).aA(this)}get de(){return N.a.jlg}get mc(){return document.querySelector('[id="vhViewer"]')}get Ff(){return!0}lh(ba){return ea.DOMElementExtensions.xf(this.mc,ba)}sj(){this.Zw.$.frame.Le.tk(this.Zw.$.frame.Le.qF)}Wj(){}gg(ba,cb){cb||this.Zw.VPb.then(Kb=>{Kb.enterViewerFocusTrapZone();return null});return!cb}}Object(b.a)(Ka,"VersionHistoryViewer",
null,[39]);var Oa=a(143),wa=a(253),qa=a(69),aa=a(422),ia=a(760);class Ha{constructor(){this.actionUrl=this.ulsLogger=null;this.useFetch=this.hideEmbedFooter=!1}}Object(b.a)(Ha,"AppBootSettings",null,[]);class Z{constructor(){this.rootDiv=this.appBootSettings=null}}Object(b.a)(Z,"AppVersionControllerFactoryParameters",null,[]);class la{constructor(){this.telemetryCollector=this.baseVersionInfo=this.selectedVersionInfo=null}}Object(b.a)(la,"OnVersionSelectedParams",null,[]);class Xa{constructor(){this.appName=
0;this.wdEnableDownloadTokens=!1;this.retryCount=0;this.wdEnableIterator=this.wdEnableRestore=this.wdEnableSaveACopy=!1;this.uiLocale=this.wacCluster=this.userSessionId=null;this.disableSaveACopy=this.wdEnableShowVersionChanges=this.wdEnableHiddenButtonsUntilVersionLoadComplete=this.viewerRootPositionRelative=this.useXhr=this.isRtl=!1;this.disabledChangeGates=null;this.wdEnableDeleteVersions=this.wdEnableSaveACopyOverFlowMenu=!1;this.wdExperimentWithIteratorLocation=this.wdEnableAppColorUpdate=null}}
Object(b.a)(Xa,"AppSettings",null,[]);class Za{constructor(){this.perfTelemetryInfos=this.appSettings=this.docId=this.latestStreamServiceBase=this.serviceBase=this.ulsLogger=null}}Object(b.a)(Za,"ControllerFactoryParameters",null,[]);var xa;(function(ba){ba[ba.none=0]="none";ba[ba.vhUnknown=1]="vhUnknown";ba[ba.vhFailedToLoadVersionList=100]="vhFailedToLoadVersionList";ba[ba.vhFailedToGetDownloadToken=101]="vhFailedToGetDownloadToken";ba[ba.vhFailedToParseVersionList=102]="vhFailedToParseVersionList";
ba[ba.vhFetchFailed=103]="vhFetchFailed";ba[ba.vhVersioningNotEnabled=104]="vhVersioningNotEnabled";ba[ba.vhFileNotFound=105]="vhFileNotFound";ba[ba.vhVersionTooOld=106]="vhVersionTooOld";ba[ba.vhFetchException=107]="vhFetchException";ba[ba.vhServiceUnavailable=108]="vhServiceUnavailable";ba[ba.vhBadGateway=109]="vhBadGateway";ba[ba.vhUnauthorized=110]="vhUnauthorized";ba[ba.vhInternalServerError=111]="vhInternalServerError";ba[ba.vhEmptyVersionMetadatas=112]="vhEmptyVersionMetadatas";ba[ba.vhFailedHostDownload=
113]="vhFailedHostDownload";ba[ba.vhFailedToAddDownloadToVersionStore=114]="vhFailedToAddDownloadToVersionStore";ba[ba.vhFailedToCacheParts=115]="vhFailedToCacheParts";ba[ba.vhFailedToDownloadVersionMetadata=116]="vhFailedToDownloadVersionMetadata";ba[ba.vhFailedToDownloadParts=117]="vhFailedToDownloadParts";ba[ba.vhInvalidDocID=118]="vhInvalidDocID";ba[ba.vhMissingDocID=119]="vhMissingDocID";ba[ba.vhNullDocID=120]="vhNullDocID";ba[ba.vhNullHashedDocID=121]="vhNullHashedDocID";ba[ba.vhNullGetDownloadAccessTokenRequest=
122]="vhNullGetDownloadAccessTokenRequest";ba[ba.vhFailedToDownloadVersionFromHost=123]="vhFailedToDownloadVersionFromHost";ba[ba.vhNullResponseFromFetch=124]="vhNullResponseFromFetch";ba[ba.vhGetTipVersionException=125]="vhGetTipVersionException";ba[ba.vhGetVersionsException=126]="vhGetVersionsException";ba[ba.vhGetDownloadTokenException=127]="vhGetDownloadTokenException";ba[ba.vhFetchRetryException=128]="vhFetchRetryException";ba[ba.vhNullResponseFromRequestVersionHistory=129]="vhNullResponseFromRequestVersionHistory";
ba[ba.vhNullResponseFromRequestDownloadToken=130]="vhNullResponseFromRequestDownloadToken";ba[ba.vhXhrJsonParseFailed=131]="vhXhrJsonParseFailed";ba[ba.vhXhrException=132]="vhXhrException";ba[ba.vhNullResponseFromXhr=133]="vhNullResponseFromXhr";ba[ba.vhFileGone=134]="vhFileGone";ba[ba.vhNullRevisionIDs=135]="vhNullRevisionIDs";ba[ba.vhRequestDeleteVersionsException=136]="vhRequestDeleteVersionsException";ba[ba.vhNullResponseFromRequestDeleteVersions=137]="vhNullResponseFromRequestDeleteVersions";
ba[ba.vhVersionInfoFromTipVersionException=138]="vhVersionInfoFromTipVersionException"})(xa||(xa={}));Object(b.b)("VersionHistoryFullAppErrorCode",xa);var fa=a(302);class ua{constructor(ba){this.baseVersionInfo=this.X3=this.ypa=this.jm=this.ewaAccessibilityManager=this.VPb=null;this.oLd=this.nxf=!1;this.vKe=!0;this.dialog=this.jC=this.xYe=this.fE=this.F2d=this.D2d=this.E2d=null;this.SGf=cb=>{d.ULS.sendTraceTag(42553885,0,50,"VersionHistoryPaneActor:OnRestoreVersionSelected - Restore is triggered");
if(this.ZGj()){var Kb=Qc=>{m.c(2138207060,!1);this.jm.setRestoreFailedAtServer(Qc)};this.fE&&this.fE.startTimer(ua.Kdg);var lc=()=>{this.fE.endTimer(ua.Kdg);this.tBe(this.fE)};this.jm.setRestoreInProgress();va.a(this.$).Ks(new ca.a(t.a.hy,5,()=>{const Qc=qa.a(this.$).fd.activityState;Qc[wa.a.Kq]=t.a.mEe;Qc[Oa.a.zY]=!0;Qc[Oa.a.JT]=0;Qc[v.klg]=cb;Qc[v.ktc]=e.AFrameworkApplication.Zi;Qc[v.qxd]=lc;Qc[r.x9f]=Kb;Y.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.RestoreVersionForConvergenceExcelOnline",
!1)&&(Qc[fa.a.mFd]=!0)}))}else m.c(2138207060,!1)};this.zJf=cb=>{this.VPb.then(Kb=>{Kb.enterFocusTrapZone();return null});d.ULS.sendTraceTag(537150349,0,50,"VersionHistoryPaneActor: OnVersionsReady called");this.fE.endTimer(ua.mZd);this.fE.incrementCounter(ua.Iah);d.ULS.sendTraceTag(537150348,0,50,`VersionHistoryPaneActor: OnVersionsReady TimeTakenGetVersionsToOnVersionsReady Ms:${this.fE.getTimerDuration(ua.mZd)}`);this.eoj(cb.containerDiv);cb.versions&&0<cb.versions.length&&(this.xYe=ua.DF(cb.versions[cb.versions.length-
1]));this.X3&&this.ypa&&this.vQd(this.X3);d.ULS.sendTraceTag(537150346,0,50,"VersionHistoryPaneActor:OnVersionsReady Exit")};this.onVersionSelected=cb=>{d.ULS.sendTraceTag(537150345,0,50,`VersionHistoryPaneActor:OnVersionSelected called. for Version:${ua.DF(cb.currentVersion)}, LastSelected:${ua.DF(this.X3)}`);this.fE.incrementCounter(ua.Hah);this.X3=cb.currentVersion;this.baseVersionInfo=cb.baseVersion;this.nxf=cb.noBaseToCompareTo;this.ypa&&this.f3j()&&(this.vQd(cb.currentVersion),d.ULS.sendTraceTag(537150344,
0,50,"VersionHistoryPaneActor:OnVersionSelected Exit"))};this.BBf=cb=>{d.ULS.sendTraceTag(537150337,0,50,`VersionHistoryPaneActor:OnDownloadTokenReady called. for Version:${(null===cb||void 0===cb?0:cb.versionSelected)?ua.DF(cb.versionSelected.currentVersion):null} UpdatedVersionsCount${(null===cb||void 0===cb?0:cb.updatedVersions)?cb.updatedVersions.length:0}, LastSelected:${ua.DF(this.X3)}`);this.fE.incrementCounter(ua.Gah);if(this.baseVersionInfo){if((null===cb||void 0===cb?0:cb.updatedVersions)&&
2<=cb.updatedVersions.length){let Kb=null,lc=null;const Qc=ua.DF(this.X3),Rc=ua.DF(this.baseVersionInfo);for(const zd of cb.updatedVersions)if(cb=ua.DF(zd),Qc===cb?Kb=zd:Rc===cb&&(lc=zd),Kb&&lc)break;Kb&&lc?(this.X3=Kb,this.baseVersionInfo=lc,d.ULS.sendTraceTag(537150307,0,50,`VersionHistoryPaneActor:OnDownloadTokenReady -Calling versionsViewController:OnVersionSelected RevisionID[N]: ${ua.DF(this.X3)}, RevisionID[N-1]: ${ua.DF(this.baseVersionInfo)}.`),this.vQd(this.X3)):d.ULS.sendTraceTag(537150306,
0,50,`VersionHistoryPaneActor:OnDownloadTokenReady - does not find currentVersion or baseVersion from UpdatedVersions. RevisionID[N]: ${Qc}, RevisionID[N-1]: ${Rc}.`)}else d.ULS.sendTraceTag(537150305,0,50,"VersionHistoryPaneActor:OnDownloadTokenReady - no diff call due to downloadTokenReadyObject or downloadTokenReadyObject.UpdatedVersions objects are null or not enough.");d.ULS.sendTraceTag(537150304,0,50,"VersionHistoryPaneActor:OnDownloadTokenReady")}else d.ULS.sendTraceTag(537150336,0,50,"VersionHistoryPaneActor:OnDownloadTokenReady baseVersionInfo is null in OnDownloadTokenReady callback.")};
this.zAf=()=>{d.ULS.sendTraceTag(537150303,0,50,"VersionHistoryPaneActor:OnCloseVersionHistoryDialog Called");this.o6g();const cb=new O.a(1470556788,0,this.$.Hc,0,null);this.$.Ka.Lb(cb)};this.iHf=cb=>{d.ULS.sendTraceTag(41739662,0,50,"VersionHistoryPaneActor:OnSaveACopy Called");let Kb=new O.a(-1244760097,0,this.$.Hc,0,null);this.$.he.get(51)&&(d.ULS.sendTraceTag(537150301,0,50,"VersionHistoryPaneActor:OnSaveACopy for ODConsumer Called"),Kb=new O.a(-309686558,0,this.$.Hc,0,null));m.c(1604651619,!0);
this.$.Ka.Lb(Kb,{["FileDownloadUrl"]:cb})};this.CBf=cb=>{d.ULS.sendTraceTag(537150300,0,50,"VersionHistoryPaneActor:OnDownloadVersion Called");if(!Y.EwaSettings.isChangeGateEnabled("OfficeVSO:6794681_VHDisableDownloadACopy")||this.YGj())cb=new P.QueryStringBuilder(cb),cb.Xi("fn",e.AFrameworkApplication.fileName),d.ULS.sendTraceTag(537150299,0,50,"VersionHistoryPaneActor:OnDownloadVersion URL Length is "+cb.toString().length),8===this.$.frame.o$a(cb.toString(),!0)?(d.ULS.sendTraceTag(587830283,0,10,
"VersionHistoryPaneActor:OnDownloadVersion failed"),m.c(1316171850,!1)):m.c(1316171850,!0)};this.fzf=cb=>{this.jm.setFullAppErrorCode(cb);Y.EwaSettings.isChangeGateEnabled("OfficeVSO:6773359_ExcelVersionHistoryErrorHandlingFixes")&&this.jm.setViewerError(!0)};this.Vwe=cb=>{const Kb=document.getElementById(ua.LVe);!Kb||this.jC&&!cb||(d.ULS.sendTraceTag(537150293,0,50,"VersionHistoryPaneActor: SelectVersion Lazy instantiate VersionHistoryMessenger"),this.jC=new V.a(Kb.contentWindow,w.a.oba(this.$.va.VersionHistoryActionUrl)||
ia.a.v$),this.jC.em(G.a.tVa,this.$Ib),this.jC.em(G.a.uVa,this.$Ib),this.jC.uo(V.a.setCurrentChangeCount),this.jC.uo(V.a.setTotalChangesCount),Y.EwaSettings.isChangeGateEnabled("OfficeVSO:4844740_ExcelVersionHistoryHighlightChangesFix")&&this.jC.uo(V.a.$Pa),this.jC.em(V.a.setCurrentChangeCount,this.$Ib),this.jC.em(V.a.setTotalChangesCount,this.$Ib),Y.EwaSettings.isChangeGateEnabled("OfficeVSO:4844740_ExcelVersionHistoryHighlightChangesFix")&&this.jC.em(V.a.$Pa,this.$Ib))};this.MCf=cb=>{if(Y.EwaSettings.isChangeGateEnabled("OfficeVSO:6773359_ExcelVersionHistoryErrorHandlingFixes"))cb=
xa[cb]?xa[cb]:"None";else switch(cb){case 101:cb="VHFailedToGetDownloadToken";break;case 100:cb="VHFailedToLoadVersionList";break;case 104:cb="VHVersioningNotEnabled";break;case 105:cb="VHFileNotFound";break;case 106:cb="VHVersionTooOld";break;default:cb="None"}this.fE.addEvent("OnFullAppError",cb);d.ULS.sendTraceTag(537150291,0,10,`FullApp Error Event: ${cb}`)};this.NEd=cb=>{this.vKe=cb;d.ULS.sendTraceTag(537150290,0,50,`VersionHistoryPaneActor:Show Changes toggled to:${cb.toString()}`);this.TQd(V.a.xPb,
{["ToggleValue"]:cb})};this.dEf=cb=>{d.ULS.sendTraceTag(50405840,0,50,`VersionHistoryPaneActor:OnIteratorSelected next: ${cb}`);m.c(1488635506,!0);const Kb={};cb?this.TQd(V.a.iterateNext,Kb):this.TQd(V.a.fya,Kb)};this.$Ib=cb=>{switch(cb.MessageId){case G.a.tVa:d.ULS.sendTraceTag(537150289,0,50,"VersionHistoryPaneActor.ReceivePostMessageFromVHSession WacAppCompleted ");Y.EwaSettings.ma(416)&&this.jm.setVersionLoadComplete();break;case G.a.uVa:d.ULS.sendTraceTag(51128035,0,10,"VersionHistoryPaneActor.ReceivePostMessageFromVHSession WacAppFailed");
break;case V.a.setCurrentChangeCount:cb=cb.Values.count;d.ULS.sendTraceTag(537150288,0,50,`VersionHistoryPaneActor.ReceivePostMessageFromVHSession SetCurrentChangeCount : ${cb}`);this.jm.setCurrentChangeCount(cb);break;case V.a.setTotalChangesCount:cb=cb.Values.count;d.ULS.sendTraceTag(537150287,0,50,`VersionHistoryPaneActor.ReceivePostMessageFromVHSession SetTotalChangesCount : ${cb}`);this.jm.setTotalChangesCount(cb);break;case V.a.$Pa:this.NEd(this.vKe);break;default:d.ULS.sendTraceTag(537150286,
0,15,`VersionHistoryPaneActor.ReceivePostMessageFromVHSession MessageID:${cb.MessageId}`)}};this.$=ba;this.K$b=this.$.Eb+ua.uEh;this.nLd=!1;Y.EwaSettings.ma(382)&&this.Vhh();this.VCb="";this.mvd=0;this.perfTelemetryInfos=[]}dispose(){this.TCe()}O6i(){this.$.da.$a(15,ba=>{this.ewaAccessibilityManager=ba;this.ewaAccessibilityManager.mode=2})}Vhh(){this.E2d=new ka(this);this.D2d=new Ba(this);this.F2d=new Ka(this)}oKj(){d.ULS.sendTraceTag(41739649,0,15,"VersionHistoryPaneActor:ShowVersionHistoryDialogAction called");
e.AFrameworkApplication.ON("Microsoft.Office.Excel.Server.Flighting.IDenyListExcelVersionHistoryEnableODCSaveACopy");e.AFrameworkApplication.ON("Microsoft.Office.Excel.Server.Flighting.IDenyListVersionHistorySaveACopyOverFlowMenu");e.AFrameworkApplication.ON("Microsoft.Office.Excel.Server.Flighting.IDenyListExcelVersionHistoryRestoreSkipCoauthCheck");e.AFrameworkApplication.Rt("8492a557;72ff4572");this.fE=excelVersionHistory.FactoryGlobal.getTelemetryCollector();this.perfTelemetryInfos=[];this.fE.startTimer(ua.Jdg);
if(!this.jm&&(aa.a(()=>{this.jm=versionHistory.FactoryGlobal.getVersionHistoryControllerInstance(Object(X.a)(new Za,{ulsLogger:new C.a,docId:e.AFrameworkApplication.Zi,appSettings:Object(X.a)(new Xa,{appName:120,userSessionId:e.AFrameworkApplication.userSessionId,wdEnableSaveACopy:Y.EwaSettings.ma(351),wdEnableDownloadTokens:Y.EwaSettings.ma(346),wacCluster:e.AFrameworkApplication.Bd.lP,uiLocale:e.AFrameworkApplication.uiCulture||"en-us",wdEnableRestore:Y.EwaSettings.ma(317)&&this.$.isEditMode,wdEnableIterator:Y.EwaSettings.ma(314)&&
Y.EwaSettings.ma(315),useXhr:!1,wdEnableHiddenButtonsUntilVersionLoadComplete:Y.EwaSettings.ma(416),disableSaveACopy:this.bUd(),wdEnableShowVersionChanges:Y.EwaSettings.ma(314)&&Y.EwaSettings.ma(316),disabledChangeGates:this.$.va.VHSDisabledChangeGates,wdEnableSaveACopyOverFlowMenu:Y.EwaSettings.ma(532),isRtl:e.AFrameworkApplication.isRtl,wdExperimentWithIteratorLocation:Y.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.VersionHistoryIteratorInPane",!1)}),perfTelemetryInfos:this.perfTelemetryInfos}))}),
!this.jm))return d.ULS.sendTraceTag(537150352,0,10,"VersionHistoryPaneActor:ShowVersionHistoryDialogAction - VersionHistoryController should not be null"),m.c(429638140,!1),!1;this.pKj();this.fE.endTimer(ua.Jdg);this.fE.startTimer(ua.Mdg);d.ULS.sendTraceTag(537150351,0,50,"VersionHistoryPaneActor:ShowVersionHistoryDialogAction Returned Success");m.c(429638140,!0);return!0}pKj(){var ba;this.Ogj();if(!document.getElementById(this.K$b)){const cb=document.createElement("div");cb.id=this.K$b;cb.style.width=
"100%";cb.style.zIndex="998";cb.style.display="block";cb.style.position="absolute";if(e.AFrameworkApplication.sa.Pa.Ye){const Kb=(null===(ba=document.getElementById("HeaderRegion"))||void 0===ba?void 0:ba.offsetHeight)||0;cb.style.top=Kb+"px";cb.style.bottom="0px";cb.style.height=`calc(100vh - ${Kb}px)`}else cb.style.height="100%";this.$.yr.insertBefore(cb,this.$.yr.firstChild);this.VPb=this.jm.createVersionHistoryDialog(cb)}document.getElementById(this.K$b).style.display="block";this.cLd();this.fE.startTimer(ua.mZd);
this.jm.getVersions("")}cLd(){Y.EwaSettings.ma(382)&&(this.E2d.ai(),this.D2d.ai(),this.F2d.ai(),this.O6i())}D0d(){Y.EwaSettings.ma(382)&&(this.E2d.z8(),this.D2d.z8(),this.F2d.z8(),this.ewaAccessibilityManager&&(this.ewaAccessibilityManager.mode=0))}Ogj(){this.jm.getVersionsReadyEvent().addListener(this.zJf);this.jm.getVersionSelectedEvent().addListener(this.onVersionSelected);this.jm.getCloseSelectedEvent().addListener(this.zAf);this.jm.getFullAppErrorEvent().addListener(this.MCf);this.jm.getIteratorSelectedEvent().addListener(this.dEf);
this.jm.getShowVersionChangesToggledEvent().addListener(this.NEd);Y.EwaSettings.ma(346)&&(this.jm.getDownloadTokenReadyEvent().addListener(this.BBf),this.nLd=!0);Y.EwaSettings.ma(351)&&(this.jm.getSaveACopySelectedEvent().addListener(this.iHf),this.jm.getDownloadVersionSelectedEvent().addListener(this.CBf));Y.EwaSettings.ma(317)&&this.$.isEditMode&&(this.jm.getRestoreVersionSelectedEvent().addListener(this.SGf),this.oLd=!0)}Pgj(){this.ypa.getAppErrorEvent().addListener(this.fzf)}$j(){this.jm.getVersionsReadyEvent().removeListener(this.zJf);
this.jm.getVersionSelectedEvent().removeListener(this.onVersionSelected);this.jm.getCloseSelectedEvent().removeListener(this.zAf);this.jm.getFullAppErrorEvent().removeListener(this.MCf);this.jm.getIteratorSelectedEvent().removeListener(this.dEf);this.jm.getShowVersionChangesToggledEvent().removeListener(this.NEd);Y.EwaSettings.ma(351)&&(this.jm.getSaveACopySelectedEvent().removeListener(this.iHf),this.jm.getDownloadVersionSelectedEvent().removeListener(this.CBf));this.nLd&&(this.jm.getDownloadTokenReadyEvent().removeListener(this.BBf),
this.nLd=!1);this.oLd&&(this.jm.getRestoreVersionSelectedEvent().removeListener(this.SGf),this.oLd=!1);this.ypa&&this.ypa.getAppErrorEvent().removeListener(this.fzf)}LEj(){return this.bUd()||!e.AFrameworkApplication.yZ}YGj(){return this.LEj()?(d.ULS.sendTraceTag(520180169,0,15,"VersionHistoryPaneActor:OnDownloadVersion blocked"),m.c(1316171850,!1),!1):!0}ZGj(){let ba=!0;if(Y.EwaSettings.ma(594)&&!this.$.zN)return d.ULS.sendTraceTag(537150350,0,15,"VersionHistoryPaneActor:ShouldTriggerRestore - Skipping coauth check with status "+
this.$.ea.amIAlone.toString()),!0;if(!this.$.ea.amIAlone&&!Y.EwaSettings.ma(313)){this.OBi();this.jm.setCoauthRestoreError();ba=!1;const cb=new O.a(-729359593,0,this.$.Hc,0,null);this.$.Ka.Lb(cb)}this.$.zN&&(d.ULS.sendTraceTag(42522439,0,10,"VersionHistoryPaneActor:ShouldTriggerRestore - Restore failed, Unsaved changes present"),ba&&(ba=!1,this.nKj()));return ba}nKj(){var ba=T.a.Zc(1,0,1892,1891,0,-1603358883,"RestoreVersionUnsavedChangesError");ba=this.dialog||new W.ErrorDialog(this.$,ba);ba.initialize();
ba.ug()}f3j(){d.ULS.sendTraceTag(537150343,0,50,`VersionHistoryPaneActor:ValidateDiffDiffParameters called for BaseVersion${this.baseVersionInfo?ua.DF(this.baseVersionInfo):""}`);if(ua.DF(this.X3)===this.xYe)return d.ULS.sendTraceTag(537150342,0,15,"VersionHistoryPaneActor:ValidateDiffDiffParameters for last version"),!0;if(Y.EwaSettings.isChangeGateEnabled("OfficeVSO:4381797_XLVHSkipBaseVersionValidateForGroupingUI")&&!this.baseVersionInfo&&this.nxf)return d.ULS.sendTraceTag(537150341,0,50,"VersionHistoryPaneActor:ValidateDiffDiffParameters skipping diff last version"),
!0;if(!this.baseVersionInfo)return d.ULS.sendTraceTag(537150340,0,10,"VersionHistoryPaneActor:ValidateDiffDiffParameters for null BaseVersion"),!1;const ba=ua.AUh(this.baseVersionInfo);d.ULS.sendTraceTag(537150339,0,50,`downloadURL length ${ba?ba.length:0}`);return ba?!0:(d.ULS.sendTraceTag(537150338,0,50,"VersionHistoryPaneActor:ValidateDiffDiffParameters downloadURL is null"),!1)}bUd(){return!this.$.kla}o6g(){document.getElementById(this.K$b).style.display="none";const ba=new O.a(-1423792966,0,
this.$.Hc,0,null);this.$.Ka.Lb(ba);this.TCe()}TCe(){this.fE&&(this.fE.endTimer(ua.Mdg),this.tBe(this.fE),this.fE=null);this.$j();this.D0d();this.perfTelemetryInfos&&(d.ULS.sendTraceTag(537150302,0,15,this.perfTelemetryInfos.map(ba=>JSON.stringify(ba)).toString()),this.perfTelemetryInfos=null);this.jC&&(this.jC.npa(G.a.tVa),this.jC.npa(G.a.uVa),this.jC.npa(V.a.setCurrentChangeCount),this.jC.npa(V.a.setTotalChangesCount),Y.EwaSettings.isChangeGateEnabled("OfficeVSO:4844740_ExcelVersionHistoryHighlightChangesFix")&&
this.jC.npa(V.a.$Pa),this.jC.dispose(),this.jC=null)}eoj(ba){try{this.ypa?(H.setIsPageLoadForFirstTime(!1),Y.EwaSettings.isChangeGateEnabled("OfficeVSO:6773359_ExcelVersionHistoryErrorHandlingFixes")&&!document.getElementById(ua.LVe)&&(this.ypa.resetContainer(ba),this.Vwe(!0))):(H.setIsPageLoadForFirstTime(!0),aa.a(()=>{const cb=new Ha;cb.ulsLogger=new C.a;cb.actionUrl=this.$.va.VersionHistoryActionUrl;cb.hideEmbedFooter=!0;cb.useFetch=Y.EwaSettings.ma(411)&&!J.a.vy;this.ypa=excelVersionHistory.FactoryGlobal.getAppVersionControllerInstance(Object(X.a)(new Z,
{appBootSettings:cb,rootDiv:ba}))})),this.Pgj()}catch(cb){d.ULS.sendTraceTag(41239239,0,10,`VersionHistoryPaneActor: ResetAppVersionController failed due to exception. ${cb}`)}}vQd(ba){d.ULS.sendTraceTag(537150298,0,50,`VersionHistoryPaneActor:SelectVersion called. for Version:${ua.DF(ba)}, LastSelected:${this.VCb}`);if(ba)if(ua.DF(ba).length){var cb=(new Date).getTime();if(ua.DF(ba)===this.VCb&&1E3>cb-this.mvd)d.ULS.sendTraceTag(537150295,0,50,"VersionHistoryPaneActor:SelectVersion reattempt within 1 sec");
else{ua.DF(ba)!==this.VCb&&(d.ULS.sendTraceTag(537150294,0,50,"VersionHistoryPaneActor:Reset Iterator states if user clicks on different version"),this.jm.setTotalChangesCount(-1),this.jm.setCurrentChangeCount(-1));var Kb=excelVersionHistory.FactoryGlobal.getTelemetryCollector();Kb.addEvent("SelectVersion",ua.DF(ba));try{this.J5j(Kb);this.mvd=cb;this.VCb=ua.DF(ba);const lc=new la;lc.selectedVersionInfo=this.X3;lc.baseVersionInfo=this.baseVersionInfo;lc.telemetryCollector=Kb;this.ypa.onVersionSelectedWithParams(lc);
this.jm&&Y.EwaSettings.ma(351)&&this.jm.setDisableSaveACopy(this.bUd());this.Vwe(!1)}catch(lc){this.mvd=0,this.VCb="",Kb.addEvent("Exception",lc.toString()),d.ULS.sendTraceTag(42016832,0,10,`VersionHistoryPaneActor: OnVersionSelected failed due to exception. ${lc}`)}finally{d.ULS.sendTraceTag(537150292,0,50,Kb?Kb.getJsonForLogging():"")}}}else d.ULS.sendTraceTag(537150296,0,50,"VersionHistoryPaneActor:SelectVersion selectedVersion RevisionId is null");else d.ULS.sendTraceTag(537150297,0,50,"VersionHistoryPaneActor:SelectVersion selectedVersion is null")}J5j(ba){for(const cb of this.perfTelemetryInfos){const Kb=
cb.TelemetryEventKey?cb.TelemetryEventKey:cb.telemetryEventKey?cb.telemetryEventKey:"",lc=cb.TelemetryEventData?cb.TelemetryEventData:cb.telemetryEventData?cb.telemetryEventData:"";Kb&&lc&&ba.addEvent(Kb,lc)}this.perfTelemetryInfos.length=0}tBe(ba){d.ULS.sendTraceTag(42553886,0,15,`VersionHistoryPaneActor:CaptureSessionTelemetry - ${ba?ba.getJsonForLogging():""} `)}OBi(){const ba=this.$.ea.Ym,cb={};let Kb=null;for(const lc of ba)lc.UserEmail&&(cb[lc.UserEmail]=lc.UserEmail in cb?cb[lc.UserEmail]+
1:1),lc.User.UserID===this.$.ea.clientId&&(Kb=lc.UserEmail);d.ULS.sendTraceTag(42522438,0,10,`VersionHistoryPaneActor:LogCoauthorsTelemetry Restore failed, TotalAuthors: ${ba.length}, TotalAuthorsAsYourself ${Kb?cb[Kb]:-1}`)}TQd(ba,cb){d.ULS.sendTraceTag(537150285,0,50,`VersionHistoryPaneActor.SendPostMessageToTheVHSession called with MessageID:${ba}`);if(this.jC){ba=new M.a(ba);ba.Values[S.a.d7c]=this.$.va.UserSessionId;if(cb)for(let Kb in cb)ba.Values[Kb]=cb[Kb];this.jC.send(ba)}else d.ULS.sendTraceTag(537150284,
0,10,"VersionHistoryPaneActor.SendPostMessageToTheVHSession versionHistoryMessenger is null")}static DF(ba){return ba?ba.RevisionID?ba.RevisionID:ba.revisionID?ba.revisionID:"":""}static AUh(ba){return ba?ba.DownloadUrl?ba.DownloadUrl:ba.downloadUrl?ba.downloadUrl:"":""}}ua.uEh="_excelVersionHistoryOverlay";ua.LVe="vhs_frame";ua.Jdg="TimeTakenShowVersionHistoryDialogAction";ua.Mdg="TimeTillVersionHistoryDialogWasOpenMs";ua.mZd="TimeTakenGetVersionsToOnVersionsReady";ua.Hah="CountOnVersionSelectedCalledinOneVHSession";
ua.Iah="CountOnVersionsReadyCalledinOneVHSession";ua.Gah="CountOnDownloadTokenReadyCalledinOneVHSession";ua.Kdg="TimeTakenVersionRestore";Object(b.a)(ua,"VersionHistoryPaneActor",null,[2]);var sa=a(184);class sb extends B.a{constructor(ba){super(ba)}nd(){const ba=this.YAi(),cb=A.GetServiceTaskFactory.Oa(this.$.da,21,137,this.Ya);y.TaskExtensions.Aa(y.TaskExtensions.Fd([ba,cb],this.la,3),()=>{var Kb=cb.result;const lc=w.a.oba(this.$.va.VersionHistoryActionUrl);lc!==ia.a.v$&&Kb.CGa(lc);Kb=new ua(this.$);
this.Yc([new L(this.$,Kb)])},this.la,3)}YAi(){const ba=A.GetServiceTaskFactory.jka(this.$.da,283,284,this.Ya).then(cb=>cb.pn.loadScript("excelVersionHistory"),cb=>{d.ULS.sendTraceTag(537150412,0,10,`versionHistoryManagerFactory: Dynamic Script Loading failed due to exception. ${cb}`);return Promise.reject(cb)});return sa.c(ba)}static ka(ba){B.a.Nd(304,new sb(ba))}}Object(b.a)(sb,"VersionHistoryCommandHandlerFactory",B.a,[]);var hb=a(1261),bb=a(695);class lb extends f.a{constructor(ba){super();this.$=
ba;this.Fb()}create(){const ba=A.GetServiceTaskFactory.Oa(this.$.da,211,212,this.Ya),cb=A.GetServiceTaskFactory.Oa(this.$.da,21,137,this.Ya);y.TaskExtensions.Aa(y.TaskExtensions.Fd([ba,cb],this.$.la),()=>{const Kb=Object(bb.a)(this.$.da,305,()=>new hb.a(this.$,!0,cb.result,ba.result));this.ob(Kb)},this.$.la,3)}static ka(ba){ba.da.Ga(306,new lb(ba))}}Object(b.a)(lb,"VersionHistoryHighlightManagerFactory",f.a,[]);var Fa=a(511),Na=a(5),Mb=a(161),dc=a(13);class Cb extends h.a{constructor(ba,cb,Kb){super(ba,
cb);this.lineageManager=Kb}execute(ba){this.lineageManager.lineageHidePreviousHistory();return super.execute(ba)}}Object(b.a)(Cb,"LineageClearHistoryConfirmedActivity",h.a,[]);var Tb=a(17),Jb=a(140);class eb{constructor(ba,cb){this.$=ba;this.lineageManager=cb;ba=[new Tb.a(t.a.Yvd,1038647878,0,0,2234),new Tb.a(t.a.idle,1038647878,0,1)];qa.a(this.$).RKd(new Jb.a(t.a.Xvd,t.a.idle,ba),new Cb(t.a.Yvd,t.a.idle,cb))}nc(){return!1}executeCommand(ba,cb,Kb){ba=!1;switch(cb.command){case 1834994092:9===cb.$e&&
this.HPj();this.NHj(cb,Kb);ba=!0;break;case -409942531:this.PHj(),ba=!0}return ba?I.Task.Ta(!0):x.a(cb.command)}wc(ba,cb){return 1834994092===cb.command||-409942531===cb.command}Jc(){return!1}NHj(ba,cb){d.ULS.sendTraceTag(537155483,0,50,`LineageActivityCommandHandler::ShowChangesCore command location: ${cb.MenuItemId||ba.$e}`);this.lineageManager.V8f(19===ba.$e&&!!cb.MenuItemId,cb.MenuItemId,ba.$e,cb)}HPj(){const ba=Na.a.Ctc;ba!==Mb.a(this.$).Gm.gA&&Mb.a(this.$).Gm.activateRibbonTab(ba)}PHj(){va.a(this.$).Ks(new ca.a(t.a.Xvd,
5,()=>{const ba=qa.a(this.$).fd,cb=T.a.Zc(3,1,2231,2232,2233,1038647878,"LineageConfirmClearHistory");cb.HelpTopicId="a1493bf9-25c3-470a-b970-60eceb0136e5";cb.HelpDescription=dc.a.instance.ga(1313);ba.tr([cb])}))}}Object(b.a)(eb,"LineageActivityCommandHandler",null,[165]);class za extends B.a{constructor(ba){super(ba)}nd(){y.TaskExtensions.Aa(A.GetServiceTaskFactory.Oa(this.$.da,366,367,this.Ya),ba=>{this.Yc([new eb(this.$,ba.result)])},this.la,3)}static ka(ba){B.a.Nd(363,new za(ba))}}Object(b.a)(za,
"LineageActivityCommandHandlerFactory",B.a,[]);class ha{constructor(ba){this.DTa=!0;ha.Vgf()?ha.xmi()?this.DTa=!1:ha.ehf()?(d.ULS.sendTraceTag(526434368,0,50,`LineageCatchUpExperimentManager is running in hybrid mode. TUI exhausted: ${!ba}`),this.DTa=ba):this.DTa=!1:this.DTa=!0}J7a(){return!this.DTa}static ehf(){return ha.Vgf()&&Y.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.LineageCatchUpIntegrationTeachingUXTreatmentToControl",!1)}static Vgf(){return Y.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.LineageCatchUpIntegrationSummaryStringTreatment",
!1)}static xmi(){return Y.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.BlueDot",!1)}}Object(b.a)(ha,"LineageCatchUpExperimentManager",null,[367]);class fb extends f.a{constructor(ba){super();this.$=ba;this.Fb()}create(){ha.ehf()?y.TaskExtensions.Aa(A.GetServiceTaskFactory.Oa(this.$.da,456,457,this.Ya),ba=>{y.TaskExtensions.Aa(ba.result.jGj(),cb=>{this.jIe(cb.result)},this.$.la,3)},this.$.la,3):this.jIe(!0)}jIe(ba){this.ob(this.$.da.za(458)||this.$.da.Ga(458,new ha(ba)))}static ka(ba){ba.da.Ga(459,
new fb(ba))}}Object(b.a)(fb,"LineageCatchUpExperimentManagerFactory",f.a,[]);var rb=a(417),pa=a(33),Ma=a(83),Ja=a(147),Ga=a(120);class La{}Object(b.a)(La,"LineageClientParams",null,[]);class nb{}Object(b.a)(nb,"LineageFilter",null,[]);var Lb=a(64),ac=a(76),ib=a(132),Ra=a(42),ya=a(188),Va=a(116),oa=a(109),kb=a(282),Sa=a(281),U=a(21),ta=a(133),ub=a(60);const hc=(ba,cb,Kb,lc,Qc,Rc,zd,ae=null)=>{ae=ba.Na(1,ae);ae.clientParams=cb;ae.lineageFilter=Kb;return ub.g(ba,"LineageOpenPaneOrChangeFilter",ae,lc,
Qc,Rc,zd,0)},Bc=(ba,cb,Kb,lc,Qc,Rc,zd=null)=>{zd=ba.Na(1,zd);zd.fetchFromBelow=cb;return ub.g(ba,"LineageLoadMore",zd,Kb,lc,Qc,Rc,0)},Qa=(ba,cb,Kb,lc,Qc,Rc=null)=>{Rc=ba.Na(1,Rc);return ub.g(ba,"LineageRefreshView",Rc,cb,Kb,lc,Qc,0)},na=(ba,cb,Kb,lc,Qc,Rc=null)=>{Rc=ba.Na(1,Rc);return ub.g(ba,"LineageUpdateView",Rc,cb,Kb,lc,Qc,0)},ab=(ba,cb,Kb,lc,Qc,Rc=null)=>{Rc=ba.Na(1,Rc);return ub.g(ba,"LineageClosePane",Rc,cb,Kb,lc,Qc,0)},Gb=(ba,cb,Kb,lc,Qc,Rc=null)=>{Rc=ba.Na(1,Rc);return ub.g(ba,"LineageHidePreviousHistory",
Rc,cb,Kb,lc,Qc,0)},fc=(ba,cb,Kb,lc,Qc,Rc=null)=>{Rc=ba.Na(1,Rc);return ub.g(ba,"LineageLoadInGridBlueDots",Rc,cb,Kb,lc,Qc,0)};var pb=a(51),Ea=a(344);class xb{constructor(){this.activityList=null;this.oldestActivityId=this.latestActivityId=0;this.lastSearchedActivityTimestamp=null;this.serverLastActivityId=this.serverFirstActivityId=this.serverMessageCode=0;this.docId=null;this.showLoadPrevious=!1;this.eolPersonHideHistory=this.eolDateHideHistory=this.eolCorrelationId=null}}Object(b.a)(xb,"LineageActivitiesResponseDTO",
null,[]);class bc extends xb{constructor(){super();this.hasNewActivities=!1;this.filterSheetMultiRange=null}}Object(b.a)(bc,"LineageActivitiesUpdateResponseDTO",xb,[]);class zb{constructor(){this.onDisplayInGridHighlightsChanged=this.areInGridHighlightsEnabled=this.areInGridHighlightsAvailable=this.onDegradedCardGiveFeedbackButtonClicked=this.onLearnMoreLinkClicked=this.isFeatureEnabled=this.onRangeFilterInputEnabled=this.tryParseRangeInfo=this.onVersionHistoryButtonClicked=this.onCardSelected=this.lineageUpdateViewRequest=
this.lineageRefreshViewRequest=this.lineageLoadMoreRequest=this.lineageOpenPaneOrChangeFilterRequest=null}}Object(b.a)(zb,"LineageAppCallbacks",null,[]);class Ub{constructor(){this.imageUrl=this.email=this.displayName=this.provider=this.id=null}}Object(b.a)(Ub,"LineageAuthorDTO",null,[]);class wc{constructor(){this.logger=this.uiCulture=this.dataCulture=null;this.clientBatchSize=0;this.lineageAppCallbacks=this.filterableSheetList=null}}Object(b.a)(wc,"LineageControllerFactoryParams",null,[]);class mb{constructor(){this.lastCol=
this.firstCol=this.lastRow=this.firstRow=0}}Object(b.a)(mb,"LineageSharedRangeDTO",null,[]);class Db{constructor(){this.sheetName=this.rangeList=null}}Object(b.a)(Db,"LineageSheetMultiRangeDTO",null,[]);class Ic{constructor(){this.activityId=0;this.displayTimestamp=this.author=this.activityGuid=null;this.activityType=0;this.rangeHighlightLocation=this.isBulkEditOverflow=this.valueChanges=this.gridLocation=this.sheetName=this.nestedActivityList=null;this.degradedCardTypeBits=0}}Object(b.a)(Ic,"LineageUserActivityDTO",
null,[]);class Hc{constructor(){this.hasOldValue=this.hasNewValue=!1;this.cellLocation=this.oldValue=this.newValue=null}}Object(b.a)(Hc,"LineageValueChangeDTO",null,[]);var Ab;(function(ba){ba[ba.default=0]="default";ba[ba.D48X48=1]="D48X48";ba[ba.D64X64=2]="D64X64";ba[ba.D96X96=3]="D96X96";ba[ba.D120X120=4]="D120X120";ba[ba.D240X240=5]="D240X240";ba[ba.D360X360=6]="D360X360";ba[ba.D432X432=7]="D432X432";ba[ba.D504X504=8]="D504X504";ba[ba.D648X648=9]="D648X648"})(Ab||(Ab={}));Object(b.b)("ProfilePhotoDimension",
Ab);const db=(ba,cb)=>{let Kb=[];for(const Sd of ba){ba=Sd;var lc=cb,Qc=Object(X.a),Rc=new Ic,zd=Number.parseLocale(ba.UserActivity.Id),ae=ba.Uid,ze=ba.UserActivity.Type;var Be=ba.UserActivity.Person;var xe=lc;if(Be){var Ce=null;e.AFrameworkApplication.fa.qa("IsUserProfilePictureResolutionEnabled")&&(Ce=xe.Zta(Be.Email,Be.Provider,e.AFrameworkApplication.Zi,Ab.default));Be=Object(X.a)(new Ub,{id:Be.Id,provider:Be.Provider,displayName:Be.DisplayName,email:Be.Email,imageUrl:Ce})}else Be=null;xe=ba.SheetName;
Ce=new Date(ba.UserActivity.DisplayTimestamp);var ef=ba.DisplayLocation,Jf=ba.LineageValueChangeList;var Ia=[];for(const fe of Jf)Jf=Object(X.a)(new Hc,{hasNewValue:fe.HasNewValue,hasOldValue:fe.HasOldValue,newValue:fe.HasNewValue?fe.NewValue:null,oldValue:fe.HasOldValue?fe.OldValue:null,cellLocation:fe.CellLocation}),Ia.push(Jf);Jf=ba.IsBulkEditOverFlow;a:{var Bb=ba.UserActivity.LocationList;var zc=ba.UserActivity.Type;if(!Bb){d.ULS.sendTraceTag(512259102,0,15,"LineageManagerUtil:: RangeHighlightLocation.ActivityLocationList is null");
zc=null;break a}if(!Bb.length){d.ULS.sendTraceTag(512259101,0,50,"LineageManagerUtil:: RangeHighlightLocation.ActivityLocationList is empty");zc=null;break a}var ad=[],sd=[];let fe="";21===zc?sd.push(Bb[0]):sd=Bb;for(const qe of sd)switch(qe.Type){case 1:break;case 2:fe=qe.SheetName;break;case 0:Bb=qe;if(!Bb.RangeList){d.ULS.sendTraceTag(512259099,0,50,"LineageManagerUtil:: RangeHighlightLocation.RangeActivityLocation is null");break}fe=Bb.RangeList[0].SheetName;sd=[];21===zc?sd.push(Bb.RangeList[0]):
sd=Bb.RangeList;for(const mf of sd)Bb=Object(X.a)(new mb,{firstCol:mf.FirstColumn,firstRow:mf.FirstRow,lastRow:mf.LastRow,lastCol:mf.LastColumn}),ad.push(Bb);break;default:d.ULS.sendTraceTag(512259098,0,50,"LineageManagerUtil:: RangeHighlightLocation.ActivityLocationList is of type: ",qe.Type)}zc=Object(X.a)(new Db,{sheetName:fe,rangeList:ad})}lc=(ad=ba.NestedActivityList)?db(ad,lc):null;ba=Qc(Rc,{activityId:zd,activityGuid:ae,activityType:ze,author:Be,sheetName:xe,displayTimestamp:Ce,gridLocation:ef,
valueChanges:Ia,isBulkEditOverflow:Jf,rangeHighlightLocation:zc,nestedActivityList:lc,degradedCardTypeBits:ba.DegradedCardTypeBits});25===ba.activityType?(Qc=[],Pb(ba,Qc),Kb=[...Kb,...Qc]):Kb.push(ba)}return Kb},Pb=(ba,cb)=>{25===ba.activityType?ba.nestedActivityList.forEach(Kb=>{Kb&&Pb(Kb,cb)}):cb.push(ba)};class td{constructor(ba,cb,Kb,lc,Qc){this.R3a=this.YF=null;this.KE=this.awd=0;this.oGb=()=>{this.a8&&(this.a8.stop(),this.a8=null);this.FNb.start();this.YF.createLineageTaskPane(this.Wvd,this.R3a,
this.activityGuid)};this.lineageOpenPaneOrChangeFilterRequest=(Rc,zd)=>{this.FNb.stop();ta.b(this.$).Gd(ib.a.XVi,{});this.dKj();const ae=Object(X.a)(new La,{ClientViewCapacity:Rc.clientViewCapacity});let ze=null;zd&&(ze=Object(X.a)(new nb,{FilterSheetMultiRange:this.sUj(zd.filterSheetMultiRange)}));const Be=xe=>{xe=Va.a.Oe(xe.data);d.ULS.sendTraceTag(537155481,0,50,`LineageManager::LineageOpenPaneOrChangeFilter service call failed. Errors: [${T.a.sc(xe)}]`)};this.$.userOperationManager.Kc(new ya.a(1010,
0,(xe,Ce,ef)=>hc(this.$.pa.ya,ae,ze,Sa.b(xe,this.uhd("LineageOpenPaneOrChangeFilter")),Sa.a(Ce,Be),ef,null),80),null)};this.lineageLoadMoreRequest=Rc=>{ta.b(this.$).Gd(ib.a.WVi,{});const zd=ae=>{ae=Va.a.Oe(ae.data);d.ULS.sendTraceTag(537155480,0,50,`LineageManager::LineageLoadMore service call failed. Errors: [${T.a.sc(ae)}]`)};this.$.userOperationManager.Kc(new ya.a(1011,0,(ae,ze,Be)=>Bc(this.$.pa.ya,Rc,Sa.b(ae,this.uhd("LineageLoadMore")),Sa.a(ze,zd),Be,null),80),null)};this.lineageRefreshViewRequest=
()=>{ta.b(this.$).Gd(ib.a.YVi,{});const Rc=zd=>{zd=Va.a.Oe(zd.data);d.ULS.sendTraceTag(537155479,0,50,`LineageManager::LineageRefreshView service call failed. Errors: [${T.a.sc(zd)}]`)};this.$.userOperationManager.Kc(new ya.a(1012,0,(zd,ae,ze)=>Qa(this.$.pa.ya,Sa.b(zd,this.uhd("LineageRefreshView")),Sa.a(ae,Rc),ze,null),80),null)};this.lineageUpdateViewRequest=()=>{na(this.$.pa.ya,Rc=>{if(Rc=kb.a(Rc)?null:Rc.Result){var zd={["CountOfUpdatedActivities"]:Rc.LineageActivitiesResponse.ActivityList.length};
ta.b(this.$).Gd(ib.a.ZVi,zd);Rc=Object(X.a)(new bc,{activityList:Y.EwaSettings.isChangeGateEnabled("OfficeVSO:7124981_HandleFlatteningActivitiesInLineageManager")?db(Rc.LineageActivitiesResponse.ActivityList,this.kAa):this.zId(Rc.LineageActivitiesResponse.ActivityList),latestActivityId:Rc.LineageActivitiesResponse.LastSearchedActivityId,oldestActivityId:Rc.LineageActivitiesResponse.FirstSearchedActivityId,serverMessageCode:Rc.LineageActivitiesResponse.LineageResponseCode,lastSearchedActivityTimestamp:new Date(Rc.LineageActivitiesResponse.EcmaLastSearchedDate),
hasNewActivities:Rc.HasNewActivities,filterSheetMultiRange:this.iUj(Rc.LineageActivitiesResponse.FilterSheetMultiRange),serverFirstActivityId:Rc.LineageActivitiesResponse.ServerFirstActivityId,serverLastActivityId:Rc.LineageActivitiesResponse.ServerLastActivityId,showLoadPrevious:Rc.LineageActivitiesResponse.ShowLoadPrevious,eolCorrelationId:Rc.LineageActivitiesResponse.EolCorrelationId,eolDateHideHistory:new Date(Rc.LineageActivitiesResponse.EolDateHideHistory),eolPersonHideHistory:this.uxb(Rc.LineageActivitiesResponse.EolPersonHideHistory)});
this.YF.onLineageActivitiesUpdateResponse(Rc)}else d.ULS.shipAssertTag(537155475,0,!!Rc,"LineageManager.LineageUpdateView returned null response.")},Rc=>{Rc=Va.a.Oe(Rc.data);d.ULS.sendTraceTag(537155474,0,50,`LineageManager::LineageUpdateView service call failed. Errors: [${T.a.sc(Rc)}]`)},null,null)};this.areInGridHighlightsAvailable=()=>this.blueDotManager&&this.blueDotManager.areInGridHighlightsAvailable();this.areInGridHighlightsEnabled=()=>this.blueDotManager&&this.blueDotManager.areInGridHighlightsEnabled();
this.onDisplayInGridHighlightsChanged=Rc=>{this.blueDotManager&&this.blueDotManager.lzj(Rc)};this.onCardSelected=(Rc,zd)=>{if(Rc=Rc.rangeHighlightLocation){if(zd){let ae;if(({range:ae}=Ra.Z(zd,Y.EwaSettings.isChangeGateEnabled("OfficeVSO:7236999_passEwaSheetsInLineageManager")?this.$.xa:null)).returnValue){this.pcf(Rc.sheetName,this.w5a([Ra.j(ae)]));return}d.ULS.shipAssertTag(537155472,0,!1,"The produced subCellLocation string "+zd+" is not valid.")}Rc.rangeList.length?this.pcf(Rc.sheetName,Rc.rangeList):
this.wdi(Rc.sheetName)}};this.onLearnMoreLinkClicked=()=>{const Rc=new O.a(-859308420,ac.a.Db,this.$.Hc,12,null);this.$.Ka.Lb(Rc,{[ac.a.lg]:"HelpID=XLO_LineageTS",["InputMethod"]:ac.a.Db,[ac.a.Ic]:Na.a.tV,["ShouldCanvasTakeFocus"]:!0})};this.onVersionHistoryButtonClicked=Rc=>{this.$.Ka.Lb(new O.a(-1112508866,Rc,this.$.Hc,12,null))};this.onDegradedCardGiveFeedbackButtonClicked=()=>{const Rc={};Rc[Na.a.GQ]="LineageDegradedCard";this.$.Xc(802602464,0,12,Rc)};this.isFeatureEnabled=Rc=>{switch(Rc){case "FlattenListInLineageManager":return Y.EwaSettings.isChangeGateEnabled("OfficeVSO:7124981_HandleFlatteningActivitiesInLineageManager");
default:return!1}};this.yf=()=>{const Rc=this.$.ea.Ho.LineageVersion;Rc!==this.awd&&(d.ULS.sendTraceTag(537155470,0,50,`LineageManager.OnWorkbookMetadataChanged: lineageVersion: ${Rc}, this.lineageVersion: ${this.awd}`),this.awd=Rc,this.Gej())};this.Tc=(Rc,zd)=>{this.YF&&!this.lineageTaskPane.Oic&&zd.YH&&(d.ULS.sendTraceTag(587220563,0,15,"LineageManager::SessionIdChanged detected."),this.onStaleActivitiesDetected())};this.Oo=()=>{this.YF&&!this.lineageTaskPane.Oic&&(d.ULS.sendTraceTag(587220562,
0,15,"LineageManager::LoadOnDemandOccurred detected."),this.onStaleActivitiesDetected())};this.PD=()=>{const Rc=this.B5a();this.YF.onFilterableSheetListChange(Rc)};this.Hza=()=>{const Rc=this.B5a();this.YF.onFilterableSheetListChange(Rc)};this.Eqc=()=>{const Rc=this.B5a();this.YF.onFilterableSheetListChange(Rc)};this.onPaneClosed=()=>{this.YF.onPaneClosed();ab(this.$.pa.ya,null,Rc=>{Rc=Va.a.Oe(Rc.data);d.ULS.sendTraceTag(537155469,0,50,`LineageManager::OnLineageClosePaneFailed service call failed. Errors: [${T.a.sc(Rc)}]`)},
null,null)};this.onRangeFilterInputEnabled=Rc=>{Rc?this.gridView.ha.RT(this.Pc):this.gridView.ha.aS(this.Pc)};this.Pc=()=>{var Rc=Ra.q(this.gridView.ha.ra.activeRange,this.$);Rc=Object(X.a)(new Db,{rangeList:this.w5a(Rc.Ranges),sheetName:Rc.SheetName});this.YF.onSelectedRangeUpdated(Rc)};this.tryParseRangeInfo=Rc=>{let zd;if(({sheetName:zd,range:Rc}=Ra.Z(Rc,this.$.xa)).returnValue){zd||(zd=this.$.xa.na.sheetName);const ae=[];ae.push(Rc);Rc=Ra.u(zd,null,ae);return Object(X.a)(new Db,{rangeList:this.w5a(Rc.Ranges),
sheetName:Rc.SheetName})}return null};this.Vz=()=>{const Rc=this.KE!==this.$.ea.ye;this.YF&&this.lineageTaskPane.isVisible&&Rc&&(this.KE=this.$.ea.ye,this.YF.onRefreshRequired())};this.$=ba;cb.Ga(366,this);this.blueDotManager=lc;this.gridView=U.h(this.$);this.lineageTaskPane=Kb;this.Wvd=this.lineageTaskPane.UM();this.batchSize=50;this.a8=Qc;this.FNb=this.$.Jb.Ng("UserAction","LineagePaneLoadingShimmerStopWatch");this.kAa=Ma.a.instance.resolve("Common.App.People.IUserProfilePictureUtils");this.Yhi();
this.QIg()}dispose(){this.Jhj();this.$=null;this.lineageTaskPane&&(this.lineageTaskPane.wO(this.onPaneClosed),this.lineageTaskPane.nG(this.Vz),this.lineageTaskPane=null);this.FNb=this.kAa=this.R3a=this.Wvd=this.YF=null}V8f(ba,cb,Kb,lc){this.activityGuid=null;if(this.lineageTaskPane.isVisible){if(9===Kb){d.ULS.sendTraceTag(560989858,0,50,"LineageManager::ShowLineageTaskPane open from callout was invoked with an opened pane");return}if(!ba&&16!==Kb&&18!==Kb&&30!==Kb){this.lineageTaskPane.l3c();return}}pa.a.gd(this.$)||
(this.FNb.start(),this.a8&&(pb.b().UA(this.FNb.id,this.a8.id,"actions","actions"),this.a8.stop(),this.a8=null));this.lineageTaskPane.Oic||d.ULS.sendTraceTag(537155482,0,50,`LineageManager::ShowLineageTaskPane pane reopened by user via ${ba?cb:Kb}`);this.KE=this.$.ea.ye;this.R3a=null;ba?(ba=Ra.r(this.gridView.ha.ra.selectedRanges,this.$),this.R3a=Object(X.a)(new Db,{rangeList:cb.toString()===Na.a.n8f?this.w5a(ba.Ranges):null,sheetName:ba.SheetName})):Y.EwaSettings.isChangeGateEnabled("OfficeVSO:6883957_InvokeEntryPointForClickingActivityIndicatorTooltip")&&
30===Kb&&this.S7i(lc);pa.a.gd(this.$)&&this.lineageTaskPane.Oic?this.lineageTaskPane.Fzj(this.oGb):this.YF.createLineageTaskPane(this.Wvd,this.R3a,this.activityGuid);this.lineageTaskPane.vg(!0);this.$.Xc(-71295319,-1,0,null)}S7i(ba){if(ba){var cb=ba.sheetName,Kb=ba.gridLocation;ba=ba.activityGuid;if(cb&&Kb&&ba){this.activityGuid=ba;var lc;({range:lc}=Ra.Z(Kb,this.$.xa)).returnValue?this.R3a=Object(X.a)(new Db,{rangeList:this.w5a([Ra.j(lc)]),sheetName:cb}):d.ULS.shipAssertTag(512266262,0,!1,"Blue dot sheetName/gridLocation is not valid.")}else d.ULS.shipAssertTag(509752709,
0,!1,"Blue dot sheetName/gridLocation/activityGuid is not set.")}else d.ULS.shipAssertTag(509752710,0,!1,"Blue dot unexpected undefined properties for command handling.")}lineageHidePreviousHistory(){const ba={["paneVisible"]:this.lineageTaskPane.isVisible};Ja.a.sendTelemetryEvent(Object(X.a)(new Ea.a,{name:"Office.Excel.Online.Lineage.ClearHistoryConfirmed",dataFields:Ga.a.Vj(ba)}));this.$.userOperationManager.Kc(new ya.a(1018,0,(cb,Kb,lc)=>Gb(this.$.pa.ya,cb,Kb,lc,null),64),null);this.lineageTaskPane.isVisible||
this.V8f(!1,null,4,void 0)}Yhi(){const ba=Object(X.a)(new zb,{tryParseRangeInfo:this.tryParseRangeInfo,isFeatureEnabled:this.isFeatureEnabled,onCardSelected:this.onCardSelected,onVersionHistoryButtonClicked:this.onVersionHistoryButtonClicked,onRangeFilterInputEnabled:this.onRangeFilterInputEnabled,onLearnMoreLinkClicked:this.onLearnMoreLinkClicked,onDegradedCardGiveFeedbackButtonClicked:this.onDegradedCardGiveFeedbackButtonClicked,lineageOpenPaneOrChangeFilterRequest:this.lineageOpenPaneOrChangeFilterRequest,
lineageLoadMoreRequest:this.lineageLoadMoreRequest,lineageRefreshViewRequest:this.lineageRefreshViewRequest,lineageUpdateViewRequest:this.lineageUpdateViewRequest,areInGridHighlightsAvailable:this.areInGridHighlightsAvailable,areInGridHighlightsEnabled:this.areInGridHighlightsEnabled,onDisplayInGridHighlightsChanged:this.onDisplayInGridHighlightsChanged});aa.a(()=>{this.YF=cellLineage.LineageActivityControllerFactoryGlobal.createLineageActivityController(Object(X.a)(new wc,{clientBatchSize:this.batchSize,
filterableSheetList:this.B5a(),uiCulture:this.$.va.UICultureTag,dataCulture:this.$.va.DataCultureTag,logger:new C.a,lineageAppCallbacks:ba}))})}uhd(ba){return cb=>{if(cb=kb.a(cb)?null:cb.Result){var Kb={["CountOfActivities"]:cb.ActivityList.length};Kb.WebRequestName=ba;ta.b(this.$).Gd(ib.a.tTi,Kb);cb=Object(X.a)(new xb,{activityList:Y.EwaSettings.isChangeGateEnabled("OfficeVSO:7124981_HandleFlatteningActivitiesInLineageManager")?db(cb.ActivityList,this.kAa):this.zId(cb.ActivityList),latestActivityId:cb.LastSearchedActivityId,
oldestActivityId:cb.FirstSearchedActivityId,serverMessageCode:cb.LineageResponseCode,lastSearchedActivityTimestamp:new Date(cb.EcmaLastSearchedDate),serverFirstActivityId:cb.ServerFirstActivityId,serverLastActivityId:cb.ServerLastActivityId,showLoadPrevious:cb.ShowLoadPrevious,eolCorrelationId:cb.EolCorrelationId,eolDateHideHistory:new Date(cb.EolDateHideHistory),eolPersonHideHistory:this.uxb(cb.EolPersonHideHistory)});this.YF.onLineageActivitiesResponse(cb)}else d.ULS.shipAssertTag(537155477,0,!!cb,
"LineageManager."+ba+" returned null response.")}}iUj(ba){return oa.e(ba.Ranges)&&!ba.SheetName?null:Object(X.a)(new Db,{rangeList:this.w5a(ba.Ranges),sheetName:ba.SheetName})}w5a(ba){const cb=[];for(const Kb of ba)ba=Object(X.a)(new mb,{firstCol:Kb.FirstColumn,firstRow:Kb.FirstRow,lastRow:Kb.LastRow,lastCol:Kb.LastColumn}),cb.push(ba);return cb}sUj(ba){if(!ba)return null;const cb={};cb.Ranges=this.zid(ba.rangeList);cb.SheetName=ba.sheetName;return cb}zid(ba){const cb=[];if(oa.e(ba))return cb;for(const Kb of ba)ba=
{},ba.FirstColumn=Kb.firstCol,ba.FirstRow=Kb.firstRow,ba.LastRow=Kb.lastRow,ba.LastColumn=Kb.lastCol,cb.push(ba);return cb}wdi(ba){(ba=this.$.xa.getItemByName(ba))&&ba.visible&&ba.activate(!0)}pcf(ba,cb){const Kb=[];for(var lc of cb)cb={},cb.FirstColumn=lc.firstCol,cb.FirstRow=lc.firstRow,cb.LastRow=lc.lastRow,cb.LastColumn=lc.lastCol,Kb.push(Ra.D(cb));lc=Kb.length-1;cb=Kb[lc].topLeft;U.h(this.$).U4(Kb,lc,ba,null,cb,null,null,3,"LineageManager.OnCardSelected",void 0,void 0,void 0,!0)}Gej(){this.YF&&
this.lineageTaskPane.isVisible&&(this.KE=this.$.ea.ye,this.YF.onRefreshRequired())}QIg(){this.lineageTaskPane.AM(this.onPaneClosed);this.lineageTaskPane.RE(this.Vz);this.$.ea.mu(this.yf);this.$.ea.Tj(this.Tc);this.$.ea.zM(this.Oo);const ba=this.$.xa;ba.GY(this.PD);ba.oha(this.Eqc);ba.NGa(this.Hza);ba.NZa(this.Eqc)}Jhj(){this.$.ea.Ov(this.yf);this.gridView.ha.aS(this.Pc);this.$.ea.qk(this.Tc);this.$.ea.ZR(this.Oo);const ba=this.$.xa;ba.z7(this.PD);ba.Ena(this.Eqc);ba.yRa(this.Hza);ba.dKb(this.Eqc)}onStaleActivitiesDetected(){this.YF.onStaleActivitiesDetected()}B5a(){const ba=
this.$.xa.items,cb=[];for(const Kb of ba)Kb.visible&&!Lb.e(Kb)&&cb.push(Kb.sheetName);return cb}dKj(){if(Y.EwaSettings.ma(600)){var ba=this.$.da.za(403);ba&&ba.disable();ba=new O.a(-847286761,ac.a.Db,this.$.Hc,0,Na.a.v0);this.$.Ka.Lb(ba,{["InputMethod"]:ac.a.Db,CalloutName:5})}}zId(ba){const cb=[];for(const Kb of ba)ba=Object(X.a)(new Ic,{activityId:Number.parseLocale(Kb.UserActivity.Id),activityGuid:Kb.Uid,activityType:Kb.UserActivity.Type,author:this.uxb(Kb.UserActivity.Person),sheetName:Kb.SheetName,
displayTimestamp:new Date(Kb.UserActivity.DisplayTimestamp),gridLocation:Kb.DisplayLocation,valueChanges:this.U9i(Kb.LineageValueChangeList),isBulkEditOverflow:Kb.IsBulkEditOverFlow,rangeHighlightLocation:this.I9i(Kb.UserActivity.LocationList,Kb.UserActivity.Type),nestedActivityList:this.B9i(Kb.NestedActivityList),degradedCardTypeBits:Kb.DegradedCardTypeBits}),cb.push(ba);return cb}I9i(ba,cb){if(!ba)return d.ULS.sendTraceTag(537155468,0,15,"LineageManager:: RangeHighlightLocation.ActivityLocationList is null"),
null;if(!ba.length)return d.ULS.sendTraceTag(537155467,0,50,"LineageManager:: RangeHighlightLocation.ActivityLocationList is empty"),null;const Kb=[];var lc=[];let Qc="";21===cb?lc.push(ba[0]):lc=ba;for(const Rc of lc)switch(Rc.Type){case 1:break;case 2:Qc=Rc.SheetName;break;case 0:ba=Rc;if(!ba.RangeList){d.ULS.sendTraceTag(537155465,0,50,"LineageManager:: RangeHighlightLocation.RangeActivityLocation is null");break}Qc=ba.RangeList[0].SheetName;lc=[];21===cb?lc.push(ba.RangeList[0]):lc=ba.RangeList;
for(const zd of lc)ba=Object(X.a)(new mb,{firstCol:zd.FirstColumn,firstRow:zd.FirstRow,lastRow:zd.LastRow,lastCol:zd.LastColumn}),Kb.push(ba);break;default:d.ULS.sendTraceTag(537155464,0,50,"LineageManager:: RangeHighlightLocation.ActivityLocationList is of type: ")}return Object(X.a)(new Db,{sheetName:Qc,rangeList:Kb})}U9i(ba){const cb=[];for(const Kb of ba)ba=Object(X.a)(new Hc,{hasNewValue:Kb.HasNewValue,hasOldValue:Kb.HasOldValue,newValue:Kb.HasNewValue?Kb.NewValue:null,oldValue:Kb.HasOldValue?
Kb.OldValue:null,cellLocation:Kb.CellLocation}),cb.push(ba);return cb}B9i(ba){return ba?this.zId(ba):null}uxb(ba){if(!ba)return null;let cb=null;e.AFrameworkApplication.fa.qa("IsUserProfilePictureResolutionEnabled")&&(cb=this.kAa.Zta(ba.Email,ba.Provider,e.AFrameworkApplication.Zi,0));return Object(X.a)(new Ub,{id:ba.Id,provider:ba.Provider,displayName:ba.DisplayName,email:ba.Email,imageUrl:cb})}}Object(b.a)(td,"LineageManager",null,[721,2]);class Vb extends f.a{constructor(ba){super();this.a8=this.lineageTaskPane=
null;this.$=ba;this.Fb()}oqf(ba,cb){y.TaskExtensions.Aa(ba,()=>{this.ob(this.$.da.za(366)||new td(this.$,this.$.da,this.lineageTaskPane,cb,this.a8))},this.$.la,3)}create(){this.a8=this.$.Jb.Ac("UserAction","LineagePaneSeenStopwatch");this.a8.start();const ba=A.GetServiceTaskFactory.Oa(this.$.da,365,364,this.Ya),cb=rb.a(this.$),Kb=A.GetServiceTaskFactory.Oa(this.$.da,283,284,this.Ya);if(Y.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.BlueDot",!1)){const lc=A.GetServiceTaskFactory.Oa(this.$.da,
501,500,0);y.TaskExtensions.Aa(y.TaskExtensions.Fd([ba,cb,Kb,lc],this.$.la),()=>{this.lineageTaskPane=ba.result;pa.a.gd(this.$)||cb.result.yN(this.lineageTaskPane);this.oqf(sa.c(Kb.result.pn.loadScript("cellLineage")),lc.result)},this.$.la,3)}else y.TaskExtensions.Aa(y.TaskExtensions.Fd([ba,cb,Kb],this.$.la),()=>{this.lineageTaskPane=ba.result;pa.a.gd(this.$)||cb.result.yN(this.lineageTaskPane);this.oqf(sa.c(Kb.result.pn.loadScript("cellLineage")),null)},this.$.la,3)}static ka(ba){ba.da.Ga(367,new Vb(ba))}}
Object(b.a)(Vb,"LineageManagerFactory",f.a,[]);var Ac=a(788),Kc=a(224),dd=a(14),Vd=a(107),Jd=a(260),oe=a(85),De=a(238),Ke=a(19),rd=a(701);const bf=Na.a.NBc+"LineageActivityPaneTitle",cc=Na.a.yfb+"LineageActivityCloseButton";class Wc extends De.a{constructor(ba,cb,Kb){super(ba);this.oGb=this.cEe=this.Qd=null;this.Xrd=!0;this.wq=0;this.Tp=!1;this.Bc=(lc,Qc)=>{Qc.Lf||this.l3c()};this.mk=()=>{this.l3c();return!0};this.$=cb;this.taskPaneManager=Kb;this.$.dk(this.Bc);ra.a(this.$).ai(this);pa.a.gd(this.$)&&
(this.isVisible=!1)}MP(ba){this.get_events().addHandler("LineageTaskPaneRemove",ba)}$R(ba){this.get_events().removeHandler("LineageTaskPaneRemove",ba)}RE(ba){this.addHandler("LineageTaskPaneVisibilityChanged",ba)}nG(ba){this.removeHandler("LineageTaskPaneVisibilityChanged",ba)}AM(ba){this.get_events().addHandler("LineageTaskPaneClose",ba)}wO(ba){this.get_events().removeHandler("LineageTaskPaneClose",ba)}get isVisible(){return super.isVisible}set isVisible(ba){super.isVisible!==ba&&(super.isVisible=
ba,this.raiseEvent("LineageTaskPaneVisibilityChanged"))}get Oic(){return this.Xrd}get Ff(){return this.isVisible}get ih(){return 15}get de(){return N.a.dAi}get dl(){return Ke.a.CBh}get vN(){return dc.a.instance.ga(1071)}get Lp(){return 300}get isResizable(){return!1}get mc(){return this.domElement}get height(){return this.taskPaneManager.YO.offsetHeight}get titleText(){return dc.a.instance.ga(1288)}get eC(){return this.taskPaneManager.Kva(this.mc,this.titleText,this.Lp,this.isResizable,()=>{this.isVisible=
!0;this.oGb?this.oGb():d.ULS.shipAssertTag(537155462,0,!1,"OnLineagePaneOpened callback not set.")},()=>{this.isVisible=!1},()=>{this.isVisible=!0},()=>{this.isVisible=!1},this.Lp)}nq(){return this.Tp}Es(){return this.Tp}JR(){}WQ(){return!1}sj(){}Wj(){}dispose(){this.$&&(this.$.Jl(this.Bc),ra.a(this.$).aA(this));this.Qd&&(Kc.a.instance.Ba(dd.a.click,this.Qd,this.mk),Vd.KeyInputManager.instance.Vv(this.Qd,this.cEe));this.Qd=this.taskPaneManager=this.$=null;super.dispose()}gg(ba,cb){if(!cb){ba=ea.DOMElementExtensions.getElementById(this.domElement,
"LineagePaneFilterButton");if(!ba)return!1;ea.DOMElementExtensions.setFocus(ba)}return!cb}lh(ba){return ea.DOMElementExtensions.xf(this.mc,ba)}vg(ba){this.Tp=ba;const cb=this.taskPaneManager;if(this.isVisible=ba)this.$.frame.Le.Xj("LineagePane"),this.Xrd=!1;if(pa.a.gd(this.$))ba?cb.e7("LineageTaskPane",this.eC):cb.hideTaskPane("LineageTaskPane");else{this.taskPaneManager.pA();const Kb=!!this.taskPaneManager.nh&&15===this.taskPaneManager.nh.taskPane.ih;ba&&0<cb.dC.length&&(!Kb||cb.isCollapsed)&&cb.qG(this,
!0)}this.$.af()}UM(){var ba=this.$.Eb;ba=pa.a.gd(this.$)?this.domElement:document.getElementById(ba+Na.a.$vd);var cb=this.uH();ba.appendChild(cb);cb=rd.b("div","LineagePaneBodyId","LineageActivityBody");ba.appendChild(cb);this.Gzj();return cb}l3c(){this.$.frame.Le.Xj(this.$.frame.Le.qF||Jd.AFrame.XT);this.Xrd=!0;this.vg(!1);this.raiseEvent("LineageTaskPaneClose")}Fzj(ba){this.oGb=ba}Gzj(){this.$.frame.Le.tk("LineagePane");const ba=this.$.frame.Le.Bi("LineagePane");ba.parent=Jd.AFrame.XT;ba.MN=!0}uH(){const ba=
rd.b("div","LineagePaneHeaderId","LineageActivityPaneHeader"),cb=rd.b("h1","LineagePaneTitleId",bf);cb.innerText=this.titleText;this.Qd=Ac.a.pb("LineagePaneCloseButtonId",cc,dc.a.instance.ga(10),"ClosePaneGlyph_16x16x32",!1);this.Qd.classList.add(e.AFrameworkApplication.isRtl?Na.a.Waa:Na.a.Xaa);Kc.a.instance.ta(dd.a.click,this.Qd,this.mk);this.cEe=Vd.KeyInputManager.instance.Ms(this.Qd,this.mk,oe.a.Sh);ba.appendChild(cb);ba.appendChild(this.Qd);return ba}static ka(ba,cb){const Kb=ba.Eb;let lc=document.getElementById(Kb+
Na.a.$vd);lc||(lc=document.createElement("div"),lc.id=ba.Eb+Na.a.$vd,lc.classList.add("LineageActivityPane"),pa.a.gd(ba)||document.getElementById(Kb+Na.a.BR).appendChild(lc));return ba.da.za(365)||ba.da.Ga(365,new Wc(lc,ba,cb))}}Object(b.a)(Wc,"LineageTaskPane",De.a,[715,2,263,39]);class id extends f.a{constructor(ba){super();this.gh=this.xi=null;this.$=ba;this.Fb()}get RD(){this.xi||(this.xi=y.TaskExtensions.Aa(rb.a(this.$),ba=>{this.gh=Wc.ka(this.$,ba.result)},this.la,3));return this.xi}create(){const ba=
A.GetServiceTaskFactory.create(this.$.da,203,this.la,this.Ya),cb=A.GetServiceTaskFactory.create(this.$.da,155,this.la,this.Ya);y.TaskExtensions.Aa(y.TaskExtensions.ts(y.TaskExtensions.Fd([ba,cb],this.la),()=>this.RD,this.la),()=>{this.ob(this.gh)},this.la,3)}dispose(){this.gh=this.xi=this.$=null;super.dispose()}static ka(ba){ba.da.Ga(364,new id(ba))}}Object(b.a)(id,"LineageTaskPaneFactory",f.a,[]);class Tc{constructor(ba,cb){this.Bsd=!1;this.yf=()=>{this.hfg()};this.$=ba;Y.EwaSettings.ma(600)&&this.$.ea.s9a&&
!Tc.yyb&&(cb&&!cb.DTa||this.B3j(),Tc.vaf?d.ULS.sendTraceTag(537155461,0,50,"LineageTeachingCalloutTriggerManager will not trigger WYWA waterline check as it was already checked in session"):cb&&!cb.DTa||this.I3j());d.ULS.sendTraceTag(537155460,0,50,"LineageTeachingCalloutTriggerManager is initialized.")}dispose(){this.NLd();this.$=null;d.ULS.sendTraceTag(537155459,0,50,"LineageTeachingCalloutTriggerManager is disposed.")}disable(){Tc.yyb||(Tc.yyb=!0,d.ULS.sendTraceTag(578557781,0,50,"LineageTeachingCalloutTriggerManager.Disable as the pane was opened."));
this.NLd()}I3j(){Y.EwaSettings.ma(596)&&!this.$.isAnonymousUser()&&ub.i(this.$.pa.ya,ba=>{this.$?(ba=ba.Result,d.ULS.sendTraceTag(578557780,0,50,`CheckLineageWywaChanges service call succeeded, hasnewchanges = ${ba}.`),Tc.vaf=!0,ba&&this.MPb(0)):d.ULS.sendTraceTag(537155458,0,50,"LineageTeachingCalloutTriggerManager.VerifyWaterlineTrigger ignoring server response as class is disposed.")},()=>{d.ULS.sendTraceTag(537155457,0,10,"CheckLineageWywaChanges service call failed.")},null,null)}B3j(){Y.EwaSettings.ma(595)&&
!this.hfg()&&(this.$.ea.mu(this.yf),this.Bsd=!0)}hfg(){return this.$.ea&&this.$.ea.Ho&&this.$.ea.Ho.ShouldTriggerLineageCalloutOnMerge?(d.ULS.sendTraceTag(578557778,0,50,"LineageTeachingCalloutTriggerManager.TriggerLineageCalloutOnMerge"),this.MPb(1),!0):!1}MPb(ba){Tc.yyb?d.ULS.sendTraceTag(537155456,0,50,"LineageTeachingCalloutTriggerManager.TriggerCallout Will not trigger dialog as it was already shown in session"):(Tc.yyb=!0,d.ULS.sendTraceTag(578557776,0,50,`LineageTeachingCalloutTriggerManager.TriggerCallout triggering callout due to reason ${ba}.`),
this.NLd(),Y.EwaSettings.ma(476)&&(ba=new O.a(-847286761,ac.a.Db,this.$.Hc,0,Na.a.v0),this.$.Ka.Lb(ba,{["CalloutName"]:4})))}NLd(){this.Bsd&&(this.Bsd=!1,this.$.ea.Ov(this.yf))}}Tc.yyb=!1;Tc.vaf=!1;Object(b.a)(Tc,"LineageTeachingCalloutTriggerManager",null,[366,2]);class Gd extends f.a{constructor(ba){super();this.$=ba;this.Fb()}create(){y.TaskExtensions.Aa(A.GetServiceTaskFactory.Oa(this.$.da,458,459,this.Ya),ba=>{const cb=ba.result;ba=Object(bb.a)(this.$.da,403,()=>new Tc(this.$,cb));this.ob(ba)},
this.$.la,3)}static ka(ba){ba.da.Ga(402,new Gd(ba))}}Object(b.a)(Gd,"LineageTeachingCalloutTriggerManagerFactory",f.a,[]);var Wd=a(872),Dd=a(79);class Kd{constructor(ba,cb){this.yh=ba;this.gv=cb}fX(ba,cb,Kb,lc=null){return this.fph(ba,lc,Qc=>this.yh.mob(Qc,2,Kb,cb,void 0,void 0,void 0,void 0,void 0,"2"))}fph(ba,cb,Kb){const lc=!!cb&&""!==cb;let Qc=ba;lc&&(Qc=w.a.NT(ba,"perfTag",cb));const Rc=new Date;return Wd.a.then(Kb(Qc),zd=>{const ae=+new Date-+Rc;if(!zd||!zd.Hg||!zd.Hg.data)return zd;lc&&zd.Hg.data.request&&
this.tvj(zd.Hg.data.request.getResolvedUrl(),cb,ae);return zd})}tvj(ba,cb,Kb){ba=this.gv.G2h(ba);if(ba.count&&(ba=Dd.last(ba))){const lc={Message:"Request durations for activities calls."};lc.PerfTag=cb;lc.CustomDuration=Kb;lc.PerformanceDuration=ba.duration;d.ULS.sendTraceTag(592189641,3012,50,JSON.stringify(lc))}}}Object(b.a)(Kd,"CatchUpNetworkingWrapper",null,[755]);var we=a(243);class We extends we.a{constructor(ba,cb){super(ba,cb)}eba(){return 6}}Object(b.a)(We,"GetActivityFeedRequest",we.a,
[]);class Od extends we.a{constructor(ba,cb,Kb,lc,Qc,Rc){super(ba,cb);this.ItemIds=null;this.ActivityStatesToReset=this.ActivityStatesToSet=0;this.ResetUnseenCount=!1;this.ItemIds=Kb;this.ActivityStatesToSet=lc;this.ActivityStatesToReset=Qc;this.ResetUnseenCount=Rc}eba(){return 7}}Object(b.a)(Od,"UpdateActivityFeedStateRequest",we.a,[]);var le=a(385);class de{constructor(ba,cb,Kb){this.Sfe=ba;this.xDa=cb;this.ODa=Kb}getActivityFeed(ba){return Wd.a.then(this.ODa.execute(new We(this.xDa(),null),(cb,
Kb,lc)=>this.Sfe.fX(cb,Kb,lc,"ActivityFeed"),ba),cb=>{if(!cb)return d.ULS.sendTraceTag(572846937,3012,10,"GetActivityFeed: Response is null"),null;if(!cb.Hg)return d.ULS.sendTraceTag(572846938,3012,10,"GetActivityFeed: Response.Args is null"),null;if(!cb.Hg.data)return d.ULS.sendTraceTag(572846939,3012,10,"GetActivityFeed: Response.Args.Data is null"),null;if(!cb.Hg.data.te)return d.ULS.sendTraceTag(572846940,3012,10,"GetActivityFeed: Response.Args.Data.ResponseData is null"),null;cb=le.a.sJa(cb.Hg.data.te);
return cb?cb:(d.ULS.sendTraceTag(572846941,3012,10,"GetActivityFeed: Deserialized response is null"),null)})}DYj(ba,cb,Kb,lc){return Wd.a.then(this.ODa.execute(new Od(this.xDa(),null,ba,cb,Kb,lc),(Qc,Rc,zd)=>this.Sfe.fX(Qc,Rc,zd,"UpdateActivityFeedState"),null),Qc=>{try{return Qc.succeeded}catch(Rc){return d.ULS.sendTraceTag(523121054,3012,10,"UpdateActivityFeed: Exception: "+Rc.message),!1}})}}Object(b.a)(de,"CatchUpRequestHandler",null,[754]);var Re=a(467);class Ee{constructor(ba){this.Kga=ba;this.Hee=
new Re.a}MBi(){this.ACi()}ACi(){if(this.Kga){var ba=cb=>{this.Hee.contains("CatchUpChangesFeedback")||(this.Hee.add("CatchUpChangesFeedback"),cb.logActivity("CatchUpChangesFeedback",null))};this.Kga.execute(cb=>{window.setTimeout(()=>{ba(cb)},2E4)})}else d.ULS.sendTraceTag(571586199,383,15,"FloodgateEventLogger: IFuture<ISystemInitiatedFeedback> was null")}}Object(b.a)(Ee,"FloodgateEventLogger",null,[]);var Te=a(187);class Ae{constructor(ba){this.HBg=ba}get duration(){return this.HBg.duration}}Object(b.a)(Ae,
"PerformanceResourceTimingWrapper",null,[]);class kf{constructor(ba){this.gv=ba}G2h(ba){const cb=new Te.a;if(!this.gv)return cb;ba=this.gv.getEntriesByName(ba,"resource");if(!ba)return cb;for(const Kb of ba)cb.add(new Ae(Kb));return cb}}Object(b.a)(kf,"PerformanceWrapper",null,[]);var Oe=a(248);class $a{constructor(){this.gb=null}get name(){return"Common.App.CatchUpActivity"}Vh(ba){this.gb=ba;this.gb.register(Kd,"Common.App.CatchUpActivity.CatchUpNetworkingWrapper").as("Common.App.CatchUpActivity.ICatchUpNetworkingWrapper").xc().Fc(()=>
new Kd(e.AFrameworkApplication.Bd,new kf(window.performance)));this.gb.register(de,"Common.App.CatchUpActivity.CatchUpRequestHandler").as("Common.App.CatchUpActivity.ICatchUpRequestHandler").xc().Fc(()=>new de(this.gb.resolve("Common.App.CatchUpActivity.ICatchUpNetworkingWrapper"),()=>e.AFrameworkApplication.Zi,new le.a));this.gb.register(Ee,"Common.App.CatchUpActivity.FloodgateEventLogger").xc().Fc(()=>new Ee(this.gb.Ub("Common.ISystemInitiatedFeedback")))}init(){this.gb.resolve("Common.App.CatchUpActivity.ICatchUpNetworkingWrapper");
this.gb.resolve("Common.App.CatchUpActivity.ICatchUpRequestHandler")}dispose(){}static main(){Oe.a.instance.Ei(new $a)}}Object(b.a)($a,"CatchUpActivityPackage",null,[4,5]);class Zb{constructor(ba,cb){this.$=ba;this.catchUpActivityManager=cb}nc(ba,cb){return this.catchUpActivityManager?-876699925===cb?!this.catchUpActivityManager.Ugf:!1:!0}executeCommand(ba,cb){ba=!1;switch(cb.command){case -876699925:ba=this.catchUpActivityManager.u0i();break;case 950288339:return this.catchUpActivityManager.showHideInGridHighlights(),
I.Task.Ta(!0)}return ba?I.Task.Ta(!0):x.a(cb.command)}wc(ba,cb){return Y.EwaSettings.ma(431)?-876699925===cb.command||950288339===cb.command:!1}Jc(){return!1}}Object(b.a)(Zb,"CatchUpActivityCommandHandler",null,[165]);class Da extends B.a{constructor(ba){super(ba)}nd(){this.$.da.$a(286,ba=>{this.Yc([new Zb(this.$,ba)])})}static ka(ba){B.a.Nd(285,new Da(ba))}}Object(b.a)(Da,"CatchUpActivityCommandHandlerFactory",B.a,[]);var Pa=a(263),tb=a(518),Ib=a(87),Yb=a(82),vc=a(25);class Zc{constructor(ba){this.Th=
ba}doesContentExist(ba){if(!ba)return d.ULS.sendTraceTag(537168066,3012,10,"Null activity: DoesContentExist. Default to false."),!1;switch(ba.type){case 2:case 3:case 4:case 6:case 8:case 9:case 7:case 10:if(!ba.navigationId)return d.ULS.sendTraceTag(537168065,3012,10,"Null activity.NavigationId: DoesContentExist. Default to false."),!1;const cb={};cb.NavigationId=atob(ba.navigationId);return 32===this.Th.ae(vc.a.GJa,2,cb);default:return!1}}}Object(b.a)(Zc,"CatchUpActivityContentManager",null,[716]);
var nd=a(821),hd=a(1236);class Ud{constructor(ba){this.kGb=()=>{switch(this.Au.model.state){case 1:this.f9f(!0);break;case 0:this.ONb(!1);break;case 2:case 3:this.ONb(!0);break;default:d.ULS.shipAssertTag(537167968,0,!1,"RangeCatchUpActivityView.OnHighlightStateChanged - Invalid CatchUpActivityHighlightState:"+this.Au.model.state)}};this.Yxg=ba;this.Au.$qe(this.kGb);this.Ez=[]}get Au(){return this.Yxg}dispose(){this.Au.gVf(this.kGb);this.Ez=null}czj(ba){this.Ez.push(ba)}o5g(){this.Ez.length=0}f9f(ba){for(const cb of this.Ez){cb.className=
nd.a.e2g;const Kb=document.getElementById(`${cb.id}-${Na.a.yBe}`);ea.DOMElementExtensions.setVisible(Kb,ba)}}ONb(ba){for(const cb of this.Ez)cb&&(ba?cb.className=2===this.Au.model.state?nd.a.Obj:nd.a.Pbj:this.f9f(!1))}}Object(b.a)(Ud,"RangeCatchUpActivityView",null,[751,2]);var ee=a(22);class ec extends hd.a{constructor(ba,cb,Kb){super(ba,cb,Kb);this.gridView=U.h(ba);this.rna=cb}dispose(){this.gridView=null;super.dispose()}sLg(ba){const cb=this.dhb[0];cb?cb.czj(ba):d.ULS.shipAssertTag(537168004,0,
!1,"RangeCatchUpActivityHighlightController.AddViewElement - RangeCatchUpActivityView is null for activityId"+this.rna.activityId)}Roj(){const ba=this.dhb[0];ba&&ba.o5g()}CJg(ba){this.rna.addRange(ba)}nSh(){if(3!==this.rna.activityType)return null;d.ULS.shipAssertTag(537168003,0,1===this.rna.kOb.length,"RangeCatchUpActivityHighlightController::GetCommentActivityRange Range Information Length should be 1.");return Ra.D(this.rna.kOb[0])}RLb(ba){if(ba){if(!this.rna)return;this.rAd(this.$pj())}super.RLb(ba)}Q6c(){const ba=
this.v6c();this.dhb.push(ba)}v6c(){return new Ud(this)}rAd(ba){ba?ba.SheetName?(this.gridView.ha.Ra.zH(null),this.gridView.focus(),this.gridView.z9e(ba,3,!1,"RangeCatchUpActivityHighlightController.NavigateToRange")):d.ULS.shipAssertTag(537168E3,0,!1,"RangeCatchUpActivityHighlightController.NavigateToRange: SheetName in the range is null."):d.ULS.shipAssertTag(537168001,0,!1,"RangeCatchUpActivityHighlightController.NavigateToRange: Range is null. Either the location list is empty or sheet is hidden.")}$pj(){if(oa.e(this.rna.kOb))return d.ULS.shipAssertTag(537167971,
0,!1,"RangeCatchUpActivityHighlightController.RetrieveRangeInformationForNavigation : SortedRanges is either null or empty."),null;var ba=this.$.xa.na;d.ULS.shipAssertTag(537167970,0,!!ba,"RangeCatchUpActivityHighlightController.RetrieveRangeInformationForNavigation : currentSheet is null.");ba=this.tVj(ba.sheetName,this.rna.kOb);if(!ba&&(ba=this.m7h(this.rna.kOb),!ba))return null;const cb={};cb.SheetName=ba.SheetName;cb.FirstColumn=ba.FirstColumn;cb.FirstRow=ba.FirstRow;cb.LastColumn=ba.FirstColumn;
cb.LastRow=ba.FirstRow;return cb}m7h(ba){if(oa.e(ba))return null;let cb=null;for(let lc=0;lc<ba.length;lc++){var Kb=ba[lc].SheetName;if(!ee.a.equals(Kb,cb,!1)&&(cb=Kb,Kb=this.$.xa.getItemByName(Kb),null===Kb||void 0===Kb?0:Kb.visible))return ba[lc]}return null}tVj(ba,cb){if(cb)for(const Kb of cb)if(ee.a.equals(Kb.SheetName,ba,!1))return Kb;return null}}Object(b.a)(ec,"RangeCatchUpActivityHighlightController",hd.a,[]);var Vc=a(78);class ud extends Vc.a{constructor(ba,cb,Kb,lc,Qc){super();this.$=ba;
this.u5d=cb;this.ssg=Kb;this.BC=lc;this.state=Qc?1:0}get type(){return this.BC}get activityId(){return this.u5d}get activityType(){return this.ssg}dispose(){this.u5d=null;super.dispose()}}Object(b.a)(ud,"CatchUpActivityHighlightModelBase",Vc.a,[]);class ke extends ud{constructor(ba,cb,Kb,lc,Qc,Rc){super(ba,cb,Kb,lc,Rc);this.ranges=Qc;this.v8a=!1}get kOb(){this.v8a||(this.ranges.sort(ke.$4b),this.v8a=!0);return this.ranges}addRange(ba){for(const cb of ba)this.ranges.push(cb)}dispose(){this.ranges=
null;super.dispose()}static $4b(ba,cb){if(!ba.SheetName||!cb.SheetName)return d.ULS.shipAssertTag(537167969,0,!1,"RangeCatchUpActivityHighlightModel.CompareSharedSheetRange : SheetName is null."),0;const Kb=ba.SheetName.localeCompare(cb.SheetName);return Kb?Kb:ba.FirstColumn<cb.FirstColumn||ba.FirstColumn===cb.FirstColumn&&ba.FirstRow<cb.FirstRow?-1:ba.FirstColumn===cb.FirstColumn&&ba.FirstRow===cb.FirstRow?0:1}}Object(b.a)(ke,"RangeCatchUpActivityHighlightModel",ud,[]);var te=a(343);class pe{constructor(){this.i4c=
[];this.fNb={};this.Hoe={}}dispose(){this.Hoe=this.fNb=this.i4c=null}sWf(ba,cb){cb?U.h(ba).qb.Tn([24]):U.h(ba).qb.Wg([24])}uch(ba,cb,Kb,lc){const Qc={};for(const zd of cb){if(!zd||oa.e(zd.LocationList))continue;cb=[];const ae={},ze=[];for(const Be of zd.LocationList){if(!Be){d.ULS.shipAssertTag(537168013,0,!1,"CatchUpActivityHighlightManagerHelper.CreateControllersAndHighlights - Location is Null for activityId : "+zd.Id);break}switch(Be.Type){case 0:var Rc=Be;let xe;"0"in ae?(xe=ae["0"],xe.CJg(Rc.RangeList)):
(xe=new ec(ba,new ke(ba,zd.Id,zd.Type,0,Rc.RangeList,lc),Kb),cb.push(xe),ae["0"]=xe);for(const Ce of Rc.RangeList){Rc=new te.a(Ra.D(Ce),Lb.d(ba.xa.getItemByName(Ce.SheetName)));if(this.ezc(Rc)in this.fNb)this.fNb[this.ezc(Rc)].push(xe);else{let ef=[];ef.push(xe);this.fNb[this.ezc(Rc)]=ef}ze.push(Rc);this.i4c.push(Rc)}break;default:d.ULS.sendTraceTag(537168012,0,10,"CatchUpHighlightControllersCreator.CreateControllersAndHighlights(): Failed.Invalid ActivityLocationType")}}d.ULS.shipAssertTag(537168011,
0,!(zd.Id in Qc),"CatchUpHighlightControllersCreator.CreateAndUpdateControllers - highlightControllers already has activity: "+zd.Id);this.Hoe[zd.Id]=ze;Qc[zd.Id]=cb}this.Odh(ba,this.i4c,this.fNb,lc);return Qc}g5g(ba){for(let cb in ba){const Kb=ba[cb];for(const lc of Kb)lc.Roj()}}ezc(ba){return`${ba.range}-${ba.sheetId}`}Odh(ba,cb,Kb,lc){this.g5g(Kb);U.h(ba).qb.nx(cb,[24],lc,(Qc,Rc)=>{var zd=new te.a(Qc.range,Qc.sheetId);zd=this.ezc(zd);const ae=Kb[zd];if(ae)for(const ze of ae)ze.sLg(Rc),Qc.metadata=
ze;else d.ULS.shipAssertTag(537168010,0,!1,"CatchUpHighlightControllersCreator.CreateHighlightsAndUpdateControllers(), Missing Controller for SheetRangeKey "+zd)})}}Object(b.a)(pe,"CatchUpHighlightControllersCreator",null,[]);class rf{constructor(){this.activityIds=this.container=this.target=null;this.isSticky=!1;this.dirHint=0;this.onHoverLeave=this.onHoverEnter=this.activityNavigationManager=null}}Object(b.a)(rf,"CreateIndicatorTooltipParameters",null,[]);class cf{constructor(){this.clearSticky=
!1}}Object(b.a)(cf,"DismissIndicatorTooltipParameters",null,[]);class wf{constructor(){this.target=null;this.isSticky=!1}}Object(b.a)(wf,"UpdateIndicatorTooltipParameters",null,[]);class Ge{constructor(ba,cb){this.$=ba;this.Th=cb}navigateToActivity(ba){if(ba.fromSummaryString)return ba=new O.a(1834994092,ac.a.Db,this.$.Hc,18,null),this.$.Ka.Lb(ba),this.jDa(1);ba=ba.activity;if(Y.EwaSettings.isChangeGateEnabled("OfficeVSO:6883957_InvokeEntryPointForClickingActivityIndicatorTooltip")&&ba&&1===ba.type){var cb=
new O.a(1834994092,ac.a.Db,this.$.Hc,30,null);this.$.Ka.Lb(cb,{["activityGuid"]:ba.activityId,["sheetName"]:ba.location.region,["gridLocation"]:ba.location.subregion[0]});return this.jDa(1)}if(!this.Fli(ba))return this.jDa(4);if(!this.dvi(ba))return this.jDa(7);const Kb={};try{cb=window.self.atob(ba.navigationId);if(!cb)return this.jDa(5);Kb.NavigationId=cb}catch(lc){return d.ULS.sendTraceTag(537168023,3012,10,`Exception thrown when trying to decode activity NavigationID: ${lc}`),this.jDa(5)}if(8===
this.Th.ae(vc.a.GJa,2,Kb))return this.Th.processAction(vc.a.A$a,2),this.jDa(2);ba=32===this.Th.ae(vc.a.u1a,2,Kb)?1:6;return this.jDa(ba)}Fli(ba){return ba&&ba.navigationId?!0:!1}dvi(ba){switch(ba.type){case 3:case 4:case 6:case 7:case 9:case 8:return!0;case 10:return Y.EwaSettings.isChangeGateEnabled("OfficeVSO:7212124_EnableTaskReplyNavigation")?!0:!1;default:return!1}}jDa(ba){return Promise.resolve(ba)}}Object(b.a)(Ge,"CatchUpActivityNavigationManager",null,[717]);class Ue{constructor(ba,cb){this.K5b=
this.sfa=null;this.Kdd=!1;this.uSa=null;this.Jka={};this.lEa=null;this.qmd=!1;this.kGb=(Kb,lc)=>{switch(lc.state){case 0:case 1:3===lc.gId&&(this.Kci(),this.uSa=null);break;case 2:break;case 3:this.q8c();this.uSa=lc.activityId;this.QHj();break;default:d.ULS.shipAssertTag(537168030,0,!1,"CatchUpActivityHighlightManager.OnHighlightStateChanged - Invalid CatchUpActivityHighlightState:"+lc.state)}};this.am=()=>{this.Btb()};this.Pc=()=>{this.Btb()};this.Mn=()=>{this.Btb()};this.rh=()=>{this.Btb()};this.f8f=
(Kb,lc)=>{this.sfa&&lc.VH!==this.Kka&&(lc.isSticky&&this.v8b(!0),(Kb=this.IVj(lc.VH))?(this.sfa.createActivityIndicatorTooltip(Object(X.a)(new rf,{target:lc.VH,container:Kb,activityIds:[lc.activityId],isSticky:lc.isSticky,dirHint:this.gridView.rtl?12:9,activityNavigationManager:Y.EwaSettings.isChangeGateEnabled("OfficeVSO:6883957_InvokeEntryPointForClickingActivityIndicatorTooltip")?this.y3b:void 0})),lc.isSticky?(this.Kka=lc.VH,d.ULS.sendTraceTag(51172352,0,50,"CatchUpActivityHighlightManager::ShowActivityFlyoutHandler: Activity Indicator Raising Selected/Unselected Event.")):
(this.Pfc=lc.VH,d.ULS.sendTraceTag(51172353,0,50,"CatchUpActivityHighlightManager::ShowActivityFlyoutHandler: Activity Indicator Raising Hover/Unhover Event.")),this.oic||(this.gridView.view.nt(this.vDc),this.gridView.mv(this.vDc),this.oic=!0)):d.ULS.shipAssertTag(537168027,0,!1,"CatchUpActivityHighlightManager::ShowActivityFlyoutHandler FlyoutContainer is null."))};this.XMe=(Kb,lc)=>{this.v8b(lc.Nnh)};this.vDc=()=>{this.sfa?(this.Kka&&this.sfa.updateActivityIndicatorTooltip(Object(X.a)(new wf,{target:this.Kka,
isSticky:!0})),this.Pfc&&this.sfa.updateActivityIndicatorTooltip(Object(X.a)(new wf,{target:this.Kka,isSticky:!1}))):d.ULS.shipAssertTag(537168024,0,!1,"CatchUpActivityHighlightManager::UpdateActivityFlyouts ActivityIndicatorTooltipManager is null.")};this.$=ba;this.gridView=U.h(this.$);this.ha=this.gridView.ha;this.Za=this.gridView.Vb;this.ha.Z_b(this.am);this.ha.kH(this.Pc);this.gridView.IC(this.Mn);this.Za.Xk(this.rh);this.Kka=this.Pfc=null;this.oic=!1;this.rdd={};this.y3b=new Ge(this.$,e.AFrameworkApplication.ub);
this.blueDotManager=cb}get Ioe(){return this.sfa}set Ioe(ba){this.sfa=ba}get excelCommentManager(){this.lEa||(this.lEa=this.$.da.za(65));return this.lEa}get J1a(){this.K5b||(this.K5b=new pe);return this.K5b}set J1a(ba){this.K5b=ba}dispose(){this.ha.Nuc(this.am);this.ha.mG(this.Pc);this.gridView.cE(this.Mn);this.Za.Fk(this.rh);this.eMe();this.rdd=this.Kka=this.Pfc=this.uSa=this.Za=this.ha=this.gridView=null}z2f(ba){const cb=this.ipb();this.eMe();if(!oa.e(ba)){d.ULS.sendTraceTag(537168035,0,50,"In CatchUpActivityHighlightManager:ProcessActivityPayloadHighlights().");
if(this.Jka=this.J1a.uch(this.$,ba,this,cb)){ba=this.Jka;for(let Kb in ba){const lc=ba[Kb];for(const Qc of lc)this.NTg(Qc)}}this.J1a.sWf(this.$,cb)}}MNb(){const ba=this.ipb();ba&&this.qmd?d.ULS.shipAssertTag(537168034,0,!1,"CatchUpActivityHighlightManager.ShowOrHideAllHighlights - Trying to show all highlights when marked as read"):(ba||this.Btb(),this.J1a.sWf(this.$,ba))}vdi(ba){if(this.ipb())if(this.Kka&&this.v8b(!0),this.q8c(),ba=this.Jka[ba.activityId])for(const cb of ba)cb.RLb(!0);else d.ULS.sendTraceTag(537168032,
0,50,"CatchUpActivityHighlightManager.OnSelectHighlight - Controllers not found during select")}Y3f(ba){if(this.Kdd!==ba){var cb=this.ipb();this.Kdd=ba;cb!==this.ipb()&&this.MNb()}}eMe(){if(this.Jka){const ba=this.Jka;for(let cb in ba){const Kb=ba[cb];for(const lc of Kb)this.Khj(lc),lc.dispose()}}this.Jka={};this.J1a.dispose();this.J1a=null}QHj(){if(this.excelCommentManager){var ba=this.Jka[this.uSa];ba&&0<ba.length&&3===ba[0].model.activityType&&((ba=ba[0])?this.excelCommentManager.uIj(ba.nSh()):
d.ULS.shipAssertTag(537168029,0,!1,"RangeCatchUpActivityHighlightController::ShowCommentFlyoutOnSelectedActivity RangeController is Null."))}}Kci(){this.excelCommentManager&&this.excelCommentManager.Bub()}q8c(){if(this.uSa){const ba=this.Jka[this.uSa];if(ba){for(const cb of ba)cb.RLb(!1);this.uSa=null}else d.ULS.sendTraceTag(537168028,0,50,"CatchUpActivityHighlightManager.DeselectCurrentlySelected - Controllers not found for deselection")}}Btb(){this.q8c();this.v8b(!0)}IVj(ba){if(!ba)return d.ULS.shipAssertTag(537168026,
0,!1,"CatchUpActivityHighlightManager::TryGetFlyoutContainer HighlightDot is null."),null;ba=`${ba.id}-${Na.a.c2g}`;let cb=this.rdd[ba];if(!cb){if(!this.gridView.domElement)return d.ULS.shipAssertTag(537168025,0,!1,"CatchUpActivityHighlightManager::TryGetFlyoutContainer gridView.DOMElement is null."),null;cb=document.createElement("Div");cb.className=nd.a.d2g;cb.id=ba;this.gridView.domElement.appendChild(cb);this.rdd[ba]=cb}return cb}v8b(ba){this.sfa&&(this.sfa.dismissActivityIndicatorTooltips(Object(X.a)(new cf,
{clearSticky:ba})),this.Pfc=null,ba&&(this.Kka=null),this.oic&&!this.Kka&&(this.gridView.view.ir(this.vDc),this.gridView.Oy(this.vDc),this.oic=!1))}NTg(ba){ba.$qe(this.kGb);ba.WLg(this.f8f);ba.VLg(this.XMe)}Khj(ba){ba.gVf(this.kGb);ba.Tij(this.f8f);ba.Sij(this.XMe)}ipb(){return this.blueDotManager&&this.blueDotManager.areInGridHighlightsEnabled()&&!this.Kdd}}Object(b.a)(Ue,"CatchUpActivityHighlightManager",null,[738,2]);var gb=a(444);class Ob{}Object(b.a)(Ob,"GetRelevantActivitiesDataRequest",null,
[]);class rc{constructor(){this.activityFeedItemId=this.activityId=null;this.type=0;this.collectionId=this.state=this.navigationId=this.relevancy=this.displayTimestamp=this.location=this.actors=null}}Object(b.a)(rc,"Activity",null,[]);class Oc{constructor(){this.collectionId=this.type=this.id=null;this.activityState=0;this.timestamp=this.activityFeedItemPayload=null}}Object(b.a)(Oc,"ActivityFeedItem",null,[]);class ld{constructor(){this.activityFeedItems=null}}Object(b.a)(ld,"ActivityFeedPayload",
null,[]);class Cd{constructor(){this.lowWaterline=this.highWaterline=this.wywaWaterline=this.actors=this.activities=null;this.hasMore=!1;this.isFirstDocumentOpen=null}}Object(b.a)(Cd,"ActivityRequestPayload",null,[]);class Qd{constructor(){this.color=this.imageUrl=this.email=this.givenName=this.displayName=this.provider=this.id=null}}Object(b.a)(Qd,"Person",null,[]);class re extends rc{constructor(){super();this.relationship=0}}Object(b.a)(re,"TaskActivity",rc,[]);const Ie=(ba,cb,Kb,lc,Qc,Rc=null)=>
{Rc=ba.Na(1,Rc);return ub.g(ba,"GetLineageWywaAuthors",Rc,cb,Kb,lc,Qc,4)},qf=(ba,cb,Kb,lc,Qc,Rc,zd=null)=>{zd=ba.Na(1,zd);zd.getRelevantActivitiesDataRequest=cb;return ub.g(ba,"GetRelevantActivitiesData",zd,Kb,lc,Qc,Rc,0)};class Pe{constructor(ba,cb,Kb=!1,lc=null){this.c2d=null;this.$=ba;this.z3b=cb;this.OHb=Ma.a.instance.resolve("Common.App.People.IPeopleColorUtils");this.kAa=Ma.a.instance.resolve("Common.App.People.IUserProfilePictureUtils");this.J7a=Kb;this.blueDotManager=lc}requestWYWAActivities(){return this.J7a?
new Promise((ba,cb)=>{Ie(this.$.pa.ya,Kb=>{var lc;const Qc=kb.a(Kb)?null:Kb.Result;Y.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.BlueDot",!1)?(Kb=null===(lc=null===Qc||void 0===Qc?void 0:Qc.WywaAuthors)||void 0===lc?void 0:lc.length,null!=Kb&&0<Kb?this.Dig(Rc=>{Rc={activities:Rc,actors:Qc?this.zdc(Qc.WywaAuthors):null,hasMore:!1,highWaterline:Pe.Mia,lowWaterline:Pe.Mia,wywaWaterline:Pe.Mia};ba(Rc)}):ba(Pe.utb)):(lc=Object(X.a)(new Cd,{activities:[],actors:Qc?this.zdc(Qc.WywaAuthors):
null,hasMore:!1,highWaterline:Pe.Mia,lowWaterline:Pe.Mia,wywaWaterline:Pe.Mia}),ba(lc))},()=>{d.ULS.sendTraceTag(537168022,0,10,"CatchUpActivityRequestManager::GetLineageWywaAuthors service call failed.");cb(null)},null,null)}):Promise.resolve(Pe.utb)}requestActivities(){return Promise.resolve(Pe.utb)}requestRelevantActivities(){if(!this.$.ea.Zb||this.$.ea.f6a)return d.ULS.sendTraceTag(537168021,3012,15,`CatchUpActivityRequestManager.RequestRelevantActivities: RequestRelevantActivities skipped [IsSessionActive: ${this.$.ea.Zb}, HasRaisedSessionEnded: ${this.$.ea.f6a}]`),
Promise.resolve(Pe.utb);const ba=Object(X.a)(new Ob,{SetDaysBack:e.AFrameworkApplication.fa.ud("AppWaterlineOverrideDaysValue",0),SetTimestamp:e.AFrameworkApplication.fa.ud("AppWaterlineOverrideTimestampValue",0)});return new Promise((cb,Kb)=>{qf(this.$.pa.ya,ba,lc=>{let Qc=Pe.utb;lc?kb.a(lc)?(lc=T.a.sc(lc.Errors),d.ULS.sendTraceTag(578353159,3012,10,`CatchUpActivityRequestManager::GetRelevantActivitiesData call returned errors codes: ${lc}`)):Qc=this.i2h(lc.Result):d.ULS.sendTraceTag(537168020,3012,
10,"CatchUpActivityRequestManager::GetRelevantActivitiesData call returned Null result.");cb(Qc)},lc=>{lc=Va.a.Oe(lc.data);lc=T.a.sc(lc);d.ULS.sendTraceTag(537168019,3012,10,`CatchUpActivityRequestManager::GetRelevantActivitiesData call has failed - Errors: [${lc}]`);Kb(null)},null,null)})}requestActivityFeed(){return sa.b(this.getActivityFeed()).then(ba=>Object(X.a)(new ld,{activityFeedItems:this.gUj(ba)}))}updateActivityState(ba){return Y.EwaSettings.ma(447)?Promise.resolve(!0):this.z3b?sa.b(this.z3b).then(cb=>
{var Kb,lc;return sa.b(cb.DYj(ba.itemIds,null!==(Kb=ba.activityStatesToSet)&&void 0!==Kb?Kb:0,null!==(lc=ba.activityStatesToReset)&&void 0!==lc?lc:0,ba.resetUnseenCount))}):Promise.resolve(!1)}getActivityFeed(){return this.z3b?Wd.a.gZd(this.z3b,ba=>ba.getActivityFeed(null)):I.Task.Ta([])}i2h(ba){if(!ba)return d.ULS.sendTraceTag(537168018,3012,10,"CatchUpActivityRequestManager::GetRelevantActivityRequestPayload response is null."),Object(X.a)(new Cd,{activities:[]});const cb=this.Reg(ba.NewActivities,
2);ba=this.Reg(ba.OutstandingActivities,3);for(const Kb of ba)cb.push(Kb);return Object(X.a)(new Cd,{activities:cb})}Reg(ba,cb=1){const Kb=[];if(!ba||!ba.length)return Kb;for(const lc of ba)lc?(ba=Pe.nUj(lc.Type),6===ba||7===ba||9===ba||8===ba?Kb.push(Object(X.a)(new re,{activityId:lc.Id,type:ba,displayTimestamp:new Date(lc.DisplayTimestamp),navigationId:lc.NavigationId,actors:this.zdc(lc.People),relevancy:cb,relationship:this.mUj(lc.Relationship)})):Kb.push(Object(X.a)(new rc,{activityId:lc.Id,type:ba,
displayTimestamp:new Date(lc.DisplayTimestamp),navigationId:lc.NavigationId,actors:this.zdc(lc.People),relevancy:cb}))):d.ULS.shipAssertTag(537168017,3012,!1,"CatchUpActivityRequestManager.TranslateRelevantActivitiesToActivities: relevantActivity is null");return Kb}mUj(ba){switch(ba){case 1:return 1;case 2:return 2;case 3:return 3}d.ULS.sendTraceTag(537168016,0,10,"Unexpected Relationship.");return 1}gUj(ba){const cb=[];for(const Kb of ba)ba=Object(X.a)(new Oc,{id:Kb.id,type:Kb.type,collectionId:Kb.collectionId,
activityState:Kb.activityState,activityFeedItemPayload:Kb.activityFeedItemPayload,timestamp:Kb.timestamp}),cb.push(ba);return cb}zdc(ba){const cb=[];if(!ba||!ba.length)return cb;for(const Kb of ba)Kb&&cb.push(this.uxb(Kb));return cb}uxb(ba){return Object(X.a)(new Qd,{id:ba.Id,provider:ba.Provider,displayName:ba.DisplayName,email:ba.Email,imageUrl:this.kAa.Zta(ba.Email,ba.Provider,e.AFrameworkApplication.Zi,0),color:this.OHb.Ojd(new gb.a(null,void 0,ba.DisplayName),6)})}static nUj(ba){switch(ba){case 1:return 3;
case 2:return 4;case 3:return 6;case 4:return 7;case 6:return 8;case 5:return 9;case 7:return 10;default:return d.ULS.shipAssertTag(537168015,3012,!1,"CatchUpActivityRequestManager.TranslateRelevantActivityTypeToActivityType: unknown RelevantActivityType"),1}}m9i(ba,cb){const Kb=ba.map(lc=>({activityId:lc.activityGuid,activityFeedItemId:null,type:1,actors:[{id:lc.author.id,provider:lc.author.provider,displayName:lc.author.displayName,givenName:null,email:lc.author.email,imageUrl:lc.author.imageUrl,
color:null}],location:{type:105,region:lc.sheetName,subregion:[lc.gridLocation]},displayTimestamp:lc.displayTimestamp,relevancy:null,navigationId:null,state:0,collectionId:null}));this.c2d=ba.map(lc=>{var Qc,Rc;const zd=null!==(Rc=null===(Qc=lc.rangeHighlightLocation)||void 0===Qc?void 0:Qc.rangeList.map(ae=>({Type:0,RangeList:[{SheetName:lc.sheetName,FirstRow:ae.firstRow,LastRow:ae.lastRow,FirstColumn:ae.firstCol,LastColumn:ae.lastCol}]})))&&void 0!==Rc?Rc:[];return{Id:lc.activityGuid,Type:null,
Person:null,DisplayTimestamp:null,LocationList:zd}});cb(Kb)}Dig(ba){this.blueDotManager?this.blueDotManager.NIj().then(cb=>{this.m9i(cb,ba)},()=>{}):d.ULS.shipAssertTag(509703879,3012,!1,"CatchUpActivityRequestManager.updateInGridBlueDots: Missing blue dot manager in blue dot method")}}Pe.Mia="<WywaWaterline>DefaultWaterline</WywaWaterline>";Pe.utb=Object(X.a)(new Cd,{activities:[],actors:[],hasMore:!1,highWaterline:Pe.Mia,lowWaterline:Pe.Mia,wywaWaterline:Pe.Mia});Object(b.a)(Pe,"CatchUpActivityRequestManager",
null,[718]);class of{constructor(ba){this.$=ba}shouldShowEmptyExperienceButton(){return this.$.ea.s9a?!0:!1}onButtonClick(){const ba={["InputMethod"]:ac.a.Db};this.$.Ka.Lb(new O.a(1834994092,ac.a.Db,this.$.Hc,16,null),ba)}onInviteOthersButtonClick(){const ba={["InputMethod"]:ac.a.Db};this.$.Ka.Lb(new O.a(869186573,ac.a.Db,this.$.Hc,16,null),ba)}getExplanationText(){const ba=this.$.da.za(365);return dc.a.instance.Ua(ba&&ba.isVisible?656:655)}getCommandName(){return dc.a.instance.ga(443)}}Object(b.a)(of,
"CatchUpEmptyExperienceBehaviorManager",null,[719]);const Hb=ba=>{window.performance&&"function"===typeof window.performance.mark&&window.performance.mark("CatchUpInit."+ba)};class mc{constructor(ba,cb=null){this.$=ba;this.flyoutRibbonButton=cb;ra.a(this.$).ai(this);this.hasFocus=!1}dispose(){ra.a(this.$).aA(this)}get mc(){return document.getElementById("catchUpFlyoutContainer")}get Ff(){return this.flyoutRibbonButton.Fif&&!this.hasFocus}get de(){return N.a.J1c}gg(ba,cb){if(cb)return!1;ba=document.getElementById("flyoutItem0");
if(!ba)return d.ULS.sendTraceTag(537168009,3012,10,"Could not find firstItem in flyout when setting up focus"),!1;ba.focus();this.Snh(ba);return!0}lh(ba){return this.mc?ea.DOMElementExtensions.xf(this.mc,ba):!1}sj(){this.hasFocus=!0}Wj(){this.hasFocus=!1}Snh(ba){if(Sys.Browser.agent===Sys.Browser.Firefox){var cb=document.createEvent("KeyboardEvent");cb.initKeyEvent(dd.a.Ob,!0,!0,window.self,!1,!1,!1,!1,oe.a.PEc,0);ba.dispatchEvent(cb)}else cb=document.createEvent("Events"),cb.initEvent(dd.a.Ob,!0,
!0),cb.keyCode=oe.a.PEc,cb.which=oe.a.PEc,ba.dispatchEvent(cb)}}Object(b.a)(mc,"FlyoutFocus",null,[39,2]);var Mc=a(420);class Rb{constructor(ba){this.buttonClickedCallback=null;this.kkb=this.HAb=!1;this.PJh=new Date;this.HYe=ba}dispose(){this.kkb=this.HAb=!1}registerButtonClickedEvent(ba){this.buttonClickedCallback&&d.ULS.sendTraceTag(537168008,3012,15,"RegisterButtonClickedEvent: Button clicked callback should only be registered once.");this.buttonClickedCallback=ba.buttonClickedCallback}onFlyoutInitialized(){this.HAb&&
d.ULS.sendTraceTag(537168007,3012,15,"OnFlyoutInitialized: Flyout should only be initialized once.");const ba=(new Date).getTime()-this.PJh.getTime();d.ULS.sendTraceTag(593601546,3012,50,`Time from retrieve activities to initialize Flyout: ${ba}`);m.c(vc.a.g2g,!0,m.e,0,0,ba);this.HAb=!0;Mc.a.GC&&Mc.a.GC.updateCommandUI(!0)}logFlightTriggers(){}toggleCatchUpFlyout(){this.HAb?this.buttonClickedCallback?this.buttonClickedCallback():d.ULS.sendTraceTag(537168005,3012,10,"ToggleCatchUpFlyout: User clicked the button before the buttonClickedCallback was registered."):
d.ULS.sendTraceTag(537168006,3012,10,"ToggleCatchUpFlyout: User clicked the button before the flyout was initialized.")}get Fif(){return this.kkb}onFlyoutVisibilityChanged(ba){this.kkb!==ba.flyoutIsVisible&&(this.kkb=ba.flyoutIsVisible,Mc.a.GC&&Mc.a.GC.updateCommandUI(!0),this.kkb||this.HYe&&this.HYe.MBi())}}Object(b.a)(Rb,"FlyoutRibbonButton",null,[737]);var xc=a(522);class ed{constructor(){this.flyoutAnchorTarget=this.useCompactSummaryString=this.disableDismissOnClick=this.customDynamicEntryPointEnabled=
this.dynamicEntryPointEnabled=this.activityFeedDataEnabled=this.includeRelevantAuthorsInSummaryString=this.summaryStringEnabled=this.flyoutEnabled=this.featuredActivityGroupsEnabled=null}}Object(b.a)(ed,"CatchUpConfiguration",null,[]);class xd{constructor(){this.emptyCatchUpBehaviorManager=this.ulsLogger=this.uiCulture=this.flyoutRibbonButton=this.flyoutFocus=this.dataCulture=this.changeSummariesDataProvider=this.appColorUpdateIsEnabled=this.activityRequestManager=this.activityNavigationManager=this.activityContentManager=
null}}Object(b.a)(xd,"SharedControllerFactoryParameters",null,[]);class yd{constructor(ba,cb,Kb=null,lc=null,Qc=null){this.aIa=null;this.taf=!1;this.yf=()=>{this.aia.Y3f(!0);this.Zqb.Dig(()=>{this.aia.z2f(this.Zqb.c2d);this.aia.Y3f(!1)})};this.SJf=Rc=>{Y.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.BlueDot",!1)&&!Pa.a.ph(Rc.wywaActivities)&&2!==Rc.wywaActivities[0].type&&(this.aia.z2f(this.Zqb.c2d),this.showHideInGridHighlights(),this.aia.vdi(Rc.wywaActivities[0]),this.$.ea.mu(this.yf))};
this.$=ba;this.blueDotManager=Qc;this.aia=new Ue(this.$,this.blueDotManager);this.d7d=new Zc(e.AFrameworkApplication.ub,Y.EwaSettings.ma(447));ba=tb.a.MSj(Ma.a.instance.Ub("Common.App.CatchUpActivity.ICatchUpRequestHandler"));this.Upf=lc;this.Zqb=new Pe(this.$,ba,this.J7a(),this.blueDotManager);this.y3b=new Ge(this.$,e.AFrameworkApplication.ub);this.emptyCatchUpBehaviorManager=new of(this.$);this.uAi(Rc=>{this.HOi(Rc)},cb);this.tCi();cb=null;Kb||(cb=Ma.a.instance.resolve("Common.App.CatchUpActivity.FloodgateEventLogger"));
this.flyoutRibbonButton=Kb||new Rb(cb);this.flyoutFocus=new mc(this.$,this.flyoutRibbonButton)}get Ugf(){const ba=this.flyoutRibbonButton.HAb;ba&&!this.taf&&(d.ULS.sendTraceTag(588129368,3012,50,"Catch Up Flyout is ready and button is enabled."),this.taf=!0);return ba}get Rmi(){return this.flyoutRibbonButton.Fif}dispose(){this.aIa&&this.aIa.getWywaEvent().removeListener(this.SJf);this.aIa=this.$=null;Ib.a.Ia(this.aia);this.flyoutRibbonButton=this.flyoutFocus=this.d7d=this.y3b=this.Zqb=this.aia=null;
this.$.ea.Ov(this.yf)}u0i(){this.flyoutRibbonButton.toggleCatchUpFlyout();return!0}showHideInGridHighlights(){this.aia.MNb()}tCi(){d.ULS.sendTraceTag(589608192,3012,50,"Catch Up script is loaded and Flyout is enabled.");this.pgf()&&d.ULS.sendTraceTag(526718752,3012,50,"ActivityFeedData is enabled")}uAi(ba,cb){Hb("ScriptDownload");y.TaskExtensions.Aa(A.GetServiceTaskFactory.Oa(this.$.da,283,284,cb),Kb=>{ba(sa.c(Kb.result.pn.loadScript("catchUpActivity")))},this.$.da.la,3)}J7a(){return!!this.Upf&&this.Upf.J7a()&&
this.$.ea.s9a}pgf(){return Y.EwaSettings.getBooleanFeatureGate("Microsoft.Office.SharedOnline.ActivityFeedIsEnabled",!1)}HOi(ba){y.TaskExtensions.Aa(ba,()=>{aa.a(()=>{this.aIa=catchUpActivity.FactoryGlobal.getExcelCatchUpAppInstance(Object(X.a)(new xd,{activityContentManager:Object(Yb.a)(716,this.d7d),activityNavigationManager:Object(Yb.a)(717,this.y3b),activityRequestManager:Object(Yb.a)(718,this.Zqb),dataCulture:this.$.va.DataCultureTag,flyoutFocus:null,flyoutRibbonButton:Object(Yb.a)(Rb,this.flyoutRibbonButton),
uiCulture:this.$.va.UICultureTag,ulsLogger:new C.a,emptyCatchUpBehaviorManager:Object(Yb.a)(719,this.emptyCatchUpBehaviorManager)}))});this.aia.Ioe=this.aIa.getActivityIndicatorTooltipManager();xc.a(this.$);this.aIa.getWywaEvent().addListener(this.SJf);Hb("InitializeCatchUpApp");this.aIa.initialize(Object(X.a)(new ed,{featuredActivityGroupsEnabled:!1,summaryStringEnabled:this.J7a(),includeRelevantAuthorsInSummaryString:!1,useCompactSummaryString:!0,activityFeedDataEnabled:this.pgf()}))},this.$.la,
3)}}Object(b.a)(yd,"CatchUpActivityManager",null,[720,2]);class Zd extends f.a{constructor(ba){super();this.$=ba;this.Fb()}create(){let ba=Y.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.BlueDot",!1)?A.GetServiceTaskFactory.Oa(this.$.da,501,500,1):I.Task.Ta(null),cb=A.GetServiceTaskFactory.Oa(this.$.da,458,459,this.Ya);y.TaskExtensions.Aa(y.TaskExtensions.Fd([ba,cb],this.$.la),()=>{const Kb=cb.result,lc=ba.result,Qc=Object(bb.a)(this.$.da,286,()=>new yd(this.$,this.Ya,null,Kb,lc));this.ob(Qc)},
this.$.la,3)}static ka(ba){ba.da.Ga(287,new Zd(ba))}}Object(b.a)(Zd,"CatchUpActivityManagerFactory",f.a,[]);var me=a(235),wb=a(157),$b=a(163),uc=a(283);class Pc{constructor(ba,cb){this.blueDotSettings=0;this.areInGridHighlightsAvailable=()=>!0;this.areInGridHighlightsEnabled=()=>0===(this.blueDotSettings&1);this.lzj=Kb=>{d.ULS.sendTraceTag(509732679,0,50,"User toggled in grid highlights, new value {0}.",Kb);this.blueDotSettings=Kb?0:1;Kb=new O.a(950288339,0,2,12,null);this.$.Ka.Lb(Kb,{});this.D5j()};
this.$=ba;this.blueDotSettings=cb;this.kAa=Ma.a.instance.resolve("Common.App.People.IUserProfilePictureUtils")}dispose(){this.$=null}NIj(){return Object($b.a)(this,void 0,void 0,function*(){return new Promise(ba=>{d.ULS.sendTraceTag(512234945,0,50,"BlueDotManager::showInGridBlueDots");ta.b(this.$).Gd(ib.a.lineageLoadInGridBlueDots,{});const cb=lc=>{lc=Va.a.Oe(lc.data);d.ULS.sendTraceTag(512234944,0,50,`BlueDotManager::LineageLoadInGridBlueDots service call failed. Errors: [${T.a.sc(lc)}]`)},Kb=lc=>
{if(lc=kb.a(lc)?null:lc.Result){var Qc={["CountOfActivities"]:lc.ActivityList.length};ta.b(this.$).Gd(ib.a.cAi,Qc);lc=db(lc.ActivityList,this.kAa);ba(lc)}else d.ULS.shipAssertTag(512234914,0,!!lc,"BlueDotManager LineageLoadInGridBlueDots returned null response.")};this.$.userOperationManager.Kc(new ya.a(1024,0,(lc,Qc,Rc)=>fc(this.$.pa.ya,Sa.b(lc,Kb),Sa.a(Qc,cb),Rc,null),80),null)})})}D5j(){Y.EwaSettings.isChangeGateEnabled("OfficeVSO:7146345_bluedotroamingsetting")&&!Y.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.Test.BlueDotSkipRoamingCall",
!1)&&uc.C(this.$.pa.ya,4,this.blueDotSettings.toString(),ba=>{T.a.Zf(ba.Errors)?d.ULS.sendTraceTag(509732678,0,10,`BlueDotManager.writeBlueDotSettingsToRoamingService: encountered an error. Errors: ${T.a.sc(ba.Errors)}`):ba.Result||d.ULS.sendTraceTag(509732677,0,10,"BlueDotManager.writeBlueDotSettingsToRoamingService failed to write to roaming service.")},(ba,cb,Kb)=>{ba=Va.a.Oe(ba.data);d.ULS.sendTraceTag(509732676,0,10,`BlueDotManager.writeBlueDotSettingsToRoamingService: Encountered errors for ${Kb}. Errors: ${T.a.sc(ba)}.`)},
null,null)}}Object(b.a)(Pc,"BlueDotManager",null,[688,2]);class Ad extends f.a{constructor(ba){super();this.Vbc=null;this.ISi=cb=>{cb=Va.a.Oe(cb.data);d.ULS.sendTraceTag(509732673,0,10,`LineageBlueDotFactory: Encountered errors while reading roaming setting. Errors: ${T.a.sc(cb)}.`)};this.$=ba;this.Fb()}create(){this.Vbc||(this.Vbc=this.lQh());this.Vbc.continueWith(()=>{this.ob(Object(bb.a)(this.$.da,501,()=>new Pc(this.$,this.Vbc.result)))})}static ka(ba){ba.da.Ga(500,new Ad(ba))}lQh(){if(Y.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.Test.BlueDotSkipRoamingCall",
!1))return me.a.Ta(0);let ba=new wb.a;Object(uc.w)(this.$.pa.ya,4,cb=>{this.JSi(cb,ba)},cb=>{this.ISi(cb);ba.setResult(1)},null,null);return ba.task}JSi(ba,cb){T.a.Zf(ba.Errors)?(d.ULS.sendTraceTag(509732675,0,10,`LineageBlueDotFactory encountered an error while reading roaming setting. Errors: ${T.a.sc(ba.Errors)}`),cb.setResult(1)):null==ba.Result?cb.setResult(0):(ba=parseInt(ba.Result,10),d.ULS.sendTraceTag(509732674,0,50,`LineageBlueDotFactory read roaming setting. Value: ${ba}`),cb.setResult(ba))}}
Object(b.a)(Ad,"BlueDotManagerFactory",f.a,[]);Type.registerNamespace("Microsoft.Office.Excel.WebUI.Client");Type.registerNamespace("Microsoft.Office.Excel.WebUI.Client.Lineage");Type.registerNamespace("Microsoft.Office.Excel.WebUI.Client.VersionHistory");Type.registerNamespace("_Ewa");c.a.Fa(sb.ka);c.a.Fa(lb.ka);c.a.Fa(n.ka);c.a.Fa(z.ka);Fa.a.Mi('.LineageActivityPane{height:100%;display:flex;flex-direction:column;overflow:hidden;background-color:#edebe9}.LineageActivityPaneHeader{display:flex;flex-direction:row;position:relative;overflow:hidden;padding-right:16px;padding-left:16px;padding-top:16px;padding-bottom:11px;height:auto;background-color:#edebe9}.LineageActivityPaneTitle{max-width:240px;display:inline-flex;font-weight:bold;font-family:"Segoe UI Semi Bold","Segoe UI Web",Arial,Verdana,sans-serif;font-size:16px;line-height:16px;flex-grow:1;align-content:center;height:auto;text-overflow:ellipsis;overflow:hidden;background-color:#edebe9;margin:0}.LineageActivityCloseButton{display:inline-flex;align-self:center}.LineageActivityBody{height:100%;padding-left:16px;overflow:hidden;background-color:#edebe9}');
(()=>{c.a.Fa(ba=>{id.ka(ba);Vb.ka(ba);fb.ka(ba);Gd.ka(ba);za.ka(ba)})})();Type.registerNamespace("Common.App.CatchUpActivity");$a.main();(()=>{c.a.Fa(ba=>{Hb("Begin");Zd.ka(ba);Da.ka(ba)})})();(()=>{c.a.Fa(ba=>{Ad.ka(ba)})})()},983:function(u,D,a){a.d(D,"a",function(){return e});u=a(0);var c=a(164);D=a(1239);var b=a(760);class e extends D.a{constructor(f,d){super(f,d);d!==b.a.v$&&this.CGa(d);this.fha(e.iterateNext);this.fha(e.fya);this.qWc(c.a.tVa);this.qWc(c.a.uVa)}}e.iterateNext="IterateNext";e.fya=
"IteratePrevious";e.xPb="ToggleShowChanges";e.setCurrentChangeCount="SetCurrentChangeCount";e.setTotalChangesCount="SetTotalChangesCount";e.$Pa="OnVHDiffReady";Object(u.a)(e,"VersionHistoryMessenger",D.a,[])}}]);

//# sourceMappingURL=https://artifacts.dev.azure.com/office/_apis/symbol/symsrv/EwaDSEsNext.catchup.js.map/bea984a5db22d0cbb1bc7bc22c20fc08/EwaDSEsNext.catchup.js.map